{"meta":{"title":"WgCg Blog","subtitle":"Keep Learning and Never Give Up","description":"WgCgã€Cong.Wangã€WangCongã€Vueã€Webpackã€HTMLã€CSSã€JS","author":"Cong.Wang","url":"http://yoursite.com"},"pages":[{"title":"æ‰€æœ‰åˆ†ç±»","date":"2019-01-26T02:26:44.100Z","updated":"2019-01-26T02:26:44.100Z","comments":true,"path":"categories/index.html","permalink":"http://yoursite.com/categories/index.html","excerpt":"","text":""},{"title":"å…³äºæˆ‘","date":"2019-01-26T02:33:41.907Z","updated":"2019-01-26T02:33:41.907Z","comments":true,"path":"about/index.html","permalink":"http://yoursite.com/about/index.html","excerpt":"","text":""},{"title":"æ—¥ç¨‹å®‰æ’","date":"2019-01-26T02:35:23.254Z","updated":"2019-01-26T02:35:23.254Z","comments":true,"path":"schedule/index.html","permalink":"http://yoursite.com/schedule/index.html","excerpt":"","text":""},{"title":"æ‰€æœ‰æ ‡ç­¾","date":"2019-01-26T02:31:18.099Z","updated":"2019-01-26T02:31:18.099Z","comments":true,"path":"tags/index.html","permalink":"http://yoursite.com/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"Velocityè¯­æ³•","slug":"Velocityè¯­æ³•","date":"2019-03-12T05:55:09.000Z","updated":"2019-03-12T07:18:12.244Z","comments":true,"path":"2019/03/12/Velocityè¯­æ³•.html","link":"","permalink":"http://yoursite.com/2019/03/12/Velocityè¯­æ³•.html","excerpt":"","text":"VelocityåŸºæœ¬è¯­æ³•ä»‹ç»åˆ¤æ–­è¯­å¥1234567#if($condition) ...#elseif($condition) ...#else ...#end è¿ç®—ç¬¦ æ¯”è¾ƒç¬¦ï¼š== != &gt; &gt;= &lt; &lt;= é€»è¾‘è¿ç®—ç¬¦ï¼š&amp;&amp; || ! è¿ç®—ç¬¦ï¼š+ - * / % å¸¸ç”¨åˆ¤æ–­ åˆ¤æ–­æ˜¯å¦ä¸ºnull #if(( !$condition) &amp;&amp; (â€œ$!conditionâ€ == â€œâ€) ) ä½¿ç”¨NULLå·¥å…·ï¼š#if( $null.isNull($condition) ) ä½¿ç”¨#ifnull() æˆ– #ifnotnull()ï¼Œè¦ä½¿ç”¨è¿™ä¸ªç‰¹æ€§å¿…é¡»åœ¨velocity.propertiesæ–‡ä»¶ä¸­åŠ å…¥ï¼š 12userdirective = org.apache.velocity.tools.generic.directive.Ifnulluserdirective = org.apache.velocity.tools.generic.directive.Ifnotnull åˆ¤æ–­æ˜¯å¦ä¸ºtrueï¼š#if( $condition == true ) åˆ¤æ–­æ˜¯å¦ä¸ºnullæˆ–falseï¼š#if( !$condition ) åˆ¤æ–­æ˜¯å¦ä¸ºç©ºå­—ç¬¦ä¸²ï¼š#if( $condition == â€œâ€ ) åˆ¤æ–­æ˜¯å¦ä¸ºnullæˆ–è€…ç©ºå­—ç¬¦ä¸²ï¼š#if( â€œ$!conditionâ€ === â€œâ€ ) åˆ¤æ–­æ˜¯å¦æ˜¯ä¸€ä¸ªæ•°å­—ï¼š#if( $condition == 123 ) Velocityä¸­çš„==å¯ä»¥ç›´æ¥æ¯”è¾ƒæ•°å€¼ï¼Œå­—ç¬¦ä¸²ä»¥åŠå…¶å®ƒå¯¹è±¡ï¼Œå¦‚æœ==ä¸¤ä¾§çš„å¯¹è±¡æ˜¯ä¸åŒçš„ç±»çš„å¯¹è±¡ï¼Œåœ¨æ¯”è¾ƒå‰ä¼šç”¨toString()è½¬æ¢åå†æ¯”è¾ƒã€‚æ‰€ä»¥å½“$conditionçš„å€¼ä¸º123æˆ–â€123â€æ—¶ï¼Œæ¡ä»¶éƒ½ä¸ºçœŸ å¾ªç¯è¯­å¥123#foreach($val in $arr)...#end $velocityCountå’Œ$foreach.countå¯ä»¥è·å¾—å½“å‰å¾ªç¯æ¬¡æ•°ï¼Œåˆå§‹å€¼ä¸º1 $foreach.hasNextç”¨æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ä¸‹ä¸€æ¬¡å¾ªç¯ #breakç”¨äºç”¨äºè·³å‡ºå¾ªç¯ï¼Œç»æµ‹è¯•ï¼Œåœ¨jelloæ¡†æ¶é‡Œæ— æ•ˆ å½“$arrä¸ºå¯¹è±¡çš„æ—¶å€™ï¼š$valå–åˆ°çš„æ˜¯valueï¼Œå¦‚æœéœ€è¦åœ¨éå†å¯¹è±¡çš„è¿‡ç¨‹ä¸­ï¼ŒåŒæ—¶å–åˆ°å¯¹è±¡çš„keysï¼Œå¯ä»¥ä½¿ç”¨entrySet() æˆ– keySet()æ–¹æ³• 1234567#foreach($item in $!obj.entrySet()) $!item.key: $!item.value#end#foreach($key in $!obj.keySet()) $key: $obj.get($key)#end æ³¨æ„ï¼šè¿™ç§é›†åˆçš„éå†æ˜¯æ— åºçš„ï¼Œå³éå†é¡ºåºå¯èƒ½ä¸åŒäº$objä¸­å…ƒç´ å®šä¹‰çš„é¡ºåº Range Operator1234567#foreach($foo in [1..5]) $foo#end#foreach($bar in [2..-2]) $bar#end ä»¥ä¸Šè¾“å‡ºä¸ºï¼š Example1ï¼š1 2 3 4 5Example2ï¼š2 1 0 -1 -2 Example2ï¼Œç»æµ‹è¯•ï¼Œåœ¨jelloæ¡†æ¶ä¸­ä¸èƒ½åŒ…å«è´Ÿæ•° å­—ç¬¦ä¸²$str.charAt(index) è·å–æŒ‡å®šä¸‹æ ‡çš„å­—ç¬¦ $str.substring(begin, end) endä¸å¡«ï¼Œæˆªå–beginåˆ°å­—ç¬¦ä¸²æœ«å°¾ï¼Œä¸æ”¹å˜åŸå€¼ $str.length() è¿”å›å­—ç¬¦ä¸²çš„é•¿åº¦ $str.toUpperCase() æŠŠå­—ç¬¦ä¸²è½¬æ¢ä¸ºå¤§å†™ $str.toLowerCase() æŠŠå­—ç¬¦ä¸²è½¬æ¢ä¸ºå°å†™ $str.replace(old, new) æ›¿æ¢å­—ç¬¦ä¸²ä¸­æŒ‡å®šçš„å­ä¸² $str.indexOf($substr) ä»å­—ç¬¦ä¸²å¤´éƒ¨å¼€å§‹æ£€ç´¢æ˜¯å¦å­˜åœ¨æŸä¸ªå­ä¸² $str.lastIndexOf($substr) ä»å­—ç¬¦ä¸²å°¾éƒ¨å¼€å§‹æ£€ç´¢æ˜¯å¦å­˜åœ¨æŸä¸ªå­ä¸² å­—ç¬¦ä¸²æ‹¼æ¥ï¼š$str + $str1 æˆ– ${str}oo${str1}ï¼š ä¾‹å¦‚ï¼š 12345#set($str = â€œAAâ€)#set($str1 = â€œBBâ€)#set($str2 = $str + $str1) åˆ™${str}oo${str1}çš„ç»“æœä¸ºï¼šAAooBB å­—ç¬¦ä¸²è½¬æ•°å­—ï¼š 12345#set( $intString = â€œ9â€ )#set( $Integer = 0 )$Integer.parseInt($intString) åŒç†ï¼š 12345#set( $doubleString = â€œ12.3â€ )#set( $Double = 0.0 )$Double.parseDouble( $doubleString ) æ•°ç»„$arr.size() è¿”å›æ•°ç»„é•¿åº¦ $arr.isEmpty() åˆ¤æ–­æ•°ç»„æ˜¯å¦ä¸ºç©º $arr.get(index)æˆ–$arr[index] è¿”å›æ•°ç»„ä¸­æŒ‡å®šä¸‹æ ‡indexçš„å€¼ $arr.set(1, â€œtestâ€) è®¾ç½®æ•°ç»„ä¸­æŒ‡å®šä¸‹æ ‡çš„å€¼ $arr.add($param) å¢åŠ å…ƒç´  å®å®çš„å®šä¹‰ï¼š#macro(å®çš„åç§° $å‚æ•°1 $å‚æ•°2) è¯­å¥ä½“ #end å®çš„è°ƒç”¨ï¼š#macro($å‚æ•°1 $å‚æ•°2)//å‚æ•°ä¹‹é—´ç”¨ç©ºæ ¼éš”å¼€ ä¾‹å­: 123456789#macro (tablerows $color $somelist) #foreach($something in $somelist) &lt;tr&gt;&lt;td bgColor=$color&gt;$something&lt;/td&gt;&lt;/tr&gt; #end#end è°ƒç”¨ï¼š 12345678#set($color = â€œblueâ€)#set($arr = [â€œaâ€, â€œbâ€, â€œcâ€, â€œdâ€])&lt;table&gt;#tablerows($color $arr)&lt;/table&gt; å‚è€ƒæ–‡æ¡£ http://www.blogjava.net/alexwan/archive/2008/06/07/206473.html http://velocity.apache.org/engine/devel/user-guide.html#variables http://wiki.apache.org/velocity/VelocityNullSupport http://wiki.apache.org/velocity/CheckingForNull","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"http://yoursite.com/categories/ç¼–ç¨‹è¯­è¨€/"},{"name":"Velocity","slug":"ç¼–ç¨‹è¯­è¨€/Velocity","permalink":"http://yoursite.com/categories/ç¼–ç¨‹è¯­è¨€/Velocity/"}],"tags":[{"name":"velocity","slug":"velocity","permalink":"http://yoursite.com/tags/velocity/"}]},{"title":"js-ç»§æ‰¿çš„5ç§æ–¹å¼","slug":"js-ç»§æ‰¿çš„5ç§æ–¹å¼","date":"2019-03-11T08:50:40.000Z","updated":"2019-03-11T10:25:56.134Z","comments":true,"path":"2019/03/11/js-ç»§æ‰¿çš„5ç§æ–¹å¼.html","link":"","permalink":"http://yoursite.com/2019/03/11/js-ç»§æ‰¿çš„5ç§æ–¹å¼.html","excerpt":"","text":"åŸå‹åŸºç¡€123456789function Animal (name) &#123; this.name = name&#125;Animal.prototype.say = function (something) &#123; console.log(`$&#123; this.name &#125; is say something`)&#125;const animal = new Animal('animal') å¾€åŸå‹ä¸Šå¢åŠ å±æ€§å’Œæ–¹æ³•çš„åŸå› ï¼šå¦‚æœæ‰€æœ‰å±æ€§å’Œæ–¹æ³•éƒ½æ·»åŠ åœ¨å®ä¾‹ä¸Šï¼Œé‚£ä¹ˆæ¯åˆ›å»ºä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œå…¶éƒ½æœ‰å¾ˆå¤šé‡å¤çš„å±æ€§å’Œæ–¹æ³•ï¼Œéœ€è¦è€—è´¹å¤§é‡çš„å†…å­˜ï¼Œä¸”é™ä½äº†è¿è¡Œæ•ˆç‡ æ„é€ å‡½æ•°Animalï¼Œå…¶åŸå‹é“¾ä¸ºï¼šAnimal =&gt; Animal.prototype =&gt; Objectçš„å®ä¾‹ =&gt; nullï¼ŒAnimal.prototype.proto.proto === null å®ä¾‹å¯¹è±¡çš„consturctorå±æ€§ï¼ˆå®é™…ä¸Šè¿™ä¸ªå±æ€§ä¸åœ¨å®ä¾‹å¯¹è±¡æœ¬èº«ä¸Šï¼Œè€Œæ˜¯åœ¨æ„é€ å‡½æ•°çš„åŸå‹ä¸Šï¼‰æŒ‡å‘æ„é€ å‡½æ•° prototypeå¯¹è±¡çš„isPrototypeOfæ–¹æ³•ç”¨æ¥åˆ¤æ–­æ˜¯å¦æ˜¯æŸä¸ªå¯¹è±¡çš„åŸå‹ å®ä¾‹å¯¹è±¡çš„hasOwnPropertyæ–¹æ³•åˆ¤æ–­æŸä¸ªå±æ€§æ˜¯å¦æ˜¯å®ä¾‹å¯¹è±¡æœ¬èº«çš„å±æ€§ inæ“ä½œç¬¦ç”¨äºåˆ¤æ–­æŸä¸ªå±æ€§æ˜¯å¦å­˜åœ¨äºå®ä¾‹å¯¹è±¡æˆ–å…¶åŸå‹ä¸Š instanceofç”¨äºåˆ¤æ–­æŸä¸ªå¯¹è±¡æ˜¯å¦æ˜¯æŸä¸ªæ„é€ å‡½æ•°çš„å®ä¾‹ animal.proto === A.prototype æ„é€ å‡½æ•°çš„5ç§ç»§æ‰¿æ–¹æ³•","categories":[{"name":"é¢è¯•é¢˜","slug":"é¢è¯•é¢˜","permalink":"http://yoursite.com/categories/é¢è¯•é¢˜/"},{"name":"js","slug":"é¢è¯•é¢˜/js","permalink":"http://yoursite.com/categories/é¢è¯•é¢˜/js/"}],"tags":[{"name":"js","slug":"js","permalink":"http://yoursite.com/tags/js/"},{"name":"ç»§æ‰¿","slug":"ç»§æ‰¿","permalink":"http://yoursite.com/tags/ç»§æ‰¿/"},{"name":"extends","slug":"extends","permalink":"http://yoursite.com/tags/extends/"}]},{"title":"TypeScriptç¬”è®°","slug":"TypeScriptç¬”è®°","date":"2019-03-09T07:43:06.000Z","updated":"2019-03-11T08:07:07.188Z","comments":true,"path":"2019/03/09/TypeScriptç¬”è®°.html","link":"","permalink":"http://yoursite.com/2019/03/09/TypeScriptç¬”è®°.html","excerpt":"","text":"TypeScriptå…¥é—¨æ•™ç¨‹ nullå’Œundefinedæ˜¯æ‰€æœ‰ç±»å‹çš„å­ç±»å‹ï¼Œä¹Ÿå°±è¯´nullå’Œundefinedç±»å‹çš„å˜é‡å¯ä»¥èµ‹å€¼ç»™ä»»æ„ç±»å‹çš„å˜é‡ï¼Œè€Œvoidç±»å‹çš„å˜é‡å´ä¸è¡Œã€‚ åœ¨anyç±»å‹çš„å˜é‡ä¸Šè®¿é—®ä»»ä½•å±æ€§æˆ–è€…è°ƒç”¨ä»»ä½•æ–¹æ³•éƒ½æ˜¯å…è®¸çš„ï¼Œå£°æ˜ä¸€ä¸ªå˜é‡ä¸ºanyåï¼Œå¯¹å®ƒçš„ä»»ä½•æ“ä½œï¼Œè¿”å›çš„å†…å®¹çš„ç±»å‹éƒ½æ˜¯ä»»æ„å€¼ã€‚ å˜é‡å¦‚æœåœ¨å£°æ˜çš„æ—¶å€™ï¼ŒæœªæŒ‡å®šå…¶ç±»å‹ï¼Œé‚£ä¹ˆå®ƒä¼šè¢«è¯†åˆ«ä¸ºanyç±»å‹ã€‚ å½“TypeScriptä¸ç¡®å®šä¸€ä¸ªè”åˆç±»å‹çš„å˜é‡æ˜¯å“ªä¸ªç±»å‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªèƒ½è®¿é—®æ­¤è”åˆç±»å‹çš„æ‰€æœ‰ç±»å‹é‡Œå…±æœ‰çš„å±æ€§å’Œæ–¹æ³•ã€‚ 12345function getLength(something: string | number): number &#123; return something.length;&#125;// index.ts(2,22): error TS2339: Property 'length' does not exist on type 'string | number'.// Property 'length' does not exist on type 'number'. èµ‹å€¼çš„æ—¶å€™ï¼Œå˜é‡çš„å½¢çŠ¶å¿…é¡»ä¸æ¥å£çš„å½¢çŠ¶ä¿æŒä¸€è‡´ã€‚ æ¥å£ä¸€æ—¦å®šä¹‰äº†ç´¢å¼•ç­¾åï¼Œé‚£ä¹ˆç¡®å®šå±æ€§å’Œå¯é€‰å±æ€§çš„ç±»å‹éƒ½å¿…é¡»æ˜¯å®ƒçš„ç±»å‹çš„å­é›†ã€‚ 123456interface Person &#123; name: string; age?: number; [propName: string]: string;&#125;// index.ts(3,5): error TS2411: Property 'age' of type 'number' is not assignable to string index type 'string'. åªè¯»å±æ€§çš„çº¦æŸå­˜åœ¨äºç¬¬ä¸€æ¬¡ç»™å¯¹è±¡èµ‹å€¼çš„æ—¶å€™ï¼Œè€Œä¸æ˜¯ç¬¬ä¸€æ¬¡ç»™åªè¯»å±æ€§èµ‹å€¼çš„æ—¶å€™ã€‚ 1234567891011121314151617interface Person &#123; readonly id: number; name: string; age?: number; [propName: string]: any;&#125;let tom: Person = &#123; name: 'Tom', gender: 'male'&#125;;tom.id = 89757;// index.ts(8,5): error TS2322: Type '&#123; name: string; gender: string; &#125;' is not assignable to type 'Person'.// Property 'id' is missing in type '&#123; name: string; gender: string; &#125;'.// index.ts(13,5): error TS2540: Cannot assign to 'id' because it is a constant or a read-only property. è°ƒç”¨å‡½æ•°æ—¶ï¼Œè¾“å…¥å¤šä½™çš„ï¼ˆæˆ–è€…å°‘äºè¦æ±‚çš„ï¼‰å‚æ•°ï¼Œæ˜¯ä¸è¢«å…è®¸çš„ï¼Œå¯ä»¥ä½¿ç”¨å¯é€‰å‚æ•°ã€‚ å¯é€‰å‚æ•°åé¢ä¸å…è®¸å†å‡ºç°å¿…é¡»å‚æ•°äº†ã€‚ TypeScriptä¼šå°†æ·»åŠ äº†é»˜è®¤å€¼çš„å‚æ•°è¯†åˆ«ä¸ºå¯é€‰å‚æ•°ï¼Œæ­¤æ—¶å°±ä¸å—ã€Œå¯é€‰å‚æ•°å¿…é¡»æ¥åœ¨å¿…éœ€å‚æ•°åé¢ã€çš„é™åˆ¶äº†ã€‚ å½“å‘ç”Ÿå‡½æ•°é‡è½½çš„æ—¶å€™ï¼ŒTypeScriptä¼šä¼˜å…ˆä»æœ€å‰é¢çš„å‡½æ•°å®šä¹‰å¼€å§‹åŒ¹é…ï¼Œæ‰€ä»¥å¤šä¸ªå‡½æ•°å®šä¹‰å¦‚æœæœ‰åŒ…å«å…³ç³»ï¼Œéœ€è¦ä¼˜å…ˆæŠŠç²¾ç¡®çš„å®šä¹‰å†™åœ¨å‰é¢ã€‚ ç±»å‹æ–­è¨€ä¸æ˜¯ç±»å‹è½¬æ¢ï¼Œæ–­è¨€æˆä¸€ä¸ªè”åˆç±»å‹ä¸­ä¸å­˜åœ¨çš„ç±»å‹æ˜¯ä¸å…è®¸çš„ã€‚ 123456function toBoolean(something: string | number): boolean &#123; return &lt;boolean&gt;something;&#125;// index.ts(2,10): error TS2352: Type 'string | number' cannot be converted to type 'boolean'.// Type 'number' is not comparable to type 'boolean'. declare var a ä¸ var açš„åŒºåˆ«åœ¨äºdeclareå¹¶æ²¡æœ‰å¯¹å˜é‡aè¿›è¡Œå£°æ˜ï¼Œåœ¨ç¼–è¯‘ç»“æœä¸­ä¼šè¢«åˆ é™¤ï¼Œè€Œvar aå£°æ˜äº†è¿™ä¸ªå˜é‡ã€‚ 1234567891011121314decalre var a // è¯´æ˜åœ¨æŸå¤„å·²ç»å£°æ˜è¿‡æ”¹å˜é‡a = 1 // å¯¹å˜é‡é‡æ–°è¿›è¡Œèµ‹å€¼// ä¸Šè¿°ä»£ç ç¼–è¯‘ç»“æœa = 1// -----------var aa = 1// ä¸Šè¿°ä»£ç ç¼–è¯‘ç»“æœvar aa = 1 åªæœ‰functionã€classå’Œinterfaceå¯ä»¥ç›´æ¥é»˜è®¤å¯¼å‡ºï¼Œå…¶å®ƒçš„å˜é‡éœ€è¦å…ˆå®šä¹‰å‡ºæ¥ï¼Œå†é»˜è®¤å¯¼å‡º 1234567export default enum Directions &#123;// ERROR: Expression expected. Up, Down, Left, Right&#125; å½“ä¸ºå…ƒç»„ç±»å‹çš„å˜é‡æ·»åŠ è¶Šç•Œçš„å…ƒç´ æ—¶ï¼Œå®ƒçš„ç±»å‹ä¼šè¢«é™åˆ¶ä¸ºå…ƒç»„æ¯ä¸ªç±»å‹çš„è”åˆç±»å‹ã€‚ æšä¸¾é¡¹æœ‰ä¸¤ç§ç±»å‹ï¼šå¸¸æ•°é¡¹å’Œè®¡ç®—æ‰€å¾—é¡¹ã€‚å¦‚æœç´§æ¥åœ¨è®¡ç®—æ‰€å¾—é¡¹åé¢çš„æ˜¯æœªæ‰‹åŠ¨èµ‹å€¼çš„é¡¹ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šå› ä¸ºæ— æ³•è·å¾—åˆå§‹å€¼è€ŒæŠ¥é”™ 1234enum Color &#123;Red = \"red\".length, Green, Blue&#125;;// index.ts(1,33): error TS1061: Enum member must have initializer.// index.ts(1,40): error TS1061: Enum member must have initializer. å¸¸æ•°æšä¸¾ä¸æ™®é€šæšä¸¾çš„åŒºåˆ«æ˜¯ï¼Œå®ƒä¼šåœ¨ç¼–è¯‘é˜¶æ®µè¢«åˆ é™¤ï¼Œå¹¶ä¸”ä¸èƒ½åŒ…å«è®¡ç®—æˆå‘˜ã€‚ 12345678910declare enum Directions &#123; Up, Down, Left, Right&#125;let directions = [Directions.Up, Directions.Down, Directions.Left, Directions.Right];// ä¸Šè¿°ä»£ç ç¼–è¯‘ä¸ºï¼švar directions = [0 /* Up */, 1 /* Down */, 2 /* Left */, 3 /* Right */];","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"http://yoursite.com/categories/ç¼–ç¨‹è¯­è¨€/"},{"name":"TypeScript","slug":"ç¼–ç¨‹è¯­è¨€/TypeScript","permalink":"http://yoursite.com/categories/ç¼–ç¨‹è¯­è¨€/TypeScript/"}],"tags":[{"name":"typescript","slug":"typescript","permalink":"http://yoursite.com/tags/typescript/"}]},{"title":"gitç»“åˆbeyond-compare","slug":"gitç»“åˆbeyond-compare","date":"2019-03-08T07:10:44.000Z","updated":"2019-03-08T07:14:00.514Z","comments":true,"path":"2019/03/08/gitç»“åˆbeyond-compare.html","link":"","permalink":"http://yoursite.com/2019/03/08/gitç»“åˆbeyond-compare.html","excerpt":"","text":"beyond compare æ— é™è¯•ç”¨for mac åº”ç”¨ç¨‹åº -&gt; beyond cmpareå³å‡»æ˜¾ç¤ºåŒ…å†…å®¹ -&gt; contents -&gt; macos åœ¨å½“å‰ç›®å½•ä¸‹æ–°å»ºæ–‡ä»¶BCompare.shï¼ŒæŠŠåŸæ¥çš„BCompareé‡å‘½åä¸ºBCompare.real ç¼–è¾‘BCompare.shï¼Œè¾“å…¥ä»¥ä¸‹ä»£ç : 123#!/bin/bashrm \"/Users/$(whoami)/Library/Application Support/Beyond Compare/registry.dat\"\"`dirname \"$0\"`\"/BCompare.real $@ å³å‡»BCompare.sh -&gt; æ˜¾ç¤ºç®€ä»‹ -&gt; åˆ é™¤æ–‡ä»¶ååç¼€.sh .gitconfigé…ç½®.gitconfigä½äºuserä¸‹, shift + comand + . æ˜¾ç¤ºéšè—æ–‡ä»¶ 12345678910111213141516[alias] dift = &quot;difftool --dir-diff --no-symlinks&quot;[diff] tool = bcomp[difftool] prompt = false[difftool &quot;bcomp&quot;] trustExitCode = true cmd = &quot;/usr/local/bin/bcomp&quot; \\&quot;$LOCAL\\&quot; \\&quot;$REMOTE\\&quot;[merge] tool = bcomp[mergetool] prompt = false[mergetool &quot;bcomp&quot;] trustExitCode = true cmd = &quot;/usr/local/bin/bcomp&quot; \\&quot;$LOCAL\\&quot; \\&quot;$REMOTE\\&quot; \\&quot;$BASE\\&quot; \\&quot;$MERGED\\&quot; git dift origin/devï¼šå½“å‰åˆ†æ”¯ä¸è¿œç¨‹devåˆ†æ”¯è¿›è¡Œæ¯”è¾ƒ","categories":[{"name":"å…¶å®ƒæŠ€æœ¯","slug":"å…¶å®ƒæŠ€æœ¯","permalink":"http://yoursite.com/categories/å…¶å®ƒæŠ€æœ¯/"},{"name":"git","slug":"å…¶å®ƒæŠ€æœ¯/git","permalink":"http://yoursite.com/categories/å…¶å®ƒæŠ€æœ¯/git/"}],"tags":[{"name":"git","slug":"git","permalink":"http://yoursite.com/tags/git/"},{"name":"beyond compare","slug":"beyond-compare","permalink":"http://yoursite.com/tags/beyond-compare/"}]},{"title":"Jekinsæ„å»ºç»“æœä¸æœ¬åœ°æ„å»ºç»“æœVueç‰ˆæœ¬ä¸åŒ","slug":"Jekinsæ„å»ºç»“æœä¸æœ¬åœ°æ„å»ºç»“æœVueç‰ˆæœ¬ä¸åŒ","date":"2019-03-08T07:00:30.000Z","updated":"2019-03-08T07:09:09.434Z","comments":true,"path":"2019/03/08/Jekinsæ„å»ºç»“æœä¸æœ¬åœ°æ„å»ºç»“æœVueç‰ˆæœ¬ä¸åŒ.html","link":"","permalink":"http://yoursite.com/2019/03/08/Jekinsæ„å»ºç»“æœä¸æœ¬åœ°æ„å»ºç»“æœVueç‰ˆæœ¬ä¸åŒ.html","excerpt":"","text":"èƒŒæ™¯é¡¹ç›®è¿ç§»åˆ°jenkinsï¼Œé€šè¿‡jenkinsè¿›è¡Œæ„å»ºï¼Œéƒ¨ç½²åå‘ç°é¡µé¢æŠ¥é”™ï¼Œä½†æ˜¯æœ¬åœ°æ„å»ºå‡ºæ¥ä»£ç éƒ¨ç½²åæ˜¯æ­£å¸¸çš„ï¼ŒæŠ¥é”™å¦‚ä¸‹ï¼š é—®é¢˜æ’æŸ¥è¿‡ç¨‹ æ³¨é‡Šwebpackæ’ä»¶UglifyJsPluginæ’ä»¶ï¼Œä¸è¿›è¡Œä»£ç å‹ç¼© å¯¹æ¯”æœ¬åœ°ä»£ç ä¸jenkinsæ„å»ºå‡ºæ¥çš„ä»£ç ï¼Œæ„å»ºè¾“å‡ºç›®å½•ç»“æ„å¦‚ä¸‹ï¼š å¯¹æ¯”ç»“æœ app.jsä¸­åªå­˜åœ¨ä¸€äº›å˜é‡åå’ŒPathçš„ä¸ä¸€è‡´ï¼Œä¸ä¼šäº§ç”Ÿé”™è¯¯ manifest.jså®Œå…¨ä¸€è‡´ vendor.jsä¸­Vueçš„ç‰ˆæœ¬ä¸ä¸€è‡´ï¼Œjenkinsæ„å»ºå‡ºæ¥çš„Vueç‰ˆæœ¬æ˜¯2.5.20ï¼Œæœ¬åœ°æ„å»ºå‡ºæ¥çš„Vueç‰ˆæœ¬æ˜¯2.5.21ï¼Œæ¨æµ‹æ˜¯ç”±æ­¤äº§ç”Ÿçš„é”™è¯¯ ç”¨æœ¬åœ°æ„å»ºå‡ºçš„vendor.jsæ›¿æ¢jenkinsæ„å»ºå‡ºçš„vendor.jsï¼Œéƒ¨ç½²åˆ°ftpä¸Šï¼Œå‘ç°é—®é¢˜è§£å†³äº†ï¼Œç¡®è®¤æ¨æµ‹æ˜¯æ­£ç¡®çš„ å¯¹æ¯”ä¸¤ä¸ªVueç‰ˆæœ¬ä»£ç çš„ä¸åŒï¼Œå‘ç°æ˜¯ä»¥ä¸‹ä»£ç å½±å“çš„ï¼š åˆ†æï¼šrendListæ˜¯v-forçš„å®ç°æ–¹æ³•ï¼Œåœ¨Vue2.5.20ä¸­ï¼Œå½“å…¥å‚valå±äºç±»å‹: Array, String, Number, Objectï¼ˆénullï¼‰æ—¶åˆå§‹åŒ–å˜é‡retä¸ºæ•°ç»„å¹¶è¿›è¡Œç›¸åº”çš„å¤„ç†ï¼Œç„¶ååˆ¤æ–­retå˜é‡ä¸ä¸ºundefinedå’Œnullæ—¶ï¼Œç»™retå˜é‡æ·»åŠ å±æ€§_isVListä¸ºtrueï¼Œç„¶åå°†retå˜é‡è¿”å›ï¼Œretçš„ç±»å‹å¯èƒ½ä¸ºundefined, Arrayï¼Œå½“è¿”å›undefinedæ—¶ï¼Œå¯¹undefinedè¿›è¡Œä¸€äº›æ•°ç»„çš„æ“ä½œå°±ä¼šå‘ç”Ÿé”™è¯¯ï¼Œè€Œæ§åˆ¶å°æ‰€æŠ¥çš„é”™è¯¯å°±æ˜¯å› ä¸ºå–äº†undefined.lengthå¯¼è‡´çš„ï¼Œåœ¨Vue2.5.21ç‰ˆæœ¬ä¿®å¤äº†è¿™ä¸ªBugï¼Œå¦‚æœretå˜é‡ä¸ºundefinedæˆ–nullæ—¶ï¼Œåˆå§‹åŒ–retä¸º[]ï¼Œè¿™æ ·ç¡®ä¿rendListçš„è¿”å›å€¼ç±»å‹å§‹ç»ˆä¸ºArray è§£å†³æ–¹æ³•ç”±ä¸Šå¯çŸ¥ï¼Œäº§ç”Ÿæ”¹é—®é¢˜çš„åŸå› å¦‚ä¸‹ï¼š ç›´æ¥åŸå› ï¼š Vue2.5.20ç‰ˆæœ¬ä¸­å­˜åœ¨ä»£ç æ¼æ´ æ ¹æœ¬åŸå› ï¼šjenkinsæœåŠ¡å™¨å®‰è£…çš„Vueç‰ˆæœ¬ä¸æ­£ç¡®ï¼Œè€Œä¸ºä»€ä¹ˆjenkinsæœåŠ¡å™¨å®‰è£…çš„vueç‰ˆæœ¬å’Œæœ¬åœ°å®‰è£…çš„ä¸ä¸€è‡´ï¼Œéœ€è¦è¿›ä¸€æ­¥æ’æŸ¥ï¼Œå·²ç»æ’é™¤æ˜¯nodeç‰ˆæœ¬å¯¼è‡´çš„åŸå›  å› æ­¤ï¼Œåªè¦æŠŠpackage.jsonä¸­vueä¾èµ–çš„ç‰ˆæœ¬å·å›ºå®šä¸º2.5.21ï¼ˆæ³¨æ„ï¼švue-template-compilerç‰ˆæœ¬éœ€è¦è·Ÿvueç‰ˆæœ¬ä¿æŒä¸€è‡´ï¼‰ï¼Œé—®é¢˜å°±å¯ä»¥è§£å†³äº†ï¼Œå¦‚ä¸‹å›¾ï¼š","categories":[{"name":"æ‰“åŒ…å·¥å…·","slug":"æ‰“åŒ…å·¥å…·","permalink":"http://yoursite.com/categories/æ‰“åŒ…å·¥å…·/"},{"name":"Webpack","slug":"æ‰“åŒ…å·¥å…·/Webpack","permalink":"http://yoursite.com/categories/æ‰“åŒ…å·¥å…·/Webpack/"},{"name":"é—®é¢˜ç§¯ç´¯","slug":"æ‰“åŒ…å·¥å…·/Webpack/é—®é¢˜ç§¯ç´¯","permalink":"http://yoursite.com/categories/æ‰“åŒ…å·¥å…·/Webpack/é—®é¢˜ç§¯ç´¯/"}],"tags":[{"name":"webpack","slug":"webpack","permalink":"http://yoursite.com/tags/webpack/"},{"name":"vue","slug":"vue","permalink":"http://yoursite.com/tags/vue/"}]},{"title":"åŠ¨æ€åŠ è½½æ¨¡å—","slug":"åŠ¨æ€åŠ è½½æ¨¡å—","date":"2019-03-08T06:59:10.000Z","updated":"2019-03-08T07:08:18.598Z","comments":true,"path":"2019/03/08/åŠ¨æ€åŠ è½½æ¨¡å—.html","link":"","permalink":"http://yoursite.com/2019/03/08/åŠ¨æ€åŠ è½½æ¨¡å—.html","excerpt":"","text":"èƒŒæ™¯é¡¹ç›®æœ¬åœ°å¼€å‘é€šè¿‡mockjsè¿›è¡Œæ•°æ®æ¨¡æ‹Ÿï¼Œå®ƒæ˜¯é€šè¿‡é‡å†™XMLHttpRequestå¯¹è±¡æ¥æ‹¦æˆªè¯·æ±‚ï¼Œä»è€Œè¾¾åˆ°çº¯å‰ç«¯mockï¼Œåœ¨webpackå…¥å£æ–‡ä»¶main.jsä¸­é€šè¿‡requireå¼•å…¥mockæ–‡ä»¶ï¼Œä»¥ä¸‹æ˜¯mockæ–‡ä»¶å’Œmain.jsçš„ä»£ç ï¼š mock file: main.js: Bugæè¿°ä¸Šçº¿åï¼Œå‘ç°åœ¨éƒ¨åˆ†androidæ‰‹æœºå’Œå°‘æ•°iosæ‰‹æœºä¸Šæ— æ³•åŠ è½½å‡ºé¡µé¢ é—®é¢˜æ’æŸ¥ é€šè¿‡æŠ“åŒ…æ’é™¤æ¥å£&amp;æ•°æ®é—®é¢˜ é¡µé¢æ³¨å…¥vConsoleå‘ç°æ§åˆ¶å°è¾“å‡ºè„šæœ¬é”™è¯¯ï¼Œæ— æ³•è¯†åˆ«constå…³é”®å­— åœ¨æ„å»ºå‡ºçš„jsä¸­å®šä½constå…³é”®å­—ï¼Œå¦‚ä¸‹å›¾ï¼š å¯ä»¥å¾—å‡ºé—®é¢˜è¡¨é¢åŸå› æ˜¯å› ä¸ºæŸäº›æœºå‹æµè§ˆå™¨ç‰ˆæœ¬è¾ƒä½ï¼Œæ— æ³•è¯†åˆ«ES6è¯­æ³• é—®é¢˜åˆ†æé€šè¿‡æŸ¥çœ‹æ„å»ºåçš„jsä¸åˆ†æå‘ç°äº†ä¸‰ä¸ªé—®é¢˜ï¼š constè¯­å¥æ˜¯å†™åœ¨mockæ–‡ä»¶ä¸­ï¼Œæ˜æ˜åœ¨main.jsä¸­æ ¹æ®ç¯å¢ƒå»require mockæ–‡ä»¶äº†ï¼Œä¸ºä½•mockæ–‡ä»¶è¿˜è¢«æ‰“åŒ…è¿›äº†é¡µé¢çš„jsä¸­ï¼Ÿ ä¸ºä½•è¯¥constè¯­æ³•æ²¡æœ‰ç»è¿‡babelè½¬è¯‘æˆES5è¯­æ³•ï¼Ÿ ä¸ºä½•æ‰“åŒ…å‡ºçš„jsæ²¡æœ‰è¿›è¡Œå‹ç¼©ï¼Ÿ é—®é¢˜ä¸€constè¯­å¥æ˜¯å†™åœ¨mockæ–‡ä»¶ä¸­ï¼Œæ˜æ˜åœ¨main.jsä¸­æ ¹æ®ç¯å¢ƒå»require mockæ–‡ä»¶äº†ï¼Œä¸ºä½•mockæ–‡ä»¶è¿˜è¢«æ‰“åŒ…è¿›äº†é¡µé¢çš„jsä¸­ï¼Ÿ webapckæ„å»ºè¿‡ç¨‹ï¼šwebpackåœ¨æ„å»ºçš„æ—¶å€™ï¼Œä¼šä»æ‰€æœ‰å…¥å£æ–‡ä»¶å¼€å§‹é€’å½’æŸ¥æ‰¾ä»£ç ä¸­çš„requireè¯­æ³•å’Œimportè¯­æ³•ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªä¾èµ–å›¾ï¼Œè¿™ä¸ªä¾èµ–å›¾åŒ…å«ç€åº”ç”¨ç¨‹åºæ‰€éœ€çš„æ¯ä¸ªæ¨¡å—ï¼Œç„¶åå°†æ‰€æœ‰è¿™äº›æ¨¡å—æ‰“åŒ…ä¸ºå°‘é‡çš„bundleï¼Œè€ŒåŠ¨æ€requireæ¨¡å—webpackä¹Ÿæ˜¯èƒ½å¤Ÿæ”¯æŒçš„ï¼Œä½†ä¼šå¯¼è‡´æ‰€æœ‰å¯èƒ½ç”¨åˆ°çš„æ¨¡å—éƒ½åŒ…å«åœ¨bundleä¸­ï¼ˆè¯¦è§ï¼‰ï¼Œå¦‚æœä»£ç ä¸­ä¾èµ–æ¡ä»¶è¡¨è¾¾å¼åŠ¨æ€requireæ¨¡å—ï¼Œç±»ä¼¼ä¸Šé¢çš„main.jsé‚£æ ·ï¼Œåˆä¸æƒ³æŠŠä¸éœ€è¦çš„æ¨¡å—æ‰“åŒ…åˆ°bundleä¸­ï¼Œéœ€è¦éµå¾ªä»¥ä¸‹è¦æ±‚ï¼š æ¡ä»¶è¡¨è¾¾å¼ä¸­ä¸å…è®¸å‡ºç°å˜é‡ æ¡ä»¶è¡¨è¾¾å¼ä¸å…è®¸æ‰§è¡Œå‡½æ•°è°ƒç”¨ åªèƒ½è¿›è¡Œä¸€äº›å¸¸é‡çš„è¿ç®—ï¼Œå¦‚ä¸‹ï¼š 12345678910111213141516171819// module.jsä¼šè¢«æ‰“åŒ…è¿›bundleif (1 + 1 === 2) &#123; require('./module.js')&#125;// module.jsä¼šè¢«æ‰“åŒ…è¿›bundleif (true) &#123; require('./module.js')&#125;// module.jsä¸ä¼šè¢«æ‰“åŒ…è¿›bundleif (1 &gt; 2) &#123; require('./module.js')&#125;// module.jsä¸ä¼šè¢«æ‰“åŒ…è¿›bundleif (1 !== 1) &#123; require('./module.js')&#125; webapcké›†æˆçš„DefinePluginæ’ä»¶å…è®¸åˆ›å»ºä¸€ä¸ªåœ¨ç¼–è¯‘æ—¶å¯ä»¥é…ç½®çš„å…¨å±€å¸¸é‡ï¼ˆè¯¦è§ï¼‰ é—®é¢˜1çš„åŸå› æ­£æ˜¯å› ä¸ºè¿èƒŒäº†ä¸Šè¿°åŸåˆ™2ï¼Œè°ƒç”¨äº†å­—ç¬¦ä¸²çš„matchå‡½æ•°ï¼Œè€Œæˆ‘ä»¬åœ¨webpacké…ç½®ä½¿ç”¨DefinePluginæ’ä»¶ï¼Œåˆ›å»ºäº†ä¸€ä¸ªå…¨å±€å¸¸é‡process.envï¼Œä»è€Œè§„é¿äº†åŸåˆ™1 12345678910111213// main.jsif (!process.env.NODE_ENV.match(/production|test/)) &#123; require('../mock/index')&#125;// webpacké…ç½®&#123; plugins: [ new webpack.DefinePlugin(&#123; 'process.env': env &#125;) ]&#125; å› æ­¤æˆ‘ä»¬å¯ä»¥æŠŠmain.jsæ–‡ä»¶ä¸­çš„ä»£ç æ”¹æˆä»¥ä¸‹å†…å®¹ï¼Œè¾¾åˆ°éå¼€å‘ç¯å¢ƒä¸æŠŠmockæ–‡ä»¶æ‰“åŒ…åˆ°bundleä¸­ 123if (process.env.NODE_ENV === 'development') &#123; require('../mock/index')&#125; é—®é¢˜äºŒä¸ºä½•è¯¥constè¯­æ³•æ²¡æœ‰ç»è¿‡babelè½¬è¯‘æˆES5è¯­æ³•ï¼Ÿ åŸå› æ˜¯åœ¨webpackçš„é…ç½®ä¸­ï¼Œé…ç½®äº†åªå¯¹srcï¼Œtestç›®å½•ä¸‹çš„æ–‡ä»¶æ‰§è¡Œbabelè½¬è¯‘ï¼ˆè¯¦è§ï¼‰ï¼Œè€Œmockæ–‡ä»¶ä¸åœ¨è¿™äº›ç›®å½•ä¸‹ï¼Œæ‰€ä»¥æ²¡æœ‰è¿›è¡Œè½¬è¯‘ é—®é¢˜ä¸‰ä¸ºä½•æ‰“åŒ…å‡ºçš„jsæ²¡æœ‰è¿›è¡Œå‹ç¼©ï¼Ÿ æˆ‘ä»¬å¯¹é¡¹ç›®è¿›è¡Œæ„å»ºï¼ŒUglifyJsWebpackPluginæ’ä»¶ä¼šæŠ¥å‡ºå¦‚ä¸‹é”™è¯¯ï¼š é”™è¯¯é—®é¢˜æŒ‡å‘çš„æ˜¯æ‰“åŒ…åçš„constè¯­æ³•ï¼ŒåŸå› æ˜¯å› ä¸ºUglifyJsWebpackPluginä¸æ”¯æŒES6è¯­æ³•ï¼Œæ‰€ä»¥åœ¨treeshakingçš„æ—¶å€™ï¼Œé‡åˆ°constè¯­æ³•ï¼Œå°±å‘ç”Ÿé”™è¯¯äº†ï¼Œç»ˆæ­¢äº†æ’ä»¶çš„æ‰§è¡Œï¼Œä»è€Œä¹Ÿæ— æ³•æ‰§è¡Œåç»­çš„å‹ç¼©æ­¥éª¤ï¼Œä½†è¿™å¹¶ä¸å½±å“å…¶å®ƒæ’ä»¶çš„åŠŸèƒ½ï¼Œwebpackä¹Ÿæ— æ³•æ„ŸçŸ¥åˆ°è¿™ä¸ªæ’ä»¶åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç°äº†é”™è¯¯ï¼Œæ‰€ä»¥æ„å»ºç»“æœä»ç„¶æ˜¯æˆåŠŸçš„ æ€»ç»“ è¿ç”¨æ¡ä»¶è¡¨è¾¾å¼åŠ¨æ€åŠ è½½æ¨¡å—ï¼Œé™¤éæ¡ä»¶è¡¨è¾¾å¼ä¸­ä¸å‡ºç°å˜é‡ã€å‡½æ•°è°ƒç”¨ï¼Œåªè¿›è¡Œä¸€äº›å¸¸é‡çš„è¿ç®—ï¼Œé‚£ä¹ˆæ¡ä»¶ä¸ºfalseçš„æ—¶å€™è¯¥æ¨¡å—æ˜¯ä¸ä¼šæ‰“åŒ…è¿›bundleä¸­çš„ï¼Œå¦åˆ™æ— è®ºæ¡ä»¶ä¸ºfalseè¿˜æ˜¯trueï¼Œå§‹ç»ˆä¼šæŠŠè¯¥æ¨¡å—æ‰“åŒ…è¿›bundleï¼Œåªä¸è¿‡åœ¨æ¡ä»¶ä¸ºfalseçš„æƒ…å†µä¸‹ä¸æ‰§è¡Œä»£ç ç½¢äº† å¯ä»¥è¿ç”¨DefinePluginæ·»åŠ è¿è¡Œæ—¶çš„å…¨å±€å¸¸é‡ å¯ä»¥é€šè¿‡é…ç½®babel-loaderçš„includeé€‰é¡¹å¯¹æŒ‡å®šæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶è¿›è¡Œè½¬è¯‘ UglifyJsWebpackPluginä¸æ”¯æŒES6è¯­æ³• webpackæ— æ³•æ„ŸçŸ¥æ’ä»¶è¿è¡Œè¿‡ç¨‹ä¸­å‡ºç°çš„é”™è¯¯ï¼Œéœ€è¦æ„å»ºå®Œæˆå¯¹æ„å»ºçš„ç»“æœè¿›è¡Œcheckï¼Œä¾‹å¦‚é€šè¿‡eslintå¯¹distæ–‡ä»¶è¿›è¡Œæ£€æŸ¥ï¼Œæ˜¯å¦æœ‰éES5çš„ä»£ç ","categories":[{"name":"æ‰“åŒ…å·¥å…·","slug":"æ‰“åŒ…å·¥å…·","permalink":"http://yoursite.com/categories/æ‰“åŒ…å·¥å…·/"},{"name":"Webpack","slug":"æ‰“åŒ…å·¥å…·/Webpack","permalink":"http://yoursite.com/categories/æ‰“åŒ…å·¥å…·/Webpack/"},{"name":"é—®é¢˜ç§¯ç´¯","slug":"æ‰“åŒ…å·¥å…·/Webpack/é—®é¢˜ç§¯ç´¯","permalink":"http://yoursite.com/categories/æ‰“åŒ…å·¥å…·/Webpack/é—®é¢˜ç§¯ç´¯/"}],"tags":[{"name":"webpack","slug":"webpack","permalink":"http://yoursite.com/tags/webpack/"}]},{"title":"æ»šåŠ¨ç©¿é€é—®é¢˜","slug":"æ»šåŠ¨ç©¿é€é—®é¢˜","date":"2019-03-08T06:52:10.000Z","updated":"2019-03-08T06:53:31.953Z","comments":true,"path":"2019/03/08/æ»šåŠ¨ç©¿é€é—®é¢˜.html","link":"","permalink":"http://yoursite.com/2019/03/08/æ»šåŠ¨ç©¿é€é—®é¢˜.html","excerpt":"","text":"ç›®çš„å½“é¡µé¢ä¸­æœ‰å¼¹å±‚æ—¶ï¼Œç¦æ­¢bodyçš„æ»šåŠ¨ è§£å†³æ–¹æ¡ˆ ç»™bodyæˆ–htmlå¢åŠ overflow: hidden pcç«¯ï¼šå¯è¡Œ iosï¼šä¸å¯è¡Œï¼Œä»ç„¶ä¼šæ»šåŠ¨ç©¿é€ï¼Œæ‰“å¼€å¼¹å±‚æ—¶é¡µé¢ä¸ä¼šæ»šåˆ°é¡¶éƒ¨ï¼Œé™¤ébodyæˆ–htmlé«˜åº¦ä¸ºå±å¹•é«˜åº¦ androidï¼šä¸å¯è¡Œï¼Œä»ç„¶ä¼šæ»šåŠ¨ç©¿é€ï¼Œæ‰“å¼€å¼¹å±‚æ—¶é¡µé¢ä¸ä¼šæ»šåˆ°é¡¶éƒ¨ï¼Œé™¤ébodyæˆ–htmlé«˜åº¦ä¸ºå±å¹•é«˜åº¦ maskå¢åŠ touchmove.preventï¼Œæ»šåŠ¨å…ƒç´ å¢åŠ prevent.stop pcç«¯ï¼šä¸å¯è¡Œï¼Œä»ç„¶ä¼šæ»šåŠ¨ç©¿é€ iosï¼šä¸å¯è¡Œï¼Œä»ç„¶ä¼šæ»šåŠ¨ç©¿é€ android: ä¸å¯è¡Œï¼Œä»ç„¶ä¼šæ»šåŠ¨ç©¿é€ ç»™bodyå¢åŠ fixedï¼Œæ‰“å¼€å¼¹å±‚æ—¶è®°å½•æ»šåŠ¨æ¡ä½ç½®ï¼Œå¼¹å±‚æ¶ˆå¤±æ—¶æ»šåŠ¨åˆ°è®°å½•ä½ç½® pcç«¯ï¼šå¯è¡Œ iosï¼šå½“ä½ ä»æ»šåŠ¨å®¹å™¨æ»‘åŠ¨åˆ°å®¹å™¨ä¹‹å¤–æ—¶ï¼Œæˆ–ä»åº•éƒ¨ä¸‹æ‹‰èµ·æ§åˆ¶ä¸­å¿ƒï¼Œä¼šå¯¼è‡´å®¹å™¨è¿›å…¥çŸ­æš‚çš„æ— æ³•æ»šåŠ¨çŠ¶æ€ï¼Œç­‰å¾…ä¸€æ®µæ—¶é—´åè‡ªåŠ¨æ¢å¤ï¼Œæ¨æµ‹æ˜¯iosçš„é¡µé¢å›å¼¹æ•ˆæœå½±å“çš„ android: å¯è¡Œ 12345.modal-open &#123; position: fixed; width: 100%; overflow: hidden;&#125; 12345678910111213141516const ModalHelper = (function (bodyCls) &#123; let scrollTop return &#123; // å¼¹å‡ºä¹‹åè®°å½•ä¿å­˜æ»šåŠ¨ä½ç½®ï¼Œå¹¶ä¸”ç»™bodyæ·»åŠ .modal-open afterOpen: function () &#123; scrollTop = document.scrollingElement.scrollTop document.body.classList.add(bodyCls) document.body.style.top = -scrollTop + 'px' &#125;, // å…³é—­æ—¶å°†.modal-openç§»é™¤å¹¶è¿˜åŸä¹‹å‰ä¿å­˜æ»šåŠ¨ä½ç½® beforeClose: function () &#123; document.body.classList.remove(bodyCls) document.scrollingElement.scrollTop = scrollTop &#125; &#125;;&#125;)('modal-open') ç›‘å¬æ»šåŠ¨å®¹å™¨çš„touchmoveäº‹ä»¶ï¼Œå½“æ£€æµ‹åˆ°å·²ç»å¤„äºæœ€åº•éƒ¨ï¼Œå´è¿˜æ„å›¾å¾€ä¸‹æ»šåŠ¨æ—¶ï¼Œé˜»æ­¢é»˜è®¤äº‹ä»¶ï¼ˆå¤„äºæœ€é¡¶éƒ¨æ—¶åŒç†ï¼‰ pcç«¯ï¼šä¸æ”¯æŒtouchäº‹ä»¶ iosï¼šå¯è¡Œï¼Œè§£å†³äº†é¡µé¢åå¼¹é—®é¢˜ android: ä¸å¯è¡Œï¼Œé˜»æ­¢é»˜è®¤äº‹ä»¶æ²¡ç”Ÿæ•ˆï¼Œä»ä¼šæ»šåŠ¨ç©¿é€ 12345678910111213141516171819202122232425262728293031323334353637383940// è®°å½•å¼€å§‹æ»‘åŠ¨çš„åæ ‡ï¼Œç”¨äºåˆ¤æ–­æ»‘åŠ¨æ–¹å‘let startY = 0// è®°å½•æ»‘åŠ¨çŠ¶æ€ï¼š0ï¼šæœªå¼€å§‹ï¼Œ1ï¼šå·²å¼€å§‹ï¼Œ2ï¼šæ»‘åŠ¨ä¸­let scrollStatus = 0// ä»¥ä¸‹æ‰€æœ‰äº‹ä»¶å‡ç»‘å®šåœ¨æ»šåŠ¨å®¹å™¨å…ƒç´ ä¸Šfunction touchstartHandler (e) &#123; status = 1 startY = e.targetTouches[0].pageY&#125;function touchmoveHandler (e) &#123; if (status !== 1) return status = 2 let t = e.currentTarget let py = e.targetTouches[0].pageY // å†…å®¹å¯è§†é«˜åº¦ let ch = t.clientHeight // å†…å®¹æ»šåŠ¨é«˜åº¦ let sh = t.scrollHeight // å½“å‰æ»šåŠ¨é«˜åº¦ let st = t.scrollTop // å·²ç»åˆ°å¤´éƒ¨å°½å¤´äº†è¿˜è¦å‘ä¸Šæ»‘åŠ¨ï¼Œé˜»æ­¢å®ƒ if (st === 0 &amp;&amp; startY &lt; py) &#123; e.preventDefault() &#125; // å·²ç»åˆ°ä½éƒ¨å°½å¤´äº†è¿˜è¦å‘ä¸‹æ»‘åŠ¨ï¼Œé˜»æ­¢å®ƒ if ((st === sh - ch) &amp;&amp; startY &gt; py) &#123; e.preventDefault() &#125;&#125;function touchendHandler (e) &#123; status = 0&#125; ä¸ç”¨è‡ªå¸¦æ»šåŠ¨æ¡ï¼Œä½¿ç”¨transform+overflow:hiddenï¼Œç›‘å¬touchmoveäº‹ä»¶è‡ªå®ç°æ»šåŠ¨æ•ˆæœ æ€»ç»“é’ˆå¯¹ç½‘é¡µéœ€è¦é€‚é…çš„ç«¯çš„ä¸åŒï¼Œå¯é‡‡ç”¨ä¸åŒçš„è§£å†³æ–¹æ¡ˆï¼š PCç«¯ï¼š ä¸Šè¿°1ã€3 ç§»åŠ¨ç«¯ï¼šç”±ä¸Šå¯è§ï¼Œå•ç‹¬çš„ä»»ä½•ä¸€ç§æ–¹æ³•éƒ½æ— æ³•å®Œç¾é€‚é…androidå’Œiosï¼Œå› æ­¤éœ€è¦åˆå¹¶ä¸Šè¿°æ–¹æ³•3ã€4ä»¥è¾¾åˆ°å®Œç¾é€‚é…ï¼ˆTipï¼šåœ¨æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œå‘ç°ä¸Šè¿°æ–¹æ³•3åœ¨iosä¸‹çš„æŸäº›appä¸­å¼¹å‡ºå¼¹å±‚æ—¶é¡µé¢ä¼šé—ªåŠ¨ï¼Œä¸”é¡µé¢å¼¹å±‚ä¼šæ¶ˆå¤±ï¼Œæ‹–åŠ¨é¡µé¢æ‰å‡ºç°ï¼Œå¦‚æœè¦é€‚é…çš„appå‡ºç°æ­¤ç±»é—®é¢˜ï¼Œæœ€å¥½åŒºåˆ†androidå’Œiosç¯å¢ƒåˆ†åˆ«é‡‡ç”¨ä¸Šè¿°3ã€4çš„æ–¹æ³•ï¼Œæˆ–è€…é‡‡ç”¨ä¸Šè¿°1ã€4åˆå¹¶ï¼ˆä½†æ˜¯è¦æŠŠbodyæˆ–htmlçš„é«˜åº¦è®¾ç½®ä¸ºå±å¹•çš„é«˜åº¦ï¼‰ï¼‰","categories":[{"name":"ç§»åŠ¨ç«¯å¼€å‘","slug":"ç§»åŠ¨ç«¯å¼€å‘","permalink":"http://yoursite.com/categories/ç§»åŠ¨ç«¯å¼€å‘/"},{"name":"é—®é¢˜ç§¯ç´¯","slug":"ç§»åŠ¨ç«¯å¼€å‘/é—®é¢˜ç§¯ç´¯","permalink":"http://yoursite.com/categories/ç§»åŠ¨ç«¯å¼€å‘/é—®é¢˜ç§¯ç´¯/"}],"tags":[{"name":"ç§»åŠ¨ç«¯","slug":"ç§»åŠ¨ç«¯","permalink":"http://yoursite.com/tags/ç§»åŠ¨ç«¯/"},{"name":"æ»šåŠ¨ç©¿é€","slug":"æ»šåŠ¨ç©¿é€","permalink":"http://yoursite.com/tags/æ»šåŠ¨ç©¿é€/"}]},{"title":"inputä¹‹type=number","slug":"inputä¹‹type-number","date":"2019-03-08T06:51:56.000Z","updated":"2019-03-11T10:27:03.371Z","comments":true,"path":"2019/03/08/inputä¹‹type-number.html","link":"","permalink":"http://yoursite.com/2019/03/08/inputä¹‹type-number.html","excerpt":"","text":"ä¸šåŠ¡éœ€æ±‚é¡µé¢ä¸­å­˜åœ¨è¾“å…¥æ¡†ï¼Œç‚¹å‡»è¾“å…¥æ¡†éœ€è¦å¼¹å‡ºæ•°å­—é”®ç›˜ï¼Œä¸”åªèƒ½è¾“å…¥åˆæ³•æ•°å­— è§£å†³æ–¹æ¡ˆ è‡ªå·±å¼€å‘ä¸€ä¸ªé”®ç›˜ç»„ä»¶ input type=â€numberâ€ input type=â€numberâ€å­˜åœ¨çš„é—®é¢˜ï¼ˆåªè°ƒæŸ¥äº†éƒ¨åˆ†æœºå‹ï¼Œä¸ä¸€å®šå®Œå…¨å‡†ç¡®ï¼‰ æœºå‹ é”®ç›˜ç±»å‹ è¡¨ç° è¾“å…¥é™åˆ¶ ios è‡ªå¸¦é”®ç›˜ è°ƒèµ·å¸¦æ•°å­—çš„ç‰¹æ®Šç¬¦å·é”®ç›˜ï¼Œå¯ä»¥åˆ‡æ¢æˆè‹±æ–‡é”®ç›˜ å¯ä»¥è¾“å…¥ä»»ä½•å­—ç¬¦ï¼Œè¾“å…¥çš„ä¸æ˜¯åˆæ³•çš„æ•°å­—ï¼Œåˆ™å–åˆ°çš„valueä¸ºç©º ios éè‡ªå¸¦é”®ç›˜ è°ƒèµ·æ•°å­—é”®ç›˜ï¼Œå¯ä»¥åˆ‡æ¢æˆè‹±æ–‡é”®ç›˜ å¯ä»¥è¾“å…¥ä»»ä½•å­—ç¬¦ï¼Œè¾“å…¥çš„ä¸æ˜¯åˆæ³•çš„æ•°å­—ï¼Œåˆ™å–åˆ°çš„valueä¸ºç©º android è‡ªå¸¦é”®ç›˜ è°ƒèµ·çº¯æ•°å­—é”®ç›˜ï¼Œå¯ä»¥åˆ‡æ¢æˆè‹±æ–‡é”®ç›˜ å¯ä»¥è¾“å…¥æ•°å­—ï¼Œ-ã€å°æ•°ç‚¹ï¼Œè¾“å…¥çš„ä¸æ˜¯åˆæ³•çš„æ•°å­—æ—¶ï¼Œå–åˆ°çš„valueä¸ºç©º android éè‡ªå¸¦é”®ç›˜ è°ƒèµ·çº¯æ•°å­—é”®ç›˜ï¼Œå¯ä»¥åˆ‡æ¢æˆè‹±æ–‡é”®ç›˜ å¯ä»¥è¾“å…¥æ•°å­—ï¼Œ-ã€å°æ•°ç‚¹å’Œeï¼Œè¾“å…¥çš„ä¸æ˜¯åˆæ³•çš„æ•°å­—æˆ–å¸¦æœ‰eæ—¶ï¼Œå–åˆ°çš„valueä¸ºç©º ç”±ä¸Šè¡¨å¯çŸ¥ï¼Œå°½ç®¡inputè®¾ç½®äº†type=â€numberâ€ï¼Œä½†æ˜¯åœ¨ä¸åŒçš„æœºå‹ä¸è¾“å…¥æ³•ä¸‹ï¼Œæ‰€å¼¹å‡ºçš„é”®ç›˜å’Œèƒ½è¾“å…¥çš„å­—ç¬¦æ˜¯ä¸åŒçš„ï¼Œå¹¶ä¸èƒ½ä¿è¯ç”¨æˆ·è¾“å…¥çš„æ˜¯åˆæ³•çš„æ•°å­—ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å¯¹ç”¨æˆ·çš„è¾“å…¥è¿›è¡Œé™åˆ¶ã€‚é€šè¿‡ç›‘å¬inputäº‹ä»¶ï¼Œåœ¨ç”¨æˆ·è¿›è¡Œè¾“å…¥åï¼Œè¿›è¡Œæ­£åˆ™æ ¡éªŒæ›¿æ¢éæ³•å­—ç¬¦ï¼Œä½†æ˜¯è®¾ç½®äº†type=â€numberâ€åï¼Œå¦‚æœç”¨æˆ·è¾“å…¥çš„ä¸æ˜¯åˆæ³•çš„æ•°å­—ï¼Œå–åˆ°çš„valueä¸ºç©ºï¼Œæ ¹æœ¬æ— æ³•è¿›è¡Œåˆæ³•æ€§æ ¡éªŒä¸æ›¿æ¢æ“ä½œï¼Œåœ¨Androidä¸‹è¿˜å¥½ï¼Œå®ƒå·²ç»å¸®æˆ‘ä»¬é™åˆ¶äº†è‹±æ–‡ã€ç¬¦å·ç­‰éæ³•å­—ç¬¦çš„è¾“å…¥ï¼Œç”¨æˆ·çš„è¾“å…¥å¾—åˆ°äº†ä¸€å®šçš„ä¿è¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨inputçš„bluräº‹ä»¶ä¸­è¿›è¡Œæœ€ç»ˆçš„åˆæ³•æ€§æ ¡éªŒï¼Œå¹¶ç»™äºˆç”¨æˆ·ä¸€å®šçš„æç¤ºã€‚ä½†æ˜¯åœ¨iosä¸‹ï¼Œç”¨æˆ·å¯ä»¥è¾“å…¥ä»»æ„çš„å­—ç¬¦ï¼Œä¹Ÿå°±æ˜¯è¯´ç”¨æˆ·è¾“å…¥éæ³•çš„å­—ç¬¦çš„å¯èƒ½æ€§æé«˜äº†å¾ˆå¤šï¼Œè‹¥åŒæ ·åœ¨bluräº‹ä»¶ä¸­è¿›è¡Œæ ¡éªŒä¸æ›¿æ¢æ“ä½œï¼Œç»™ç”¨æˆ·å¸¦æ¥çš„ä½“éªŒè¿‡å·®ï¼Œæ‰€ä»¥åœ¨iosä¸‹ä½¿ç”¨type=â€numberâ€å¹¶ä¸å¯è¡Œ é‚£ä¹ˆåœ¨iosä¸‹æ˜¯å¦æœ‰å…¶å®ƒè°ƒèµ·çº¯æ•°å­—é”®ç›˜çš„æ–¹æ³•ç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œä»¥ä¸‹ä¸¤ç§æ–¹æ³•å¯ä»¥è°ƒèµ·çº¯æ•°å­—é”®ç›˜ï¼Œä½†æ˜¯è°ƒèµ·æ¥çš„æ•°å­—é”®ç›˜æ˜¯ä¸å¸¦å°æ•°ç‚¹çš„ï¼Œå¦‚æœéœ€è¦è¾“å…¥å°æ•°çš„è¯ï¼Œè¿™ç§æ–¹æ³•æ˜¯ä¸å¯è¡Œçš„ type=â€telâ€ pattern=â€[0-9]*â€ å¦‚æœæ˜¯webviewï¼Œè°ƒç”¨nativeçš„äº‹ä»¶è²Œä¼¼å¯ä»¥ï¼Œä½†éœ€è¦nativeäººå‘˜çš„æ”¯æŒ æ€è€ƒç»¼ä¸Šæ‰€è¯‰ï¼Œtypeè®¾ç½®ä¸ºnumberçš„æ–¹æ³•æ˜¯ä¸å¯è¡Œçš„ï¼Œæ— æ³•å®ç°æˆ‘ä»¬å¯¹ç”¨æˆ·çš„è¾“å…¥è¿›è¡Œå®æ—¶çš„æ§åˆ¶ï¼Œä½†æ˜¯æŠŠtypeè®¾ç½®ä¸ºtextï¼Œæ¯æ¬¡è°ƒèµ·çš„éƒ½æ˜¯è‹±æ–‡é”®ç›˜ï¼Œç”¨æˆ·è¿˜å¾—åˆ‡æ¢ä¸€ä¸‹é”®ç›˜ï¼Œæ‰èƒ½æ„‰å¿«çš„è¿›è¡Œè¾“å…¥ï¼Œè¿™ä¸ªä½“éªŒå®åœ¨æ˜¯å¤ªç³Ÿç³•äº†ï¼Œå¦‚æœä½ çš„é¡µé¢åªæœ‰ä¸€ä¸ªè¾“å…¥æ¡†ï¼Œç”¨æˆ·æˆ–è®¸è¿˜èƒ½å‹‰ä¸ºå…¶éš¾çš„æ¥å—ï¼Œä½†æ˜¯å¦‚æœå­˜åœ¨å¤šä¸ªï¼Œæ¯æ¬¡ç”¨æˆ·è¿›è¡Œè¾“å…¥éƒ½å¾—åˆ‡æ¢ä»¥ä¸‹ï¼Œå¯èƒ½ç ¸æ‰‹æœºçš„å¿ƒæ€éƒ½æœ‰äº†ğŸ˜¡ï¼Œå¯è§ï¼ŒæŠŠtypeè®¾ç½®ä¸ºtextçš„æ–¹æ³•æ›´åŠ ä¸å¯è¡Œ å›åˆ°æˆ‘ä»¬çš„éœ€æ±‚ å¼¹å‡ºæ•°å­—é”®ç›˜ é™åˆ¶ç”¨æˆ·è¾“å…¥ é¦–å…ˆè¦æ»¡è¶³å¼¹å‡ºæ•°å­—é”®ç›˜ï¼Œå°±å¿…é¡»è®¾ç½®type=â€numberâ€ï¼Œä½†æ˜¯è®¾ç½®äº†type=â€numberâ€ä¹‹åï¼Œè¯¥æ€ä¹ˆé™åˆ¶ç”¨æˆ·çš„è¾“å…¥å‘¢ï¼ŸæŠŠtypeè®¾å›textå°±è¡Œäº†ï¼Œäºæ˜¯æœ‰äº†ä»¥ä¸‹å¤„ç†æ–¹æ¡ˆï¼š 1234567891011121314151617181920212223&lt;template&gt; &lt;input type=\"number\" :model=\"price\" @focus=\"focusHandler($event)\" @blur=\"blurHandler($event)\"/&gt;&lt;/template&gt;&lt;script&gt; export default &#123; watch: &#123; price: function () &#123; const newPrice = // æ­£åˆ™æ›¿æ¢æ“ä½œ return newPrice &#125; &#125;, methods: &#123; blurHandler (e) &#123; e.target.type = 'number' &#125;, focusHandler (e) &#123; setTimeOut(() =&gt; &#123; e.target.type = 'text' &#125;, 100) &#125; &#125; &#125;&lt;/script&gt; åœ¨è¾“å…¥æ¡†è·å–ç„¦ç‚¹ï¼Œå¼¹èµ·äº†æ•°å­—é”®ç›˜åï¼Œå†æŠŠinputçš„typeè®¾å›textï¼Œè¿™æ ·å½“ç”¨æˆ·è¾“å…¥çš„æ˜¯éæ•°å­—å­—ç¬¦æ—¶ï¼Œä¹Ÿèƒ½è·å–åˆ°æ­£å¸¸çš„valueå€¼äº†ï¼Œç„¶åè¿›è¡Œåˆæ³•æ€§æ ¡éªŒå’Œæ›¿æ¢ï¼Œåœ¨å¤±å»ç„¦ç‚¹çš„æ—¶å€™ï¼Œå†æŠŠtypeè®¾å›numberï¼Œä»¥é˜²ä¸‹æ¬¡ç‚¹å‡»çš„æ—¶å€™å¼¹å‡ºéæ•°å­—é”®ç›˜ï¼Œç»è¿‡æµ‹è¯•è¿™ç§å®ç°æ–¹æ³•åœ¨iosä¸‹æ“ä½œæ­£å¸¸ï¼Œä½†æ˜¯åœ¨androidä¸‹æ ¹æœ¬æ— æ³•å¼¹å‡ºé”®ç›˜ï¼Œäºæ˜¯æœ‰äº†ä¸‹é¢çš„è§£å†³æ–¹æ¡ˆ æœ€ç»ˆæ–¹æ¡ˆ1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283&lt;template&gt; &lt;div class=\"demo\"&gt; &lt;input type=\"number\" class=\"demo--input\" v-model=\"realValue\" @focus=\"inputFocusHandler($event)\" @blur=\"inputBlurHandler($event)\" @input=\"inputHandler\"&gt; &lt;/div&gt;&lt;/template&gt;&lt;script&gt;export default &#123; name: \"DemoInput\", props: &#123; &#125;, data() &#123; return &#123; realValue: \"\" &#125; &#125;, computed: &#123; &#125;, created() &#123; &#125;, watch: &#123; realValue: function(newValue) &#123; let realValue = newValue.replace(/[^0-9.]|(^\\.)/g, \"\") if (realValue.charAt(realValue.length - 1) === \".\") &#123; let tempValue = realValue.slice(0, -1) this.realValue = /\\./g.test(tempValue) ? tempValue : realValue return &#125; this.realValue = realValue &#125; &#125;, methods: &#123; validateValue () &#123; const &#123; realValue &#125; = this // æ ¡éªŒè¾“å…¥çš„æ˜¯å¦æ˜¯æ•°å­— if ( realValue !== \"\" &amp;&amp; !/^[0-9]+(\\.[0-9]+)?$/.test(realValue) ) &#123; this.realValue = \"\" alet('è¯·è¾“å…¥æ­£ç¡®çš„æ•°å­—ï¼') return false &#125; // å»é™¤æ•°å­—å‰é¢å¤šä½™çš„0 if ((/\\./g).test(realValue)) &#123; this.realValue = realValue.replace(/^0+\\./, \"0.\") &#125; else &#123; this.realValue = realValue.replace(/^0+/, \"\") &#125; return true &#125;, inputBlurHandler(e) &#123; if (window.APP_TYPE === \"ios\") &#123; e.target.type = \"number\" &#125; this.validateValue() &#125;, inputHandler(e) &#123; // é•¿åº¦è¾“å…¥é™åˆ¶ if (this.realValue.length &gt; 7) &#123; this.realValue = this.realValue.slice(0, 7) &#125; &#125;, inputFocusHandler(e) &#123; if (window.APP_TYPE === \"ios\") &#123; setTimeout(() =&gt; &#123; e.target.type = \"text\" &#125;, 100) &#125; &#125; &#125;&#125;&lt;/script&gt;&lt;style lang=\"scss\" scoped&gt;&lt;/style&gt; Tip ç§»åŠ¨ç«¯è‡ªå®šä¹‰æŒ‡ä»¤v-focusä»ç„¶æ— æ³•å®ç°ç‚¹å‡»æŸä¸ªæŒ‰é’®ï¼Œä½¿inputè‡ªåŠ¨è·å–ç„¦ç‚¹ï¼Œåœ¨pcç«¯å¯è¡Œ","categories":[{"name":"ç§»åŠ¨ç«¯å¼€å‘","slug":"ç§»åŠ¨ç«¯å¼€å‘","permalink":"http://yoursite.com/categories/ç§»åŠ¨ç«¯å¼€å‘/"},{"name":"é—®é¢˜ç§¯ç´¯","slug":"ç§»åŠ¨ç«¯å¼€å‘/é—®é¢˜ç§¯ç´¯","permalink":"http://yoursite.com/categories/ç§»åŠ¨ç«¯å¼€å‘/é—®é¢˜ç§¯ç´¯/"}],"tags":[{"name":"ç§»åŠ¨ç«¯","slug":"ç§»åŠ¨ç«¯","permalink":"http://yoursite.com/tags/ç§»åŠ¨ç«¯/"},{"name":"input","slug":"input","permalink":"http://yoursite.com/tags/input/"},{"name":"type=\"number\"","slug":"type-number","permalink":"http://yoursite.com/tags/type-number/"}]},{"title":"å…«ç§æ–¹æ³•å®ç°CSSé¡µé¢åº•éƒ¨å›ºå®š","slug":"å…«ç§æ–¹æ³•å®ç°CSSé¡µé¢åº•éƒ¨å›ºå®š","date":"2019-03-08T06:42:59.000Z","updated":"2019-03-08T06:44:24.595Z","comments":true,"path":"2019/03/08/å…«ç§æ–¹æ³•å®ç°CSSé¡µé¢åº•éƒ¨å›ºå®š.html","link":"","permalink":"http://yoursite.com/2019/03/08/å…«ç§æ–¹æ³•å®ç°CSSé¡µé¢åº•éƒ¨å›ºå®š.html","excerpt":"","text":"å…«ç§æ–¹æ³•å®ç°CSSé¡µé¢åº•éƒ¨å›ºå®šé¡µé¢å¸ƒå±€ï¼š 12345&lt;div id=\"wrap\"&gt; &lt;header id=\"header\"&gt;header&lt;/header&gt; &lt;main id=\"main\"&gt;&lt;/main&gt; &lt;footer id=\"footer\"&gt;footer&lt;/footer&gt;&lt;/div&gt; é€šç”¨æ ·å¼ï¼š 123456789101112* &#123; margin: 0; padding: 0;&#125;#header &#123; height: 50px; background: #f00;&#125;#footer &#123; height: 100px; background: yellow;&#125; è§£å†³æ–¹æ¡ˆï¼š footeré«˜åº¦å›ºå®š+ç»å¯¹å®šä½ 1234567891011121314html,body &#123; height: 100%;&#125;#wrap &#123; position: relative; min-height: 100%; box-sizing: border-box; padding-bottom: 100px;&#125;#footer &#123; position: absolute; bottom: 0; width: 100%;&#125; ä¸»ä½“åŒºåŸŸè®¾ç½®marginè´Ÿå€¼ 1234567891011121314html, body &#123; height: 100%;&#125;#wrap &#123; height: 100%;&#125;#main &#123; box-sizing: border-box; min-height: 100%; padding-top: 50px; padding-bottom: 100px; margin-top: -50px; margin-bottom: -100px;&#125; header, footerè®¾ç½®marginè´Ÿå€¼ 123456789101112131415html, body, #wrap &#123; height: 100%;&#125;#main &#123; box-sizing: border-box; min-height: 100%; padding-top: 50px; padding-bottom: 100px;&#125;#header &#123; margin-bottom: -50px;&#125;#footer &#123; margin-top: -100px;&#125; é€šè¿‡è®¾ç½®flexï¼Œå°†footerçš„margin-topè®¾ç½®ä¸ºauto 12345678#wrap &#123; display: flex; min-height: 100vh; flex-direction: column;&#125;#footer &#123; margin-top: auto;&#125; é€šè¿‡calc()è®¡ç®—å†…å®¹çš„é«˜åº¦ 123#main &#123; min-height: calc(100vh - 150px);&#125; é€šè¿‡è®¾ç½®flexboxï¼Œå°†ä¸»ä½“mainè®¾ç½®ä¸ºflex 12345678#wrap &#123; display: flex; min-height: 100vh; flex-direction: column;&#125;#main &#123; flex: 1;&#125; ä½¿ç”¨gridå¸ƒå±€ 123456789#wrap &#123; display: grid; min-height: 100vh; grid-template-rows: auto 1fr auto;&#125;#footer &#123; grid-row-start: 3; grid-row-end: 4;&#125; display: table 12345678#wrap &#123; display: table; min-height: 100vh;&#125;#main &#123; display: table-row; height: 100%;&#125;","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"http://yoursite.com/categories/ç¼–ç¨‹è¯­è¨€/"},{"name":"CSS","slug":"ç¼–ç¨‹è¯­è¨€/CSS","permalink":"http://yoursite.com/categories/ç¼–ç¨‹è¯­è¨€/CSS/"}],"tags":[{"name":"css","slug":"css","permalink":"http://yoursite.com/tags/css/"},{"name":"åº•éƒ¨å›ºå®š","slug":"åº•éƒ¨å›ºå®š","permalink":"http://yoursite.com/tags/åº•éƒ¨å›ºå®š/"}]},{"title":"æ·±å…¥ç†è§£CSSï¼šå­—ä½“åº¦é‡ã€line-heightå’Œvertical-align","slug":"æ·±å…¥ç†è§£CSSï¼šå­—ä½“åº¦é‡ã€line-heightå’Œvertical-align","date":"2019-03-08T06:42:32.000Z","updated":"2019-03-08T06:45:58.664Z","comments":true,"path":"2019/03/08/æ·±å…¥ç†è§£CSSï¼šå­—ä½“åº¦é‡ã€line-heightå’Œvertical-align.html","link":"","permalink":"http://yoursite.com/2019/03/08/æ·±å…¥ç†è§£CSSï¼šå­—ä½“åº¦é‡ã€line-heightå’Œvertical-align.html","excerpt":"","text":"å‚è€ƒæ–‡æ¡£åŸæ–‡ï¼š Deep dive CSS: font metrics, line-height and vertical-align - Vincent De Oliveira è¯‘æ–‡ï¼š æ·±å…¥ç†è§£ CSSï¼šå­—ä½“åº¦é‡ã€line-height å’Œ vertical-align æ·±å…¥ç ”ç©¶CSSå­—ä½“åº¦é‡åŠCSS ç›’å­ æ€»ç»“æ¦‚è¿°line-height, vertical-alignæ¶‰åŠåˆ°IFC(å†…è”æ ¼å¼åŒ–ä¸Šä¸‹æ–‡) line-heightå–å€¼å¯ä»¥ä¸ºæ•°å­—æˆ–pxï¼Œæ•°å­—è¡¨ç¤ºç›¸å¯¹äºfont-sizeçš„å€æ•°ï¼Œé»˜è®¤å€¼ä¸ºnormalï¼Œnormalå–å€¼ä¸º1-1.2ä¹‹é—´ font-sizeä¸åŒå­—ä½“ï¼Œè®¾ç½®ç›¸åŒçš„font-sizeï¼Œå…¶åœ¨é¡µé¢ä¸Šæ‰€å æ®çš„é«˜åº¦æ˜¯ä¸ä¸€æ ·çš„ï¼ŒåŸå› åœ¨äºå­—ä½“æœ¬èº« å­—ä½“çš„å®šä¹‰è§„åˆ™ï¼š å­—æ¯çš„é«˜åº¦è¢«ç§°ä¸ºâ€œemâ€ï¼Œåœ¨æ•°å­—åŒ–å­—ä½“ä¸­ em æ˜¯ç©ºé—´çš„æ•°å­—åŒ–å®šä¹‰æ€»é‡ã€‚emçš„å¤§å°ï¼ˆä»¥ä¸‹å‡å†™ä¸º: EM sizeï¼‰é€šå¸¸æ˜¯ 1000 å•ä½ï¼Œåœ¨ TrueType å­—ä½“ä¸­ï¼ŒEM size çº¦å®šæ˜¯2çš„å¹‚ï¼Œé€šå¸¸æ˜¯1024æˆ–2048ã€‚ æ ¹æ®å…¶å®é™…ä½¿ç”¨çš„å•ä½ï¼Œå­—ä½“çš„åº¦é‡å¯ä»¥æ ¹æ®ä¸€äº›è®¾ç½®æ¥å†³å®šã€‚æ³¨æ„ï¼Œæœ‰äº›å€¼æ˜¯em-squareä¹‹å¤–çš„å€¼ã€‚ åœ¨æµè§ˆå™¨ä¸­ï¼Œç›¸å¯¹å•ä½æ˜¯ç”¨äºç¼©æ”¾ç”¨æ¥é€‚åº”æ‰€éœ€çš„ font-size å­—ä½“çš„è®¾ç½®ï¼š ä¸€æ¬¾å­—ä½“ä¼šå®šä¹‰ä¸€ä¸ªem-squareï¼šåœ¨å­—ä½“è®¾è®¡ä¸­ä¸€ä¸ªå­—ç¬¦æ‰€åœ¨çš„ç©ºé—´å®¹å™¨ï¼ˆä¹Ÿè¢«ç§°ä½œâ€œEM sizeâ€æˆ–è€…â€œUPMâ€ï¼‰ï¼‰ï¼Œä¸€èˆ¬è¢«è®¾å®šä¸ºå®½é«˜å‡ä¸º1000çš„ç›¸å¯¹å•ä½ï¼Œä¹Ÿå¯æ˜¯1024ã€2048ç›¸å¯¹å•ä½ å­—ä½“åº¦é‡ï¼š baseline (åŸºçº¿): åˆ†éš” ascent å’Œ descent ï¼Œé»˜è®¤å­—ç¬¦åº•ç«¯æ²¿ baseline æ’åˆ—ï¼Œå¦‚å›¾ä¸­çš„Pï¼Œxï¼ŒĞ(ä¸ºä¿„æ–‡å­—ç¬¦) ascent (ä¸Šå‡): åŸºçº¿çš„ä¸Šéƒ¨åˆ†ï¼Œå­—ç¬¦æœ€é«˜å¤„ä¸ ascent é¡¶ç«¯å¯èƒ½æœ‰ç©ºç™½ï¼Œç”± font-family å†³å®š descent (ä¸‹é™): åŸºçº¿çš„ä¸‹éƒ¨åˆ†ï¼Œå­—ç¬¦æœ€ä½å¤„ä¸ descent åº•ç«¯å¯èƒ½æœ‰ç©ºç™½ï¼Œç”± font-family å†³å®š xHeight (X å­—é«˜): å°å†™å­—ç¬¦ x çš„é«˜åº¦ï¼Œç”± font-family å†³å®š capHeight (é¡¶é¢é«˜åº¦): å¤§äº›å­—ç¬¦ P çš„é«˜åº¦ï¼Œç”± font-family å†³å®š lineSpacing (è¡Œé—´è·): åœ¨æµè§ˆå™¨ä¸­ä¸€èˆ¬ lineSpacing = ascent + descent lineHeight ï¼ˆè¡Œé«˜ï¼‰: é»˜è®¤ç­‰äº lineSpacingï¼Œå— line-height è®¾ç½®å½±å“ï¼Œå¦‚æœè®¾ç½® line-heightï¼ŒlineHeight ç­‰äº line-heightã€‚ half-leading (åŠè¡Œè·): å¦‚æœlineHeight &gt; lineSpacingï¼Œåˆ™lineHeight ä¸ lineSpacing ä¹‹é—´ä¼šäº§ç”Ÿä¸Šä¸‹ç›¸ç­‰çš„ç©ºéš™ (lineHeight - lineSpacing) /2 ç§°ä¸ºåŠè¡Œè·ï¼ˆhalf-leadingæˆ– half lead stripsï¼‰ã€‚","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"http://yoursite.com/categories/ç¼–ç¨‹è¯­è¨€/"},{"name":"CSS","slug":"ç¼–ç¨‹è¯­è¨€/CSS","permalink":"http://yoursite.com/categories/ç¼–ç¨‹è¯­è¨€/CSS/"}],"tags":[{"name":"CSS","slug":"CSS","permalink":"http://yoursite.com/tags/CSS/"},{"name":"å­—ä½“åº¦é‡","slug":"å­—ä½“åº¦é‡","permalink":"http://yoursite.com/tags/å­—ä½“åº¦é‡/"},{"name":"line-height","slug":"line-height","permalink":"http://yoursite.com/tags/line-height/"},{"name":"vertical-align","slug":"vertical-align","permalink":"http://yoursite.com/tags/vertical-align/"}]},{"title":"PromiseåŸç†","slug":"PromiseåŸç†","date":"2019-03-08T06:29:37.000Z","updated":"2019-03-08T06:39:14.590Z","comments":true,"path":"2019/03/08/PromiseåŸç†.html","link":"","permalink":"http://yoursite.com/2019/03/08/PromiseåŸç†.html","excerpt":"","text":"Promise é›å½¢123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657function Promise(fn) &#123; let callbackList = [] let state = 'pending' let value = null this.then = function(onFulfilled) &#123; return new Promise(resolve =&gt; &#123; // è¿™é‡Œçš„resolveæ˜¯thenå‡½æ•°æ–°åˆ›å»ºçš„promiseå¯¹åº”çš„resolveå‡½æ•°ï¼Œä¸å½“å‰promiseä¸­çš„resolveå‡½æ•°ä¸æ˜¯ä¸€ä¸ªï¼Œè¿ç”¨äº†é—­åŒ…åŸç† handler(&#123; onFulfilled: onFulfilled || null, resolve: resolve &#125;) &#125;) &#125; function handler(callback) &#123; // å¦‚æœå¤„äºæœªå®ŒæˆçŠ¶æ€ if (state === 'pending') &#123; callbackList.push(callback) // å¾€å½“å‰callbackListé˜Ÿåˆ—pushæ–°promiseå¯¹è±¡ return &#125; // å·²æˆåŠŸçŠ¶æ€ // å¦‚æœæ–°çš„promiseå¯¹è±¡çš„onFulfilledä¸ºç©ºï¼Œå³è°ƒç”¨thenæ–¹æ³•æ—¶æ²¡æœ‰æ­£ç¡®ä¼ å…¥å‡½æ•°ï¼Œåˆ™ç›´æ¥è°ƒç”¨promiseçš„resolveå‡½æ•°ï¼Œå¹¶ä¼ å…¥thenè°ƒç”¨é“¾ä¸­ä¸Šä¸€ä¸ªpromise resolveçš„å€¼ if (!callback.onFulfilled) &#123; callback.resolve(value) return &#125; // å¦‚æœæ–°çš„promiseå¯¹è±¡çš„onFulfilledä¸ä¸ºç©ºï¼Œåˆ™è°ƒç”¨thenæ–¹æ³•ä¼ å…¥çš„å›è°ƒå‡½æ•°ï¼Œå–å¾—å‡½æ•°çš„è¿”å›å€¼ï¼Œè°ƒç”¨promiseçš„resolveå‡½æ•°ï¼Œä¼ å…¥å›è°ƒå‡½æ•°çš„è¿”å›å€¼åˆ°è°ƒç”¨é“¾çš„ä¸‹ä¸€ä¸ªthenæ–¹æ³•ä¸­ const ret = callback.onFulfilled(value) callback.resolve(ret) &#125; function resolve(res) &#123; // thenä¸­return new Promise()æ‰§è¡Œæ‹¦æˆª if (res &amp;&amp; (typeof res === 'object' || typeof res === 'function')) &#123; const then = res.then if (typeof then === 'function') &#123; then.call(res, resolve) // res.then(resolve) return &#125; &#125; setTimeout(() =&gt; &#123; state = 'fulfilled' value = res callbackList.forEach((callback, callbackIndex) =&gt; &#123; handler(callback) &#125;) &#125;, 0) &#125; fn(resolve)&#125; è¯´æ˜è¿™é‡Œä¸»è¦ç”¨ä¸¤ä¸ª demo æ¥è§£é‡Šä¸€ä¸‹æ•´ä¸ª promise çš„æ‰§è¡Œè¿‡ç¨‹ demo11234567891011121314new Promise((resolve, reject) =&gt; &#123; setTimeout(() =&gt; &#123; console.log(1) resolve(2) &#125;, 0)&#125;) .then(res =&gt; &#123; setTimeout(() =&gt; &#123; console.log(res) &#125;, 100) &#125;) .then(res =&gt; &#123; console.log(res) &#125;) æ‰§è¡Œè¿‡ç¨‹è¯´æ˜ï¼š æ­¤å¤„åˆ›å»ºäº†ä¸‰ä¸ª Promise å¯¹è±¡ï¼šä¸€ä¸ªæ˜¯è‡ªå·±åˆ›å»ºçš„ï¼Œå¦å¤–ä¸¤ä¸ªæ˜¯ then æ–¹æ³•åˆ›å»ºçš„ ç¬¬ä¸€æ¬¡äº‹ä»¶å¾ªç¯ æ‰§è¡Œ Promise ä¸­çš„æ–¹æ³•ï¼ŒæŠŠ setTimeout çš„å›è°ƒæ·»åŠ åˆ°ä¸‹ä¸ªäº‹ä»¶å¾ªç¯çš„äº‹ä»¶é˜Ÿåˆ—ä¸­ï¼Œnew æ“ä½œç¬¦éšå¼è¿”å› this å¯¹è±¡ï¼ˆè®°ä¸º promise1ï¼‰ï¼Œpromise1 çš„çŠ¶æ€ä¸º pending æ‰§è¡Œ promise1 çš„ then æ–¹æ³•ï¼Œåˆ›å»º promise2ï¼Œæ‰§è¡Œæ„é€  promise2 ä¼ å…¥çš„å›è°ƒæ–¹æ³•æ—¶ï¼Œhandler å‡½æ•°æ‰§è¡Œçš„æ˜¯ promise1 ä¸­çš„ handler å‡½æ•°ï¼Œåˆ¤æ–­ promise1 çš„çŠ¶æ€ï¼Œæ­¤æ—¶ promise1 çš„çŠ¶æ€ä¸º pendingï¼ŒæŠŠ promise2 push åˆ° promise1 çš„ callbackList é˜Ÿåˆ—ä¸­ï¼Œpromise1 çš„ then æ–¹æ³•è¿”å› promise2ï¼Œpromise2 çš„çŠ¶æ€ä¸º pending æ‰§è¡Œ promise2 çš„ then æ–¹æ³•ï¼Œåˆ›å»º promise3ï¼Œæ‰§è¡Œæ„é€  promise3 ä¼ å…¥çš„å›è°ƒæ–¹æ³•æ—¶ï¼Œhandler å‡½æ•°æ‰§è¡Œçš„æ˜¯ promise2 ä¸­çš„ handler å‡½æ•°ï¼Œåˆ¤æ–­ promise2 çš„çŠ¶æ€ï¼Œæ­¤æ—¶ promise2 çš„çŠ¶æ€ä¸º pendingï¼ŒæŠŠ promise3 push åˆ° promise2 çš„ callbackList é˜Ÿåˆ—ä¸­ï¼Œpromise2 çš„ then æ–¹æ³•è¿”å› promise3ï¼Œpromise3 çš„çŠ¶æ€ä¸º pending æˆªæ­¢åˆ°ä¸Šè¯‰æ­¥éª¤ 3ï¼Œæ­¤æ—¶ promise1 çš„ callbackList ä¸­æœ‰ promise2ï¼Œpromise2 çš„ callbackList ä¸­æœ‰ promise3ï¼Œpromise3 çš„ callbackList ä¸ºç©º ç¬¬äºŒæ¬¡äº‹ä»¶å¾ªç¯ promise1 çš„å¼‚æ­¥æ–¹æ³•æ‰§è¡Œå®Œæˆï¼Œæ‰“å° 1ï¼Œå¾€ä¸‹ä¸ªäº‹ä»¶å¾ªç¯çš„æ—¶é—´é˜Ÿåˆ—ä¸­ push callbackList æ‰§è¡Œæ–¹æ³• ç¬¬ä¸‰æ¬¡äº‹ä»¶å¾ªç¯ å¼€å§‹æ‰§è¡Œ promise1 çš„ callbackListï¼Œå–å‡º promise2ï¼Œæ‰§è¡Œ handler å‡½æ•°ï¼Œä¼ å…¥ promise2ï¼Œæ­¤æ—¶ promise1 çš„çŠ¶æ€ä¸ä¸º pendingï¼Œpromise2 çš„ onFulfilled ä¸ä¸ºç©ºï¼Œæ‰§è¡Œ onFulfilled æ–¹æ³•ï¼Œä¼ å…¥ promise1 çš„ value å€¼ 2ï¼Œå¾€ä¸‹ä¸ªäº‹ä»¶å¾ªç¯é˜Ÿåˆ—æ’å…¥å›è°ƒå‡½æ•° res=&gt;{setTimeout(()=&gt;{console.log(res)},100)}ï¼Œè¿”å› undefinedï¼Œè°ƒç”¨ promise2 çš„ resolve æ–¹æ³• å¾€ä¸‹ä¸ªäº‹ä»¶å¾ªç¯çš„æ—¶é—´é˜Ÿåˆ—ä¸­ push promise2 çš„ callbackList æ‰§è¡Œæ–¹æ³• ç¬¬å››æ¬¡äº‹ä»¶å¾ªç¯ å› ä¸ºæ­¥éª¤ 6 å¾€äº‹ä»¶å¾ªç¯ä¸­ push çš„å‡½æ•°ï¼Œè¿˜æ²¡æœ‰åˆ°æ‰§è¡Œæ—¶æœºï¼ˆè®¾ç½®äº† 100msï¼Œå¦‚æœè®¾ç½®ä¸º 0 ä¼šå…ˆæ‰§è¡Œè¿™ä¸ªï¼‰ï¼Œäºæ˜¯æ‰§è¡Œé˜Ÿåˆ—ä¸­çš„ä¸‹ä¸ªå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ promise2 çš„ callbackList promise2 çš„çŠ¶æ€å˜ä¸º fulfilledï¼Œå–å‡º promise2 callbackList ä¸­çš„ promise3ï¼Œæ­¤æ—¶ promise2 çš„çŠ¶æ€ä¸ä¸º pendingï¼Œpromise3 çš„ onFulfilled ä¸ä¸ºç©ºï¼Œæ‰§è¡Œ onFulfilled æ–¹æ³•ï¼Œä¼ å…¥ promise2 çš„è¿”å›å€¼ undefineï¼Œè¾“å‡º undefined åœ¨æŸä¸€äº‹ä»¶å¾ªç¯æ—¶ 100ms åˆ°è¾¾ï¼Œæ‰§è¡Œæ­¥éª¤ 6 çš„äº‹ä»¶ï¼Œè¾“å‡º 2 æ‰€ä»¥è¾“å‡ºé¡ºåºæ˜¯ 1 undefined 2 demo21234567891011121314151617new Promise((resolve, reject) =&gt; &#123; setTimeout(() =&gt; &#123; console.log(1) resolve(2) &#125;, 0)&#125;) .then(res =&gt; &#123; return new Promise((resolve, reject) =&gt; &#123; setTimeout(() =&gt; &#123; console.log(res) resolve() &#125;, 100) &#125;) &#125;) .then(res =&gt; &#123; console.log(res) &#125;) æ‰§è¡Œè¿‡ç¨‹è¯´æ˜ï¼š 1-5. å¯¹åº”ä¸Šè¿° 1-5 æ‰§è¡Œ promise2 çš„ onFulFilled æ—¶ï¼Œåˆ›å»ºäº†ä¸€ä¸ªä¸­é—´ promiseï¼ˆmid promiseï¼‰ï¼Œæ„é€ å›è°ƒä¼ å…¥çš„å‚æ•°æ˜¯ promise2 çš„ value å€¼ï¼ŒåŒæ ·å¾€ä¸‹ä¸ªäº‹ä»¶å¾ªç¯çš„äº‹ä»¶é˜Ÿåˆ—ä¸­ push äº† setTimeout æ–¹æ³•ï¼Œå»¶è¿Ÿ 100msï¼Œä½†æ˜¯è¿™æ—¶ä¸æ˜¯è¿”å› undefinedï¼Œè¿”å›çš„æ˜¯ mid promiseï¼Œè°ƒç”¨ promise2 çš„ resolve æ–¹æ³•ä¼ å…¥çš„æ˜¯ mid promiseï¼Œå‘½ä¸­äº† resolve ä¸­çš„ promise åˆ¤æ–­ promise2 resolve æ–¹æ³•ä¸­çš„ pomise åˆ¤æ–­å‘½ä¸­ï¼Œå¹¶æ²¡æœ‰å¾€ä¸‹ä¸ªäº‹ä»¶å¾ªç¯é˜Ÿåˆ—ä¸­ push promise2 çš„ callbackList æ‰§è¡Œå›è°ƒï¼Œåè€Œè°ƒç”¨äº† mid promise çš„ then æ–¹æ³•ï¼ŒæŠŠ promise2 çš„ resolve æ–¹æ³•ä½œä¸ºå›è°ƒä¼ å…¥ mid promise çš„ then æ–¹æ³•æ‰§è¡Œï¼Œåˆ›å»º promise4ï¼Œpromise4 è¢« push åˆ° mid promise çš„ callbackList ä¸­ï¼Œç­‰å¾… mid promise è¢« resolve åœ¨æŸä¸€äº‹ä»¶å¾ªç¯æ—¶ï¼Œå‡å®šä¸º n 100ms åˆ°è¾¾ï¼ŒsetTimeout æ‰§è¡Œï¼Œè¾“å‡º promise2 çš„ value å€¼ 2ï¼Œmid promise è¢« resolveï¼Œmid promise callbackList è¢«æ·»åŠ åˆ°ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯æ‰§è¡Œ n+1 æ¬¡äº‹ä»¶å¾ªç¯ mid promise çš„ callbackList ä¸­çš„ promise4 è¢«æ‹¿å‡ºæ¥æ‰§è¡Œï¼Œè€Œæ­¤æ—¶çš„ promise4 çš„ fulFilled æ–¹æ³•ï¼Œå…¶å®å°±æ˜¯ promise2 çš„ resolve æ–¹æ³•ï¼Œäºæ˜¯æ‰§è¡Œ promise2 çš„ resolve æ–¹æ³•ï¼Œå¾€ä¸‹ä¸ªäº‹ä»¶å¾ªç¯çš„äº‹ä»¶é˜Ÿåˆ—ä¸­ push promise2 çš„ callbackList æ‰§è¡Œå›è°ƒ n+2 æ¬¡äº‹ä»¶å¾ªç¯ å¯¹åº”ä¸Šè¿° 9 æ‰€ä»¥è¾“å‡ºé¡ºåºä¸º 1 2 undefined ä¸åŸPomiseçš„ä¸ä¸€è‡´è¡Œä¸º 1234567891011121314new Promise((resolve, reject) =&gt; &#123; setTimeout(() =&gt; &#123; console.log(1) resolve(2) &#125;, 0)&#125;) .then(res =&gt; &#123; setTimeout(() =&gt; &#123; console.log(res) &#125;, 0) &#125;) .then(res =&gt; &#123; console.log(res) &#125;)","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"http://yoursite.com/categories/ç¼–ç¨‹è¯­è¨€/"},{"name":"JavaScript","slug":"ç¼–ç¨‹è¯­è¨€/JavaScript","permalink":"http://yoursite.com/categories/ç¼–ç¨‹è¯­è¨€/JavaScript/"}],"tags":[{"name":"javascript","slug":"javascript","permalink":"http://yoursite.com/tags/javascript/"},{"name":"promise","slug":"promise","permalink":"http://yoursite.com/tags/promise/"}]},{"title":"JSä¹‹å¼•æ“","slug":"JSä¹‹å¼•æ“","date":"2019-03-08T06:28:57.000Z","updated":"2019-03-08T06:37:05.490Z","comments":true,"path":"2019/03/08/JSä¹‹å¼•æ“.html","link":"","permalink":"http://yoursite.com/2019/03/08/JSä¹‹å¼•æ“.html","excerpt":"","text":"JSå¼•æ“ä¹‹Shapes&amp;Inline CachesåŸæ–‡é“¾æ¥è¯‘æ–‡é“¾æ¥ JSå¼•æ“ä¹‹V8å¦‚ä½•ä¼˜åŒ–prototypeåŸæ–‡é“¾æ¥è¯‘æ–‡é“¾æ¥","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"http://yoursite.com/categories/ç¼–ç¨‹è¯­è¨€/"},{"name":"JavaScript","slug":"ç¼–ç¨‹è¯­è¨€/JavaScript","permalink":"http://yoursite.com/categories/ç¼–ç¨‹è¯­è¨€/JavaScript/"}],"tags":[{"name":"javascript","slug":"javascript","permalink":"http://yoursite.com/tags/javascript/"},{"name":"å¼•æ“","slug":"å¼•æ“","permalink":"http://yoursite.com/tags/å¼•æ“/"}]},{"title":"JSä¹‹ç±»å‹è½¬æ¢","slug":"JSä¹‹ç±»å‹è½¬æ¢","date":"2019-03-08T06:27:50.000Z","updated":"2019-03-08T06:33:29.361Z","comments":true,"path":"2019/03/08/JSä¹‹ç±»å‹è½¬æ¢.html","link":"","permalink":"http://yoursite.com/2019/03/08/JSä¹‹ç±»å‹è½¬æ¢.html","excerpt":"","text":"JSä¹‹ç±»å‹è½¬æ¢æ–‡æ¡£JavaScriptæ ¸å¿ƒæ¦‚å¿µï¼šç±»å‹è½¬æ¢ è¿ç®—ç¬¦ä¼˜å…ˆçº§è¿ç®—ç¬¦ä¼˜å…ˆçº§è¡¨ ==è¿ç®—ç¬¦çš„éšå¼è½¬æ¢åŸåˆ™ECMAScriptÂ® 2019 : 7.2.14 Abstract Equality Comparison è§„èŒƒæè¿°ï¼šThe comparison x == y, where x and y are values, produces true or false. Such a comparison is performed as follows: If Type(x) is the same as Type(y) then Return the result of performing Strict Equality Comparison x === y. If x is null and y is undefined, return true. If x is undefined and y is null, return true. If Type(x) is Number and Type(y) is String, return the result of the comparison x == ! ToNumber(y). If Type(x) is String and Type(y) is Number, return the result of the comparison ! ToNumber(x) == y. If Type(x) is Boolean, return the result of the comparison ! ToNumber(x) == y. If Type(y) is Boolean, return the result of the comparison x == ! ToNumber(y). If Type(x) is either String, Number, or Symbol and Type(y) is Object, return the result of the comparison x == ToPrimitive(y). If Type(x) is Object and Type(y) is either String, Number, or Symbol, return the result of the comparison ToPrimitive(x) == y. Return false. \bToNumberECMAScriptÂ® 2019 : 7.1.3ToNumber ToPrimitiveECMAScriptÂ® 2019 : 7.1.1ToPrimitive ( input [ , PreferredType ] ) The abstract operation ToPrimitive takes an input argument and an optional argument PreferredType. The abstract operation ToPrimitive converts its input argument to a non-Object type[å°è¯•è½¬æ¢ä¸ºåŸå§‹å¯¹è±¡]. If an object is capable of converting to more than one primitive type, it may use the optional hint PreferredType to favour that type. Conversion occurs according to the following algorithm[å¦‚æœå¯¹è±¡èƒ½å¤Ÿè½¬æ¢ä¸ºå¤šä¸ªåŸºæœ¬ç±»å‹ï¼Œåˆ™å¯ä»¥ä½¿ç”¨å¯é€‰æç¤ºPreferredTypeæ¥æ”¯æŒè¯¥ç±»å‹ã€‚æ ¹æ®ä»¥ä¸‹ç®—æ³•è¿›è¡Œè½¬æ¢]: Assert: input is an ECMAScript language value. If Type(input) is Object, then If PreferredType is not present, let hint be â€œdefaultâ€. Else if PreferredType is hint String, let hint be â€œstringâ€. Else PreferredType is hint Number, let hint be â€œnumberâ€. Let exoticToPrim be ? GetMethod(input, @@toPrimitive). If exoticToPrim is not undefined, then Let result be ? Call(exoticToPrim, input, Â« hint Â»). If Type(result) is not Object, return result. Throw a TypeError exception. If hint is â€œdefaultâ€, set hint to â€œnumberâ€. Return ? OrdinaryToPrimitive(input, hint). Return input. 1234567891011121314151617181920212223242526272829303132333435363738// Assert: input is an ECMAScript language value.function ToPrimitive (input, PreferredType) &#123; if (typeof input === 'object') &#123; let hint = '' switch (typeof PreferredType) &#123; case 'undefined': hint = 'default' break case 'string': hint = 'string' break default: hint = 'number' &#125; let exoticToPrim = GetMethod(input, @@toPrimitive) if (exoticToPrim !== undefined) &#123; let result = Call(exoticToPrim, input, &lt;&lt; hint &gt;&gt;) if (typeof result !== 'object') &#123; return result &#125; else &#123; throw TypeError() &#125; &#125; if (hint === 'default') &#123; hint = 'number' &#125; return OrdinaryToPrimitive(input, hint) &#125; return input&#125; GetMethodECMAScriptÂ® 2019 : 7.3.9GetMethod ( V, P ) The abstract operation GetMethod is used to get the value of a specific property of an ECMAScript language value when the value of the property is expected to be a function. The operation is called with arguments V and P where V is the ECMAScript language value, P is the property key. This abstract operation performs the following steps: Assert: IsPropertyKey(P) is true. Let func be ? GetV(V, P). If func is either undefined or null, return undefined. If IsCallable(func) is false, throw a TypeError exception. Return func. 123456789101112131415// Assert: IsPropertyKey(P) is true.function GetMethod (V, P) &#123; let func = GetV(V, P) if (func === undefined || func === null) &#123; return &#125; if (!IsCallable(func)) &#123; throw TypeError() &#125; return func&#125; IsPropertyKeyECMAScriptÂ® 2019 : 7.2.7IsPropertyKey ( argument ) The abstract operation IsPropertyKey determines if argument, which must be an ECMAScript language value, is a value that may be used as a property key. If Type(argument) is String, return true. If Type(argument) is Symbol, return true. Return false. 1234567891011function IsPropertyKey (argument) &#123; switch (typeof argument) &#123; case 'string': case 'symbol': return true break default: return false &#125;&#125; GetVECMAScriptÂ® 2019 : 7.3.2GetV ( V, P ) The abstract operation GetV is used to retrieve the value of a specific property of an ECMAScript language value. If the value is not an object, the property lookup is performed using a wrapper object appropriate for the type of the value. The operation is called with arguments V and P where V is the value and P is the property key. This abstract operation performs the following steps: Assert: IsPropertyKey(P) is true. Let O be ? ToObject(V). Return ? O.[Get]. 123456// Assert: IsPropertyKey(P) is true.function GetV (V, P) &#123; let O = ToObject(V) return O.[[Get]](P, V)&#125; ToObjectECMAScriptÂ® 2019 : 7.1.13ToObject ( argument ) The abstract operation ToObject converts argument to a value of type Object according to below Table: Argument Type Result Undefined Throw a TypeError exception. Null Throw a TypeError exception. Boolean Return a new Boolean object whose [[BooleanData]] internal slot is set to argument. Number Return a new Number object whose [[NumberData]] internal slot is set to argument. String Return a new String object whose [[StringData]] internal slot is set to argument. Symbol Return a new Symbol object whose [[SymbolData]] internal slot is set to argument. Object Return argument. 12345678910111213141516171819202122function ToObject (argument) &#123; if (argument === undefined || argument === null) &#123; throw TypeError() &#125; switch (typeof argument) &#123; case 'boolean': return new Boolean(argument) break case 'number': return new Number(argument) break case 'string': return new String(argument) break case: 'symbol': return Symbol(argument) default: return argument &#125;&#125; IsCallableECMAScriptÂ® 2019 : 7.2.3IsCallable ( argument ) The abstract operation IsCallable determines if argument, which must be an ECMAScript language value, is a callable function with a [[Call]] internal method. If Type(argument) is not Object, return false. If argument has a [[Call]] internal method, return true. Return false. 123456789101112function IsCallable (argument) &#123; if (typeof argument !== 'object') &#123; return false &#125; if (typeof argument.__proto__.call === 'function') &#123; return true &#125; return false&#125; CallECMAScriptÂ® 2019 : 7.3.12Call ( F, V [ , argumentsList ] ) The abstract operation Call is used to call the [[Call]] internal method of a function object. The operation is called with arguments F, V, and optionally argumentsList where F is the function object, V is an ECMAScript language value that is the this value of the [[Call]], and argumentsList is the value passed to the corresponding argument of the internal method. If argumentsList is not present, a new empty List is used as its value. This abstract operation performs the following steps: If argumentsList is not present, set argumentsList to a new empty List. If IsCallable(F) is false, throw a TypeError exception. Return ? F.[Call]. 123456789101112function Call (F, V, ...argumentsList) &#123; if (!argumentsList) &#123; argumentsList = [] &#125; if (IsCallable(F)) &#123; throw TypeError() &#125; return F.call(V, argumentsList)&#125; OrdinaryToPrimitiveECMAScriptÂ® 2019 : 7.1.1.1OrdinaryToPrimitive ( O, hint ) When the abstract operation OrdinaryToPrimitive is called with arguments O and hint, the following steps are taken: Assert: Type(O) is Object. Assert: Type(hint) is String and its value is either â€œstringâ€ or â€œnumberâ€. If hint is â€œstringâ€, then Let methodNames be Â« â€œtoStringâ€, â€œvalueOfâ€ Â». Else, Let methodNames be Â« â€œvalueOfâ€, â€œtoStringâ€ Â». For each name in methodNames in List order, do Let method be ? Get(O, name). If IsCallable(method) is true, then Let result be ? Call(method, O). If Type(result) is not Object, return result. Throw a TypeError exception. 123456789101112131415161718192021222324// Assert: Type(O) is Object// Assert: Type(hint) is String and its value is either \"string\" or \"number\"function OrdinaryToPrimitive (O, hint) &#123; let methodNames = ['valueOf', 'toString'] if (typeof hint === 'string') &#123; methodNames = ['toString', 'valueOf'] &#125; methodNames.forEach((name, nameIndex) =&gt; &#123; let method = Get(O, name) if (IsCallable(method)) &#123; let result = Call(method, O) if (typeof result !== 'object') &#123; return result &#125; &#125; &#125;) throw TypeError()&#125; GetECMAScriptÂ® 2019 : 7.3.1Get ( O, P ) The abstract operation Get is used to retrieve the value of a specific property of an object. The operation is called with arguments O and P where O is the object and P is the property key. This abstract operation performs the following steps: Assert: Type(O) is Object. Assert: IsPropertyKey(P) is true. Return ? O.[Get]. 123456// Assert: Type(O) is Object.// Assert: IsPropertyKey(P) is true.function Get (O, P) &#123; return O.[[Get]](P, O)&#125; [[Get]][ECMAScriptÂ® 2019 : 9.1.8[Get]] ( P, Receiver ) When the [[Get]] internal method of O is called with property key P and ECMAScript language value Receiver, the following steps are taken: Return ? OrdinaryGet(O, P, Receiver). 1234function [[Get]] (P, Receiver) &#123; return OrdinaryGet(O, P, Receiver)&#125; OrdinaryGetECMAScriptÂ® 2019 : 9.1.8.1OrdinaryGet ( O, P, Receiver )) When the abstract operation OrdinaryGet is called with Object O, property key P, and ECMAScript language value Receiver, the following steps are taken: Assert: IsPropertyKey(P) is true. Let desc be ? O.[GetOwnProperty]. If desc is undefined, then. Let parent be ? O.[GetPrototypeOf]. If parent is null, return undefined. Return ? parent.[Get]. If IsDataDescriptor(desc) is true, return desc.[[Value]]. Assert: IsAccessorDescriptor(desc) is true. Let getter be desc.[[Get]]. If getter is undefined, return undefined. Return ? Call(getter, Receiver).","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"http://yoursite.com/categories/ç¼–ç¨‹è¯­è¨€/"},{"name":"JavaScript","slug":"ç¼–ç¨‹è¯­è¨€/JavaScript","permalink":"http://yoursite.com/categories/ç¼–ç¨‹è¯­è¨€/JavaScript/"}],"tags":[{"name":"javascriptï¼Œç±»å‹è½¬æ¢","slug":"javascriptï¼Œç±»å‹è½¬æ¢","permalink":"http://yoursite.com/tags/javascriptï¼Œç±»å‹è½¬æ¢/"}]},{"title":"æ’å…¥æ’åº","slug":"æ’å…¥æ’åº","date":"2019-03-08T06:23:21.000Z","updated":"2019-03-08T06:25:41.854Z","comments":true,"path":"2019/03/08/æ’å…¥æ’åº.html","link":"","permalink":"http://yoursite.com/2019/03/08/æ’å…¥æ’åº.html","excerpt":"","text":"123456789101112131415161718192021222324252627282930/*æ’å…¥æ’åºæ—¶é—´å¤æ‚åº¦ï¼šæœ€å¥½ï¼šO(n) æœ€åO(n2)ç®—æ³•ä»‹ç»ï¼šhttps://www.cnblogs.com/hapjin/p/5517667.html*/function insertSort (arr) &#123; if (!(arr instanceof Array)) &#123; return [] &#125; const arrLen = arr.length for (let i = 1; i &lt; arrLen; i++) &#123; let tempNum = arr[i] for (let j = 0; j &lt; i; j++) &#123; if (arr[i] &lt; arr[j]) &#123; arr.splice(i, 1) arr.splice(j, 0, tempNum) break &#125; &#125; &#125;&#125;let arr = [5, 2, 8, 4, 9, 1]insertSort(arr)console.log(arr)","categories":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"http://yoursite.com/categories/ç®—æ³•/"},{"name":"æ’åº","slug":"ç®—æ³•/æ’åº","permalink":"http://yoursite.com/categories/ç®—æ³•/æ’åº/"}],"tags":[{"name":"ç®—æ³•ï¼Œæ’åº","slug":"ç®—æ³•ï¼Œæ’åº","permalink":"http://yoursite.com/tags/ç®—æ³•ï¼Œæ’åº/"}]},{"title":"å¿«é€Ÿæ’åº","slug":"å¿«é€Ÿæ’åº","date":"2019-03-08T06:23:21.000Z","updated":"2019-03-08T06:26:06.601Z","comments":true,"path":"2019/03/08/å¿«é€Ÿæ’åº.html","link":"","permalink":"http://yoursite.com/2019/03/08/å¿«é€Ÿæ’åº.html","excerpt":"","text":"1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556/* å¿«é€Ÿæ’åºæ—¶é—´å¤æ‚åº¦ï¼šO(N*logN)ç®—æ³•ä»‹ç»ï¼šhttp://developer.51cto.com/art/201403/430986.htmç–‘é—®ç‚¹ï¼šåŸºæ•°åœ¨å·¦è¾¹ï¼Œä¸ºä»€ä¹ˆè¦ä»å³è¾¹å…ˆå¼€å§‹æŸ¥æ‰¾ï¼Ÿç­”ï¼šä»ä»£ç å±‚é¢åˆ†æï¼Œå› ä¸ºæœ€åæ‰¾åˆ°çš„ä¸€ä¸ªæ•°ä¹Ÿå°±æ˜¯å°æ ‡ä¸ºiçš„æ•°éœ€è¦ä¸åŸºæ•°å¯¹æ¢ï¼Œè€ŒåŸºæ•°åœ¨æœ€å·¦è¾¹ï¼Œè¯´æ˜æœ€åä¸€ä¸ªæ•°ä¼šæ”¾åˆ°æœ€å·¦è¾¹ï¼Œä¹Ÿå°±æ˜¯æœ€åä¸€ä¸ªæ•°å¿…é¡»å¿…åŸºæ•°å°ï¼Œè€Œä»å³è¾¹å¼€å§‹æŸ¥æ‰¾çš„æ˜¯å¿…åŸºæ•°å°çš„æ•°ï¼Œç»ˆæ­¢æŸ¥æ‰¾çš„å¯èƒ½æ€§ï¼šä»å³ä¾§å¼€å§‹æŸ¥æ‰¾ç»ˆæ­¢æŸ¥æ‰¾çš„å¯èƒ½æ€§ï¼š1. å‰ä¸€æ¬¡å¯¹è°ƒç»“æŸï¼Œjæ‰¾åˆ°iæ‰€åœ¨ä½ç½®ï¼Œæ­¤æ—¶iæ˜¯æ¯”åŸºæ•°å°çš„ï¼Œiä¸‹æ ‡å¯¹åº”çš„æ•°ä¸åŸºæ•°å¯¹æ¢æ²¡æœ‰é—®é¢˜2. å‰ä¸€æ¬¡å¯¹è°ƒç»“æŸï¼Œjæ‰¾åˆ°æœ€åä¸€ä¸ªæ•°ï¼Œè¿™ä¸ªæ•°æ¯”åŸºæ•°å°ï¼Œjåœæ­¢ï¼Œiå¼€å§‹æŸ¥æ‰¾æ¯”åŸºæ•°å¤§çš„æ•°ï¼Œèµ°åˆ°jçš„ä½ç½®ï¼Œiä¸å°äºjï¼Œåœæ­¢ï¼Œiä¸‹æ ‡å¯¹åº”çš„æ•°ä¸åŸºæ•°å¯¹æ¢æ²¡æœ‰é—®é¢˜ä»å·¦ä¾§å¼€å§‹æŸ¥æ‰¾ç»ˆæ­¢æŸ¥æ‰¾çš„å¯èƒ½æ€§ï¼š1. å‰ä¸€æ¬¡å¯¹è°ƒç»“æŸï¼Œiæ‰¾åˆ°jæ‰€åœ¨ä½ç½®ï¼Œæ­¤æ—¶iæ˜¯æ¯”åŸºæ•°å¤§çš„ï¼Œiä¸‹æ ‡å¯¹åº”çš„æ•°ä¸åŸºæ•°å¯¹æ¢å‡ºé”™2. å‰ä¸€æ¬¡å¯¹è°ƒç»“æŸï¼Œiæ‰¾åˆ°æœ€åä¸€ä¸ªæ•°ï¼Œè¿™ä¸ªæ•°æ¯”åŸºæ•°å¤§ï¼Œiåœæ­¢ï¼Œjå¼€å§‹æŸ¥æ‰¾æ¯”åŸºæ•°å°çš„æ•°ï¼Œèµ°åˆ°içš„ä½ç½®ï¼Œiä¸å°äºjï¼Œåœæ­¢ï¼Œiä¸‹æ ‡å¯¹åº”çš„æ•°ä¸åŸºæ•°å¯¹æ¢å‡ºé”™*/function quickSort (_left, _right, _arr) &#123; if (!(_arr instanceof Array)) &#123; return &#125; if (_left &gt;= _right) &#123; return &#125; let baseNum = _arr[_left] let i = _left let j = _right while (i !== j) &#123; while (_arr[j] &gt;= baseNum &amp;&amp; i &lt; j) &#123; j-- &#125; while (_arr[i] &lt;= baseNum &amp;&amp; i &lt; j) &#123; i++ &#125; if (i &lt; j) &#123; let tempNum = _arr[i] _arr[i] = _arr[j] _arr[j] = tempNum &#125; &#125; _arr[_left] = _arr[i] _arr[i] = baseNum console.log(_arr) quickSort(_left, i - 1, _arr) quickSort(i + 1, _right, _arr)&#125;let arr = [6, 1, 2, 7, 9, 3, 4, 5, 10, 8]// let arr = [5, 80, 55, 40, 42, 85]quickSort(0, arr.length - 1, arr)console.log(arr)","categories":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"http://yoursite.com/categories/ç®—æ³•/"},{"name":"æ’åº","slug":"ç®—æ³•/æ’åº","permalink":"http://yoursite.com/categories/ç®—æ³•/æ’åº/"}],"tags":[{"name":"ç®—æ³•ï¼Œæ’åº","slug":"ç®—æ³•ï¼Œæ’åº","permalink":"http://yoursite.com/tags/ç®—æ³•ï¼Œæ’åº/"}]},{"title":"é€‰æ‹©æ’åº","slug":"é€‰æ‹©æ’åº","date":"2019-03-08T06:23:21.000Z","updated":"2019-03-08T06:26:22.696Z","comments":true,"path":"2019/03/08/é€‰æ‹©æ’åº.html","link":"","permalink":"http://yoursite.com/2019/03/08/é€‰æ‹©æ’åº.html","excerpt":"","text":"123456789101112131415161718192021222324252627282930/* é€‰æ‹©æ’åºæ—¶é—´å¤æ‚åº¦ï¼šO(n2)ç®—æ³•ä»‹ç»ï¼šhttps://www.cnblogs.com/shen-hua/p/5424059.html*/function selectionSort (arr) &#123; if (!(arr instanceof Array)) &#123; console.error('param type is not array!') return [] &#125; for (let i = 0; i &lt; arr.length; i++) &#123; let minNumIndex = i let tempNum = arr[i] for (let j = i; j &lt; arr.length; j++) &#123; if (arr[j] &lt; arr[minNumIndex]) &#123; minNumIndex = j &#125; &#125; arr[i] = arr[minNumIndex] arr[minNumIndex] = tempNum &#125;&#125;let arr = [5, 2, 8, 4, 9, 1]selectionSort(arr)console.log(arr)","categories":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"http://yoursite.com/categories/ç®—æ³•/"},{"name":"æ’åº","slug":"ç®—æ³•/æ’åº","permalink":"http://yoursite.com/categories/ç®—æ³•/æ’åº/"}],"tags":[{"name":"ç®—æ³•ï¼Œæ’åº","slug":"ç®—æ³•ï¼Œæ’åº","permalink":"http://yoursite.com/tags/ç®—æ³•ï¼Œæ’åº/"}]},{"title":"å†’æ³¡æ’åº","slug":"å†’æ³¡æ’åº","date":"2019-03-08T06:23:21.000Z","updated":"2019-03-08T06:25:23.658Z","comments":true,"path":"2019/03/08/å†’æ³¡æ’åº.html","link":"","permalink":"http://yoursite.com/2019/03/08/å†’æ³¡æ’åº.html","excerpt":"","text":"12345678910111213141516171819202122232425/* å†’æ³¡æ’åºæ—¶é—´å¤æ‚åº¦ï¼šO(n2)ç®—æ³•ä»‹ç»ï¼šhttps://blog.csdn.net/shuaizai88/article/details/73250615*/function bubbleSort (arr) &#123; if (!(arr instanceof Array)) &#123; return [] &#125; for (let i = arr.length - 1; i &gt; 0; i--) &#123; for (let j = i; j &gt; 0; j--) &#123; if (arr[j] &lt; arr[j - 1]) &#123; let tempNum = arr[j] arr[j] = arr[j - 1] arr[j - 1] = tempNum &#125; &#125; &#125;&#125;let arr = [5, 2, 8, 4, 9, 1]bubbleSort(arr)console.log(arr)","categories":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"http://yoursite.com/categories/ç®—æ³•/"},{"name":"æ’åº","slug":"ç®—æ³•/æ’åº","permalink":"http://yoursite.com/categories/ç®—æ³•/æ’åº/"}],"tags":[{"name":"ç®—æ³•ï¼Œæ’åº","slug":"ç®—æ³•ï¼Œæ’åº","permalink":"http://yoursite.com/tags/ç®—æ³•ï¼Œæ’åº/"}]},{"title":"VueRouterä¹‹æ‰“å¼€æ–°çš„æ ‡ç­¾é¡µ","slug":"VueRouterä¹‹æ‰“å¼€æ–°çš„æ ‡ç­¾é¡µ","date":"2019-03-08T06:20:37.000Z","updated":"2019-03-08T06:21:24.623Z","comments":true,"path":"2019/03/08/VueRouterä¹‹æ‰“å¼€æ–°çš„æ ‡ç­¾é¡µ.html","link":"","permalink":"http://yoursite.com/2019/03/08/VueRouterä¹‹æ‰“å¼€æ–°çš„æ ‡ç­¾é¡µ.html","excerpt":"","text":"router-linkæ·»åŠ target=â€_blankâ€å±æ€§ window.open 12const &#123; href &#125; = this.$router.resolve(location, current ?, append ?) // è§£æç›®æ ‡ä½ç½®window.open(href, '_blank')","categories":[{"name":"æ¡†æ¶","slug":"æ¡†æ¶","permalink":"http://yoursite.com/categories/æ¡†æ¶/"},{"name":"Vue","slug":"æ¡†æ¶/Vue","permalink":"http://yoursite.com/categories/æ¡†æ¶/Vue/"},{"name":"é—®é¢˜ç§¯ç´¯","slug":"æ¡†æ¶/Vue/é—®é¢˜ç§¯ç´¯","permalink":"http://yoursite.com/categories/æ¡†æ¶/Vue/é—®é¢˜ç§¯ç´¯/"}],"tags":[{"name":"vue","slug":"vue","permalink":"http://yoursite.com/tags/vue/"},{"name":"vue-router","slug":"vue-router","permalink":"http://yoursite.com/tags/vue-router/"},{"name":"window.open","slug":"window-open","permalink":"http://yoursite.com/tags/window-open/"}]},{"title":"Vueä¹‹æ¸…ç©ºè¡¨å•","slug":"Vueä¹‹æ¸…ç©ºè¡¨å•","date":"2019-03-08T06:16:02.000Z","updated":"2019-03-08T06:17:56.726Z","comments":true,"path":"2019/03/08/Vueä¹‹æ¸…ç©ºè¡¨å•.html","link":"","permalink":"http://yoursite.com/2019/03/08/Vueä¹‹æ¸…ç©ºè¡¨å•.html","excerpt":"","text":"ç®€å•çš„çš„è¡¨å•å¦‚æœæ‰€æœ‰è¡¨å•æ§ä»¶éƒ½å¤„äºå½“å‰é¡µé¢ï¼Œä¸åŒ…å«ç»„ä»¶ï¼Œä¸”éƒ½æ˜¯åŒå‘ç»‘å®šçš„æ•°æ®ï¼Œåˆ™æ¸…ç©ºå€¼å°±è¡Œäº† å¤æ‚çš„è¡¨å•å¦‚æœè¡¨å•åŒ…å«ç»„ä»¶çº§åˆ«çš„æ§ä»¶ï¼Œå±‚çº§è¾ƒæ·±ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ç§hackçš„æ‰‹æ®µï¼Œé€šè¿‡v-ifé‡æ–°æ¸²æŸ“ç»„ä»¶ï¼Œæ¸…ç©ºç»„ä»¶å†…inputé‡Œçš„å€¼ï¼Œé€‰ä¸­çš„å¤é€‰æ¡†ç­‰ç­‰ï¼ŒåŒæ—¶å°†é¡µé¢å†…çš„ç›¸å…³æ•°æ®æ¸…ç©ºå°±è¡Œäº†ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š","categories":[{"name":"æ¡†æ¶","slug":"æ¡†æ¶","permalink":"http://yoursite.com/categories/æ¡†æ¶/"},{"name":"Vue","slug":"æ¡†æ¶/Vue","permalink":"http://yoursite.com/categories/æ¡†æ¶/Vue/"},{"name":"é—®é¢˜ç§¯ç´¯","slug":"æ¡†æ¶/Vue/é—®é¢˜ç§¯ç´¯","permalink":"http://yoursite.com/categories/æ¡†æ¶/Vue/é—®é¢˜ç§¯ç´¯/"}],"tags":[{"name":"vue","slug":"vue","permalink":"http://yoursite.com/tags/vue/"},{"name":"form","slug":"form","permalink":"http://yoursite.com/tags/form/"}]},{"title":"Vueä¹‹æ”¹å˜è·¯ç”±é¡µé¢å›åˆ°é¡¶éƒ¨","slug":"Vueä¹‹æ”¹å˜è·¯ç”±é¡µé¢å›åˆ°é¡¶éƒ¨","date":"2019-03-08T06:11:30.000Z","updated":"2019-03-08T06:15:11.019Z","comments":true,"path":"2019/03/08/Vueä¹‹æ”¹å˜è·¯ç”±é¡µé¢å›åˆ°é¡¶éƒ¨.html","link":"","permalink":"http://yoursite.com/2019/03/08/Vueä¹‹æ”¹å˜è·¯ç”±é¡µé¢å›åˆ°é¡¶éƒ¨.html","excerpt":"","text":"é—®é¢˜æè¿°vueæ˜¯å•é¡µåº”ç”¨ï¼Œé€šè¿‡æ”¹å˜hashå€¼æ¥å®ç°ä¸åŒé¡µé¢ä¹‹å‰çš„è·³è½¬ï¼Œå½“ä¸€ä¸ªé¡µé¢æ»šåŠ¨åˆ°åº•éƒ¨æ—¶ï¼Œç„¶åè·³è½¬åˆ°å¦ä¸€ä¸ªä¹Ÿé¢ï¼ŒåŒæ ·ä¼šåœ¨é¡µé¢åº•éƒ¨ï¼Œå¹¶ä¸ä¼šå›åˆ°é¡¶éƒ¨ vue-router scrollBehaviorå½“åˆ›å»ºä¸€ä¸ªrouterå®ä¾‹æ—¶ï¼Œå¯ä»¥æä¾›ä¸€ä¸ªscrollBehavioræ–¹æ³•æ§åˆ¶è·¯ç”±è·³è½¬æ—¶é¡µé¢æ»šåŠ¨æ¡çš„ä½ç½® 123456const router = new VueRouter(&#123; routes: [...], scrollBehavior (to, from, savedPosition) &#123; // return æœŸæœ›æ»šåŠ¨åˆ°å“ªä¸ªçš„ä½ç½® &#125;&#125;) å…·ä½“çš„ä½¿ç”¨æ–¹æ³•ç‚¹è¿™é‡Œï¼Œä½†æ˜¯è¯¥æ–¹æ³•åªåœ¨æ”¯æŒhistory.pushStateçš„æµè§ˆå™¨ä¸­å¯ç”¨ï¼Œç§»åŠ¨ç«¯ä¸å­˜åœ¨é—®é¢˜ï¼Œpcç«¯IE10+ä»¥ä¸Šï¼Œå› æ­¤å¯¹pcç«¯çš„è§£å†³æ–¹æ³•è¿›è¡Œäº†æ¢ç´¢ vue-router beforeEach&amp;afterEachä¸­å›åˆ°é¡¶éƒ¨æ“ä½œå­˜åœ¨çš„é—®é¢˜123router.afterEach((to, from, next) =&gt; &#123; document.documentElement.scrollTop = 0&#125;) ä»¥ä¸Šæ–¹æ³•åœ¨è·³è½¬é¡µé¢æ—¶é¡µé¢ä¼šé—ªçƒä¸€ä¸‹ï¼ŒåŸå› æ˜¯å› ä¸ºdomçš„æ›´æ–°æ“ä½œåœ¨è§¦å‘afterEachçš„å›è°ƒå‡½æ•°ä¹‹åè¿›è¡Œï¼Œä¹Ÿå°±æ˜¯æ‰€è§¦å‘afterEachå‡½æ•°çš„æ—¶å€™ï¼Œé¡µé¢çš„domå…¶å®è¿˜æ˜¯æ—§çš„é¡µé¢çš„domï¼Œæ‰€ä»¥å½“è®¾ç½®æ»šåŠ¨æ¡çš„ä½ç½®æ—¶ï¼Œä¼šåœ¨æ—§é¡µé¢å…ˆå›åˆ°é¡¶éƒ¨ï¼Œå†æ›´æ–°æˆæ–°é¡µé¢çš„domï¼Œä¸‹é¢æ˜¯vue-routerå®Œæ•´çš„å¯¼èˆªè§£ææµç¨‹ï¼š åˆ©ç”¨å®šæ—¶å™¨åˆ©ç”¨å®šæ—¶å™¨å°†æ›´æ”¹æ»šåŠ¨æ¡ä½ç½®çš„æ“ä½œæ”¾å…¥åˆ°macrotasksäº‹ä»¶é˜Ÿåˆ—æœ«å°¾ï¼Œå³åœ¨æ›´æ–°domæ“ä½œä¹‹åå°±å¯ä»¥è§£å†³é¡µé¢é—ªçƒçš„é—®é¢˜äº† 12345router.afterEach((to, from, next) =&gt; &#123; setTimeout(() =&gt; &#123; document.documentElement.scrollTop = 0 &#125;, 0)&#125;) è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œå½“åˆ·æ–°å½“å‰é¡µé¢çš„æ—¶å€™ï¼Œæµè§ˆå™¨ä¼šè®°å½•å½“å‰é¡µé¢æ»šåŠ¨æ¡ï¼Œå¹¶åœ¨åˆ·æ–°é¡µé¢åå°†æ»šåŠ¨æ¡çš„ä½ç½®æ¢å¤åˆ°åˆ·æ–°é¡µé¢ä¹‹å‰ï¼Œæµ‹è¯•äº†ä¸¤ç§æµè§ˆå™¨ï¼Œè¡¨ç°ä¸ä¸€è‡´ï¼š chromeï¼šå…ˆå›åˆ°é¡µé¢é¡¶éƒ¨-&gt;å†å›åˆ°åˆ·æ–°ä¹‹å‰ä½ç½®ï¼Œå¯¼è‡´é¡µé¢é—ªçƒ firefoxï¼šå›åˆ°é¡µé¢é¡¶éƒ¨ ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œéœ€è¦å¯¹åˆ·æ–°é¡µé¢çš„æ—¶å€™è¿›è¡Œé¢å¤–å¤„ç†ï¼Œä¸å›åˆ°é¡µé¢é¡¶éƒ¨ï¼Œå¯ä»¥æ ¹æ®afterEachå›è°ƒå‡½æ•°çš„fromå‚æ•°æ¥åˆ¤æ–­ï¼Œå½“åˆ·æ–°é¡µé¢æˆ–ç¬¬ä¸€æ¬¡è¿›å…¥é¡µé¢æ—¶ï¼Œfrom.nameä¸ºnullï¼š 12345router.afterEach((to, from, next) =&gt; &#123; from.name &amp;&amp; setTimeout(() =&gt; &#123; document.documentElement.scrollTop = 0 &#125;, 0)&#125;)","categories":[{"name":"æ¡†æ¶","slug":"æ¡†æ¶","permalink":"http://yoursite.com/categories/æ¡†æ¶/"},{"name":"Vue","slug":"æ¡†æ¶/Vue","permalink":"http://yoursite.com/categories/æ¡†æ¶/Vue/"},{"name":"é—®é¢˜ç§¯ç´¯","slug":"æ¡†æ¶/Vue/é—®é¢˜ç§¯ç´¯","permalink":"http://yoursite.com/categories/æ¡†æ¶/Vue/é—®é¢˜ç§¯ç´¯/"}],"tags":[{"name":"vue","slug":"vue","permalink":"http://yoursite.com/tags/vue/"},{"name":"vue-router","slug":"vue-router","permalink":"http://yoursite.com/tags/vue-router/"}]},{"title":"videoæ ‡ç­¾ä½¿ç”¨v-showæ’­æ”¾å¤±è´¥","slug":"videoæ ‡ç­¾ä½¿ç”¨v-showæ’­æ”¾å¤±è´¥","date":"2019-03-08T06:06:52.000Z","updated":"2019-03-08T06:10:20.423Z","comments":true,"path":"2019/03/08/videoæ ‡ç­¾ä½¿ç”¨v-showæ’­æ”¾å¤±è´¥.html","link":"","permalink":"http://yoursite.com/2019/03/08/videoæ ‡ç­¾ä½¿ç”¨v-showæ’­æ”¾å¤±è´¥.html","excerpt":"","text":"video source src å¼‚æ­¥èµ‹å€¼æ’­æ”¾å¤±è´¥å¦‚å›¾æ‰€ç¤ºï¼Œv-showæ§åˆ¶videoæ ‡ç­¾æ˜¯å¦æ˜¾ç¤ºï¼ŒshowVideoåˆå§‹å€¼ä¸ºfalseï¼Œæ¨¡æ‹Ÿæ¥å£å¼‚æ­¥è¿”å›è§†é¢‘é“¾æ¥ï¼Œç„¶åæ”¹å˜è§†é¢‘çš„srcï¼Œä½†æ­¤æ—¶è§†é¢‘æ²¡æœ‰æˆåŠŸæ’­æ”¾ï¼ŒNetworkä¸­ä¹Ÿæ²¡æœ‰å»åŠ è½½å¯¹åº”çš„è§†é¢‘èµ„æº Why?å¤§å®¶éƒ½çŸ¥é“v-showæ§åˆ¶çš„cssçš„visibilityå±æ€§ï¼Œå®é™…ä¸Šæ— è®ºv-showçš„å€¼æ˜¯trueæˆ–è€…falseéƒ½ä¼šå»æ¸²æŸ“domï¼Œå¯è§ï¼Œè§†é¢‘æ’­æ”¾å¤±è´¥è·Ÿv-showå¹¶æ²¡æœ‰å¤šå¤§çš„å…³ç³»ï¼Œäºæ˜¯æˆ‘ä»¬æŠŠv-showå»äº†éªŒè¯ä¸€ä¸‹ï¼š åŒæ ·ï¼Œè§†é¢‘ä¹Ÿæ’­æ”¾å¤±è´¥ï¼Œå¹¶ä¸”Networkä¸­ä¹Ÿæ²¡æœ‰è§†é¢‘èµ„æºçš„åŠ è½½è®°å½•ï¼Œç”±æ­¤å¯æ¨æ–­ï¼Œå½“videoä¸­å­˜åœ¨sourceæ ‡ç­¾çš„æ—¶å€™ï¼Œæµè§ˆå™¨æ¸²æŸ“ä¹‹åä¼šè‡ªåŠ¨å»åŠ è½½srcå¯¹åº”çš„èµ„æºï¼Œåç»­å³ä¾¿åœ°å€æ”¹å˜ï¼Œæµè§ˆå™¨ä¹Ÿä¸ä¼šå†å»è·å–èµ„æº è§£å†³æ–¹æ³• srcå±æ€§æ·»åŠ åˆ°videoæ ‡ç­¾ä¸Š ä½¿ç”¨v-ifæ›¿ä»£v-showï¼Œè§¦å‘domé‡æ’ è§¦å‘videoçš„loadæ–¹æ³•","categories":[{"name":"æ¡†æ¶","slug":"æ¡†æ¶","permalink":"http://yoursite.com/categories/æ¡†æ¶/"},{"name":"Vue","slug":"æ¡†æ¶/Vue","permalink":"http://yoursite.com/categories/æ¡†æ¶/Vue/"},{"name":"é—®é¢˜ç§¯ç´¯","slug":"æ¡†æ¶/Vue/é—®é¢˜ç§¯ç´¯","permalink":"http://yoursite.com/categories/æ¡†æ¶/Vue/é—®é¢˜ç§¯ç´¯/"}],"tags":[{"name":"vue","slug":"vue","permalink":"http://yoursite.com/tags/vue/"},{"name":"html","slug":"html","permalink":"http://yoursite.com/tags/html/"},{"name":"video","slug":"video","permalink":"http://yoursite.com/tags/video/"},{"name":"v-show","slug":"v-show","permalink":"http://yoursite.com/tags/v-show/"}]},{"title":"Vueä¹‹Domå¤ç”¨","slug":"Vueä¹‹Domå¤ç”¨","date":"2019-03-08T05:53:19.000Z","updated":"2019-03-08T06:08:24.780Z","comments":true,"path":"2019/03/08/Vueä¹‹Domå¤ç”¨.html","link":"","permalink":"http://yoursite.com/2019/03/08/Vueä¹‹Domå¤ç”¨.html","excerpt":"","text":"é—®é¢˜æè¿° å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œé¡µé¢ä¸­é€šè¿‡éå†æ•°ç»„å¾ªç¯å‡ºnä¸ªç»„ä»¶ï¼Œå¹¶ä¼ å…¥msgå€¼åœ¨ç»„ä»¶ä¸­æ˜¾ç¤ºï¼Œç‚¹å‡»åˆ é™¤æŒ‰é’®æ—¶ï¼Œè§¦å‘çˆ¶ç»„ä»¶çš„æ–¹æ³•ï¼Œåˆ é™¤è¯¥ç»„ä»¶ï¼Œåœ¨é¡µé¢ä¸­æˆ‘ä»¬è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š åœ¨3ä¸ªè¾“å…¥æ¡†ä¸­ä¾æ¬¡è¾“å…¥1ï¼Œ2ï¼Œ3 ç‚¹å‡»ç¬¬äºŒä¸ªåˆ é™¤æŒ‰é’® æˆåŠŸåˆ é™¤ç»„ä»¶ï¼Œä½†æœ€ç»ˆæ•ˆæœå¹¶ä¸æ˜¯æˆ‘ä»¬æ‰€æœŸæœ›çš„ä¸‹å›¾ä¸­çš„æ ·å­ Why ï¼ŸVueç»„ä»¶å¤ç”¨é—®é¢˜ï¼Œè¿™ä¸ªé—®é¢˜æ¶‰åŠåˆ°Vueçš„diffç®—æ³•ï¼Œè¿™é‡Œåªåšç®€å•æ¦‚è¿°ï¼Œå¦‚æœæƒ³è¦è¯¦ç»†äº†è§£ï¼Œè¯·å‚è€ƒæ–‡æ¡£Vue diffç®—æ³•åŸç†ï¼ŒVueä¸ºäº†ä½¿å¾—æ›´æ–°domæ—¶æ›´åŠ çš„æœ‰æ•ˆç‡ï¼Œåœ¨æ›´æ–°æ•°æ®åï¼Œé‡æ–°æ¸²æŸ“domæ—¶ï¼Œä¼šå¯¹æ¯”åŒå±‚domèŠ‚ç‚¹çš„ç±»å‹ï¼ˆæ ‡ç­¾ç±»å‹æˆ–è‡ªå®šä¹‰ç»„ä»¶ç±»å‹ï¼‰æ˜¯å¦ç›¸åŒï¼Œå¦‚æœç›¸åŒï¼Œåˆ™ç›´æ¥å¤ç”¨ä¹‹å‰çš„ç»„ä»¶ï¼Œåªè¿›è¡Œæ•°æ®çš„æ›´æ–°ï¼Œæ”¾åˆ°è¿™ä¸ªä¾‹å­é‡Œï¼Œè¯´ç™½äº†ï¼Œå½“å‰å‰©ä¸‹çš„ä¸¤ä¸ªè¾“å…¥æ¡†ç»„ä»¶å…¶å®æ˜¯ä¹‹å‰3ä¸ªä¸­çš„å‰2ä¸ªï¼Œå› ä¸ºmsgæ˜¯é€šè¿‡propä¼ å…¥åˆ°å­ç»„ä»¶çš„ï¼Œæ‰€ä»¥å½“æ”¹å˜arræ•°ç»„æ—¶ï¼Œè§¦å‘domæ›´æ–°ï¼Œè™½ç„¶å¤ç”¨äº†ä¹‹å‰çš„2ä¸ªç»„ä»¶ï¼Œä½†ä¼ å…¥çš„propæ˜¯ä¼šæ”¹å˜çš„ï¼Œä½†å› ä¸ºinputæ¡†æ˜¯å­˜åœ¨äºå­ç»„ä»¶æœ¬èº«ï¼Œå¹¶æ²¡æœ‰ä¾èµ–çˆ¶å…ƒç´ çš„å€¼ï¼Œæ‰€ä»¥inputæ¡†é‡Œçš„å€¼æ˜¯ä¸ä¼šå˜çš„ :key=â€indexâ€å­˜åœ¨çš„é—®é¢˜å¾ˆå¤šäººä¸ºäº†è§„é¿ç¼–è¾‘å™¨çš„é”™è¯¯æç¤ºï¼Œä¼šåœ¨å¾ªç¯æ—¶åŠ ä¸Š:key=â€indexâ€ï¼Œè¿™å¹¶æ²¡æœ‰æ”¹å˜vueçš„diffç®—æ³•ï¼Œä¸æ²¡åŠ çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œæ‰€æœ‰ç»„ä»¶å†…çš„å€¼éƒ½éœ€è¦é‡æ–°æ¸²æŸ“ä¸€æ¬¡ï¼š å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œç¬¬ä¸€æ¬¡éå†arræ—¶ï¼Œarrä¸­çš„3ä¸ªå€¼1,2,3å¯¹åº”çš„arrIndexçš„åˆ†åˆ«æ˜¯0ï¼Œ1ï¼Œ2ï¼Œå½“åˆ é™¤ç¬¬äºŒä¸ªç»„ä»¶æ—¶ï¼Œarrä¸º[1,3]ï¼Œé‡æ–°éå†æ¸²æŸ“æ—¶ï¼Œ1ï¼Œ3å¯¹åº”çš„arrIndexåˆ†åˆ«ä¸º0ï¼Œ1ï¼Œç›¸å½“äºå¤ç”¨äº†ä¹‹å‰arrIndexä¸º0ï¼Œ1çš„ä¸¤ä¸ªç»„ä»¶ï¼Œä¹Ÿå°±æ˜¯è·Ÿæ²¡åŠ :key=â€indexâ€æ‰€äº§ç”Ÿçš„æ•ˆæœæ˜¯ç›¸åŒçš„ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆåŠ äº†:key=â€arrIndexâ€è¿˜æ˜¯æ— æ³•è¾¾åˆ°æˆ‘ä»¬æ‰€æœŸæœ›çš„æ•ˆæœ :key=â€å”¯ä¸€idâ€è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ç»™arrä¸­çš„æ¯ä¸€é¡¹ç”Ÿæˆä¸€ä¸ªä¸å¯å˜çš„å”¯ä¸€idï¼Œåˆ™åˆ é™¤æ—¶ï¼Œå°±èƒ½æ ¹æ®å”¯ä¸€idå»å‡†ç¡®çš„æ‰¾åˆ°å…¶ä¹‹å‰æ‰€å¯¹åº”çš„domäº†ï¼Œè¾¾åˆ°å‡†ç¡®å¤ç”¨","categories":[{"name":"æ¡†æ¶","slug":"æ¡†æ¶","permalink":"http://yoursite.com/categories/æ¡†æ¶/"},{"name":"Vue","slug":"æ¡†æ¶/Vue","permalink":"http://yoursite.com/categories/æ¡†æ¶/Vue/"},{"name":"é—®é¢˜ç§¯ç´¯","slug":"æ¡†æ¶/Vue/é—®é¢˜ç§¯ç´¯","permalink":"http://yoursite.com/categories/æ¡†æ¶/Vue/é—®é¢˜ç§¯ç´¯/"}],"tags":[{"name":"Vue","slug":"Vue","permalink":"http://yoursite.com/tags/Vue/"}]},{"title":"æ·±å…¥æµ…å‡ºNodeJsï¼ˆè¯»ä¹¦ç¬”è®°ï¼‰","slug":"æ·±å…¥æµ…å‡ºNodeJsï¼ˆè¯»ä¹¦ç¬”è®°ï¼‰","date":"2019-03-08T05:36:14.000Z","updated":"2019-03-08T05:49:02.478Z","comments":true,"path":"2019/03/08/æ·±å…¥æµ…å‡ºNodeJsï¼ˆè¯»ä¹¦ç¬”è®°ï¼‰.html","link":"","permalink":"http://yoursite.com/2019/03/08/æ·±å…¥æµ…å‡ºNodeJsï¼ˆè¯»ä¹¦ç¬”è®°ï¼‰.html","excerpt":"","text":"ç¬¬ä¸€ç«  Nodeç®€ä»‹ åœ¨Nodeä¸­ï¼Œç»å¤§å¤šæ•°çš„æ“ä½œéƒ½æ˜¯ä»¥å¼‚æ­¥çš„æ–¹å¼è¿›è¡Œè°ƒç”¨ Nodeç›¸æ¯”äºå…¶å®ƒå¤§å¤šæ•°åç«¯è¯­è¨€çš„ç‹¬ç‰¹ä¹‹å¤„ï¼šäº‹ä»¶é©±åŠ¨ã€å¼‚æ­¥ã€å›è°ƒå‡½æ•° Nodeä¿æŒäº†JSåœ¨æµè§ˆå™¨ä¸­å•çº¿ç¨‹çš„ç‰¹ç‚¹ã€‚åœ¨Nodeä¸­ï¼ŒJSä¸å…¶ä½™çº¿ç¨‹æ˜¯æ— æ³•å…±äº«ä»»ä½•çŠ¶æ€çš„ã€‚å•çº¿ç¨‹çš„æœ€å¤§å¥½å¤„æ˜¯ä¸ç”¨åƒå¤šçº¿ç¨‹é‚£æ ·å¤„å¤„åœ¨æ„çŠ¶æ€çš„åŒæ­¥é—®é¢˜ï¼Œè¿™é‡Œæ²¡æœ‰æ­»é”çš„å­˜åœ¨ï¼Œä¹Ÿæ²¡æœ‰çº¿ç¨‹ä¸Šä¸‹æ–‡äº¤æ¢å¸¦æ¥çš„æ€§èƒ½ä¸Šçš„å¼€é”€ã€‚å•çº¿ç¨‹çš„å¼±ç‚¹ï¼š æ— æ³•åˆ©ç”¨å¤šæ ¸CPU é”™è¯¯ä¼šå¼•èµ·æ•´ä¸ªåº”ç”¨é€€å‡ºï¼Œåº”ç”¨çš„å¥å£®æ€§å€¼å¾—è€ƒéªŒ å¤§é‡è®¡ç®—å ç”¨CPUå¯¼è‡´æ— æ³•ç»§ç»­è°ƒç”¨å¼‚æ­¥I/O Nodeçš„åº”ç”¨åœºæ™¯ï¼š I/Oå¯†é›†å‹ï¼šä»å•çº¿ç¨‹çš„è§’åº¦æ¥è¯´ï¼ŒNodeå¤„ç†I/Oçš„èƒ½åŠ›æ˜¯å€¼å¾—ç«–èµ·æ‹‡æŒ‡ç§°èµçš„ã€‚é€šå¸¸ï¼Œè¯´Nodeæ“…é•¿I/Oå¯†é›†å‹çš„åº”ç”¨åœºæ™¯åŸºæœ¬ä¸Šæ˜¯æ²¡äººåå¯¹çš„ã€‚Nodeé¢å‘ç½‘ç»œä¸”æ“…é•¿å¹¶è¡ŒI/Oï¼Œèƒ½å¤Ÿæœ‰æ•ˆåœ°ç»„ç»‡èµ·æ›´å¤šçš„ç¡¬ä»¶èµ„æºï¼Œä»è€Œæä¾›æ›´å¤šå¥½çš„æœåŠ¡ã€‚I/Oå¯†é›†å‹çš„ä¼˜åŠ¿ä¸»è¦åœ¨äºNodeåˆ©ç”¨äº‹ä»¶å¾ªç¯çš„å¤„ç†èƒ½åŠ›ï¼Œè€Œä¸æ˜¯å¯åŠ¨æ¯ä¸€ä¸ªçº¿ç¨‹ä¸ºæ¯ä¸€ä¸ªè¯·æ±‚æœåŠ¡ï¼Œèµ„æºå ç”¨æå°‘ CPUå¯†é›†å‹ï¼šCPUå¯†é›†å‹åº”ç”¨ç»™Nodeå¸¦æ¥çš„æŒ‘æˆ˜ä¸»è¦æ˜¯ï¼šç”±äºJSå•çº¿ç¨‹çš„åŸå› ï¼Œå¦‚æœæœ‰é•¿æ—¶é—´è¿è¡Œçš„è®¡ç®—ï¼ˆæ¯”å¦‚å¤§å¾ªç¯ï¼‰ï¼Œå°†ä¼šå¯¼è‡´CPUæ—¶é—´ç‰‡ä¸èƒ½é‡Šæ”¾ï¼Œä½¿å¾—åç»­I/Oæ— æ³•å‘èµ·ã€‚ä½†æ˜¯é€‚å½“è°ƒæ•´å’Œåˆ†è§£å¤§å‹è¿ç®—ä»»åŠ¡ä¸ºå¤šä¸ªå°ä»»åŠ¡ï¼Œä½¿å¾—è¿ç®—èƒ½å¤Ÿé€‚æ—¶é‡Šæ”¾ï¼Œä¸é˜»å¡I/Oè°ƒç”¨çš„å‘èµ·ï¼Œè¿™æ ·æ—¢å¯ä»¥åŒäº‹äº«å—åˆ°å¹¶è¡Œå¼‚æ­¥I/Oçš„å¥½å¤„ï¼Œåˆèƒ½å……åˆ†åˆ©ç”¨CPU èº«ä¸ºå•çº¿ç¨‹çš„åº”ç”¨ï¼ŒNodeå¦‚ä½•èƒ½å¤Ÿå……åˆ†çš„åˆ©ç”¨CPU? Nodeå¯ä»¥é€šè¿‡ç¼–å†™C/C++æ‰©å±•çš„æ–¹å¼æ›´é«˜æ•ˆåœ°åˆ©ç”¨CPUï¼Œå°†ä¸€äº›V8ä¸èƒ½åšåˆ°æ€§èƒ½æè‡´çš„åœ°æ–¹é€šè¿‡C/C++æ¥å®ç° é€šè¿‡åˆ›å»ºå­è¿›ç¨‹çš„æ–¹å¼ï¼Œå°†ä¸€éƒ¨åˆ†Nodeè¿›ç¨‹å½“åšå¸¸é©»æœåŠ¡è¿›ç¨‹ç”¨äºè®¡ç®—ï¼Œç„¶ååˆ©ç”¨è¿›ç¨‹é—´çš„æ¶ˆæ¯æ¥ä¼ é€’ç»“æœï¼Œå°†è®¡ç®—ä¸I/Oåˆ†ç¦»ï¼Œè¿™æ ·è¿˜èƒ½å……åˆ†åˆ©ç”¨å¤šCPU Nodeä½¿ç”¨è€…çš„å„è‡ªå€šé‡ç‚¹ï¼š å‰åç«¯ç¼–ç¨‹è¯­è¨€ç¯å¢ƒç»Ÿä¸€ Nodeå¸¦æ¥çš„é«˜æ€§èƒ½I/Oç”¨äºå®æ—¶åº”ç”¨ å¹¶è¡ŒI/Oä½¿å¾—ä½¿ç”¨è€…å¯ä»¥æ›´é«˜æ•ˆçš„åˆ©ç”¨åˆ†å¸ƒå¼ç¯å¢ƒ å¹¶è¡ŒI/Oï¼Œæœ‰æ•ˆåˆ©ç”¨ç¨³å®šæ¥å£æå‡Webæ¸²æŸ“èƒ½åŠ› äº‘è®¡ç®—å¹³å°æä¾›Nodeæ”¯æŒ æ¸¸æˆå¼€å‘é¢†åŸŸ å·¥å…·ç±»åº”ç”¨ ç¬¬äºŒç«  æ¨¡å—æœºåˆ¶ åœ¨Web1.0æ—¶ä»£ï¼Œå¯¹äºJSè‡ªèº«è€Œè¨€ï¼Œå®ƒçš„è§„èŒƒæ˜¯è–„å¼±çš„ï¼Œå­˜åœ¨ä»¥ä¸‹ç¼ºé™·ï¼š æ²¡æœ‰æ¨¡å—ç³»ç»Ÿ æ ‡å‡†åº“è¾ƒå°‘ æ²¡æœ‰æ ‡å‡†æ¥å£ ç¼ºä¹åŒ…ç®¡ç†ç³»ç»Ÿ CommonJSè§„èŒƒ æ¨¡å—å¼•ç”¨ï¼švar mathModule = require(â€˜mathModuleâ€™) æ¨¡å—å¯¼å‡ºï¼šexports.add = function (x, y) { return x + y } Nodeåœ¨å®ç°ä¸­å¹¶éå®Œå…¨æŒ‰ç…§è§„èŒƒå®ç°ï¼Œè€Œæ˜¯å¯¹æ¨¡å—è§„èŒƒè¿›è¡Œäº†ä¸€å®šçš„å–èˆï¼Œåœ¨Nodeä¸­å¼•å…¥æ¨¡å—ï¼Œéœ€è¦ç»å†å¦‚ä¸‹3ä¸ªæ­¥éª¤ï¼š è·¯å¾„åˆ†æ æ–‡ä»¶å®šä½ ç¼–è¯‘æ‰§è¡Œ åœ¨Nodeä¸­æ¨¡å—åˆ†ä¸ºä¸¤ç±»ï¼š æ ¸å¿ƒæ¨¡å—ï¼šæ ¸å¿ƒæ¨¡å—éƒ¨åˆ†åœ¨Nodeæºä»£ç çš„ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œç¼–è¯‘è¿›äº†äºŒè¿›åˆ¶æ‰§è¡Œæ–‡ä»¶ã€‚åœ¨Nodeè¿›ç¨‹å¯åŠ¨æ—¶ï¼Œéƒ¨åˆ†æ ¸å¿ƒæ¨¡å—å°±è¢«ç›´æ¥åŠ è½½è¿›å†…å­˜ä¸­ï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†æ ¸å¿ƒæ¨¡å—å¼•å…¥æ—¶ï¼Œæ–‡ä»¶å®šä½å’Œç¼–è¯‘æ‰§è¡Œè¿™ä¸¤ä¸ªæ­¥éª¤å¯ä»¥çœç•¥æ‰ï¼Œå¹¶ä¸”åœ¨è·¯å¾„åˆ†æä¸­ä¼˜å…ˆåˆ¤æ–­ï¼Œæ‰€ä»¥å®ƒçš„åŠ è½½é€Ÿåº¦æ˜¯æœ€å¿«çš„ æ–‡ä»¶æ¨¡å—ï¼šæ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€åŠ è½½ï¼Œéœ€è¦å®Œæ•´çš„è·¯å¾„åˆ†æã€æ–‡ä»¶å®šä½ã€ç¼–è¯‘æ‰§è¡Œè¿‡ç¨‹ï¼Œé€Ÿåº¦æ¯”æ ¸å¿ƒæ¨¡å—æ…¢ ä¸å‰ç«¯æµè§ˆå™¨ä¼šç¼“å­˜é™æ€è„šæœ¬æ–‡ä»¶ä»¥æé«˜æ€§èƒ½ä¸€æ ·ï¼ŒNodeå¯¹å¼•å…¥è¿‡çš„æ¨¡å—éƒ½ä¼šè¿›è¡Œç¼“å­˜ï¼Œä»¥å‡å°‘äºŒæ¬¡å¼•å…¥æ—¶çš„å¼€é”€ã€‚ä¸åŒçš„åœ°æ–¹åœ¨äºï¼Œæµè§ˆå™¨ä»…ä»…ç¼“å­˜æ–‡ä»¶ï¼Œè€ŒNodeç¼“å­˜çš„æ˜¯ç¼–è¯‘å’Œæ‰§è¡Œä¹‹åçš„å¯¹è±¡ã€‚ æ¨¡å—æ ‡è¯†ç¬¦åˆ†æ æ¨¡å—è¡¨ç¤ºç¬¦çš„åˆ†ç±»ï¼š æ ¸å¿ƒæ¨¡å—ï¼Œå¦‚httpsã€fsã€pathç­‰ .æˆ–..å¼€å§‹çš„ç›¸å¯¹è·¯å¾„æ–‡ä»¶æ¨¡å— ä»¥/å¼€å§‹çš„ç»å¯¹è·¯å¾„æ–‡ä»¶æ¨¡å— éè·¯å¾„å½¢å¼çš„æ–‡ä»¶æ¨¡å—ï¼Œå¦‚è‡ªå®šä¹‰çš„connectæ¨¡å— Nodeæ¨¡å—åŠ è½½é¡ºåºï¼šæ ¸å¿ƒæ¨¡å— &gt; æ–‡ä»¶æ¨¡å— &gt; è‡ªå®šä¹‰æ¨¡å—ï¼ˆéœ€è¦æŒ‰ç…§module.pathsè·¯å¾„ä¸€å±‚å±‚å‘ä¸Šå¯»æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°ç›®æ ‡æ–‡ä»¶æˆ–ç³»ç»Ÿæ ¹ç›®å½•ä¸ºæ­¢ï¼‰ CommonJSæ¨¡å—è§„èŒƒå…è®¸åœ¨æ ‡è¯†ç¬¦ä¸­ä¸åŒ…å«æ–‡ä»¶æ‰©å±•åï¼Œè¿™ç§æƒ…å†µä¸‹ï¼ŒNodeä¼šæŒ‰.jsã€.jsonã€.nodeçš„æ¬¡åºè¡¥è¶³æ‰©å±•åï¼Œä¾æ¬¡å°è¯•ã€‚åœ¨å°è¯•çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦è°ƒç”¨fsæ¨¡å—åŒæ­¥é˜»å¡å¼åœ°åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚å› ä¸ºNodeæ˜¯å•çº¿ç¨‹çš„ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯ä¸€ä¸ªä¼šå¼•èµ·æ€§èƒ½é—®é¢˜çš„åœ°æ–¹ã€‚å°è¯€çªæ˜¯ï¼šå¦‚æœæ˜¯.nodeå’Œ.jsonæ–‡ä»¶ï¼Œåœ¨ä¼ é€’ç»™require()çš„æ ‡è¯†ç¬¦ä¸­å¸¦ä¸Šæ‰©å±•åï¼Œä¼šåŠ å¿«ä¸€ç‚¹é€Ÿåº¦ã€‚å¦ä¸€ä¸ªè¯€çªæ˜¯ï¼šåŒæ­¥é…åˆç¼“å­˜ï¼Œå¯ä»¥å¤§å¹…åº¦ç¼“è§£Nodeå•çº¿ç¨‹ä¸­é˜»å¡å¼è°ƒç”¨çš„ç¼ºé™·ã€‚ æ¨¡å—ç¼–è¯‘ï¼Œæ¯ä¸€ä¸ªç¼–è¯‘æˆåŠŸçš„æ¨¡å—éƒ½ä¼šå°†å…¶æ–‡ä»¶è·¯å¾„ä½œä¸ºç´¢å¼•ç¼“å­˜åœ¨Module._cacheå¯¹è±¡ä¸Š 12345678910111213// åœ¨Nodeä¸­ï¼Œæ¯ä¸ªæ–‡ä»¶æ¨¡å—éƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒçš„å®šä¹‰å¦‚ä¸‹function Module(id, parent) &#123; this.id = id this.exports = &#123;&#125; this.parent = parent if (parent &amp;&amp; parent.children) &#123; parent.children.push(this) &#125; this.filename = null this.loaded = false this.children = []&#125; å¯¹äºä¸åŒçš„æ–‡ä»¶æ‰©å±•åï¼Œæ¨¡å—è½½å…¥çš„æ–¹æ³•ä¹Ÿæœ‰æ‰€ä¸åŒ .jsæ–‡ä»¶ï¼šé€šè¿‡fsæ¨¡å—åŒæ­¥è¯»å–æ–‡ä»¶åç¼–è¯‘æ‰§è¡Œ .nodeæ–‡ä»¶ï¼šè¿™æ˜¯ç”¨C/C++ç¼–å†™çš„æ‰©å±•æ–‡ä»¶ï¼Œé€šè¿‡dlopen()æ–¹æ³•åŠ è½½æœ€åç¼–è¯‘ç”Ÿæˆçš„æ–‡ä»¶ .jsonæ–‡ä»¶ï¼šé€šè¿‡fsæ¨¡å—åŒæ­¥è¯»å–æ–‡ä»¶åï¼Œç”¨JSON.parse()è§£æè¿”å›ç»“æœ å…¶ä½™æ‰©å±•åæ–‡ä»¶ï¼šå®ƒä»¬éƒ½è¢«å½“åš.jsæ–‡ä»¶è½½å…¥ npm install -gæ˜¯å°†ä¸€ä¸ªåŒ…å®‰è£…ä¸ºå…¨å±€å¯ç”¨çš„å¯æ‰§è¡Œå‘½ä»¤ å‰ç«¯æ¨¡å—åŒ– CommonJSï¼šCommonJSç”¨åŒæ­¥çš„æ–¹å¼åŠ è½½æ¨¡å—ï¼Œåœ¨æœåŠ¡ç«¯ï¼Œæ¨¡å—æ–‡ä»¶éƒ½å­˜åœ¨æœ¬åœ°ç£ç›˜ï¼Œè¯»å–éå¸¸å¿«ï¼Œæ‰€ä»¥è¿™æ ·åšä¸ä¼šæœ‰é—®é¢˜ã€‚ä½†æ˜¯åœ¨æµè§ˆå™¨ç«¯ï¼Œé™äºç½‘ç»œåŸå› ï¼Œæ›´åˆç†çš„æ–¹æ¡ˆæ˜¯ä½¿ç”¨å¼‚æ­¥åŠ è½½ AMDï¼šå¼‚æ­¥æ¨¡å—å®šä¹‰ï¼Œé‡‡ç”¨å¼‚æ­¥çš„æ–¹å¼åŠ è½½æ¨¡å—ï¼Œæ¨¡å—çš„åŠ è½½ä¸å½±å“åé¢è¯­å¥çš„æ‰§è¡Œï¼Œä¾èµ–å‰ç½®ï¼Œæå‰æ‰§è¡Œï¼Œå®šä¹‰æ¨¡å—æ—¶è¦å¯¹å…¶ä¾èµ–è¿›è¡Œå£°æ˜ CMDï¼šé€šç”¨æ¨¡å—å®šä¹‰ï¼Œä¾èµ–å°±è¿‘ï¼Œåœ¨éœ€è¦æ—¶è¿›è¡Œå¼•å…¥ï¼Œå»¶è¿Ÿæ‰§è¡Œï¼ˆå¹¶ä¸æ˜¯å»¶è¿ŸåŠ è½½ï¼‰ï¼Œç›¸å¯¹äºAMDï¼Œæ›´è´´è¿‘CommonJSè§„èŒƒå’ŒNode Modulesè§„èŒƒ ES6 Moduleï¼Œä¸CommonJSæ¨¡å—çš„å·®å¼‚ï¼š CommonJS æ¨¡å—è¾“å‡ºçš„æ˜¯ä¸€ä¸ªå€¼çš„æ‹·è´ï¼ŒES6 æ¨¡å—è¾“å‡ºçš„æ˜¯å€¼çš„å¼•ç”¨ CommonJS æ¨¡å—è¾“å‡ºçš„æ˜¯å€¼çš„æ‹·è´ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦è¾“å‡ºä¸€ä¸ªå€¼ï¼Œæ¨¡å—å†…éƒ¨çš„å˜åŒ–å°±å½±å“ä¸åˆ°è¿™ä¸ªå€¼ ES6 æ¨¡å—çš„è¿è¡Œæœºåˆ¶ä¸ CommonJS ä¸ä¸€æ ·ã€‚JS å¼•æ“å¯¹è„šæœ¬é™æ€åˆ†æçš„æ—¶å€™ï¼Œé‡åˆ°æ¨¡å—åŠ è½½å‘½ä»¤importï¼Œå°±ä¼šç”Ÿæˆä¸€ä¸ªåªè¯»å¼•ç”¨ã€‚ç­‰åˆ°è„šæœ¬çœŸæ­£æ‰§è¡Œæ—¶ï¼Œå†æ ¹æ®è¿™ä¸ªåªè¯»å¼•ç”¨ï¼Œåˆ°è¢«åŠ è½½çš„é‚£ä¸ªæ¨¡å—é‡Œé¢å»å–å€¼ã€‚æ¢å¥è¯è¯´ï¼ŒES6 çš„importæœ‰ç‚¹åƒ Unix ç³»ç»Ÿçš„â€œç¬¦å·è¿æ¥â€ï¼ŒåŸå§‹å€¼å˜äº†ï¼ŒimportåŠ è½½çš„å€¼ä¹Ÿä¼šè·Ÿç€å˜ã€‚å› æ­¤ï¼ŒES6 æ¨¡å—æ˜¯åŠ¨æ€å¼•ç”¨ï¼Œå¹¶ä¸”ä¸ä¼šç¼“å­˜å€¼ï¼Œæ¨¡å—é‡Œé¢çš„å˜é‡ç»‘å®šå…¶æ‰€åœ¨çš„æ¨¡å— CommonJS æ¨¡å—æ˜¯è¿è¡Œæ—¶åŠ è½½ï¼ŒES6 æ¨¡å—æ˜¯ç¼–è¯‘æ—¶è¾“å‡ºæ¥å£ è¿è¡Œæ—¶åŠ è½½: CommonJS æ¨¡å—å°±æ˜¯å¯¹è±¡ï¼›å³åœ¨è¾“å…¥æ—¶æ˜¯å…ˆåŠ è½½æ•´ä¸ªæ¨¡å—ï¼Œç”Ÿæˆä¸€ä¸ªå¯¹è±¡ï¼Œç„¶åå†ä»è¿™ä¸ªå¯¹è±¡ä¸Šé¢è¯»å–æ–¹æ³•ï¼Œè¿™ç§åŠ è½½ç§°ä¸ºâ€œè¿è¡Œæ—¶åŠ è½½â€ ç¼–è¯‘æ—¶åŠ è½½: ES6 æ¨¡å—ä¸æ˜¯å¯¹è±¡ï¼Œè€Œæ˜¯é€šè¿‡ export å‘½ä»¤æ˜¾å¼æŒ‡å®šè¾“å‡ºçš„ä»£ç ï¼Œimportæ—¶é‡‡ç”¨é™æ€å‘½ä»¤çš„å½¢å¼ã€‚å³åœ¨importæ—¶å¯ä»¥æŒ‡å®šåŠ è½½æŸä¸ªè¾“å‡ºå€¼ï¼Œè€Œä¸æ˜¯åŠ è½½æ•´ä¸ªæ¨¡å—ï¼Œè¿™ç§åŠ è½½ç§°ä¸ºâ€œç¼–è¯‘æ—¶åŠ è½½â€CommonJS åŠ è½½çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ˆå³module.exportså±æ€§ï¼‰ï¼Œè¯¥å¯¹è±¡åªæœ‰åœ¨è„šæœ¬è¿è¡Œå®Œæ‰ä¼šç”Ÿæˆã€‚è€Œ ES6 æ¨¡å—ä¸æ˜¯å¯¹è±¡ï¼Œå®ƒçš„å¯¹å¤–æ¥å£åªæ˜¯ä¸€ç§é™æ€å®šä¹‰ï¼Œåœ¨ä»£ç é™æ€è§£æé˜¶æ®µå°±ä¼šç”Ÿæˆ ç¬¬ä¸‰ç«  å¼‚æ­¥I/O ä¸ºä»€ä¹ˆè¦å¼‚æ­¥I/Oï¼Œè¿™ä¸Nodeé¢å‘ç½‘ç»œè€Œè®¾è®¡ä¸æ— å…³ç³»ï¼Œå…·ä½“åˆ°å®å¤„ï¼Œä»ä»¥ä¸‹ä¸¤ä¸ªæ–¹é¢è¯´èµ·ï¼š ç”¨æˆ·ä½“éªŒï¼šåœ¨æµè§ˆå™¨ä¸­ï¼ŒJSåœ¨å•çº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œä¸”ä¸UIæ¸²æŸ“å…±ç”¨ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™æ„å‘³ç€å½“JSæ‰§è¡Œçš„æ—¶å€™ï¼ŒUIçš„æ¸²æŸ“å’Œå“åº”æ˜¯å¤„äºåœæ»çŠ¶æ€çš„ã€‚å¦‚æœç½‘é¡µéœ€è¦ä¸´æ—¶è·å–ä¸€ä¸ªèµ„æºï¼Œé€šè¿‡åŒæ­¥çš„æ–¹å¼è·å–ï¼Œè¿™æœŸé—´UIå°†åœé¡¿ï¼Œä¸å“åº”ç”¨æˆ·çš„äº¤äº’è¡Œä¸ºï¼Œå¯ä»¥æƒ³è±¡ï¼Œè¿™æ ·çš„ç”¨æˆ·ä½“éªŒå°†ä¼šå¤šå·®ã€‚è€Œé‡‡ç”¨å¼‚æ­¥è¯·æ±‚ï¼Œåœ¨èµ„æºçš„ä¸‹è½½æœŸé—´ï¼ŒJSå’ŒUIçš„æ‰§è¡Œéƒ½ä¸ä¼šå¤„äºç­‰å¾…çŠ¶æ€ï¼Œå¯ä»¥ç»§ç»­å“åº”ç”¨æˆ·çš„äº¤äº’è¡Œä¸ºã€‚å‰ç«¯å¯ä»¥é€šè¿‡å¼‚æ­¥æ¶ˆé™¤æ‰UIé˜»å¡çš„ç°è±¡ï¼Œä½†æ˜¯å‰ç«¯è·å–èµ„æºçš„é€Ÿåº¦ä¹Ÿå–å†³äºåç«¯çš„å“åº”é€Ÿåº¦ï¼Œä¾‹å¦‚ï¼šä¸¤ä¸ªèµ„æºè·å–è€—æ—¶ä¸ºMã€Nï¼Œå¦‚æœé‡‡ç”¨åŒæ­¥æ–¹å¼è€—æ—¶ä¸ºM+Nï¼Œå¼‚æ­¥æ–¹å¼åˆ™ä¸ºMax(M, N)ï¼Œå› æ­¤åªæœ‰åç«¯èƒ½å¤Ÿå¿«é€Ÿå“åº”èµ„æºï¼Œæ‰èƒ½è®©å‰ç«¯çš„ä½“éªŒç¼–å·ã€‚ èµ„æºåˆ†é…ï¼šå¤šçº¿ç¨‹çš„ä»£ä»·åœ¨äºåˆ›å»ºçº¿ç¨‹å’Œæ‰§è¡ŒæœŸçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€è¾ƒå¤§ï¼Œå¦å¤–ï¼Œåœ¨å¤æ‚çš„ä¸šåŠ¡ä¸­ï¼Œå¤šçº¿ç¨‹ç¼–ç¨‹ç»å¸¸é¢ä¸´ç€é”å’ŒçŠ¶æ€åŒæ­¥çš„é—®é¢˜ã€‚å•çº¿ç¨‹çš„ç¼ºç‚¹åœ¨äºæ€§èƒ½ï¼ŒåŒæ­¥çš„ç¼–ç¨‹æ¨¡å‹å¯¼è‡´çš„é—®é¢˜æ˜¯ï¼Œä»»æ„ä¸€ä¸ªç•¥æ…¢çš„ä»»åŠ¡éƒ½ä¼šå¯¼è‡´åç»­æ‰§è¡Œä»£ç è¢«é˜»å¡ï¼Œç€é€ æˆèµ„æºä¸èƒ½è¢«æ›´å¥½çš„åˆ©ç”¨ã€‚æ“ä½œç³»ç»Ÿä¼šå°†CPUçš„æ—¶é—´ç‰‡åˆ†é…ç»™å…¶ä½™è¿›ç¨‹ï¼Œä»¥å…¬å¹³è€Œæœ‰æ•ˆåœ°åˆ©ç”¨èµ„æºï¼ŒåŸºäºè¿™ä¸€ç‚¹ï¼Œæœ‰çš„æœåŠ¡å™¨ä¸ºäº†æå‡å½±å“èƒ½åŠ›ï¼Œä¼šé€šè¿‡å¯åŠ¨å¤šä¸ªå·¥ä½œè¿›ç¨‹æ¥ä¸ºæ›´å¤šçš„ç”¨æˆ·æœåŠ¡ã€‚ä½†æ˜¯å¯¹äºè¿™ä¸€ç»„äººç‰©è€Œè¨€ï¼Œå®ƒæ— æ³•åˆ†å‘ä»»åŠ¡åˆ°å¤šä¸ªè¿›ç¨‹ä¸Šï¼Œæ‰€ä»¥ä¾ç„¶æ— æ³•é«˜æ•ˆåˆ©ç”¨èµ„æºï¼Œç»“æŸæ‰€æœ‰ä»»åŠ¡æ‰€éœ€çš„æ—¶é—´ä¼šæ¯”è¾ƒé•¿ã€‚å› æ­¤ï¼ŒNodeåœ¨ä¸¤è€…ä¹‹é—´ç»™å‡ºäº†å®ƒçš„æ–¹æ¡ˆï¼šåˆ©ç”¨å•çº¿ç¨‹ï¼Œè¿œç¦»å¤šçº¿ç¨‹æ­»é”ã€çŠ¶æ€åŒæ­¥ç­‰é—®é¢˜ï¼›åˆ©ç”¨å¼‚æ­¥I/Oï¼Œè®©å•çº¿ç¨‹è¿œç¦»é˜»å¡ï¼Œä»¥æ›´å¥½åœ°ä½¿ç”¨CPUã€‚ä¸ºäº†å¼¥è¡¥å•çº¿ç¨‹æ— æ³•åˆ©ç”¨å¤šæ ¸CPUçš„ç¼ºç‚¹ï¼ŒNodeæä¾›äº†ç±»ä¼¼å‰ç«¯æµè§ˆå™¨ä¸­çš„Web Workersçš„å­è¿›ç¨‹ï¼Œè¯¥å­è¿›ç¨‹å¯ä»¥é€šè¿‡å·¥ä½œè¿›ç¨‹é«˜æ•ˆåœ°åˆ©ç”¨CPUå’ŒI/Oã€‚ ä»è®¡ç®—æœºå†…æ ¸I/Oè€Œè¨€ï¼Œå¼‚æ­¥/åŒæ­¥å’Œé˜»å¡/éé˜»å¡å®é™…ä¸Šæ˜¯ä¸¤å›äº‹ æ“ä½œç³»ç»Ÿå†…æ ¸å¯¹äºI/Oåªæœ‰ä¸¤ç§æ–¹å¼ï¼š é˜»å¡I/Oï¼šè°ƒç”¨ä¹‹åä¸€å®šè¦ç­‰åˆ°ç³»ç»Ÿå†…æ ¸å±‚é¢å®Œæˆæ‰€æœ‰æ“ä½œåï¼Œè°ƒç”¨æ‰ç»“æŸï¼Œé€ æˆCPUç­‰å¾…I/Oï¼Œæµªè´¹ç­‰å¾…äº‹ä»¶ï¼ŒCPUçš„å¤„ç†èƒ½åŠ›ä¸èƒ½å¾—åˆ°å……åˆ†åˆ©ç”¨ éé˜»å¡I/Oï¼šè°ƒç”¨ä¹‹åç«‹å³è¿”å›éé˜»å¡I/Oè¿”å›ä¹‹åï¼ŒCPUçš„æ—¶é—´ç‰‡å¯ä»¥ç”¨åŠ›å¤„ç†å…¶ä»–äº‹ç‰©ï¼Œæ­¤æ—¶çš„æ€§èƒ½æå‡æ˜¯æ˜æ˜¾çš„ã€‚ä½†éé˜»å¡I/Oä¹Ÿå­˜åœ¨ä¸€äº›é—®é¢˜ã€‚ç”±äºå®Œæ•´çš„I/Oå¹¶æ²¡æœ‰å®Œæˆï¼Œç«‹å³è¿”å›çš„å¹¶ä¸æ˜¯ä¸šåŠ¡å±‚æ¸´æœ›çš„æ•°æ®ï¼Œè€Œä»…ä»…æ˜¯å½“å‰è°ƒç”¨çš„çŠ¶æ€ã€‚ä¸ºäº†è·å–å®Œæ•´çš„æ•°æ®ï¼Œåº”ç”¨ç¨‹åºéœ€è¦é‡å¤è°ƒç”¨I/Oæ“ä½œæ¥ç¡®è®¤æ˜¯å¦å®Œæˆã€‚è¿™ç§é‡å¤è°ƒç”¨åˆ¤æ–­æ“ä½œæ˜¯å¦å®Œæˆçš„æŠ€æœ¯å«åšè½®è¯¢ é˜»å¡I/Oé€ æˆCPUç­‰å¾…æµªè´¹ï¼Œéé˜»å¡å¸¦æ¥çš„éº»çƒ¦å´æ˜¯éœ€è¦è½®è¯¢å»ç¡®è®¤æ˜¯å¦å®Œæˆå®Œæˆæ•°æ®è·å–ï¼Œå®ƒä¼šè®©CPUå¤„ç†çŠ¶æ€åˆ¤æ–­ï¼Œæ˜¯å¯¹CPUèµ„æºçš„æµªè´¹ è½®è¯¢æŠ€æœ¯ï¼š read select poll epollï¼šè¯¥æ–¹æ¡ˆæ˜¯Linuxä¸‹æ•ˆç‡æœ€é«˜çš„I/Oäº‹ä»¶é€šçŸ¥æœºåˆ¶ï¼Œåœ¨è¿›å…¥è½®è¯¢çš„æ—¶å€™å¦‚æœæ²¡æœ‰æ£€æŸ¥åˆ°I/Oäº‹ä»¶ï¼Œå°†ä¼šè¿›è¡Œä¼‘çœ ï¼Œç›´åˆ°äº‹ä»¶å‘ç”Ÿå°†å®ƒå”¤é†’ã€‚å®ƒæ˜¯çœŸå®åˆ©ç”¨äº†äº‹ä»¶é€šçŸ¥ã€æ‰§è¡Œå›è°ƒçš„æ–¹å¼ï¼Œè€Œä¸æ˜¯éå†æŸ¥è¯¢ï¼Œæ‰€ä»¥ä¸ä¼šæµªè´¹CPUï¼Œæ‰§è¡Œæ•ˆç‡è¾ƒé«˜ kqueueï¼šè¯¥æ–¹æ¡ˆçš„å®ç°æ–¹å¼ä¸epollç±»ä¼¼ï¼Œä¸è¿‡å®ƒä»…åœ¨FreeBSDç³»ç»Ÿä¸‹å­˜åœ¨ éé˜»å¡I/Oå¯¹äºåº”ç”¨ç¨‹åºè€Œè¨€ï¼Œå®ƒä»ç„¶åªèƒ½ç®—æ˜¯ä¸€ç§åŒæ­¥ï¼Œå› ä¸ºåº”ç”¨ç¨‹åºä»ç„¶éœ€è¦ç­‰å¾…I/Oå®Œå…¨è¿”å›ï¼Œä¾æ—§èŠ±è´¹äº†å¾ˆå¤šæ—¶é—´æ¥ç­‰å¾…ã€‚ç­‰å¾…æœŸé—´ï¼ŒCPUå¹ºå¦¹ç”¨äºéå†æ–‡ä»¶æè¿°ç¬¦çš„çŠ¶æ€ï¼Œè¦ä¹ˆç”¨äºä¼‘çœ ç­‰å¾…äº‹ä»¶å‘ç”Ÿï¼Œå¯¹äºå½“å‰çº¿ç¨‹è€Œè¨€åˆ©ç”¨ç‡ä¸å¤Ÿï¼Œç†æƒ³çš„å¼‚æ­¥I/Oæ˜¯åº”ç”¨ç¨‹åºå‘èµ·éé˜»å¡è°ƒç”¨ï¼Œæ— éœ€é€šè¿‡éå†æˆ–è€…äº‹ä»¶å”¤é†’ç­‰æ–¹å¼è½®è¯¢ï¼Œå¯ä»¥ç›´æ¥å¤„ç†ä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚é‡‡ç”¨å¤šçº¿ç¨‹çš„æ–¹å¼ï¼Œé€šè¿‡è®©éƒ¨åˆ†çº¿ç¨‹è¿›è¡Œé˜»å¡I/Oæˆ–è€…éé˜»å¡I/OåŠ è½®è¯¢æŠ€æœ¯æ¥å®Œæˆæ•°æ®è·å–ï¼Œè®©ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œè®¡ç®—å¤„ç†ï¼Œé€šè¿‡çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡å°†I/Oå¾—åˆ°çš„æ•°æ®è¿›è¡Œä¼ é€’ï¼Œè¿™å°±è½»æ¾å®ç°äº†å¼‚æ­¥I/Oã€‚ Nodeæ˜¯å•çº¿ç¨‹çš„ï¼Œè¿™é‡Œçš„å•çº¿ç¨‹ä»…ä»…åªæ˜¯JSæ‰§è¡Œåœ¨å•çº¿ç¨‹ä¸­ç½¢äº†ã€‚åœ¨Nodeä¸­ï¼Œæ— è®ºæ˜¯*nixè¿˜æ˜¯Windowså¹³å°ï¼Œå†…éƒ¨å®ŒæˆI/Oä»»åŠ¡çš„å¦æœ‰çº¿ç¨‹æ±  Nodeçš„å¼‚æ­¥I/O äº‹ä»¶å¾ªç¯ï¼šåœ¨è¿›ç¨‹å¯åŠ¨æ—¶ï¼ŒNodeä¾¿ä¼šåˆ›å»ºä¸€ä¸ªç±»ä¼¼äºwhile(true)çš„å¾ªç¯ï¼Œæ¯æ‰§è¡Œä¸€æ¬¡å¾ªç¯ä½“çš„è¿‡ç¨‹æˆ‘ä»¬ç§°ä¸ºTickã€‚æ¯ä¸ªTickçš„è¿‡ç¨‹å°±æ˜¯æŸ¥çœ‹æ˜¯å¦æœ‰äº‹ä»¶å¾…å¤„ç†ï¼Œå¦‚æœæœ‰ï¼Œå°±å–å‡ºäº‹ä»¶åŠç›¸å…³çš„å›è°ƒå‡½æ•°ã€‚å¦‚æœå­˜åœ¨å…³è”çš„å›è°ƒå‡½æ•°ï¼Œå°±æ‰§è¡Œå®ƒä»¬ã€‚ç„¶åè¿›å…¥ä¸‹ä¸ªå¾ªç¯ï¼Œå¦‚æœä¸å†æœ‰äº‹ä»¶å¤„ç†ï¼Œå°±é€€å‡ºè¿›ç¨‹ã€‚ è§‚å¯Ÿè€…ï¼šæ¯ä¸ªäº‹ä»¶å¾ªç¯ä¸­æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªè§‚å¯Ÿè€…ï¼Œè€Œåˆ¤æ–­æ˜¯å¦æœ‰äº‹ä»¶è¦å¤„ç†çš„è¿‡ç¨‹å°±æ˜¯å‘è¿™äº›è§‚å¯Ÿè€…è¯¢é—®æ˜¯å¦æœ‰è¦å¤„ç†çš„äº‹ä»¶ï¼Œä¸€ä¸ªè§‚å¯Ÿè€…é‡Œå¯èƒ½æœ‰å¤šä¸ªäº‹ä»¶ï¼Œåœ¨Nodeä¸­ï¼Œäº‹ä»¶ä¸»è¦æ¥æºäºç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶I/Oç­‰ï¼Œè¿™äº›äº‹ä»¶å¯¹åº”çš„è§‚å¯Ÿè€…æœ‰æ–‡ä»¶I/Oè§‚å¯Ÿè€…ã€ç½‘ç»œI/Oè§‚å¯Ÿè€…ç­‰ã€‚è§‚å¯Ÿè€…å°†äº‹ä»¶è¿›è¡Œäº†åˆ†ç±»ã€‚äº‹ä»¶å¾ªç¯æ˜¯ä¸€ä¸ªå…¸å‹çš„ç”Ÿäº§è€…/æ¶ˆè´¹è€…æ¨¡å‹ã€‚å¼‚æ­¥I/Oã€ç½‘ç»œè¯·æ±‚ç­‰åˆ™æ˜¯äº‹æƒ…çš„ç”Ÿäº§è€…ï¼Œæºæºä¸æ–­ä¸ºNodeæä¾›ä¸åŒç±»å‹çš„äº‹ä»¶ï¼Œè¿™äº›äº‹ä»¶è¢«ä¼ é€’åˆ°å¯¹åº”çš„è§‚å¯Ÿè€…å“ªé‡Œï¼Œäº‹ä»¶å¾ªç¯åˆ™ä»è§‚å¯Ÿè€…é‚£é‡Œå–å‡ºäº‹ä»¶å¹¶å¤„ç†ã€‚åœ¨Windowsä¸‹ï¼Œè¿™ä¸ªå¾ªç¯åŸºäºIOCPåˆ›å»ºï¼Œè€Œåœ¨*nixä¸‹åˆ™åŸºäºå¤šçº¿ç¨‹åˆ›å»ºã€‚ è¯·æ±‚å¯¹è±¡ï¼šä»JSå‘èµ·è°ƒç”¨åˆ°å†…æ ¸æ‰§è¡Œå®ŒI/Oæ“ä½œçš„è¿‡æ¸¡è¿‡ç¨‹ä¸­ï¼Œå­˜åœ¨ä¸€ç§ä¸­é—´äº§ç‰©ï¼Œå®ƒå«åšè¯·æ±‚å¯¹è±¡ï¼Œæ‰€æœ‰çš„çŠ¶æ€éƒ½ä¿å­˜åœ¨è¿™ä¸ªå¯¹è±¡ä¸­ï¼ŒåŒ…æ‹¬é€å…¥çº¿ç¨‹æ± ç­‰å¾…æ‰§è¡Œä»¥åŠI/Oæ“ä½œå®Œæ¯•åçš„å›è°ƒå¤„ç† æ‰§è¡Œå›è°ƒï¼šçº¿ç¨‹æ± ä¸­çš„I/Oæ“ä½œè°ƒç”¨å®Œæ¯•ä¹‹åï¼Œä¼šå°†ç»“æœå­˜å‚¨åœ¨è¯·æ±‚å¯¹è±¡ï¼ˆreq-&gt;resultï¼‰å±æ€§ä¸Šï¼Œç„¶åé€šçŸ¥IOCPï¼Œå‘ŠçŸ¥å½“å‰å¯¹è±¡æ“ä½œä»¥å®Œæˆã€‚åœ¨æ¯æ¬¡Tickçš„æ‰§è¡Œä¸­ï¼Œå®ƒä¼šè°ƒç”¨IOCPç›¸å…³çš„æ–¹æ³•æ£€æŸ¥çº¿ç¨‹æ± ä¸­æ˜¯å¦æœ‰æ‰§è¡Œå®Œæˆçš„è¯·æ±‚ï¼Œå¦‚æœå­˜åœ¨ï¼Œä¼šå°†è¯·æ±‚å¯¹è±¡åŠ å…¥åˆ°I/Oè§‚å¯Ÿè€…çš„é˜Ÿåˆ—ä¸­ï¼Œç„¶åå°†å…¶å½“åšäº‹ä»¶å¤„ç†ã€‚I/Oè§‚å¯Ÿè€…å›è°ƒå‡½æ•°çš„è¡Œä¸ºå°±æ˜¯å–å‡ºè¯·æ±‚å¯¹è±¡çš„resultå±æ€§ä½œä¸ºå‚æ•°ï¼Œå–å‡ºoncomplete_symå±æ€§ä½œä¸ºæ–¹æ³•ï¼Œç„¶åè°ƒç”¨æ‰§è¡Œï¼Œä»¥æ­¤è¾¾åˆ°è°ƒç”¨JSä¸­ä¼ å…¥çš„å›è°ƒå‡½æ•°çš„ç›®çš„ã€‚äº‹ä»¶å¾ªç¯ã€è§‚å¯Ÿè€…ã€è¯·æ±‚å¯¹è±¡ã€I/Oçº¿ç¨‹æ± è¿™å››è€…å…±åŒæ„æˆäº†Nodeå¼‚æ­¥I/Oæ¨¡å‹çš„åŸºæœ¬è¦ç´ ã€‚ éI/Oçš„å¼‚æ­¥API å®šæ—¶å™¨ï¼šè°ƒç”¨setTimeout()æˆ–è€…setInterval()åˆ›å»ºçš„å®šæ—¶å™¨ä¼šè¢«æ’å…¥åˆ°å®šæ—¶å™¨è§‚å¯Ÿè€…å†…éƒ¨çš„ä¸€ä¸ªçº¢é»‘æ ‘ä¸­ã€‚æ¯æ¬¡Tickæ‰§è¡Œæ—¶ï¼Œä¼šä»è¯¥çº¢é»‘æ ‘ä¸­è¿­ä»£å–å‡ºå®šæ—¶å™¨å¯¹è±¡ï¼Œæ£€æŸ¥æ˜¯å¦è¶…è¿‡å®šæ—¶æ—¶é—´ï¼Œå¦‚æœè¶…è¿‡ï¼Œå°±å½¢æˆä¸€ä¸ªäº‹ä»¶ï¼Œå®ƒçš„å›è°ƒå‡½æ•°å°†ç«‹å³æ‰§è¡Œã€‚å®šæ—¶å™¨çš„é—®é¢˜åœ¨äºï¼Œå®ƒå¹¶éç²¾ç¡®çš„ï¼ˆåœ¨å®¹å¿èŒƒå›´å†…ï¼‰ã€‚å°½ç®¡äº‹ä»¶å¾ªç¯ååˆ†å¿«ï¼Œä½†æ˜¯å¦‚æœæŸä¸€æ¬¡å¾ªç¯å ç”¨çš„æ—¶é—´è¾ƒå¤šï¼Œé‚£ä¹ˆä¸‹æ¬¡å¾ªç¯æ—¶ï¼Œå®ƒä¹Ÿè®¸å·²ç»è¶…æ—¶å¾ˆä¹…äº†ã€‚è­¬å¦‚é€šè¿‡setTimeout()è®¾å®šä¸€ä¸ªä»»åŠ¡åœ¨10æ¯«ç§’åæ‰§è¡Œï¼Œä½†æ˜¯åœ¨9æ¯«ç§’åï¼Œæœ‰ä¸€ä¸ªä»»åŠ¡å ç”¨äº†5æ¯«ç§’çš„CPUæ—¶é—´ç‰‡ï¼Œå†æ¬¡è½®åˆ°å®šæ—¶å™¨æ‰§è¡Œæ—¶ï¼Œæ—¶é—´å°±å·²ç»è¿‡æœŸ4æ¯«ç§’ã€‚ process.nextTick()ï¼šç›¸å½“äºsetTimeout(fn, 0)ï¼Œè€Œç”±äºæ—¶é—´å¾ªç¯è‡ªèº«çš„ç‰¹ç‚¹ï¼Œå®šæ—¶å™¨çš„ç²¾ç¡®åº¦ä¸å¤Ÿã€‚è€Œäº‹å®ä¸Šï¼Œé‡‡ç”¨å®šæ—¶å™¨éœ€è¦åŠ¨ç”¨çº¢é»‘æ ‘ï¼Œåˆ›å»ºå®šæ—¶å™¨å¯¹è±¡å’Œè¿­ä»£ç­‰æ“ä½œï¼Œè€ŒsetTimeout(fn, 0)çš„æ–¹å¼è¾ƒä¸ºæµªè´¹æ€§èƒ½ã€‚å®é™…ä¸Šï¼Œprocess.nextTick()æ–¹æ³•çš„æ“ä½œç›¸å¯¹è¾ƒä¸ºè½»é‡ã€‚æ¯æ¬¡è°ƒç”¨process.nextTick()æ–¹æ³•ï¼Œåªä¼šå°†å›è°ƒå‡½æ•°æ”¾å…¥é˜Ÿåˆ—ä¸­ï¼Œåœ¨ä¸‹ä¸€è½®Tickæ—¶å–å‡ºæ‰§è¡Œã€‚å®šæ—¶å™¨é‡‡ç”¨çº¢é»‘æ ‘çš„æ“ä½œæ—¶é—´å¤æ‚åº¦ä¸ºO(lg(n))ï¼ŒnextTick()çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(1)ã€‚ setImmediate()ï¼šsetImmediate()æ–¹æ³•ä¸procee.nextTick()æ–¹æ³•ååˆ†ç±»ä¼¼ï¼Œéƒ½æ˜¯å°†å›è°ƒå‡½æ•°å»¶è¿Ÿæ‰§è¡Œã€‚process.nextTick()ä¸­çš„å›è°ƒå‡½æ•°æ‰§è¡Œçš„ä¼˜å…ˆçº§è¦é«˜äºsetImmediate()ã€‚è¿™é‡Œçš„åŸå› åœ¨äºäº‹ä»¶å¾ªç¯å¯¹è§‚å¯Ÿè€…çš„æ£€æŸ¥æ˜¯æœ‰å…ˆåé¡ºåºçš„ï¼Œprocess.nextTick()å±äºidleè§‚å¯Ÿè€…ï¼ŒsetImmediate()å±äºcheckè§‚å¯Ÿè€…ã€‚åœ¨æ¯ä¸€ä¸ªè½®å¾ªç¯æ£€æŸ¥ä¸­ï¼Œidleè§‚å¯Ÿè€…å…ˆäºI/Oè§‚å¯Ÿè€…ï¼ŒI/Oè§‚å¯Ÿè€…å…ˆäºcheckè§‚å¯Ÿè€…ã€‚åœ¨å…·ä½“å®ç°ä¸Šï¼Œprocess.nextTick()çš„å›è°ƒå‡½æ•°ä¿å­˜åœ¨ä¸€ä¸ªæ•°ç»„ä¸­ï¼ŒsetImmediate()çš„ç»“æœåˆ™æ˜¯ä¿å­˜åœ¨é“¾è¡¨ä¸­ã€‚åœ¨è¡Œä¸ºä¸Šï¼Œprocess.nextTick()åœ¨æ¯è½®å¾ªç¯ä¸­ä¼šå°†æ•°ç»„ä¸­çš„å›è°ƒå‡½æ•°å…¨éƒ¨æ‰§è¡Œå®Œï¼Œè€ŒsetImmediate()åœ¨æ¯è½®å¾ªç¯ä¸­æ‰§è¡Œé“¾è¡¨ä¸­çš„ä¸€ä¸ªå›è°ƒå‡½æ•°ã€‚ä¹‹æ‰€ä»¥è¿™æ ·è®¾è®¡ï¼Œæ˜¯ä¸ºäº†ä¿è¯æ¯æ¬¡æ¯è½®å¾ªç¯èƒ½å¤Ÿè¾ƒå¿«åœ°æ‰§è¡Œç»“æŸï¼Œé˜²æ­¢CPUå ç”¨è¿‡å¤šè€Œé˜»å¡åç»­I/Oè°ƒç”¨çš„æƒ…å†µã€‚ æœåŠ¡å™¨æ¨¡å‹ï¼š åŒæ­¥å¼ï¼šå¯¹äºåŒæ­¥å¼çš„æœåŠ¡ï¼Œä¸€æ¬¡åªèƒ½å¤„ç†ä¸€ä¸ªè¯·æ±‚ï¼Œå¹¶ä¸”å…¶ä½™è¯·æ±‚éƒ½å¤„äºç­‰å¾…çŠ¶æ€ æ¯è¿›ç¨‹/æ¯è¯·æ±‚ï¼šä¸ºæ¯ä¸ªè¯·æ±‚å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹ï¼Œè¿™æ ·å¯ä»¥å¤„ç†å¤šä¸ªè¯·æ±‚ï¼Œä½†æ˜¯å®ƒä¸å…·å¤‡æ‰©å±•æ€§ï¼Œå› ä¸ºç³»ç»Ÿèµ„æºåªæœ‰é‚£ä¹ˆå¤š æ¯çº¿ç¨‹/æ¯è¯·æ±‚ï¼šä¸ºæ¯ä¸ªè¯·æ±‚å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†ã€‚å°½ç®¡çº¿ç¨‹æ¯”è¿›ç¨‹è¦è½»é‡ï¼Œä½†æ˜¯ç”±äºæ¯ä¸ªçº¿ç¨‹éƒ½å ç”¨ä¸€å®šå†…å­˜ï¼Œå½“å¤§å¹¶å‘è¯·æ±‚åˆ°æ¥æ—¶ï¼Œå†…å­˜å°†ä¼šå¾ˆå¿«ç”¨å…‰ï¼Œå¯¼è‡´æœåŠ¡å™¨ç¼“æ…¢ã€‚Nodeé€šè¿‡äº‹ä»¶é©±åŠ¨çš„æ–¹å¼å¤„ç†è¯·æ±‚ï¼Œæ— é¡»ä¸ºæ¯ä¸€ä¸ªè¯·æ±‚åˆ›å»ºé¢å¤–çš„å¯¹åº”çº¿ç¨‹ï¼Œå¯ä»¥çœæ‰åˆ›å»ºçº¿ç¨‹å’Œé”€æ¯çº¿ç¨‹çš„å¼€é”€ã€‚çŸ¥åæœåŠ¡å™¨Nginxï¼Œä¹Ÿæ‘’å¼ƒäº†å¤šçº¿ç¨‹çš„æ–¹å¼ï¼Œé‡‡ç”¨äº†å’ŒNodeç›¸åŒçš„äº‹ä»¶é©±åŠ¨ï¼Œä¸åŒä¹‹å¤„åœ¨äºNginxé‡‡ç”¨çº¯Cå†™æˆï¼Œæ€§èƒ½è¾ƒé«˜ï¼Œä½†æ˜¯å®ƒä»…é€‚åˆäºåšWebæœåŠ¡å™¨ï¼Œç”¨äºåå‘ä»£ç†æˆ–è´Ÿè½½å‡è¡¡ç­‰æœåŠ¡ï¼Œåœ¨å¤„ç†å…·ä½“ä¸šåŠ¡æ–¹é¢è¾ƒä¸ºæ¬ ç¼ºã€‚ ç¬¬å››ç«  å¼‚æ­¥ç¼–ç¨‹ å‡½æ•°å¼ç¼–ç¨‹ é«˜é˜¶å‡½æ•°ï¼šå¯ä»¥æŠŠå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œæˆ–æ˜¯å°†å‡½æ•°ä½œä¸ºè¿”å›å€¼çš„å‡½æ•° åå‡½æ•°ï¼šé€šè¿‡æŒ‡å®šéƒ¨åˆ†å‚æ•°æ¥äº§ç”Ÿä¸€ä¸ªæ–°çš„å®šåˆ¶å‡½æ•°çš„å½¢å¼å°±æ˜¯åå‡½æ•° å¼‚æ­¥ç¼–ç¨‹ä¼˜åŠ¿ï¼šNodeå¸¦æ¥çš„æœ€å¤§ç‰¹æ•ˆè«è¿‡äºåŸºäºäº‹ä»¶é©±åŠ¨çš„éé˜»å¡I/Oæ¨¡å‹ï¼Œéé˜»å¡I/Oå¯ä»¥ä½¿CPUä¸I/Oå¹¶ä¸ç›¸äº’ä¾èµ–ç­‰å¾…ï¼Œè®©èµ„æºå¾—åˆ°æ›´å¥½çš„åˆ©ç”¨ã€‚åˆ©ç”¨äº‹ä»¶å¾ªç¯çš„æ–¹å¼ï¼ŒJSçº¿ç¨‹åƒä¸€ä¸ªåˆ†é…ä»»åŠ¡å’Œå¤„ç†ç»“æœçš„å¤§ç®¡å®¶ï¼ŒI/Oçº¿ç¨‹æ± é‡Œçš„å„ä¸ªI/Oçº¿ç¨‹éƒ½æ˜¯å°äºŒï¼Œè¿™ä¸ªæ¨¡å‹çš„ç¼ºç‚¹åˆ™åœ¨äºç®¡å®¶æ— æ³•æ‰¿æ‹…è¿‡å¤šçš„ç»†èŠ‚æ€§ä»»åŠ¡ï¼Œå¦‚æœæ‰¿æ‹…å¤ªå¤šï¼Œåˆ™ä¼šå½±å“åˆ°ä»»åŠ¡çš„è°ƒåº¦ï¼Œç®¡å®¶å¿™ä¸ªä¸åœï¼Œå°äºŒå´å¾—ä¸åˆ°æ´»å¹²ï¼Œç»“å±€åˆ™æ˜¯æ•´ä½“æ•ˆç‡çš„é™ä½ã€‚æ¢è¨€ä¹‹ï¼ŒNodeæ˜¯ä¸ºäº†è§£å†³ç¼–ç¨‹æ¨¡å‹ä¸­é˜»å¡I/Oæ€§èƒ½é—®é¢˜çš„ï¼Œé‡‡ç”¨äº†å•çº¿ç¨‹æ¨¡å‹ï¼Œè¿™å¯¼è‡´Nodeæ›´åƒä¸€ä¸ªå¤„ç†I/Oå¯†é›†å‹çš„èƒ½æ‰‹ï¼Œè€ŒCPUå¯†é›†å‹åˆ™å–å†³äºç®¡å®¶çš„èƒ½è€å¦‚ä½•ã€‚ç”±äºäº‹ä»¶å¾ªç¯æ¨¡å‹éœ€è¦åº”å¯¹æµ·é‡è¯·æ±‚ï¼Œæµ·é‡è¯·æ±‚åŒæ—¶ä½œç”¨åœ¨å•çº¿ç¨‹ä¸Šï¼Œå°±éœ€è¦é˜²æ­¢ä»»ä½•ä¸€ä¸ªè®¡ç®—è€—è´¹è¿‡å¤šçš„CPUæ—¶é—´ç‰‡ã€‚è‡³äºæ˜¯è®¡ç®—å¯†é›†å‹ï¼Œè¿˜æ˜¯I/Oå¯†é›†å‹ï¼Œåªè¦è®¡ç®—ä¸å½±å“å¼‚æ­¥I/Oçš„è°ƒåº¦ï¼Œé‚£å°±ä¸æ„æˆé—®é¢˜ã€‚å»ºè®®å¯¹CPUçš„è€—ç”¨ä¸è¦è¶…è¿‡10msï¼Œæˆ–è€…å°†å¤§é‡çš„è®¡ç®—åˆ†è§£ä¸ºè¯¸å¤šçš„å°é‡è®¡ç®—ï¼Œé€šè¿‡setImmediate()è¿›è¡Œè°ƒåº¦ã€‚åªè¦åˆç†åˆ©ç”¨Nodeçš„å¼‚æ­¥æ¨¡å‹å’ŒV8çš„é«˜æ€§èƒ½ï¼Œå°±å¯ä»¥å……åˆ†å‘æŒ¥CPUå’ŒI/Oèµ„æºçš„ä¼˜åŠ¿ã€‚ å¼‚æ­¥ç¼–ç¨‹çš„éš¾ç‚¹ï¼š å¼‚å¸¸å¤„ç†ï¼šè¿‡å»æˆ‘ä»¬å¤„ç†å¼‚å¸¸æ—¶ï¼Œé€šå¸¸ä½¿ç”¨ç±»Javaçš„try/catch/finalè¯­å¥å—è¿›è¡Œå¼‚å¸¸æ•è·ã€‚ä½†æ˜¯è¿™å¯¹äºå¼‚æ­¥ç¼–ç¨‹ä¸ä¸€å®šé€‚ç”¨ã€‚ç¬¬3ç« æåˆ°è¿‡ï¼Œå¼‚æ­¥I/Oçš„å®ç°ä¸»è¦åŒ…å«ä¸¤ä¸ªé˜¶æ®µï¼šæäº¤è¯·æ±‚å’Œå¤„ç†ç»“æœã€‚è¿™ä¸¤ä¸ªé˜¶æ®µä¸­é—´æœ‰äº‹ä»¶å¾ªç¯çš„è°ƒåº¦ï¼Œä¸¤è€…å½¼æ­¤ä¸å…³è”ã€‚å¼‚æ­¥æ–¹æ³•åˆ™é€šå¸¸åœ¨ç¬¬ä¸€ä¸ªé˜¶æ®µæäº¤è¯·æ±‚åç«‹å³è¿”å›ï¼Œå› ä¸ºå¼‚å¸¸å¹¶ä¸ä¸€å®šå‘ç”Ÿåœ¨è¿™ä¸ªé˜¶æ®µï¼Œtry/catchçš„åŠŸæ•ˆåœ¨æ­¤å¤„ä¸ä¼šå‘æŒ¥ä»»ä½•ä½œç”¨ã€‚ 12345678910var async = function (callback) &#123; process.nextTick(callback)&#125;// åªèƒ½æ•è·å½“æ¬¡äº‹ä»¶å¾ªç¯å†…çš„å¼‚å¸¸ï¼Œå¯¹callbackæ‰§è¡Œæ—¶æŠ›å‡ºçš„å¼‚å¸¸æ— èƒ½ä¸ºåŠ›try &#123; async(callback)&#125; catch (e) &#123; // TODO&#125; Nodeåœ¨å¤„ç†å¼‚å¸¸ä¸Šå½¢æˆäº†ä¸€ç§çº¦å®šï¼Œå°†å¼‚å¸¸ä½œä¸ºå›è°ƒå‡½æ•°çš„ç¬¬ä¸€ä¸ªå®å‚ä¼ å›ï¼Œå¦‚æœä¸ºç©ºå€¼ï¼Œåˆ™è¡¨æ˜å¼‚æ­¥è°ƒç”¨æ²¡æœ‰å¼‚å¸¸æŠ›å‡ºï¼š 123async(function (err, results) &#123; // TODO&#125;) åœ¨æˆ‘ä»¬è‡ªè¡Œç¼–å†™çš„å¼‚æ­¥æ–¹æ³•ä¸Šï¼Œä¹Ÿéœ€è¦å»éµå¾ªè¿™æ ·ä¸€äº›åŸåˆ™ï¼š åŸåˆ™1ï¼šå¿…é¡»æ‰§è¡Œè°ƒç”¨è€…ä¼ å…¥çš„å›è°ƒå‡½æ•° åŸåˆ™2ï¼šæ­£ç¡®ä¼ é€’å›å¼‚å¸¸ä¾›è°ƒç”¨è€…åˆ¤æ–­ å‡½æ•°åµŒå¥—è¿‡æ·±ï¼šå¯¹äºNodeè€Œè¨€ï¼Œäº‹åŠ¡ä¸­å­˜åœ¨å¤šä¸ªå¼‚æ­¥è°ƒç”¨çš„åœºæ™¯æ¯”æ¯”çš†æ˜¯ï¼Œå‡½æ•°åµŒå¥—è¿‡æ·±å¯¼è‡´ä»£ç éš¾ä»¥é˜…è¯» é˜»å¡ä»£ç ï¼šNodeä¸­æ²¡æœ‰sleep()è¿™æ ·çš„çº¿ç¨‹æ²‰ç¡åŠŸèƒ½ï¼Œå”¯ç‹¬èƒ½ç”¨äºå»¶æ—¶æ“ä½œçš„åªæœ‰setTimeout()å’ŒsetInterval()è¿™ä¸¤ä¸ªå‡½æ•°ã€‚ä½†æ˜¯è¿™ä¸¤ä¸ªå‡½æ•°å¹¶ä¸èƒ½é˜»å¡åç»­ä»£ç çš„æ‰§è¡Œã€‚æ‰€ä»¥ï¼Œæœ‰å¤šåŠå¼€å‘è€…ä¼šå†™å‡ºä¸‹è¿°è¿™æ ·çš„ä»£ç æ¥å®ç°sleep(1000)çš„æ•ˆæœï¼š 12345var start = new Date()while (new Date() - start &lt; 1000) &#123; // TODO&#125;// éœ€è¦é˜»å¡çš„ä»£ç  ä½†æ˜¯äº‹å®æ˜¯ç³Ÿç³•çš„ï¼Œè¿™æ®µä»£ç ä¼šæŒç»­å ç”¨CPUè¿›è¡Œåˆ¤æ–­ï¼Œä¸çœŸæ­£çš„çº¿ç¨‹æ²‰ç¡ç›¸å»ç”šè¿œï¼Œå®Œå…¨ç ´åäº†äº‹ä»¶å¾ªç¯çš„è°ƒåº¦ã€‚ç”±äºNodeå•çº¿ç¨‹çš„åŸå› ï¼ŒCPUèµ„æºå…¨éƒ½ä¼šç”¨äºä¸ºè¿™æ®µä»£ç æœåŠ¡ï¼Œå¯¼è‡´å…¶ä½™ä»»ä½•è¯·æ±‚éƒ½ä¼šå¾—ä¸åˆ°å“åº”ã€‚ é‡è§è¿™æ ·çš„éœ€æ±‚æ—¶ï¼Œåœ¨åŒä¸€è§„åˆ’ä¸šåŠ¡é€»è¾‘ä¹‹åï¼Œè°ƒç”¨setTimeout()çš„æ•ˆæœä¼šæ›´å¥½ã€‚ å¤šçº¿ç¨‹ç¼–ç¨‹ï¼šJSè¿è¡Œåœ¨å•çº¿ç¨‹ä¹‹ä¸Šï¼Œæ²¡æœ‰å……åˆ†åˆ©ç”¨å¤šæ ¸CPUï¼Œæµè§ˆå™¨é‡‡ç”¨Web Workersï¼ŒNodeå€Ÿé‰´äº†è¿™ä¸ªæ¨¡å¼ï¼Œchild_processæ˜¯å…¶åŸºç¡€APIï¼Œclusteræ¨¡å—æ˜¯æ›´æ·±å±‚æ¬¡çš„åº”ç”¨ã€‚ å¼‚æ­¥è½¬åŒæ­¥ å¼‚æ­¥ç¼–ç¨‹è§£å†³æ–¹æ¡ˆï¼š äº‹ä»¶å‘å¸ƒ/è®¢é˜…æ¨¡å¼ï¼šNodeè‡ªèº«æä¾›eventsæ¨¡å—ï¼Œå®ƒå…·æœ‰addListener/on()ã€once()ã€removeListener()ã€removeAllListeners()å’Œemit()ç­‰åŸºæœ¬çš„æ—¶é—´ç›‘å¬æ¨¡å¼çš„æ–¹æ³•å®ç°ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒNodeå¯¹äº‹ä»¶å‘å¸ƒ/è®¢é˜…çš„æœºåˆ¶åšäº†ä¸€äº›é¢å¤–çš„å¤„ç†ï¼Œè¿™å¤§å¤šæ˜¯åŸºäºå¥å£®æ€§è€Œè€ƒè™‘çš„ã€‚ä¸‹é¢ä¸ºä¸¤ä¸ªå…·ä½“çš„ç»†èŠ‚ç‚¹ï¼š å¦‚æœå¯¹ä¸€ä¸ªäº‹ä»¶æ·»åŠ äº†è¶…è¿‡10ä¸ªä¾¦å¬å™¨ï¼Œå°†ä¼šå¾—åˆ°ä¸€ä¸ªè­¦å‘Šã€‚è¿™ä¸€å¤„è®¾è®¡ä¸Nodeè‡ªèº«å•çº¿ç¨‹è¿è¡Œæœ‰å…³ï¼Œè®¾è®¡è€…è®¤ä¸ºä¾¦å¬å™¨å¤ªå¤šå¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼ã€‚è°ƒç”¨emitter.setMaxListeners(0)ï¼Œå¯ä»¥å°†è¿™ä¸ªé™åˆ¶å»æ‰ã€‚å¦ä¸€æ–¹é¢ï¼Œç”±äºäº‹ä»¶å‘å¸ƒä¼šå¼•èµ·ä¸€ç³»åˆ—ä¾¦å¬å™¨æ‰§è¡Œï¼Œå¦‚æœäº‹ä»¶ç›¸å…³çš„ä¾¦å¬å™¨è¿‡å¤šï¼Œå¯èƒ½å­˜åœ¨è¿‡å¤šå ç”¨CPUçš„æƒ…æ™¯ã€‚ ä¸ºäº†å¼‚å¸¸å¤„ç†ï¼ŒEventEmitterå¯¹è±¡å¯¹erroräº‹ä»¶è¿›è¡Œäº†ç‰¹æ®Šå¯¹å¾…ã€‚å¦‚æœå…è®¸æœŸé—´çš„é”™è¯¯è§¦å‘äº†erroräº‹ä»¶ï¼ŒEventEmitterä¼šæ£€æŸ¥æ˜¯å¦æœ‰é˜Ÿerroräº‹ä»¶æ·»åŠ è¿‡ä¾¦å¬å™¨ã€‚å¦‚æœæ·»åŠ äº†ï¼Œè¿™ä¸ªé”™è¯¯å°†ä¼šäº¤ç”±æ”¹ä¾¦å¬å™¨å¤„ç†ï¼Œå¦åˆ™è¿™ä¸ªé”™è¯¯å°†ä¼šä½œä¸ºå¼‚å¸¸æŠ›å‡ºã€‚å¦‚æœå¤–éƒ¨æ²¡æœ‰æ•è·è¿™ä¸ªå¼‚å¸¸ï¼Œå°†ä¼šå¼•èµ·çº¿ç¨‹é€€å‡ºã€‚ä¸€ä¸ªå¥å£®çš„EventEmitterå®ä¾‹åº”è¯¥å¤šerroräº‹ä»¶åšå¤„ç†ã€‚ ç»§æ‰¿eventsæ¨¡å— 123456var events = require('events')function Stream() &#123; events.EventEmitter.call(this)&#125;util.inherits(Stream, events.EventEmitter) åˆ©ç”¨äº‹ä»¶é˜Ÿåˆ—è§£å†³é›ªå´©é—®é¢˜ï¼šæ‰€è°“é›ªå´©é—®é¢˜ï¼Œå°±æ˜¯åœ¨é«˜è®¿é—®é‡ã€å¤§å¹¶å‘é‡çš„æƒ…å†µä¸‹ç¼“å­˜å¤±æ•ˆçš„æƒ…æ™¯ï¼Œæ­¤æ—¶å¤§é‡çš„è¯·æ±‚åŒæ—¶æ¶Œå…¥æ•°æ®åº“ä¸­ï¼Œæ•°æ®åº“æ— æ³•åŒæ—¶æ‰¿å—å¦‚æ­¤å¤§çš„æŸ¥è¯¢è¯·æ±‚ï¼Œè¿›è€Œå¾€å‰å½±å“åˆ°ç½‘ç«™æ•´ä½“çš„å“åº”é€Ÿåº¦ã€‚ ä»¥ä¸‹æ˜¯ä¸€æ¡æ•°æ®åº“æŸ¥è¯¢è¯­å¥çš„è°ƒç”¨ï¼š 12345var select = function (callback) &#123; db.select('SQL', function (results) &#123; callback(results) &#125;)&#125; å¦‚æœç«™ç‚¹åˆšå¥½å¯åŠ¨ï¼Œè¿™æ—¶ç¼“å­˜ä¸­æ˜¯ä¸å­˜åœ¨æ•°æ®çš„ï¼Œè€Œå¦‚æœè®¿é—®é‡å·¨å¤§ï¼ŒåŒä¸€å¥SQLä¼šè¢«å‘é€åˆ°æ•°æ®åº“ä¸­åå¤æŸ¥è¯¢ï¼Œä¼šå½±å“æœåŠ¡çš„æ•´ä½“æ€§èƒ½ã€‚ä¸€ç§æ”¹è¿›æ–¹æ¡ˆæ˜¯æ·»åŠ ä¸€ä¸ªçŠ¶æ€é”ï¼Œç›¸å…³ä»£ç å¦‚ä¸‹ï¼š 123456789101112var status = 'ready'var select = function (callback) &#123; if (status !== 'ready') &#123; return &#125; status = 'pending' db.select('SQL', function (results) &#123; status = 'ready' callback(results) &#125;)&#125; ä½†æ˜¯åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿ç»­åœ°å¤šæ¬¡è°ƒç”¨select()æ—¶ï¼Œåªæœ‰ç¬¬ä¸€æ¬¡è°ƒç”¨æ˜¯ç”Ÿæ•ˆçš„ï¼Œåç»­çš„select()æ˜¯æ²¡æœ‰æ•°æ®æœåŠ¡çš„ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥å¼•å…¥äº‹ä»¶é˜Ÿåˆ—ï¼Œç›¸å…³ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415var proxy = new events.EventEmitter()var status = 'ready'var select = function (callback) &#123; proxy.once('selected', callback) if (status !== 'ready') &#123; return &#125; status = 'pending' db.select('SQL', function (results) &#123; proxy.emit('selected', results) status = 'ready' &#125;)&#125; æ­¤å¤„å¯èƒ½å› ä¸ºå­˜åœ¨ä¾¦å¬å™¨è¿‡å¤šå¼•å‘è­¦å‘Šï¼Œéœ€è¦è°ƒç”¨setMaxListeners(0)ç§»é™¤è­¦å‘Šï¼Œæˆ–è€…è®¾ç½®æ›´å¤§çš„è­¦å‘Šé˜ˆå€¼ å¤šå¼‚æ­¥ä¹‹é—´çš„åä½œæ–¹æ¡ˆ è¿™é‡Œæˆ‘ä»¬å°è¯•é€šè¿‡åŸç”Ÿä»£ç è§£å†³â€œéš¾ç‚¹2â€ä¸­ä¸ºäº†æœ€ç»ˆç»“æœçš„å¤„ç†è€Œå¯¼è‡´å¯ä»¥å¹¶è¡Œè°ƒç”¨ä½†å®é™…åªèƒ½ä¸²è¡Œæ‰§è¡Œçš„é—®é¢˜ã€‚è¿™é‡Œä»¥æ¸²æŸ“é¡µé¢æ‰€éœ€è¦çš„æ¨¡æ¿è¯»å–ã€æ•°æ®è¯»å–å’Œæœ¬åœ°åŒ–èµ„æºè¯»å–ä¸ºä¾‹ç®€è¦ä»‹ç»ä¸€ä¸‹ï¼Œç›¸å…³ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920var count = 0var results = &#123;&#125;var done = function (key, value) &#123; results[key] = value count++ if (count === 3) &#123; render(results) &#125;&#125;fs.readFile(template_path, 'utf8', function (err, template) &#123; done('template', template)&#125;)db.query(sql, function (err, data) &#123; done('data', data)&#125;)l10n.get(function (err, resources) &#123; done('resources', resources)&#125;) ç”±äºå¤šä¸ªå¼‚æ­¥åœºæ™¯ä¸­å›è°ƒå‡½æ•°çš„æ‰§è¡Œå¹¶ä¸èƒ½ä¿è¯é¡ºåºï¼Œä¸”å›è°ƒå‡½æ•°ä¹‹é—´äº’ç›¸æ²¡æœ‰ä»»ä½•äº¤é›†ï¼Œæ‰€ä»¥éœ€è¦å€ŸåŠ©ä¸€ä¸ªç¬¬ä¸‰æ–¹å‡½æ•°å’Œç¬¬ä¸‰æ–¹å˜é‡æ¥å¤„ç†å¼‚æ­¥åä½œçš„ç»“æœã€‚é€šå¸¸ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªç”¨äºæ£€æµ‹æ¬¡æ•°çš„å˜é‡å«åšå“¨å…µå˜é‡ã€‚è¿™é‡Œå¯ä»¥åˆ©ç”¨åå‡½æ•°æ¥å¤„ç†å“¨å…µå˜é‡å’Œç¬¬ä¸‰æ–¹å‡½æ•°çš„å…³ç³»ï¼Œç›¸å…³ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314var after = function (times, callback) &#123; var count = 0 var results = &#123;&#125; return function (key, value) &#123; results[key] = value count++ if (count === times) &#123; callback(results) &#125; &#125;&#125;var done = after(3, render) ä¸Šè¿°æ–¹æ¡ˆå®ç°äº†å¤šä¸ªäº‹ä»¶å¯¹åº”ä¸€ä¸ªä¾¦å¬å™¨çš„ç›®çš„ã€‚å¦‚æœä¸šåŠ¡ç»§ç»­å¢é•¿ï¼Œæˆ‘ä»¬ä¾ç„¶å¯ä»¥ç»§ç»­åˆ©ç”¨å‘å¸ƒ/è®¢é˜…æ–¹å¼æ¥å®Œæˆå¤šå¯¹å¤šçš„æ–¹æ¡ˆï¼Œç›¸å…³ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415var emitter = new events.Emitter()var done = after(times, render)emitter.on('done', done)emitter.on('done', other)fs.readFile(template_path, 'utf8', function (err, template) &#123; emitter.emit('done', 'template', template)&#125;)db.query(sql, function (err, data) &#123; emitter.emit('done', 'data', data)&#125;)l10n.get(function (err, resources) &#123; emitter.emit('done', 'resources', resources)&#125;) åœ¨ä¸Šé¢çš„æ–¹æ³•ä¸­ï¼Œæœ‰ä¸€ä¸ªä»¤è°ƒç”¨è€…ä¸é‚£ä¹ˆèˆ’æœçš„é—®é¢˜ï¼Œé‚£å°±æ˜¯è°ƒç”¨è€…è¦å»å‡†å¤‡è¿™ä¸ªdone()å‡½æ•°ï¼Œä»¥åŠåœ¨å›è°ƒå‡½æ•°ä¸­éœ€è¦ä»ç»“æœæŠŠæ•°æ®ä¸€ä¸ªä¸ªæå–å‡ºæ¥ï¼Œå†è¿›è¡Œå¤„ç†ã€‚ å¦ä¸€ä¸ªæ–¹æ¡ˆåˆ™æ˜¯æ¥è‡ªäºç¬”è€…è‡ªå·±å†™çš„EventProxyæ¨¡å—ï¼Œç›¸å…³ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415var proxy = new EventProxy()proxy.all('template', 'data', 'resources', function (template, data, resource) &#123; //TODO&#125;)fs.readFile(template_path, 'utf8', function (err, template) &#123; proxy.emit('template', template)&#125;)db.query(sql, function (err, data) &#123; proxy.emit('data', data)&#125;)l10n.get(function (err, resources) &#123; proxy.emit('resources', resources)&#125;) Promise/Deferredæ¨¡å¼ï¼šä½¿ç”¨äº‹ä»¶çš„æ–¹å¼ï¼Œæ‰§è¡Œæµç¨‹éœ€è¦è¢«é¢„å…ˆè®¾å®šã€‚Promise/Deferredæ¨¡å¼å¯ä»¥å…ˆæ‰§è¡Œå¼‚æ­¥è°ƒç”¨ï¼Œå»¶è¿Ÿä¼ é€’å¤„ç†æ–¹ 12345678910111213// æ™®é€šAjaxè°ƒç”¨$.get('/api', &#123; success: onSuccess, error: onError, complete: onComplete&#125;)// Promise/Deferredæ¨¡å¼$.get('/api') .success(onSuccess) .success(onSuccess1) .error(onError) .complete(onComplete) è¿™ä½¿å¾—å³ä½¿ä¸è°ƒç”¨success()ã€error()ç­‰æ–¹æ³•ï¼ŒAjaxä¹Ÿä¼šæ‰§è¡Œï¼Œå¹¶ä¸”å¯ä»¥å¤„ç†å¤šä¸ªå›è°ƒ Promise/Deferredæ¨¡å¼å‘å¸ƒåœ¨CommonJSè§„èŒƒä¸­ï¼ŒCommonJSè‰æ¡ˆç›®å‰å·²ç»æŠ½è±¡å‡ºäº†Promises/Aã€Promises/Bã€Promises/Dè¿™æ ·å…¸å‹çš„å¼‚æ­¥Promise/Deferredæ¨¡å‹ Promises/Aï¼š Promise/Aæè®®å¯¹å•ä¸ªå¼‚æ­¥æ“ä½œåšå‡ºäº†è¿™æ ·çš„æŠ½è±¡å®šä¹‰ï¼š Promiseæ“ä½œåªä¼šå¤„åœ¨3ç§çŠ¶æ€çš„ä¸€ç§ï¼šæœªå®Œæˆæ€ã€å®Œæˆæ€å’Œå¤±è´¥æ€ Promiseçš„çŠ¶æ€åªä¼šå‡ºç°ä»æœªå®Œæˆæ€å‘å®Œæˆæ€æˆ–å¤±è´¥æ€è½¬åŒ–ï¼Œä¸èƒ½é€†åã€‚å®Œæˆæ€å’Œå¤±è´¥æ€ä¸èƒ½äº’ç›¸è½¬åŒ– Promiseçš„çŠ¶æ€ä¸€æ—¦è½¬åŒ–ï¼Œå°†ä¸èƒ½è¢«æ›´æ”¹åœ¨APIçš„å®šä¹‰ä¸Šï¼Œä¸€ä¸ªPromiseå¯¹è±¡åªè¦å…·å¤‡then()æ–¹æ³•å³å¯ã€‚å¯¹äºthen()æ–¹æ³•ï¼Œæœ‰ä»¥ä¸‹è¦æ±‚ï¼š æ¥å—å®Œæˆæ€ã€é”™è¯¯æ€çš„å›è°ƒæ–¹æ³• å¯é€‰åœ°æ”¯æŒprogressäº‹ä»¶å›è°ƒä½œä¸ºç¬¬ä¸‰ä¸ªæ–¹æ³• then()æ–¹æ³•åªæ¥å—functionå¯¹è±¡ï¼Œå…¶ä½™å¯¹è±¡å°†è¢«å¿½ç•¥ then()æ–¹æ³•ç»§ç»­è¿”å›Promiseå¯¹è±¡ï¼Œä»¥å®ç°é“¾å¼è°ƒç”¨then()æ–¹æ³•å®šä¹‰å¦‚ä¸‹ï¼š 1then(fulfilledHandler, errorHandler, progressHandler) ä¸ºäº†æ¼”ç¤ºPromises/Aæè®®ï¼Œè¿™é‡Œæˆ‘ä»¬å°è¯•é€šè¿‡ç»§æ‰¿Nodeçš„eventsæ¨¡å—æ¥å®Œæˆä¸€ä¸ªç®€å•çš„å®ç°ï¼Œç›¸å…³ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021var Promise = function () &#123; EventEmitter.call(this)&#125;util.inherits(Promise, EventEmitter)Promise.prototype.then = function (fulfilledHandler, errorHandler, progressHandler) &#123; if (typeof fulfilledHandler === 'function') &#123; // åˆ©ç”¨onceæ–¹æ³•ï¼Œä¿è¯æˆåŠŸå›è°ƒåªæ‰§è¡Œä¸€æ¬¡ this.once('success', fulfilledHandler) &#125; if (typeof errorHandler === 'function') &#123; this.once('error', errorHandler) &#125; if (typeof progressHandler === 'function') &#123; this.on('progress', progressHandler) &#125; return this&#125; è¿™é‡Œçœ‹åˆ°then()æ–¹æ³•æ‰€åšçš„äº‹æƒ…å°±æ˜¯å°†å›è°ƒå‡½æ•°å­˜æ”¾èµ·æ¥ã€‚ä¸ºäº†å®Œæˆæ•´ä¸ªæµç¨‹ï¼Œè¿˜éœ€è¦è§¦å‘æ‰§è¡Œè¿™äº›å›è°ƒå‡½æ•°çš„åœ°æ–¹ï¼Œå®ç°è¿™äº›åŠŸèƒ½çš„å¯¹è±¡é€šå¸¸è¢«ç§°ä¸ºDeferredï¼Œå³å»¶è¿Ÿå¯¹è±¡ï¼Œå®ä¾‹ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718var Deferred = function () &#123; this.state = 'unfulfilled' this.promise = new Promise()&#125;Deferred.prototype.resolve = function (obj) &#123; this.state = 'fulfilled' this.promise.emit('success', obj)&#125;Deferred.prototype.reject = function (err) &#123; this.state = 'failed' this.promise.emit('error', err)&#125;Deferred.prototype.progress = function (data) &#123; this.promise.emit('progress', data)&#125; Promiseä¸­çš„å¤šå¼‚æ­¥åä½œ 1234567891011121314151617181920Deferred.prototype.all = function (promises) &#123; let count = promises.length let results = [] const that = this promises.forEach(function (promise, i) &#123; promise.then(function (data) &#123; count-- results[i] = data if (count === 0) &#123; that.resolve(results) &#125; &#125;, function (err) &#123; that.reject(err) &#125;) &#125;) return this.promise&#125; Promiseçš„è¿›é˜¶çŸ¥è¯† 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788// è®©promiseæ”¯æŒé“¾å¼è°ƒç”¨var Deferred = function () &#123; this.promise = new Promise()&#125;// å®Œæˆæ€Deferred.prototype.resolve = function (obj) &#123; var promise = this.promise var handler while ((handler = promise.queue.shift())) &#123; if (handler &amp;&amp; handler.fulfilled(obj)) &#123; var ret = handler.fulfilled(obj) if (ret &amp;&amp; ret.isPromise) &#123; ret.queue = promise.queue this.promise = ret return &#125; &#125; &#125;&#125;// å¤±è´¥æ€Deferred.prototype.reject = function (obj) &#123; var promise = this.promise var handler while ((handler = promise.queue.shift())) &#123; if (handler &amp;&amp; handler.error(obj)) &#123; var ret = handler.error(obj) if (ret &amp;&amp; ret.isPromise) &#123; ret.queue = promise.queue this.promise = ret return &#125; &#125; &#125;&#125;// ç”Ÿæˆå›è°ƒå‡½æ•°Deferred.prototype.callback = function () &#123; var that = this return function (err, file) &#123; if (err) &#123; return that.reject(err) &#125; that.resolve(file) &#125;&#125;var Promise = function () &#123; // é˜Ÿåˆ—ç”¨äºå­˜å‚¨å¾…æ‰§è¡Œçš„å›è°ƒå‡½æ•° this.queue = [] this.isPromise = true&#125;Promise.prototype.then = function (fulfilledHandler, errorHandler, progressHandler) &#123; var handler = &#123;&#125; if (typeof fulfilledHandler === 'function') &#123; handler.fulfilled = fulfilledHandler &#125; if (typeof errorHandler === 'function') &#123; handler.error = errorHandler &#125; this.queue.push(handler) return this&#125;// éªŒè¯var readFile1 = function (file, encoding) &#123; var deferred = new Deferred() fs.readFile(file, encoding, deferred.callback()) return deferred.promise&#125;var readFile2 = function (file, encoding) &#123; var deferred = new Deferred() fs.readFile(file, encoding, deferred.callback()) return deferred.promise&#125;readFile1('file1.txt', 'utf8') .then(function (file1) &#123; return readFile2(file1.trim(), 'utf8') &#125;) .then(function (file2) &#123; console.log(file2) &#125;) è¦è®©Promiseæ”¯æŒé“¾å¼æ‰§è¡Œï¼Œä¸»è¦é€šè¿‡ä»¥ä¸‹ä¸¤ä¸ªæ­¥éª¤ï¼š å°†æ‰€æœ‰å›è°ƒéƒ½å­˜åˆ°é˜Ÿåˆ—ä¸­ Promiseå®Œæˆæ—¶ï¼Œé€ä¸ªæ‰§è¡Œå›è°ƒï¼Œä¸€æ—¦æ£€æµ‹åˆ°è¿”å›äº†æ–°çš„Promiseå¯¹è±¡ï¼Œåœæ­¢æ‰§è¡Œï¼Œç„¶åå°†å½“å‰Deferredå¯¹è±¡promiseå¼•ç”¨æ”¹å˜ä¸ºæ–°çš„Promiseå¯¹è±¡ï¼Œå¹¶å°†é˜Ÿåˆ—ä¸­ä½™ä¸‹çš„å›è°ƒè½¬äº¤ç»™å®ƒ å°†API PromiseåŒ– 123456789var smooth = function (method) &#123; return function () &#123; var deferred = new Deferred() var args = Array.prototype.slice.call(arguments, 1) args.push(deferred.callback()) method.apply(null, args) return deferred.promise &#125;&#125; æµç¨‹æ§åˆ¶åº“ï¼š å°¾è§¦å‘ä¸Next 1234567891011121314151617181920212223242526272829303132333435363738function offWork(data, next) &#123; console.log('ä¸Šç­ingã€‚ã€‚ã€‚') setTimeout(function() &#123; console.log('ä¸‹ç­äº†ã€‚ã€‚ã€‚') next('ä¼ ç»™ä¸‹ä¸ªä»»åŠ¡çš„æ•°æ®') &#125;, 1000)&#125;function backHome(data, next) &#123; console.log('ä¸Šä¸ªä»»åŠ¡ä¼ è¿‡æ¥çš„æ•°æ®ä¸ºï¼š' + data) setTimeout(function() &#123; console.log('åˆ°å®¶äº†ï¼ï¼ï¼') next('ä¼ ç»™ä¸‹ä¸ªä»»åŠ¡çš„æ•°æ®') &#125;, 1000) console.log('å›å®¶ingã€‚ã€‚ã€‚')&#125;App = &#123; handles: [], use: function(handle) &#123; if (typeof handle == 'function') App.handles.push(handle) &#125;, next: function(data) &#123; var handlelist = App.handles var handle = null var _next = App.next if ((handle = handlelist.shift()) != undefined) &#123; handle.call(App, data, _next) &#125; &#125;, start: function(data) &#123; App.next(data) &#125;&#125;App.use(offWork)App.use(backHome)App.start() asyncï¼šæµç¨‹æ§åˆ¶æ¨¡å— æ— ä¾èµ–å¼‚æ­¥çš„ä¸²è¡Œæ‰§è¡Œï¼šasync.series(asyncFnArray, callback) ä¾èµ–å¼‚æ­¥çš„ä¸²è¡Œæ‰§è¡Œï¼šasync.waterfall(asyncFnArray, callback) å¼‚æ­¥çš„å¹¶è¡Œæ‰§è¡Œï¼šasync.parallel(asyncFNArray, callback) è‡ªåŠ¨ä¾èµ–å¤„ç†ï¼šasync.auto(depsArray) Stepï¼šæµç¨‹æ§åˆ¶æ¨¡å— ä¾èµ–å¼‚æ­¥çš„ä¸²è¡Œæ‰§è¡Œï¼šthis å¹¶è¡Œæ‰§è¡Œä»»åŠ¡ï¼šthis.parallel() ç»“æœåˆ†ç»„ï¼šthis.group() windï¼š$awaitä½¿å¾—ä»£ç çœ‹èµ·æ¥åƒåŒæ­¥çš„ä»£ç  async/await æµç¨‹æ§åˆ¶å°ç»“ï¼šäº‹ä»¶å‘å¸ƒ/è®¢é˜…æ¨¡å¼ç›¸å¯¹ç®—æ˜¯ä¸€ç§è¾ƒä¸ºåŸå§‹çš„æ–¹å¼ï¼ŒPromise/Deferredæ¨¡å¼è´¡çŒ®äº†ä¸€ä¸ªéå¸¸ä¸é”™çš„å¼‚æ­¥ä»»åŠ¡æ¨¡å‹çš„æŠ½è±¡ã€‚è€Œä¸Šè¿°çš„è¿™äº›å¼‚æ­¥æµç¨‹æ§åˆ¶æ–¹æ¡ˆä¸Promise/Deferredæ¨¡å¼çš„æ€è·¯ä¸åŒï¼ŒPromise/Deferredçš„é‡å¤´åœ¨äºå°è£…å¼‚æ­¥çš„è°ƒç”¨éƒ¨åˆ†ï¼Œæµç¨‹æ§åˆ¶åº“åˆ™æ˜¾å¾—æ²¡æœ‰æ¨¡å¼ï¼Œå°†å¤„ç†é‡ç‚¹æ”¾ç½®åœ¨å›è°ƒå‡½æ•°çš„æ³¨å…¥ä¸Šã€‚ä»è‡ªç”±åº¦ä¸Šæ¥è®²ï¼Œasyncã€Stepè¿™ç±»æµæ§åº“ç›¸å¯¹çµæ´»å¾—å¤šã€‚ å¼‚æ­¥å¹¶å‘æ§åˆ¶ï¼šå¼‚æ­¥å¹¶å‘é‡è¿‡å¤§ï¼Œä¼šå¯¼è‡´æœåŠ¡å™¨å´©æºƒã€‚ bagpipeçš„è§£å†³æ–¹æ¡ˆï¼š é€šè¿‡ä¸€ä¸ªé˜Ÿåˆ—æ¥æ§åˆ¶å¹¶å‘é‡ å¦‚æœå½“å‰æ´»è·ƒï¼ˆæŒ‡è°ƒç”¨å‘èµ·ä½†æœªæ‰§è¡Œå›è°ƒï¼‰çš„å¼‚æ­¥è°ƒç”¨é‡å°äºé™å®šå€¼ï¼Œä»é˜Ÿåˆ—ä¸­å–å‡ºæ‰§è¡Œ å¦‚æœæ´»è·ƒè°ƒç”¨è¾¾åˆ°é™å®šå€¼ï¼Œè°ƒç”¨æš‚æ—¶å­˜æ”¾åœ¨é˜Ÿåˆ—ä¸­ æ¯ä¸ªå¼‚æ­¥è°ƒç”¨ç»“æŸæ—¶ï¼Œä»é˜Ÿåˆ—ä¸­å–å‡ºæ–°çš„å¼‚æ­¥è°ƒç”¨æ‰§è¡Œ asyncçš„è§£å†³æ–¹æ¡ˆï¼šparallelLimit() ç¬¬äº”ç«  å†…å­˜æ§åˆ¶ V8å¯¹å†…å­˜çš„ä½¿ç”¨è¿›è¡Œäº†é™åˆ¶ V8çš„å¯¹è±¡åˆ†é…ï¼šåœ¨V8ä¸­ï¼Œæ‰€æœ‰çš„JSå¯¹è±¡éƒ½æ˜¯é€šè¿‡å †æ¥è¿›è¡Œåˆ†é…çš„ï¼ŒNodeæä¾›äº†process.memoryUsage()æ–¹æ³•æŸ¥çœ‹å†…å­˜ä½¿ç”¨é‡ï¼ŒV8åŒæ ·é™åˆ¶äº†å †çš„ä½¿ç”¨å¤§å°ï¼Œè¡¨å±‚åŸå› æ˜¯å› ä¸ºV8æœ€åˆä¸ºæµè§ˆå™¨è®¾è®¡ï¼Œä¸å¤ªå¯èƒ½é‡åˆ°ç”¨å¤§é‡å†…å­˜çš„åœºæ™¯ã€‚å¯¹äºç½‘é¡µæ¥è¯´ï¼ŒV8çš„é™åˆ¶å€¼å·²ç»ç»°ç»°æœ‰ä½™ã€‚æ·±å±‚åŸå› æ˜¯V8çš„åƒåœ¾å›æ”¶æœºåˆ¶çš„é™åˆ¶ã€‚æŒ‰å®˜æ–¹çš„è¯´è¯ï¼Œä»¥1.5GBçš„åƒåœ¾å›æ”¶å †å†…å­˜ä¸ºä¾‹ï¼ŒV8åšä¸€æ¬¡å°çš„åƒåœ¾å›æ”¶éœ€è¦50æ¯«ç§’ä»¥ä¸Šï¼Œåšä¸€æ¬¡éå¢é‡å¼çš„åƒåœ¾å›æ”¶ç”šè‡³è¦1ç§’ä»¥ä¸Šã€‚è¿™æ˜¯åƒåœ¾å›æ”¶ä¸­å¼•èµ·JSçº¿ç¨‹æš‚åœæ‰§è¡Œçš„æ—¶é—´ï¼Œåœ¨è¿™æ ·çš„æ—¶é—´èŠ±é”€ä¸‹ï¼Œåº”ç”¨çš„æ€§èƒ½å’Œå“åº”èƒ½åŠ›éƒ½ä¼šç›´çº¿ä¸‹é™ã€‚å½“ç„¶ï¼Œè¿™ä¸ªé™åˆ¶ä¹Ÿä¸æ˜¯ä¸èƒ½æ‰“å¼€ï¼ŒNodeåœ¨å¯åŠ¨æ—¶å¯ä»¥ä¼ é€’â€“max-old-space-sizeæˆ–â€“max-new-space-sizeæ¥è°ƒæ•´å†…å­˜é™åˆ¶çš„å¤§å° V8çš„åƒåœ¾å›æ”¶æœºåˆ¶ï¼šV8çš„åƒåœ¾å›æ”¶ç­–ç•¥ä¸»è¦åŸºäºåˆ†ä»£å¼åƒåœ¾å›æ”¶æœºåˆ¶ï¼ŒæŒ‰å¯¹è±¡çš„å­˜æ´»æ—¶é—´å°†å†…å­˜çš„åƒåœ¾å›æ”¶è¿›è¡Œä¸åŒçš„åˆ†ä»£ï¼Œç„¶ååˆ†åˆ«å¯¹ä¸åŒåˆ†ä»£çš„å†…å­˜æ–½ä»¥æ›´é«˜æ•ˆçš„ç®—æ³• V8çš„å†…å­˜åˆ†ä»£ï¼šåœ¨V8ä¸­ï¼Œä¸»è¦å°†å†…å­˜åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€ç”Ÿä»£ã€‚æ–°ç”Ÿä»£ä¸­çš„å¯¹è±¡ä¸ºå­˜æ´»æ—¶é—´è¾ƒçŸ­çš„å¯¹è±¡ï¼Œè€ç”Ÿä»£ä¸­çš„å¯¹è±¡ä¸ºå­˜æ´»æ—¶é—´è¾ƒé•¿æˆ–å¸¸é©»å†…å­˜çš„å¯¹è±¡ï¼Œä¸Šè¿°çš„â€“max-old-space-sizeå’Œâ€“max-new-space-sizeåˆ†åˆ«å¯¹åº”è®¾ç½®è€ç”Ÿä»£å’Œæ–°ç”Ÿä»£å†…å­˜çš„å¤§å°ï¼Œè€ç”Ÿä»£å†…å­˜åœ¨64ä½ç³»ç»Ÿå’Œ32ä½ç³»ç»Ÿä¸‹åˆ†åˆ«åªèƒ½ä½¿ç”¨çº¦1.4GBå’Œçº¦0.7GBçš„å¤§å°ï¼Œå¯¹äºæ–°ç”Ÿä»£å†…å­˜ï¼Œå®ƒç”±ä¸¤ä¸ªreserved_semispace_size_æ‰€æ„æˆï¼ŒæŒ‰æœºå™¨ä½æ•°çš„ä¸åŒï¼Œreserved_semispace_size_åœ¨64ä½ç³»ç»Ÿå’Œ32ä½ç³»ç»Ÿä¸‹åˆ†åˆ«ä¸º16MBå’Œ8MBçš„å¤§å°ï¼Œæ‰€ä»¥æ–°ç”Ÿä»£å†…å­˜çš„æœ€å¤§å€¼åœ¨64ä½ç³»ç»Ÿå’Œ32ä½ç³»ç»Ÿä¸Šåˆ†åˆ«ä¸º32MBå’Œ16MBï¼ŒV8å †å†…å­˜çš„æœ€å¤§ä¿ç•™ç©ºé—´ä¸ºï¼š4 * reserved_semispace_size_ + ax-old-space-size_ï¼Œå› æ­¤ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒV8å †å†…å­˜çš„æœ€å¤§å€¼åœ¨64ä½ç³»ç»Ÿä¸Šä¸º1464MBï¼Œ32ä½ç³»ç»Ÿä¸Šåˆ™ä¸º732MBã€‚ Scavengeç®—æ³•ï¼šåœ¨åˆ†ä»£çš„åŸºç¡€ä¸Šï¼Œæ–°ç”Ÿä»£å¯¹ä¸­çš„å¯¹è±¡ä¸»è¦é€šè¿‡Scavengeç®—æ³•è¿›è¡Œåƒåœ¾å›æ”¶ã€‚åœ¨Scavengeçš„å…·ä½“å®ç°ä¸­ï¼Œä¸»è¦é‡‡ç”¨äº†Cheneyç®—æ³•ï¼šå°†æ–°ç”Ÿä»£å†…å­˜å †ç­‰åˆ†ä¸ºä¸¤ä¸ªsemispaceï¼Œä¸€ä¸ªä¸ºFromï¼Œå¦ä¸€ä¸ªä¸ºToï¼Œå½“åƒåœ¾å›æ”¶å¼€å§‹æ—¶ï¼Œä¼šä»Fromç©ºé—´ä¸­æ‹·è´å­˜æ´»çš„å¯¹è±¡åˆ°Toç©ºé—´ï¼Œè€Œéå­˜æ´»å¯¹è±¡çš„ç©ºé—´å°†ä¼šè¢«é‡Šæ”¾ï¼Œå®Œæˆå¤åˆ¶åï¼ŒFromç©ºé—´å’ŒToç©ºé—´çš„è§’è‰²å‘ç”Ÿå¯¹æ¢ã€‚åœ¨ä¸€å®šæ¡ä»¶ä¸‹ï¼Œéœ€è¦å°†å­˜è´§å‘¨æœŸé•¿çš„å¯¹è±¡ç§»åŠ¨åˆ°è€ç”Ÿä»£ä¸­ï¼Œä¹Ÿå°±æ˜¯å®Œæˆå¯¹è±¡æ™‹å‡ã€‚å¯¹è±¡æ™‹å‡çš„æ¡ä»¶ä¸»è¦æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯å¯¹è±¡æ˜¯å¦ç»å†è¿‡Scavengeå›æ”¶ï¼Œä¸€ä¸ªæ˜¯Toç©ºé—´çš„å†…å­˜å ç”¨æ¯”è¶…è¿‡é™åˆ¶ï¼ˆ25%ï¼‰ã€‚ Mark-Sweepï¼šæ ‡è®°æ¸…é™¤ï¼ŒMark-Sweepåœ¨æ ‡è®°é˜¶æ®µéå†å †å†…å­˜ä¸­çš„æ‰€æœ‰å¯¹è±¡ï¼Œå¹¶æ ‡è®°æ´»ç€çš„å¯¹è±¡ï¼Œåœ¨éšåçš„æ¸…é™¤é˜¶æ®µï¼Œåªæ¸…é™¤æ²¡æœ‰è¢«æ ‡è®°çš„å¯¹è±¡ã€‚Mark-Sweepæœ€å¤§çš„é—®é¢˜å°±æ˜¯ï¼Œåœ¨è¿›è¡Œä¸€æ¬¡æ¸…é™¤å›æ”¶ä»¥åï¼Œå†…å­˜ç©ºé—´ä¼šå‡ºç°ä¸è¿ç»­çš„çŠ¶æ€ã€‚è¿™ç§å†…å­˜ç¢ç‰‡ä¼šå¯¹åç»­çš„å†…å­˜åˆ†é…é€ æˆé—®é¢˜ã€‚å¦‚æœå‡ºç°éœ€è¦åˆ†é…ä¸€ä¸ªå¤§å†…å­˜çš„æƒ…å†µï¼Œç”±äºå‰©ä½™çš„ç¢ç‰‡ç©ºé—´ä¸è¶³ä»¥å®Œæˆæ­¤æ¬¡åˆ†é…ï¼Œå°±ä¼šæå‰è§¦å‘åƒåœ¾å›æ”¶ï¼Œè€Œè¿™æ¬¡å›æ”¶æ˜¯ä¸å¿…è¦çš„ã€‚ Mark-Compactï¼šæ ‡è®°æ•´ç†ï¼Œä¸ºäº†è§£å†³Mark-Sweepçš„å†…å­˜ç¢ç‰‡é—®é¢˜ã€‚Mark-Compactåœ¨æ ‡è®°å®Œå­˜æ´»å¯¹è±¡ä»¥åï¼Œä¼šå°†æ´»ç€çš„å¯¹è±¡å‘å†…å­˜ç©ºé—´çš„ä¸€ç«¯ç§»åŠ¨ï¼Œç§»åŠ¨å®Œæˆåï¼Œç›´æ¥æ¸…ç†æ‰è¾¹ç•Œå¤–çš„æ‰€æœ‰å†…å­˜ã€‚ Mark-Sweep &amp; Mark-Compactä¸¤è€…ç»“åˆï¼šç”±äºMark-Conpactéœ€è¦ç§»åŠ¨å¯¹è±¡ï¼Œæ‰€ä»¥å®ƒçš„æ‰§è¡Œé€Ÿåº¦ä¸å¯èƒ½å¾ˆå¿«ï¼Œåœ¨å–èˆä¸Šï¼ŒV8ä¸»è¦ä½¿ç”¨Mark-Sweepï¼Œåœ¨ç©ºé—´ä¸è¶³ä»¥å¯¹ä»æ–°ç”Ÿä»£ä¸­æ™‹å‡è¿‡æ¥çš„å¯¹è±¡è¿›è¡Œåˆ†é…æ—¶ï¼Œæ‰ä½¿ç”¨Mark-Compact Incremental Markingï¼šä¸ºäº†é¿å…å‡ºç°JSåº”ç”¨é€»è¾‘ä¸åƒåœ¾å›æ”¶å™¨çœ‹åˆ°çš„ä¸ä¸€è‡´çš„æƒ…å†µï¼Œåƒåœ¾å›æ”¶çš„3ç§åŸºæœ¬ç®—æ³•éƒ½éœ€è¦å°†åº”ç”¨é€»è¾‘æš‚åœä¸‹æ¥ï¼Œå¾…æ‰§è¡Œå®Œåƒåœ¾å›æ”¶åå†æ¢å¤æ‰§è¡Œåº”ç”¨ç¨‹åºï¼Œå¯¹äºæ–°ç”Ÿä»£æ¥è¯´ï¼Œé»˜è®¤é…ç½®å¾—è¾ƒå°ï¼Œä¸”å…¶ä¸­å­˜æ´»å¯¹è±¡é€šå¸¸è¾ƒå°‘ï¼Œå…¨åœé¡¿ï¼ˆstop-the-worldï¼‰çš„å½±å“ä¸å¤§ã€‚ä½†è€ç”Ÿä»£é€šå¸¸é…ç½®çš„è¾ƒå¤§ï¼Œä¸”å­˜æ´»å¯¹è±¡è¾ƒå¤šï¼Œå…¨å †åƒåœ¾å›æ”¶çš„æ ‡è®°ã€æ¸…ç†ã€æ•´ç†ç­‰åŠ¨ä½œé€ æˆçš„åœé¡¿ä¼šæ¯”è¾ƒå¯æ€•ï¼Œå› æ­¤ï¼ŒV8å¼•å…¥äº†å¢é‡æ ‡è®°ã€å¹¶è¡Œæ ‡è®°ä¸å¹¶è¡Œæ¸…ç†ï¼Œè¿›ä¸€æ­¥åˆ©ç”¨å¤šæ ¸æ€§èƒ½é™ä½æ¯æ¬¡åœé¡¿çš„æ—¶é—´ã€‚ V8çš„åƒåœ¾å›æ”¶æœºåˆ¶åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€ç”Ÿä»£ã€‚ æ–°ç”Ÿä»£ä¸»è¦ä½¿ç”¨Scavengeè¿›è¡Œç®¡ç†ï¼Œä¸»è¦å®ç°æ˜¯Cheneyç®—æ³•ï¼Œå°†å†…å­˜å¹³å‡åˆ†ä¸ºä¸¤å—ï¼Œä½¿ç”¨ç©ºé—´å«Fromï¼Œé—²ç½®ç©ºé—´å«Toï¼Œæ–°å¯¹è±¡éƒ½å…ˆåˆ†é…åˆ°Fromç©ºé—´ä¸­ï¼Œåœ¨ç©ºé—´å¿«è¦å æ»¡æ—¶å°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°Toç©ºé—´ä¸­ï¼Œç„¶åæ¸…ç©ºFromçš„å†…å­˜ç©ºé—´ï¼Œæ­¤æ—¶ï¼Œè°ƒæ¢Fromç©ºé—´å’ŒToç©ºé—´ï¼Œç»§ç»­è¿›è¡Œå†…å­˜åˆ†é…ï¼Œå½“æ»¡è¶³é‚£ä¸¤ä¸ªæ¡ä»¶æ—¶å¯¹è±¡ä¼šä»æ–°ç”Ÿä»£æ™‹å‡åˆ°è€ç”Ÿä»£ã€‚ è€ç”Ÿä»£ä¸»è¦é‡‡ç”¨Mark-Sweepå’ŒMark-Compactç®—æ³•ï¼Œä¸€ä¸ªæ˜¯æ ‡è®°æ¸…é™¤ï¼Œä¸€ä¸ªæ˜¯æ ‡è®°æ•´ç†ã€‚ä¸¤è€…ä¸åŒçš„åœ°æ–¹æ˜¯ï¼ŒMark-Sweepåœ¨åƒåœ¾å›æ”¶åä¼šäº§ç”Ÿç¢ç‰‡å†…å­˜ï¼Œè€ŒMark-Compactåœ¨æ¸…é™¤å‰ä¼šè¿›è¡Œä¸€æ­¥æ•´ç†ï¼Œå°†å­˜æ´»å¯¹è±¡å‘ä¸€ä¾§ç§»åŠ¨ï¼Œéšåæ¸…ç©ºè¾¹ç•Œçš„å¦ä¸€ä¾§å†…å­˜ï¼Œè¿™æ ·ç©ºé—²çš„å†…å­˜éƒ½æ˜¯è¿ç»­çš„ï¼Œä½†æ˜¯å¸¦æ¥çš„é—®é¢˜å°±æ˜¯é€Ÿåº¦ä¼šæ…¢ä¸€äº›ã€‚åœ¨V8ä¸­ï¼Œè€ç”Ÿä»£æ˜¯Mark-Sweepå’ŒMark-Compactä¸¤è€…å…±åŒè¿›è¡Œç®¡ç†çš„ã€‚ é«˜æ•ˆä½¿ç”¨å†…å­˜ å¦‚æœå˜é‡æ˜¯å…¨å±€å˜é‡ï¼ˆä¸é€šè¿‡varå£°æ˜æˆ–å®šä¹‰åœ¨globalå˜é‡ä¸Šï¼‰ï¼Œå…¶å¼•ç”¨å¯¹è±¡å¸¸é©»åœ¨å†…å­˜ä¸­ï¼ˆè€ç”Ÿä»£ä¸­ï¼‰ï¼Œå¯é€šè¿‡deleteæ“ä½œæ¥åˆ é™¤å¼•ç”¨å…³ç³»æˆ–è€…å°†å˜é‡é‡æ–°èµ‹å€¼ï¼Œåœ¨æ¥ä¸‹æ¥çš„è€ç”Ÿä»£å†…å­˜æ¸…é™¤å’Œæ•´ç†è¿‡ç¨‹ä¸­ï¼Œä¼šè¢«å›æ”¶é‡Šæ”¾ã€‚åœ¨V8ä¸­é€šè¿‡deleteåˆ é™¤å¯¹è±¡çš„å±æ€§æœ‰å¯èƒ½å¹²æ‰°V8çš„ä¼˜åŒ–ï¼Œæ‰€ä»¥é€šè¿‡èµ‹å€¼æ–¹å¼è§£é™¤å¼•ç”¨æ›´å¥½ é—­åŒ… Nodeä¸­çš„å†…å­˜ä½¿ç”¨å¹¶ééƒ½æ˜¯é€šè¿‡V8è¿›è¡Œåˆ†é…çš„ã€‚æˆ‘ä»¬å°†é‚£äº›ä¸æ˜¯é€šè¿‡V8åˆ†é…çš„å†…å­˜ç§°ä¸ºå †å¤–å†…å­˜ã€‚åˆ©ç”¨å †å¤–å†…å­˜å¯ä»¥çªç ´å†…å­˜é™åˆ¶ï¼Œä¾‹å¦‚ï¼ŒBufferå¯¹è±¡ï¼Œå®ƒä¸ç»è¿‡V8çš„å†…å­˜åˆ†é…æœºåˆ¶ï¼Œæ‰€ä»¥ä¹Ÿä¸ä¼šæœ‰å †å†…å­˜çš„å¤§å°é™åˆ¶ã€‚ å†…å­˜æ³„æ¼ é€šå¸¸ï¼Œé€ æˆå†…å­˜æ³„æ¼çš„åŸå› æœ‰å¦‚ä¸‹å‡ ä¸ªï¼š ç¼“å­˜ é˜Ÿåˆ—æ¶ˆè´¹ä¸åŠæ—¶ ä½œç”¨åŸŸæœªé‡Šæ”¾ ç¼“å­˜é™åˆ¶ç­–ç•¥ï¼šé‡‡ç”¨LRUç®—æ³•çš„ç¼“å­˜å¤±æ•ˆç­–ç•¥ ç›´æ¥å°†å†…å­˜ä½œä¸ºç¼“å­˜ä½¿ç”¨ï¼Œé™¤äº†é™åˆ¶ç¼“å­˜çš„å¤§å°å¤–ï¼Œå¦å¤–è¦è€ƒè™‘çš„äº‹æƒ…æ˜¯ï¼Œè¿›ç¨‹ä¹‹å‰æ— æ³•å…±äº«å†…å­˜ã€‚å¦‚æœåœ¨è¿›ç¨‹å†…ä½¿ç”¨ç¼“å­˜ï¼Œè¿™äº›ç¼“å­˜ä¸å¯é¿å…åœ°æœ‰é‡å¤ï¼Œå¯¹ç‰©ç†å†…å­˜çš„ä½¿ç”¨æ˜¯ä¸€ç§æµªè´¹ã€‚å¦‚ä½•ä½¿ç”¨å¤§é‡ç¼“å­˜ï¼Œç›®å‰æ¯”è¾ƒå¥½çš„è§£å†³æ–¹æ¡ˆæ˜¯é‡‡ç”¨è¿›ç¨‹å¤–çš„ç¼“å­˜ï¼Œè¿›ç¨‹è‡ªèº«éƒ¨å­˜å‚¨çŠ¶æ€ã€‚å¤–éƒ¨çš„ç¼“å­˜è½¯ä»¶æœ‰ç€è‰¯å¥½çš„ç¼“å­˜è¿‡æœŸæ·˜æ±°ç­–ç•¥ä»¥åŠè‡ªæœ‰çš„å†…å­˜ç®¡ç†ï¼Œä¸å½±å“Nodeè¿›ç¨‹çš„æ€§èƒ½ã€‚å®ƒçš„å¥½å¤„å¾ˆå¤šï¼Œåœ¨Nodeä¸­ä¸»è¦å¯ä»¥è§£å†³ä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜ï¼š å°†ç¼“å­˜è½¬ç§»åˆ°å¤–éƒ¨ï¼Œå‡å°‘å¸¸é©»å†…å­˜çš„å¯¹è±¡çš„æ•°é‡ï¼Œè®©åƒåœ¾å›æ”¶æ›´é«˜æ•ˆ è¿›ç¨‹ä¹‹é—´å¯ä»¥å…±äº«ç¼“å­˜ å¤§å†…å­˜åº”ç”¨ï¼š streamæ¨¡å— Bufferæ“ä½œ ç¬¬å…­ç«  ç†è§£Buffer Bufferå¯¹è±¡ç±»ä¼¼äºæ•°ç»„ï¼Œç”¨äºæ“ä½œå­—èŠ‚ï¼Œå®ƒçš„å…ƒç´ ä¸º16è¿›åˆ¶çš„ä¸¤ä½æ•°ï¼Œå³0åˆ°255çš„æ•°å€¼ Bufferå†…å­˜åˆ†é… é‡‡ç”¨slabåˆ†é…æœºåˆ¶ï¼Œslabæ˜¯ä¸€ç§åŠ¨æ€å†…å­˜ç®¡ç†æœºåˆ¶ï¼Œç®€å•è€Œè¨€ï¼Œslabå°±æ˜¯ä¸€å—ç”³è¯·å¥½çš„å›ºå®šå¤§å°çš„å†…å­˜åŒºåŸŸã€‚slabå…·æœ‰å¦‚ä¸‹3ç§çŠ¶æ€ï¼š fullï¼šå®Œå…¨åˆ†é…çŠ¶æ€ partialï¼šéƒ¨åˆ†åˆ†é…çŠ¶æ€ emptyï¼šæ²¡æœ‰è¢«åˆ†é…çŠ¶æ€ Nodeä»¥8KBä¸ºç•Œé™æ¥åŒºåˆ†Bufferæ˜¯å¤§å¯¹è±¡è¿˜æ˜¯å°å¯¹è±¡ï¼ŒBuffer.poolSize = 8 * 1024ï¼Œè¿™ä¸ª8KBçš„å€¼ä¹Ÿå°±æ˜¯æ¯ä¸ªslabçš„å¤§å°å€¼ï¼Œåœ¨JSå±‚é¢ï¼Œä»¥å®ƒä½œä¸ºå•ä½å•å…ƒè¿›è¡Œå†…å­˜çš„åˆ†é… çœŸæ­£çš„å†…å­˜æ˜¯åœ¨Nodeçš„C++å±‚é¢æä¾›çš„ï¼ŒJSå±‚é¢åªæ˜¯ä½¿ç”¨å®ƒã€‚å½“è¿›è¡Œå°è€Œé¢‘ç¹çš„Bufferæ“ä½œæ—¶ï¼Œé‡‡ç”¨slabçš„æœºåˆ¶è¿›è¡Œé¢„å…ˆç”³è¯·å’Œäº‹ååˆ†é…ï¼Œä½¿å¾—JSåˆ°æ“ä½œç³»ç»Ÿä¹‹é—´ä¸å¿…æœ‰è¿‡å¤šçš„å†…å­˜ç”³è¯·æ–¹é¢çš„ç³»ç»Ÿè°ƒç”¨ã€‚å¯¹äºå¤§å—çš„Bufferè€Œè¨€ï¼Œåˆ™ç›´æ¥ä½¿ç”¨C++å±‚é¢æä¾›çš„å†…å­˜ï¼Œè€Œæ— éœ€ç»†è…»çš„åˆ†é…æ“ä½œ Bufferçš„è½¬æ¢ å­—ç¬¦ä¸²è½¬Bufferï¼šnew Buffer(str, [encoding])ã€buf.write(string, [offest], [length], [encoding]) Bufferè½¬å­—ç¬¦ä¸²ï¼šbuf.toString([encoding], [start], [end]) Bufferä¸æ”¯æŒçš„ç¼–ç ç±»å‹ï¼šå¯é€šè¿‡iconvã€icon-liteæ¨¡å—è¿›è¡Œè½¬æ¢ Bufferçš„æ‹¼æ¥ï¼šBufferåœ¨ä½¿ç”¨åœºæ™¯ä¸­ï¼Œé€šå¸¸æ˜¯ä»¥ä¸€æ®µä¸€æ®µçš„æ–¹å¼ä¼ è¾“ 12345678910var fs = require('fs')var rs = fs.createReadStream('test.md')var data = ''rs.on('data', function (chunk) &#123; data += chunk // éšè—äº†toString()æ“ä½œï¼Œç­‰ä»·äºdata = data.toString() + chunk.toString()&#125;)rs.on('end', function () &#123; console.log(data)&#125;) ä¸Šè¿°ä»£ç å¯¹äºè‹±æ–‡ï¼ŒtoString()ä¸ä¼šé€ æˆä»»ä½•é—®é¢˜ï¼Œä½†å¯¹äºå®½å­—èŠ‚çš„ä¸­æ–‡ï¼Œå´ä¼šå½¢æˆé—®é¢˜ï¼Œä¸­æ–‡å­—åœ¨UTF-8ä¸‹å 3ä¸ªå­—èŠ‚ï¼Œå½“è¿™3ä¸ªå­—èŠ‚åˆ†éƒ¨åœ¨ä¸Šè¿°ä»£ç ä¸­çš„ä¸åŒchunkæ—¶ï¼Œä¼šé€ æˆè¿™3ä¸ªå­—èŠ‚ä»¥ä¹±ç çš„å½¢å¼å‘ˆç°ï¼Œ setEncoding()ä¸string_decoder()ï¼šå¯è¯»æµå¯é€šè¿‡readable.setEncoding(encoding)è®¾ç½®ç¼–ç æ–¹å¼ï¼Œè®©dataäº‹ä»¶ä¸­ä¼ é€’çš„ä¸å†æ˜¯ä¸€ä¸ªBufferå¯¹è±¡ï¼Œè€Œæ˜¯ç¼–ç åçš„å­—ç¬¦ä¸²ã€‚äº‹å®ä¸Šï¼Œåœ¨è°ƒç”¨setEncoding()æ—¶ï¼Œå¯è¯»æµå¯¹è±¡åœ¨å†…éƒ¨è®¾ç½®äº†ä¸€ä¸ªdecoderå¯¹è±¡ï¼ŒStringDecoderåœ¨å¾—åˆ°ç¼–ç åï¼ŒçŸ¥é“å®½å­—èŠ‚å­—ç¬¦åœ¨UTF-8ç¼–ç ä¸‹æ˜¯ä»¥3ä¸ªå­—èŠ‚çš„æ–¹å¼å­˜å‚¨çš„ï¼Œæ‰€ä»¥å½“è¾“å‡ºæ—¶ä¸æ»¡è¶³3ä¸ªå­—ç¬¦çš„æ¡ä»¶æ—¶ï¼Œä¼šå°†å‰©ä½™å­—ç¬¦å’Œåç»­è¾“å‡ºçš„å­—ç¬¦åˆå¹¶ï¼Œå†æ¬¡ç”¨3çš„æ•´æ•°å€å­—èŠ‚è¿›è¡Œè½¬ç ã€‚äºæ˜¯ä¹±ç é—®é¢˜é€šè¿‡è¿™ç§ä¸­é—´å½¢å¼è¢«è§£å†³äº†ï¼Œä½†æ˜¯å®ƒç›®å‰åªèƒ½å¤„ç†UTF-8ã€Base64å’ŒUCS-2/UTF-16LEè¿™3ç§ç¼–ç  æ­£ç¡®æ‹¼æ¥Buffer 12345678910111213141516171819202122232425262728293031323334353637383940414243var chunks = []var size = 0res.on('data', function (chunk) &#123; chunks.push(chunk) size += chunk.length&#125;)res.on('end', function () &#123; var buf = Buffer.concat(chunks, size) var str = iconv.decode(buf. 'utf8') console.log(str)&#125;)Buffer.concat = function (list, length) &#123; if (!Array.isArray(list)) &#123; throw new Error('Usage: Buffer.concat(list, [lenght])') &#125; if (list.length === 0) &#123; return new Buffer(0) &#125; if (list.length === 1) &#123; return list[0] &#125; if (typeof length !== 'number') &#123; length = 0 for (var i = 0; i &lt; list.length; i++) &#123; var buf = list[i] length += buf.length &#125; &#125; var buffer = new Buffer(length) var pos = 0 for (var i = 0; i &lt; list.length; i++) &#123; var buf = list[i] buf.copy(buffer, pos) pos += buf.length &#125; return buffer&#125; Bufferä¸æ€§èƒ½ åœ¨åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šæ“ä½œå­—ç¬¦ä¸²ï¼Œä½†ä¸€æ—¦åœ¨ç½‘ç»œä¸­ä¼ è¾“ï¼Œéƒ½éœ€è¦è½¬åŒ–ä¸ºBufferï¼Œä»¥è¿›è¡ŒäºŒè¿›åˆ¶æ•°æ®ä¼ è¾“ï¼Œå­—ç¬¦ä¸²ä¸Bufferçš„è½¬æ¢æœ‰æ€§èƒ½æŸè€—ï¼Œåœ¨Nodeæ„å»ºçš„Webåº”ç”¨ä¸­ï¼Œå¯ä»¥é€‰æ‹©å°†é¡µé¢ä¸­çš„åŠ¨æ€å†…å®¹å’Œé™æ€å†…å®¹åˆ†ç¦»ï¼Œé™æ€å†…å®¹éƒ¨åˆ†å¯ä»¥é€šè¿‡é¢„å…ˆè½¬æ¢ä¸ºBufferçš„æ–¹å¼ï¼Œä½¿æ€§èƒ½å¾—åˆ°æå‡ã€‚ç”±äºæ–‡ä»¶è‡ªèº«æ˜¯äºŒè¿›åˆ¶æ•°æ®ï¼Œæ‰€ä»¥åœ¨ä¸éœ€è¦æ”¹å˜å†…å®¹çš„åœºæ™¯ä¸‹ï¼Œå°½é‡åªè¯»å–Bufferï¼Œç„¶åç›´æ¥ä¼ è¾“ï¼Œä¸åšé¢å¤–çš„è½¬æ¢ï¼Œé¿å…æŸè€—ã€‚ åœ¨æ–‡ä»¶çš„è¯»å–æ—¶ï¼Œæœ‰ä¸€ä¸ªhighWaterMarkè®¾ç½®å¯¹æ€§èƒ½çš„å½±å“è‡³å…³é‡è¦ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªå½±å“çš„ç‚¹ï¼š highWaterMarkè®¾ç½®å¯¹Bufferå†…å­˜çš„åˆ†é…å’Œä½¿ç”¨æœ‰ä¸€å®šå½±å“ï¼Œå½“è¯»å–ä¸€ä¸ªç›¸åŒçš„å¤§æ–‡ä»¶æ—¶ï¼ŒhighWaterMarkå€¼è¶Šå¤§ï¼Œè¯»å–é€Ÿåº¦è¶Šå¿« highWaterMarkè®¾ç½®è¿‡å°ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿè°ƒç”¨æ¬¡æ•°è¿‡å¤š ç¬¬ä¸ƒç«  ç½‘ç»œç¼–ç¨‹ Nodeæä¾›äº†netã€dgramã€httpã€httpsè¿™4ä¸ªæ¨¡å—ï¼Œåˆ†åˆ«ç”¨äºå¤„ç†TCPã€UDPã€HTTPã€HTTPSï¼Œé€‚ç”¨äºæœåŠ¡å™¨ç«¯å’Œå®¢æœç«¯ã€‚ TCPçš„æœåŠ¡äº‹ä»¶ï¼šæœåŠ¡å™¨å¯ä»¥åŒæ—¶ä¸å¤šä¸ªå®¢æˆ·ç«¯ä¿æŒè¿æ¥ï¼Œå¯¹äºæ¯ä¸ªè¿æ¥è€Œè¨€æ˜¯å…¸å‹çš„å¯å†™å¯è¯»Streamå¯¹è±¡ æœåŠ¡å™¨äº‹ä»¶ listeningï¼šåœ¨è°ƒç”¨server.listen()ç»‘å®šç«¯å£æˆ–è€…Domain Socketåè§¦å‘ï¼Œç®€ä»‹å†™æ³•ä¸ºserver.listen(port, listeningListener)ï¼Œé€šè¿‡listen()æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ connectionï¼šæ¯ä¸ªå®¢æˆ·ç«¯å¥—æ¥å­—åŸ’è¡—é“æœåŠ¡å™¨ç«¯æ—¶è§¦å‘ï¼Œç®€æ´å†™æ³•ä¸ºé€šè¿‡net.createServer()ï¼Œæœ€åä¸€ä¸ªå‚æ•°ä¼ é€’ closeï¼šå½“æœåŠ¡å™¨å…³é—­æ—¶è§¦å‘ï¼Œåœ¨è°ƒç”¨server.close()åï¼ŒæœåŠ¡å™¨å°†åœæ­¢æ¥å—æ–°çš„å¥—æ¥å­—è¿æ¥ï¼Œä½†ä¿æŒå½“å‰å­˜åœ¨çš„è¿æ¥ï¼Œç­‰å¾…æ‰€æœ‰è¿æ¥éƒ½æ–­å¼€åï¼Œä¼šè§¦å‘è¯¥äº‹ä»¶ errorï¼šå½“æœåŠ¡å™¨å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œå°†ä¼šè§¦å‘è¯¥äº‹ä»¶ã€‚æ¯”å¦‚ä¾¦å¬ä¸€ä¸ªä½¿ç”¨ä¸­çš„ç«¯å£ï¼Œå°†ä¼šè§¦å‘ä¸€ä¸ªå¼‚å¸¸ï¼Œå¦‚æœä¸ä¾¦å¬erroräº‹ä»¶ï¼ŒæœåŠ¡å™¨å°†ä¼šæŠ›å‡ºå¼‚å¸¸ è¿æ¥äº‹ä»¶ï¼ˆsocketï¼‰ dataï¼šå½“ä¸€ç«¯ç”¨write()å‘é€æ•°æ®æ—¶ï¼Œå¦ä¸€ç«¯ä¼šè§¦å‘dataäº‹ä»¶ï¼Œäº‹ä»¶ä¼ é€’çš„æ•°æ®å³ä½¿write()å‘é€çš„æ•°æ® endï¼šå½“è¿æ¥ä¸­çš„ä»»æ„ä¸€ç«¯å‘é€äº†FINæ•°æ®æ—¶ï¼Œå°†ä¼šè§¦å‘è¯¥äº‹ä»¶ connectï¼šè¯¥äº‹ä»¶ç”¨äºå®¢æˆ·ç«¯ï¼Œå½“å¥—æ¥å­—ä¸æœåŠ¡ç«¯è¿æ¥æˆåŠŸæ—¶ä¼šè¢«è§¦å‘ drainï¼šå½“ä»»æ„ä¸€ç«¯è°ƒç”¨write()å‘é€æ•°æ®æ—¶ï¼Œå½“å‰è¿™ç«¯ä¼šè§¦å‘è¯¥äº‹ä»¶ errorï¼šå½“å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œè§¦å‘è¯¥äº‹ä»¶ timeoutï¼šå½“ä¸€å®šæ—¶é—´åè¿æ¥ä¸å†æ´»è·ƒæ—¶ï¼Œè¯¥äº‹ä»¶å°†ä¼šè¢«è§¦å‘ï¼Œé€šçŸ¥ç”¨æˆ·å½“å‰è¿æ¥å·²ç»è¢«é—²ç½®äº†å¦å¤–ï¼Œç”±äºTCPå¥—æ¥å­—æ˜¯å¯å†™å¯è¯»çš„Streamå¯¹è±¡ï¼Œå¯ä»¥åˆ©ç”¨pipe()æ–¹æ³•å·§å¦™åœ°å®ç°ç®¡é“æ“ä½œï¼Œå¦‚ä¸‹ä»£ç å®ç°äº†ä¸€ä¸ªechoæœåŠ¡å™¨ï¼š 123456var net = require('net')var server = net.createServer(function (socket) &#123; socket.write('Echo server\\r\\n') socket.pipe(socket)&#125;) å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒTCPé’ˆå¯¹ç½‘ç»œä¸­å°çš„æ•°æ®åŒ…æœ‰ä¸€å®šçš„ä¼˜åŒ–ç­–ç•¥ï¼šNagleç®—æ³•ã€‚å¦‚æœæ¯æ¬¡åªå‘é€ä¸€ä¸ªå­—èŠ‚çš„å†…å®¹è€Œä¸ä¼˜åŒ–ï¼Œç½‘ç»œä¸­å°†å……æ»¡åªæœ‰æå°‘æ•°æœ‰æ•ˆçš„æ•°æ®åŒ…ï¼Œå°†ååˆ†æµªè´¹ç½‘ç»œèµ„æºã€‚Nagleç®—æ³•é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œè¦æ±‚ç¼“å­˜åŒºçš„æ•°æ®è¾¾åˆ°ä¸€å®šæ•°é‡æˆ–è€…ä¸€å®šæ—¶é—´åæ‰å°†å…¶å‘å‡ºï¼Œæ‰€ä»¥å°æ•°æ®åŒ…å°†ä¼šè¢«Nagleç®—æ³•åˆå¹¶ï¼Œä»¥æ­¤æ¥ä¼˜åŒ–ç½‘ç»œã€‚è¿™ç§ä¼˜åŒ–è™½ç„¶ä½¿ç½‘ç»œå¸¦å®½è¢«æœ‰æ•ˆåœ°ä½¿ç”¨ï¼Œä½†æ˜¯æ•°æ®æœ‰å¯èƒ½è¢«å»¶è¿Ÿå‘é€ åœ¨Nodeä¸­ï¼Œç”±äºTCPé»˜è®¤å¯ç”¨äº†Nagleç®—æ³•ï¼Œå¯ä»¥è°ƒç”¨socket.setNoDealy(true)å»æ‰Nagleç®—æ³•ï¼Œä½¿å¾—write()å¯ä»¥ç«‹å³å‘é€æ•°æ®åˆ°ç½‘ç»œä¸­ å¦ä¸€ä¸ªéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå°½ç®¡åœ¨ç½‘ç»œçš„ä¸€ç«¯è°ƒç”¨write()ä¼šè§¦å‘å¦ä¸€ç«¯çš„dataäº‹ä»¶ï¼Œä½†æ˜¯å¹¶ä¸æ„å‘³ç€æ¯æ¬¡write()éƒ½ä¼šè§¦å‘ä¸€æ¬¡dataäº‹ä»¶ï¼Œåœ¨å…³é—­æ‰Nagleç®—æ³•åï¼Œå¦ä¸€ç«¯å¯èƒ½ä¼šå°†æ¥æ”¶åˆ°çš„å¤šä¸ªå°æ•°æ®åŒ…åˆå¹¶ï¼Œç„¶ååªè§¦å‘ä¸€æ¬¡dataäº‹ä»¶ æ„å»ºUDPæœåŠ¡ï¼šUDPåˆç§°ç”¨æˆ·æ•°æ®åŒ…åè®®ï¼Œä¸TCPä¸€æ ·åŒå±äºç½‘ç»œä¼ è¾“å±‚ã€‚UDPä¸TCPæœ€å¤§çš„ä¸åŒæ˜¯UDPä¸æ˜¯é¢å‘è¿æ¥çš„ã€‚TCPä¸­è¿æ¥ä¸€æ—¦å»ºç«‹ï¼Œæ‰€æœ‰çš„ä¼šè¯éƒ½åŸºäºè¿æ¥å®Œæˆï¼Œå®¢æˆ·ç«¯å¦‚æœè¦ä¸å¦ä¸€ä¸ªTCPæœåŠ¡é€šä¿¡ï¼Œéœ€è¦å¦åˆ›å»ºä¸€ä¸ªå¥—æ¥å­—æ¥å®Œæˆè¿æ¥ã€‚ä½†åœ¨UDPä¸­ï¼Œä¸€ä¸ªå¥—æ¥å­—å¯ä»¥ä¸å¤šä¸ªUDPæœåŠ¡é€šä¿¡ï¼Œå®ƒè™½ç„¶æä¾›é¢å‘äº‹åŠ¡çš„ç®€å•ä¸å¯é ä¿¡æ¯ä¼ è¾“æœåŠ¡ï¼Œåœ¨ç½‘ç»œå·®çš„æƒ…å†µä¸‹å­˜åœ¨ä¸¢åŒ…ä¸¥é‡çš„é—®é¢˜ï¼Œä½†æ˜¯ç”±äºå®ƒæ— é¡»è¿æ¥ï¼Œèµ„æºæ¶ˆè€—ä½ï¼Œå¤„ç†å¿«é€Ÿä¸”çµæ´»ï¼Œæ‰€ä»¥å¸¸å¸¸åº”ç”¨åœ¨é‚£ç§å¶å°”ä¸¢ä¸€ä¸¤ä¸ªæ•°æ®åŒ…ä¹Ÿä¸ä¼šäº§ç”Ÿé‡å¤§å½±å“çš„åœºæ™¯ï¼Œæ¯”å¦‚éŸ³é¢‘ã€è§†é¢‘ç­‰ã€‚UDPç›®å‰åº”ç”¨å¾ˆå¹¿æ³›ï¼ŒDNSæœåŠ¡å³ä½¿åŸºäºå®ƒå®ç°çš„ã€‚ UDPå¥—æ¥å­—äº‹ä»¶ messageï¼šå½“UDPå¥—æ¥å­—ä¾¦å¬åˆ°ç½‘å¡ç«¯å£åï¼Œæ¥æ”¶åˆ°æ¶ˆæ¯æ—¶è§¦å‘è¯¥äº‹ä»¶ï¼Œè§¦å‘æºå¸¦çš„æ•°æ®ä¸ºæ¶ˆæ¯Bufferå¯¹è±¡å’Œä¸€ä¸ªè¿œç¨‹åœ°å€ä¿¡æ¯ listeningï¼šå½“UDPå¥—æ¥å­—å¼€å§‹ä¾¦å¬æ—¶è§¦å‘è¯¥äº‹ä»¶ closeï¼šè°ƒç”¨close()æ–¹æ³•æ—¶è§¦å‘è¯¥äº‹ä»¶ï¼Œå¹¶ä¸å†è§¦å‘messageäº‹ä»¶ã€‚å¦‚éœ€å†æ¬¡è§¦å‘messageäº‹ä»¶ï¼Œé‡æ–°ç»‘å®šå³å¯ errorï¼šå½“å¼‚å¸¸å‘ç”Ÿæ—¶è§¦å‘è¯¥äº‹ä»¶ï¼Œå¦‚æœä¸ä¾¦å¬ï¼Œå¼‚å¸¸å°†ç›´æ¥æŠ›å‡ºï¼Œä½¿è¿›ç¨‹é€€å‡º æ„å»ºHTTPæœåŠ¡ï¼šåœ¨Nodeä¸­ï¼ŒHTTPæœåŠ¡ç»§æ‰¿è‡ªTCPæœåŠ¡å™¨ï¼ˆnetæ¨¡å—ï¼‰ï¼Œhttpæ¨¡å—å°†è¿æ¥æ‰€ç”¨å¥—æ¥å­—çš„è¯»å†™æŠ½è±¡ä¸ºServerRequestå’ŒServerResponseå¯¹è±¡ï¼Œå®ƒä»¬åˆ†åˆ«å¯¹åº”è¯·æ±‚å’Œå“åº”æ“ä½œã€‚åœ¨è¯·æ±‚äº§ç”Ÿçš„è¿‡ç¨‹ä¸­ï¼Œhttpæ¨¡å—æ‹¿åˆ°è¿æ¥ä¼ æ¥çš„æ•°æ®ï¼Œè°ƒç”¨äºŒçº§åˆ¶æ¨¡å—http_parserè¿›è¡Œè§£æï¼Œåœ¨è§£æå®Œè¯·æ±‚æŠ¥æ–‡çš„æŠ¥å¤´åï¼Œè§¦å‘requestäº‹ä»¶ï¼Œè°ƒç”¨ç”¨æˆ·çš„ä¸šåŠ¡é€»è¾‘ã€‚ HTTPè¯·æ±‚ req.method req.url req.httpVersion HTTPå“åº” è®¾ç½®æŠ¥æ–‡å¤´ä¿¡æ¯ï¼šres.setHeaderï¼Œå¯ä»¥è°ƒç”¨å¤šæ¬¡è¿›è¡Œè®¾ç½®ï¼Œä½†æ˜¯åªæœ‰è°ƒç”¨writeHeadåï¼ŒæŠ¥å¤´æ‰ä¼šå†™å…¥åˆ°è¿æ¥ä¸­ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œhttpæ¨¡å—ä¼šè‡ªåŠ¨å¸®ä½ è®¾ç½®ä¸€äº›å¤´ä¿¡æ¯ è®¾ç½®æŠ¥æ–‡ä½“ä¿¡æ¯ï¼šres.write()å’Œres.end()ï¼Œåè€…ä¸å‰è€…çš„å·®åˆ«åœ¨äºres.end()ä¼šå…ˆè°ƒç”¨write()å‘é€æ•°æ®ï¼Œç„¶åå‘é€ä¿¡å·å‘ŠçŸ¥æœåŠ¡å™¨è¿™æ¬¡å“åº”ç»“æŸã€‚å“åº”ç»“æŸåï¼ŒHTTPæœåŠ¡å™¨å¯èƒ½ä¼šå°†å½“å‰çš„è¿æ¥ç”¨äºä¸‹ä¸€ä¸ªè¯·æ±‚ï¼Œæˆ–è€…å…³é—­è¿æ¥ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒæŠ¥å¤´æ˜¯åœ¨æŠ¥æ–‡ä½“å‘é€å‰å‘é€çš„ï¼Œä¸€æ—¦å¼€å§‹äº†æ•°æ®çš„å‘é€ï¼ŒwriteHead()å’ŒsetHeader()å°†ä¸å†ç”Ÿæ•ˆã€‚è¿™ç”±åè®®çš„ç‰¹æ•ˆå†³å®šã€‚å¦å¤–ï¼Œæ— è®ºæœåŠ¡å™¨ç«¯åœ¨å¤„ç†ä¸šåŠ¡é€»è¾‘æ—¶æ˜¯å¦å‘ç”Ÿå¼‚å¸¸ï¼ŒåŠ¡å¿…åœ¨ç»“æŸæ—¶è°ƒç”¨res.end()ç»“æŸè¯·æ±‚ï¼Œå¦åˆ™å®¢æˆ·ç«¯å°†ä¸€ç›´å¤„äºç­‰å¾…çš„çŠ¶æ€ã€‚ HTTPæœåŠ¡çš„äº‹ä»¶ connectionï¼šåœ¨å¼€å§‹HTTPè¯·æ±‚å’Œå“åº”å‰ï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ç«¯éœ€è¦å»ºç«‹åº•å±‚çš„TCPè¿æ¥ï¼Œè¿™ä¸ªè¿æ¥å¯èƒ½å› ä¸ºå¼€å¯äº†keep-aliveï¼Œå¯ä»¥åœ¨å¤šæ¬¡è¯·æ±‚å“åº”ä¹‹é—´ä½¿ç”¨ï¼›å½“è¿™ä¸ªè¿æ¥å»ºç«‹æ—¶ï¼ŒæœåŠ¡å™¨è§¦å‘ä¸€æ¬¡connectionäº‹ä»¶ã€‚ requestï¼šå»ºç«‹TCPè¿æ¥åï¼Œhttpæ¨¡å—åº•å±‚å°†åœ¨æ•°æ®æµä¸­æŠ½è±¡å‡ºHTTPè¯·æ±‚å’ŒHTTPå“åº”ï¼Œå½“è¯·æ±‚æ•°æ®å‘é€åˆ°æœåŠ¡å™¨ç«¯ï¼Œåœ¨è§£æå‡ºHTTPè¯·æ±‚å¤´åï¼Œå°†ä¼šè§¦å‘è¯¥äº‹ä»¶ï¼›åœ¨res.end()åï¼ŒTCPè¿æ¥å¯èƒ½å°†ç”¨äºä¸‹ä¸€æ¬¡è¯·æ±‚å“åº”ã€‚ closeï¼šä¸TCPæœåŠ¡å™¨çš„è¡Œä¸ºä¸€è‡´ï¼Œè°ƒç”¨server.close()æ–¹æ³•åœæ­¢æ¥å—æ–°çš„è¿æ¥ï¼Œå½“å·²æœ‰çš„è¿æ¥éƒ½æ–­å¼€æ—¶ï¼Œè§¦å‘è¯¥äº‹ä»¶ï¼›å¯ä»¥ç»™server.close()ä¼ é€’ä¸€ä¸ªå›è°ƒå‡½æ•°æ¥å¿«é€Ÿæ³¨å†Œè¯¥äº‹ä»¶ã€‚ checkContinueï¼šæŸäº›å®¢æˆ·ç«¯åœ¨å‘é€è¾ƒå¤§çš„æ•°æ®æ—¶ï¼Œå¹¶ä¸ä¼šå°†æ•°æ®ç›´æ¥å‘é€ï¼Œè€Œæ˜¯å…ˆå‘é€ä¸€ä¸ªå¤´éƒ¨å¸¦Expect: 100-continueçš„è¯·æ±‚åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å°†ä¼šè§¦å‘checkContinueäº‹ä»¶ï¼›å¦‚æœæ²¡æœ‰ä¸ºæœåŠ¡å™¨ç›‘å¬è¿™ä¸ªäº‹ä»¶ï¼ŒæœåŠ¡å™¨ä¼šè‡ªåŠ¨å“åº”å®¢æˆ·ç«¯100 Continueçš„çŠ¶æ€ç ï¼Œè¡¨ç¤ºæ¥å—æ•°æ®ä¸Šä¼ ï¼›å¦‚æœä¸æ¥å—æ•°æ®çš„è¾ƒå¤šæ—¶ï¼Œå“åº”å®¢æˆ·ç«¯400 Bad Requestæ‹’ç»å®¢æˆ·ç«¯ç»§ç»­å‘é€æ•°æ®å³å¯ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“è¯¥äº‹ä»¶å‘ç”Ÿæ—¶ä¸ä¼šè§¦å‘requestäº‹ä»¶ï¼Œä¸¤ä¸ªäº‹ä»¶äº’æ–¥ã€‚å½“å®¢æˆ·ç«¯æ”¶åˆ°100 Continueåé‡æ–°å‘èµ·è¯·æ±‚æ—¶ï¼Œæ‰ä¼šè§¦å‘requestäº‹ä»¶ã€‚ connectï¼šå½“å®¢æˆ·ç«¯å‘èµ·CONNECTè¯·æ±‚æ—¶è§¦å‘ï¼Œè€Œå‘èµ·CONNECTè¯·æ±‚é€šå¸¸åœ¨HTTPä»£ç†æ—¶å‡ºç°ï¼›å¦‚æœä¸ç›‘å¬è¯¥äº‹ä»¶ï¼Œå‘èµ·è¯¥è¯·æ±‚çš„è¿æ¥å°†ä¼šå…³é—­ã€‚ upgradeï¼šå½“å®¢æˆ·ç«¯è¦æ±‚å‡çº§è¿æ¥çš„åè®®æ—¶ï¼Œéœ€è¦å’ŒæœåŠ¡å™¨ç«¯åå•†ï¼Œå®¢æˆ·ç«¯ä¼šåœ¨è¯·æ±‚å¤´ä¸­å¸¦ä¸ŠUpgradeå­—æ®µï¼ŒæœåŠ¡å™¨ç«¯ä¼šåœ¨æ¥å—åˆ°è¿™æ ·çš„è¯·æ±‚æ—¶è§¦å‘è¯¥äº‹ä»¶ã€‚å¦‚æœä¸ç›‘å¬è¯¥äº‹ä»¶ï¼Œå‘èµ·è¯·æ±‚çš„è¿æ¥å°†ä¼šå…³é—­ã€‚ clientErrorï¼šè¿æ¥çš„å®¢æˆ·ç«¯è§¦å‘erroräº‹ä»¶æ—¶ï¼Œè¿™ä¸ªé”™è¯¯ä¼šä¼ é€’åˆ°æœåŠ¡å™¨ç«¯ï¼Œæ­¤æ—¶è§¦å‘è¯¥äº‹ä»¶ã€‚ æ„å»ºHTTPå®¢æˆ·ç«¯ï¼šhttp.request(options, connect) optionså‚æ•°å†³å®šäº†è¿™ä¸ªHTTPè¯·æ±‚å¤´ä¸­çš„å†…å®¹ï¼Œå®ƒçš„é€‰é¡¹æœ‰å¦‚ä¸‹è¿™äº› hostï¼šæœåŠ¡å™¨çš„åŸŸåæˆ–IPåœ°å€ï¼Œé»˜è®¤ä¸ºlocalhost hostnameï¼šæœåŠ¡å™¨åç§° portï¼šæœåŠ¡å™¨ç«¯å£ï¼Œé»˜è®¤ä¸º80 localAddressï¼šå»ºç«‹ç½‘ç»œè¿æ¥çš„æœ¬åœ°ç½‘å¡ socketPathï¼šDomainå¥—æ¥å­—è·¯å¾„ methodï¼šHTTPè¯·æ±‚æ–¹æ³•ï¼Œé»˜è®¤ä¸ºGET pathï¼šè¯·æ±‚è·¯å¾„ï¼Œé»˜è®¤ä¸º/ headersï¼šè¯·æ±‚å¤´å¯¹è±¡ authï¼šBasicè®¤è¯ï¼Œè¿™ä¸ªå€¼å°†è¢«è®¡ç®—æˆè¯·æ±‚å¤´ä¸­çš„Authorizationéƒ¨åˆ†æŠ¥æ–‡ä½“çš„å†…å®¹ç”±è¯·æ±‚å¯¹è±¡çš„write()å’Œend()æ–¹æ³•å®ç°ï¼šé€šè¿‡write()æ–¹æ³•å‘è¿æ¥ä¸­å†™å…¥æ•°æ®ï¼Œé€šè¿‡end()æ–¹æ³•å‘ŠçŸ¥æŠ¥æ–‡ç»“æŸã€‚å®ƒä¸æµè§ˆå™¨ä¸­çš„Ajaxè°ƒç”¨å‡ è¿‘ç›¸åŒï¼ŒAjaxçš„å®è´¨å°±æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„ç½‘ç»œHTTPè¯·æ±‚ã€‚ HTTPå“åº”ï¼šHTTPå®¢æˆ·ç«¯çš„å“åº”å¯¹è±¡ä¸æœåŠ¡å™¨ç«¯è¾ƒä¸ºç±»ä¼¼ï¼Œåœ¨ClientRequestå¯¹è±¡ä¸­ï¼Œå®ƒçš„äº‹ä»¶å«åšresponseã€‚ClientRequeståœ¨è§£æå“åº”æŠ¥æ–‡æ—¶ï¼Œä¸€è§£æå®Œå“åº”å¤´å°±è§¦å‘responseäº‹ä»¶ï¼ŒåŒæ—¶ä¼ é€’ä¸€ä¸ªå“åº”å¯¹è±¡ä»¥ä¾›æ“ä½œClientResponseã€‚åç»­å“åº”æŠ¥æ–‡ä½“ä»¥åªè¯»æµçš„æ–¹å¼æä¾›ã€‚ HTTPä»£ç†ï¼šä¸ºäº†é‡ç”¨TCPè¿æ¥ï¼Œhttpæ¨¡å—åŒ…å«äº†ä¸€ä¸ªé»˜è®¤çš„å®¢æˆ·ç«¯ä»£ç†å¯¹è±¡http.globalAgentã€‚å®ƒå¯¹æ¯ä¸ªæœåŠ¡å™¨ç«¯ï¼ˆhost + portï¼‰åˆ›å»ºçš„è¿æ¥è¿›è¡Œäº†ç®¡ç†ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œé€šè¿‡ClientRequestå¯¹è±¡å¯¹åŒä¸€ä¸ªæœåŠ¡ç«¯å‘èµ·çš„HTTPè¯·æ±‚æœ€å¤šå¯ä»¥åˆ›å»º5ä¸ªè¿æ¥ã€‚å®ƒçš„å®è´¨æ˜¯ä¸€ä¸ªè¿æ¥æ± ã€‚è°ƒç”¨HTTPå®¢æˆ·ç«¯åŒæ—¶å¯¹ä¸€ä¸ªæœåŠ¡å™¨å‘èµ·10æ¬¡HTTPè¯·æ±‚æ—¶ï¼Œå…¶å®è´¨åªæœ‰5ä¸ªè¯·æ±‚å¤„äºå¹¶å‘çŠ¶æ€ï¼Œåç»­çš„è¯·æ±‚éœ€è¦ç­‰å¾…æŸä¸ªè¯·æ±‚å®ŒæˆæœåŠ¡åçŒœçœŸæ­£å‘å‡ºã€‚å¯åœ¨optionsä¸­ä¼ é€’agenté€‰é¡¹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯·æ±‚ä¼šé‡‡ç”¨å…¨å±€çš„ä»£ç†å¯¹è±¡ï¼Œé»˜è®¤è¿æ¥æ•°é™åˆ¶çš„ä¸º5ã€‚ 1234567891011var agent = new http.Agent(&#123; maxSockets: 10&#125;)var options = &#123; hostname: '127.0.0.1', port: 1334, path: '/', method: 'GET', agent: agent&#125; ä¹Ÿå¯ä»¥è®¾ç½®agenté€‰é¡¹ä¸ºfalseå€¼ï¼Œä»¥å¤šé‡Œè¿æ¥æ± çš„ç®¡ç†ï¼Œä½¿å¾—è¯·æ±‚ä¸å—å¹¶å‘é™åˆ¶ã€‚ Agentå¯¹è±¡çš„socketså’Œrequestså±æ€§åˆ†åˆ«è¡¨ç¤ºå½“å‰è¿æ¥æ± ä¸­ä½¿ç”¨ä¸­çš„è¿æ¥æ•°å’Œå¤„äºç­‰å¾…çŠ¶æ€çš„è¯·æ±‚æ•°ï¼Œåœ¨ä¸šåŠ¡ä¸­ç›‘è§†ç€ä¸¤ä¸ªå€¼æœ‰åŠ©äºå‘ç°ä¸šåŠ¡çŠ¶æ€çš„ç¹å¿™ç¨‹åº¦ã€‚ HTTPå®¢æˆ·ç«¯äº‹ä»¶ responseï¼šä¸æœåŠ¡å™¨ç«¯çš„requestäº‹ä»¶å¯¹åº”çš„å®¢æˆ·ç«¯åœ¨è¯·æ±‚å‘å‡ºåå¾—åˆ°æœåŠ¡å™¨ç«¯å“åº”æ—¶ï¼Œä¼šè§¦å‘è¯¥äº‹ä»¶ã€‚ socketï¼šå½“åº•å±‚è¿æ¥æ± ä¸­å»ºç«‹çš„è¿æ¥åˆ†é…ç»™å½“å‰è¯·æ±‚å¯¹è±¡æ—¶ï¼Œè§¦å‘è¯¥äº‹æƒ…ã€‚ connectï¼šå½“å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘é€CONNECTè¯·æ±‚æ—¶ï¼Œå¦‚æœæœåŠ¡å™¨ç«¯å“åº”äº†200çŠ¶æ€ç ï¼Œå®¢æˆ·ç«¯å°†ä¼šè§¦å‘è¯¥äº‹ä»¶ã€‚ upgradeï¼šå®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘èµ·Upgradeè¯·æ±‚æ—¶ï¼Œå¦‚æœæœåŠ¡å™¨ç«¯å“åº”äº†101 Switching ProtocolsçŠ¶æ€ï¼Œå®¢æˆ·ç«¯å°†ä¼šè§¦å‘è¯¥äº‹ä»¶ã€‚ continueï¼šå®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘èµ·Expect: 100-continueå¤´ä¿¡æ¯ï¼Œä»¥è¯•å›¾å‘é€è¾ƒå¤§æ•°æ®é‡ï¼Œå¦‚æœæœåŠ¡å™¨ç«¯å“åº”100 ContinueçŠ¶æ€ï¼Œå®¢æˆ·ç«¯å°†è§¦å‘è¯¥äº‹ä»¶ã€‚ æ„å»ºWebSocketæœåŠ¡ WebSocketæœåŠ¡ä¸Nodeä¹‹é—´çš„é…åˆå ªç§°å®Œç¾ï¼Œå…¶ç†ç”±æœ‰ä¸¤æ¡ï¼š WebSocketå®¢æˆ·ç«¯åŸºäºäº‹ä»¶çš„ç¼–ç¨‹æ¨¡å‹ä¸Nodeä¸­è‡ªå®šä¹‰äº‹ä»¶ç›¸å·®æ— å‡  WebSocketå®ç°äº†å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹é—´çš„é•¿è¿æ¥ï¼Œè€ŒNodeäº‹ä»¶é©±åŠ¨çš„æ–¹å¼ååˆ†æ“…é•¿ä¸å¤§é‡çš„å®¢æˆ·ç«¯ä¿æŒé«˜å¹¶å‘è¿æ¥ã€‚ WebSocketä¸ä¼ ç»ŸHTTPæœ‰å¦‚ä¸‹å¥½å¤„ï¼š å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ç«¯åªå»ºç«‹ä¸€ä¸ªTCPè¿æ¥ï¼Œå¯ä»¥ä½¿ç”¨æ›´å°‘çš„è¿æ¥ WebSocketæœåŠ¡å™¨ç«¯å¯ä»¥æ¨é€æ•°æ®åˆ°å®¢æˆ·ç«¯ï¼Œè¿™è¿œæ¯”HTTPè¯·æ±‚å“åº”æ¨¡å¼æ›´çµæ´»ã€æ›´é«˜æ•ˆ æœ‰æ›´è½»é‡çº§çš„åè®®å¤´ï¼Œå‡å°‘æ•°æ®ä¼ é€é‡ åœ¨WebSocketä¹‹å‰ï¼Œç½‘é¡µå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ç«¯è¿›è¡Œé€šä¿¡æœ€é«˜æ•ˆçš„æ˜¯Cometï¼ˆå½—æ˜Ÿï¼‰æŠ€æœ¯ã€‚å®ç°CometæŠ€æœ¯çš„ç»†èŠ‚æ˜¯é‡‡ç”¨é•¿è½®è¯¢ï¼ˆlong-pollingï¼‰æˆ–iframeæµã€‚é•¿è½®è¯¢çš„åŸç†æ˜¯å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘èµ·è¯·æ±‚ï¼ŒæœåŠ¡å™¨ç«¯åªåœ¨è¶…æ—¶æˆ–æœ‰æ•°æ®å“åº”æ—¶æ–­å¼€è¿æ¥ï¼ˆres.end()ï¼‰ï¼›å®¢æˆ·ç«¯åœ¨æ”¶åˆ°æ•°æ®æˆ–è¶…æ—¶åé‡æ–°å‘èµ·è¯·æ±‚ã€‚ WebSocketåè®®ä¸»è¦åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šæ¡æ‰‹å’Œæ•°æ®ä¼ è¾“ WebSocketæ¡æ‰‹ å®¢æˆ·ç«¯å»ºç«‹è¿æ¥æ—¶ï¼Œé€šè¿‡HTTPå‘èµ·è¯·æ±‚æŠ¥æ–‡ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 123456GET /chat HTTP/1.1HOST: server.example.comUpgrade: websocketConnection: UpgradeSec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ==Sec-WebSocket-Version: 13 ä¸æ™®é€šçš„HTTPè¯·æ±‚åè®®ç•¥æœ‰åŒºåˆ«çš„éƒ¨åˆ†åœ¨äºå¦‚ä¸‹è¿™äº›åè®®å¤´ï¼š 12Upgrade: websocketConnection: Upgrade ä¸Šè¿°ä¸¤ä¸ªå­—æ®µè¡¨ç¤ºè¯·æ±‚æœåŠ¡å™¨ç«¯å‡çº§åè®®ä¸ºWebSocketã€‚å…¶ä¸­Sec-WebSocket-Keyç”¨äºå®‰å…¨æ ¡éªŒ Sec-WebSocket-Keyçš„å€¼æ˜¯éšæœºç”Ÿæˆçš„Base64ç¼–ç çš„å­—ç¬¦ä¸²ã€‚æœåŠ¡å™¨ç«¯æ¥æ”¶åˆ°ä¹‹åå°†å…¶ä¸å­—ç¬¦ä¸²258EAFA5-E914-47DA-95CA-C5AB0DC85B11ç›¸è¿ï¼Œç„¶åé€šè¿‡sha1å®‰å…¨æ•£åˆ—ç®—æ³•è®¡ç®—å‡ºç»“æœåï¼Œå†è¿›è¡ŒBase64ç¼–ç ï¼Œæœ€åè¿”å›ç»™å®¢æˆ·ç«¯ã€‚è¿™ä¸ªç®—æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š 12var crypto = require('crypto')var val = crypto.createHash('sha1').update(key).digest('base64') å¦å¤–ï¼Œä¸‹é¢ä¸¤ä¸ªå­—æ®µæŒ‡å®šå­åè®®å’Œç‰ˆæœ¬å·ï¼š 12Sec-WebSocket-Protocol: chat, superchatSec-WebSocket-Version: 13 æœåŠ¡å™¨ç«¯å¤„ç†å®Œè¯·æ±‚åï¼Œå“åº”å¦‚ä¸‹æŠ¥æ–‡ï¼š 12345HTTP/1.1 Switching ProtocolsUpgrade: websocketConnection: UpgradeSec-WebSocket-Accept: s3pPLMBiTxaQ9kYGzzhZRbK+xOo=Sec-WebSocket-Protocol: chat ä¸Šé¢çš„æŠ¥æ–‡å‘Šä¹‹å®¢æˆ·ç«¯æ­£åœ¨æ›´æ¢åè®®ï¼Œæ›´æ–°åº”ç”¨å±‚åè®®ä¸ºWebSocketåè®®ï¼Œå¹¶åœ¨å½“å‰çš„å¥—æ¥å­—è¿æ¥ä¸Šåº”ç”¨æ–°åè®®ã€‚å‰©ä½™çš„å­—æ®µåˆ†åˆ«è¡¨ç¤ºæœåŠ¡å™¨ç«¯åŸºäºSec-WebSocket-Keyç”Ÿæˆçš„å­—ç¬¦ä¸²å’Œé€‰ä¸­çš„å­åè®®ã€‚å®¢æˆ·ç«¯å°†ä¼šæ ¡éªŒSec-WebSocket-Acceptçš„å€¼ï¼Œå¦‚æœæˆåŠŸï¼Œå°†å¼€å§‹æ¥ä¸‹æ¥çš„æ•°æ®ä¼ è¾“ã€‚ WebSocketæ•°æ®ä¼ è¾“ åœ¨æ¡æ‰‹é¡ºåˆ©å®Œæˆåï¼Œå½“å‰è¿æ¥å°†ä¸å†è¿›è¡ŒHTTPçš„äº¤äº’ï¼Œè€Œæ˜¯å¼€å§‹WebSocketçš„æ•°æ®å¸§åè®®ï¼Œå®ç°å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ç«¯çš„æ•°æ®äº¤æ¢ ä¸ºäº†å®‰å…¨è€ƒè™‘ï¼Œå®¢æˆ·ç«¯éœ€è¦å¯¹å‘é€çš„æ•°æ®å¸§è¿›è¡Œæ©ç å¤„ç†ï¼ŒæœåŠ¡å™¨ä¸€æ—¦å—åˆ°æ— æ©ç å¸§ï¼ˆæ¯”å¦‚ä¸­é—´æ‹¦æˆªç ´åï¼‰ï¼Œè¿æ¥å°†å…³é—­ã€‚è€ŒæœåŠ¡å™¨å‘é€åˆ°å®¢æˆ·ç«¯çš„æ•°æ®å¸§æ— éœ€åšæ©ç å¤„ç†ï¼ŒåŒæ ·ï¼Œå¦‚æœå®¢æˆ·ç«¯æ”¶åˆ°å¸¦æ©ç çš„æ•°æ®å¸§ï¼Œè¿æ¥ä¹Ÿå°†å…³é—­ã€‚ ç½‘ç»œæœåŠ¡ä¸å®‰å…¨ åœ¨ç½‘æ™¯å…¬å¸çš„NetScapeæµè§ˆå™¨æ¨å‡ºä¹‹åˆå°±æå‡ºäº†SSL(Secure Sockets Layerï¼Œå®‰å…¨å¥—é˜¶å±‚)ã€‚SSLä½œä¸ºä¸€ç§å®‰å…¨åè®®ï¼Œå®ƒåœ¨ä¼ è¾“å±‚æä¾›å¯¹ç½‘ç»œè¿æ¥åŠ å¯†çš„åŠŸèƒ½ã€‚å¯¹äºåº”ç”¨å±‚è€Œè¨€ï¼Œå®ƒæ˜¯é€æ˜çš„ï¼Œæ•°æ®åœ¨ä¼ é€’åˆ°åº”ç”¨å±‚ä¹‹å‰å°±å·²ç»å®Œæˆäº†åŠ å¯†å’Œè§£å¯†çš„è¿‡ç¨‹ã€‚æœ€åˆçš„SSLåº”ç”¨åœ¨Webä¸Šï¼Œè¢«æœåŠ¡å™¨ç«¯å’Œæµè§ˆå™¨ç«¯åŒæ—¶æ”¯æŒï¼ŒéšåIETFå°†å…¶æ ‡å‡†åŒ–ï¼Œç§°ä¸ºTLS(Transport Layer Securityï¼Œå®‰å…¨ä¼ è¾“å±‚åè®®) Nodeåœ¨ç½‘ç»œå®‰å…¨ä¸Šæä¾›äº†3ä¸ªæ¨¡å—ï¼Œåˆ†åˆ«ä¸ºcryptoã€tlsã€httpsã€‚å…¶ä¸­cryptoä¸»è¦ç”¨äºåŠ å¯†è§£å¯†ï¼ŒSHAï¼ã€MD5ç­‰åŠ å¯†ç®—æ³•éƒ½åœ¨å…¶ä¸­æœ‰ä½“ç°ã€‚çœŸæ­£ç”¨äºç½‘ç»œçš„æ˜¯å¦å¤–ä¸¤ä¸ªæ¨¡å—ï¼Œtlsæ¨¡å—æä¾›äº†ä¸netæ¨¡å—ç±»ä¼¼çš„åŠŸèƒ½ï¼ŒåŒºåˆ«åœ¨äºå®ƒå»ºç«‹åœ¨TLS/SSLåŠ å¯†çš„TCPè¿æ¥ä¸Šã€‚å¯¹äºhttpsè€Œè¨€ï¼Œå®ƒå®Œå…¨ä¸httpæ¨¡å—æ¥å£ä¸€è‡´ï¼ŒåŒºåˆ«ä¹Ÿä»…åœ¨äºå®ƒå»ºç«‹äºå®‰å…¨çš„è¿æ¥ä¹‹ä¸Šã€‚ TLS/SSL å¯†é’¥ï¼šTLS/SSLæ˜¯ä¸€ä¸ªå…¬é’¥/ç§é’¥çš„ç»“æ„ï¼Œå®ƒæ˜¯ä¸€ä¸ªéå¯¹ç§°çš„ç»“æ„ï¼Œæ¯ä¸ªæœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯éƒ½æœ‰è‡ªå·±çš„å…¬ç§é’¥ã€‚å…¬é’¥ç”¨æ¥åŠ å¯†è¦ä¼ è¾“çš„æ•°æ®ï¼Œç§é’¥ç”¨æ¥è§£å¯†æ¥æ”¶åˆ°çš„æ•°æ®ã€‚å…¬é’¥å’Œç§é’¥æ˜¯é…å¯¹çš„ï¼Œé€šè¿‡å…¬é’¥åŠ å¯†çš„æ•°æ®ï¼Œåªæœ‰é€šè¿‡ç§é’¥æ‰èƒ½è§£å¯†ï¼Œæ‰€ä»¥åœ¨å»ºç«‹å®‰å…¨ä¼ è¾“ä¹‹å‰ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ä¹‹é—´éœ€è¦äº’æ¢å…¬é’¥ã€‚å®¢æˆ·ç«¯å‘é€æ•°æ®æ—¶è¦é€šè¿‡æœåŠ¡å™¨ç«¯çš„å…¬é’¥è¿›è¡ŒåŠ å¯†ï¼ŒæœåŠ¡å™¨ç«¯å‘é€æ•°æ®æ—¶åˆ™éœ€è¦å®¢æˆ·ç«¯çš„å…¬é’¥è¿›è¡ŒåŠ å¯†ã€‚ Nodeåœ¨åº•å±‚é‡‡ç”¨çš„æ˜¯opensslå®ç°TLS/SSL æ•°å­—è¯ä¹¦ï¼šä¸ºäº†ç¡®ä¿æ•°æ®å®‰å…¨ï¼Œå¼•å…¥äº†ä¸€ä¸ªç¬¬ä¸‰æ–¹ï¼šCA(Certificate Authorityï¼Œæ•°å­—è¯ä¹¦è®¤è¯ä¸­å¿ƒ)ã€‚CAçš„ä½œç”¨æ˜¯ä¸ºç«™ç‚¹é¢å‘è¯ä¹¦ï¼Œä¸”è¿™ä¸ªè¯ä¹¦ä¸­å…·æœ‰CAé€šè¿‡è‡ªå·±çš„å…¬é’¥å’Œç§é’¥å®ç°çš„ç­¾åã€‚ ä¸ºäº†å¾—åˆ°ç­¾åè¯ä¹¦ï¼ŒæœåŠ¡å™¨ç«¯éœ€è¦é€šè¿‡è‡ªå·±çš„ç§é’¥ç”ŸæˆCSR(Certificate Signing Requestï¼Œè¯ä¹¦ç­¾åè¯·æ±‚)æ–‡ä»¶ã€‚CAæœºæ„å°†é€šè¿‡è¿™ä¸ªæ–‡ä»¶é¢å‘å±äºè¯¥æœåŠ¡å™¨ç«¯çš„ç­¾åè¯ä¹¦ï¼Œåªè¦é€šè¿‡CAæœºæ„å°±èƒ½éªŒè¯è¯ä¹¦æ˜¯å¦åˆæ³•ã€‚ é€šè¿‡CAæœºæ„é¢å‘è¯ä¹¦é€šå¸¸æ˜¯ä¸€ä¸ªçƒ¦ççš„è¿‡ç¨‹ï¼Œéœ€è¦ä»˜å‡ºä¸€å®šçš„ç²¾åŠ›å’Œè´¹ç”¨ã€‚å¯¹äºä¸­å°å‹ä¼ä¸šè€Œè¨€ï¼Œå¤šåŠæ˜¯é‡‡ç”¨è‡ªç­¾åè¯ä¹¦æ¥æ„å»ºå®‰å…¨ç½‘ç»œçš„ã€‚æ‰€è°“è‡ªç­¾åè¯ä¹¦ï¼Œå°±æ˜¯è‡ªå·±æ‰®æ¼”CAæœºæ„ï¼Œç»™è‡ªå·±çš„æœåŠ¡å™¨ç«¯é¢å‘ç­¾åè¯ä¹¦ã€‚ å®¢æˆ·ç«¯åœ¨å‘èµ·å®‰å…¨è¿æ¥å‰ä¼šå»è·å–æœåŠ¡å™¨ç«¯çš„è¯ä¹¦ï¼Œå¹¶é€šè¿‡CAçš„è¯ä¹¦éªŒè¯æœåŠ¡å™¨ç«¯çš„è¯ä¹¦çš„çœŸä¼ªã€‚é™¤äº†éªŒè¯çœŸä¼ªå¤–ï¼Œé€šå¸¸è¿˜å«æœ‰å¯¹æœåŠ¡å™¨åç§°ã€IPåœ°å€ç­‰è¿›è¡ŒéªŒè¯çš„è¿‡ç¨‹ã€‚ TLSæœåŠ¡ï¼šä¸æ™®é€šçš„TCPæœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯ç›¸æ¯”ï¼ŒTLSçš„æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯ä»…ä»…åªåœ¨è¯ä¹¦çš„é…ç½®ä¸Šæœ‰å·®åˆ«ï¼Œå…¶ä½™éƒ¨åˆ†åŸºæœ¬ç›¸åŒï¼Œåœ¨Nodeä¸­ï¼Œé€šè¿‡tlsæ¨¡å—æ­å»ºTLSæœåŠ¡ã€‚ HTTPSæœåŠ¡ï¼šHTTPSæœåŠ¡å°±æ˜¯å·¥ä½œåœ¨TLS/SSLä¸Šçš„HTTP ç¬¬å…«ç«  æ„å»ºWebåº”ç”¨ åŸºç¡€åŠŸèƒ½ è¯·æ±‚æ–¹æ³• 12345678910111213141516function (req, res) &#123; switch (req.method) &#123; case 'POST': update(req, res) break case 'DELETE': remove(req, res) break case 'PUT': create(req, res) break case 'GET': default: get(req, res) &#125;&#125; è·¯å¾„è§£æï¼šå®¢æˆ·ç«¯ä»£ç†ï¼ˆæµè§ˆå™¨ï¼‰ä¼šå°†è¿™ä¸ªåœ°å€è§£ææˆæŠ¥æ–‡ï¼Œå°†è·¯å¾„å’ŒæŸ¥è¯¢éƒ¨åˆ†æ”¾åœ¨æŠ¥æ–‡ç¬¬ä¸€è¡Œã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œhashéƒ¨åˆ†ä¼šè¢«ä¸¢å¼ƒï¼Œä¸ä¼šå­˜åœ¨äºæŠ¥æ–‡çš„ä»»ä½•åœ°æ–¹ã€‚ æ ¹æ®è·¯å¾„å»æŸ¥æ‰¾ç£ç›˜ä¸­çš„æ–‡ä»¶ï¼Œç„¶åå°†å…¶å“åº”ç»™å®¢æˆ·ç«¯ 123456789101112function (req, res) &#123; const pathname = url.parse(req.url).pathname fs.readFile(path.join(ROOT, pathname), function (err, file) &#123; if (err) &#123; res.writeHead(404) res.end('æ‰¾ä¸åˆ°ç›¸å…³æ–‡ä»¶ã€‚- -') return &#125; res.writeHead(200) res.end(file) &#125;)&#125; æ ¹æ®è·¯å¾„æ¥é€‰æ‹©æ§åˆ¶å™¨ 123456789101112131415// request url: /controller/action/a/b/cfunction (req, res) &#123; const pathname = url.parse(req.url).pathname const paths = pathname.split('/') const controller = paths[1] || 'index' const action = paths[2] || 'index' const args = path.slice(3) if (handles[controller] &amp;&amp; handles[controller][action]) &#123; handles[controller][action].apply(null, [req, res].concat(args)) &#125; else &#123; rew.writeHead(200) res.end('æ‰¾ä¸åˆ°å“åº”æ§åˆ¶å™¨') &#125;&#125; è¿™æ ·æˆ‘ä»¬çš„ä¸šåŠ¡éƒ¨åˆ†å¯ä»¥åªå…³å¿ƒå…·ä½“çš„ä¸šåŠ¡å®ç°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 12345handles.index = &#123;&#125;handles.index.index = function (req, res, foo, bar) &#123; res.writeHead(200) res.end(foo)&#125; æŸ¥è¯¢å­—ç¬¦ä¸² æŸ¥è¯¢å­—ç¬¦ä¸²ä½äºè·¯å¾„ä¹‹åï¼Œåœ¨åœ°å€æ ä¸­è·¯å¾„åçš„?foo=bar&amp;baz=valå­—ç¬¦ä¸²å°±æ˜¯æŸ¥è¯¢å­—ç¬¦ä¸²ã€‚è¿™ä¸ªå­—ç¬¦ä¸²ä¼šè·Ÿéšåœ¨è·¯å¾„åï¼Œå½¢æˆè¯·æ±‚æŠ¥æ–‡é¦–è¡Œçš„ç¬¬äºŒéƒ¨åˆ†ã€‚è¿™éƒ¨åˆ†å†…å®¹ç»å¸¸éœ€è¦ä¸ºä¸šåŠ¡é€»è¾‘æ‰€ç”¨ï¼ŒNodeæä¾›äº†queryStringæ¨¡å—ç”¨äºå¤„ç†è¿™éƒ¨åˆ†æ•°æ®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 1234const url = require('url')const querystring = require('querystring')const query = querystring.parse(url.parse(req.url).query)// const query = url.parse(req.url, true).query è¦æ³¨æ„çš„ç‚¹æ˜¯ï¼Œå¦‚æœæŸ¥è¯¢å­—ç¬¦ä¸²ä¸­çš„é”®å‡ºç°å¤šæ¬¡ï¼Œé‚£ä¹ˆå®ƒçš„å€¼ä¼šæ˜¯ä¸€ä¸ªæ•°ç»„ Cookie Cookieçš„å¤„ç†åˆ†ä¸ºå¦‚ä¸‹å‡ æ­¥ï¼š æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€Cookie æµè§ˆå™¨å°†Cookieä¿å­˜ ä¹‹åæ¯æ¬¡æµè§ˆå™¨éƒ½ä¼šå°†Cookieå‘å‘æœåŠ¡å™¨ç«¯ è§£æCookie 1234567891011121314function parseCookie (cookie) &#123; let cookies = &#123;&#125; if (!cookie) &#123; return cookies &#125; let list = cookie.split(';') for (let i = 0; i &lt; list.length; i++) &#123; let pair = list[i].split('=') cookies[pair[0].trim()] = pair[1] &#125; return cookies&#125; æœåŠ¡å™¨é€šè¿‡Set-Cookieå­—æ®µå¾€å®¢æˆ·ç«¯å†™å…¥Cookie 1Set-Cookie: name=value; Path=/; Expires=Sun, 23-Apr-23 09:01:35 GMT; Domain=.domain.com; å…¶ä¸­name=valueæ˜¯å¿…é¡»åŒ…å«çš„éƒ¨åˆ†ï¼Œå…¶ä½™éƒ¨åˆ†çš†æ˜¯å¯é€‰å‚æ•°ã€‚è¿™äº›å¯é€‰å‚æ•°å°†ä¼šå½±å“æµè§ˆå™¨åœ¨åç»­å°†Cookieå‘é€ç»™æœåŠ¡å™¨ç«¯çš„è¡Œä¸ºã€‚ä»¥ä¸‹ä¸ºä¸»è¦çš„å‡ ä¸ªé€‰é¡¹ï¼š pathè¡¨ç¤ºè¿™ä¸ªCookieå½±å“åˆ°çš„è·¯å¾„ï¼Œå½“å‰è®¿é—®çš„è·¯å¾„ä¸æ»¡è¶³è¯¥åŒ¹é…æ—¶ï¼Œæµè§ˆå™¨åˆ™ä¸å‘é€è¿™ä¸ªCookieã€‚ Expireså’ŒMax-Ageæ˜¯ç”¨æ¥å‘ŠçŸ¥æµè§ˆå™¨è¿™ä¸ªCookieä½•æ—¶è¿‡æœŸçš„ï¼Œå¦‚æœä¸è®¾ç½®è¯¥é€‰é¡¹ï¼Œåœ¨å…³é—­æµè§ˆå™¨æ˜¯ä¼šä¸¢å¤±æ‰è¿™ä¸ªCookieã€‚Expiresçš„å€¼æ˜¯ä¸€ä¸ªUTCæ ¼å¼çš„æ—¶é—´å­—ç¬¦ä¸²ï¼Œæ˜¯ç»å¯¹æ—¶é—´ï¼Œå¦‚æœå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯çš„æ—¶é—´ä¸åŒ¹é…ï¼Œè¿™ç§æ—¶é—´è®¾ç½®å°±ä¼šå­˜åœ¨åå·®ã€‚ä¸ºæ­¤ï¼ŒMax-Ageå‘ŠçŸ¥æµè§ˆå™¨è¿™æ¡Cookieå¤šä¹…ä¹‹åè¿‡æœŸï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå…·ä½“çš„æ—¶é—´ã€‚ HttpOnlyå‘ŠçŸ¥æµè§ˆå™¨ä¸å…è®¸é€šè¿‡è„šæœ¬document.cookieå»æ›´æ”¹è¿™ä¸ªCookieå€¼ï¼Œäº‹å®ä¸Šï¼Œè®¾ç½®HTTPOnlyä¹‹åï¼Œè¿™ä¸ªå€¼åœ¨document.cookieä¸­ä¸å¯è§ã€‚ä½†æ˜¯åœ¨HTTPè¯·æ±‚çš„è¿‡ç¨‹ä¸­ï¼Œä¾ç„¶ä¼šå‘é€è¿™ä¸ªCookieåˆ°æœåŠ¡å™¨ç«¯ã€‚ Secureï¼šå½“Secureä¸ºtrueæ—¶ï¼Œåœ¨HTTPä¸­æ˜¯æ— æ•ˆçš„ï¼Œåœ¨HTTPSä¸­æ‰æœ‰æ•ˆï¼Œè¡¨ç¤ºåˆ›å»ºçš„Cookieåªèƒ½åœ¨HTTPSè¿æ¥ä¸­è¢«æµè§ˆå™¨ä¼ é€’åˆ°æœåŠ¡å™¨ç«¯è¿›è¡Œä¼šè¯éªŒè¯ï¼Œå¦‚æœæ˜¯HTTPè¿æ¥åˆ™ä¸ä¼šä¼ é€’è¯¥ä¿¡æ¯ï¼Œæ‰€ä»¥å¾ˆéš¾è¢«çªƒå¬åˆ°ã€‚Cookieåºåˆ—åŒ–æˆç¬¦åˆè§„èŒƒçš„å­—ç¬¦ä¸² 12345678910111213function serialize (name, val, opt) &#123; var pairs = [name + '=' + encode(val)] opt = opt || &#123;&#125; if (opt.maxAge) pairs.push('Max-Age=' + opt.maxAge) if (opt.domain) pairs.push('Domain=' + opt.domain) if (opt.path) pairs.push('Path=' + opt.path) if (opt.expires) pairs.push('Expires=' + opt.expires.toUTCString()) if (opt.httpOnly) pairs.push('HttpOnly') if (opt.secure) pairs.push('Secure') return pairs.join('; ')&#125; Cookieçš„æ€§èƒ½å½±å“ï¼šç”±äºCookieçš„å®ç°æœºåˆ¶ï¼Œä¸€æ—¦æœåŠ¡å™¨ç«¯å‘å®¢æˆ·ç«¯å‘é€äº†è®¾ç½®Cookieçš„æ„å›¾ï¼Œé™¤éCookieè¿‡æœŸï¼Œå¦åˆ™å®¢æˆ·ç«¯æ¯æ¬¡è¯·æ±‚éƒ½ä¼šå‘é€è¿™äº›Cookieåˆ°æœåŠ¡å™¨ç«¯ï¼Œä¸€æ—¦è®¾ç½®çš„Cookieè¿‡å¤šï¼Œå°†ä¼šå¯¼è‡´æŠ¥å¤´è¾ƒå¤§ã€‚å¤§å¤šæ•°çš„Cookieå¹¶ä¸éœ€è¦æ¯æ¬¡éƒ½ç”¨ä¸Šï¼Œå› ä¸ºè¿™ä¼šé€ æˆå¸¦å®½çš„éƒ¨åˆ†æµªè´¹ã€‚åœ¨YSlowçš„æ€§èƒ½ä¼˜åŒ–æœ‰è§„åˆ™ä¸­æœ‰è¿™ä¹ˆä¸€æ¡ï¼š å‡å°Cookieçš„å¤§å°ï¼šæ›´ä¸¥é‡çš„æƒ…å†µæ˜¯ï¼Œå¦‚æœåœ¨åŸŸåçš„æ ¹èŠ‚ç‚¹è®¾ç½®Cookieï¼Œå‡ ä¹æ‰€æœ‰å­è·¯å¾„ä¸‹çš„è¯·æ±‚éƒ½ä¼šå¸¦ä¸Šè¿™äº›Cookieï¼Œè¿™äº›Cookieåœ¨æŸäº›æƒ…å†µä¸‹æ˜¯æœ‰ç”¨çš„ï¼Œä½†æ˜¯åœ¨æœ‰äº›æƒ…å†µä¸‹æ˜¯å®Œå…¨æ— ç”¨çš„ã€‚å…¶ä¸­ä»¥é™æ€æ–‡ä»¶æœ€ä¸ºå…¸å‹ï¼Œé™æ€æ–‡ä»¶çš„ä¸šåŠ¡å®šä½å‡ ä¹ä¸å…³å¿ƒçŠ¶æ€ï¼ŒCookieå¯¹å®ƒè€Œè¨€å‡ ä¹æ˜¯æ— ç”¨çš„ï¼Œä½†æ˜¯ä¸€æ—¦æœ‰Cookieè®¾ç½®åˆ°ç›¸åŒåŸŸä¸‹ï¼Œå®ƒçš„è¯·æ±‚ä¸­å°±ä¼šå¸¦ä¸ŠCookieã€‚å¥½åœ¨Cookieè®¾è®¡æ—¶é™å®šäº†å®ƒçš„åŸŸï¼Œåªæœ‰åŸŸåç›¸åŒæ—¶æ‰ä¼šå‘é€ã€‚æ‰€ä»¥YSlowä¸­æœ‰å¦å¤–ä¸€æ¡è§„åˆ™ç”¨æ¥é¿å…Cookieå¸¦æ¥çš„æ€§èƒ½å½±å“ã€‚ ä¸ºé™æ€ç»„ä»¶ä½¿ç”¨ä¸åŒçš„åŸŸåï¼šç®€è€Œè¨€ä¹‹å°±æ˜¯ï¼Œä¸ºä¸éœ€è¦Cookieçš„ç»„ä»¶æ¢ä¸ªåŸŸåå¯ä»¥å®ç°å‡å°‘æ— æ•ˆCookieçš„ä¼ è¾“ã€‚æ‰€ä»¥å¾ˆå¤šç½‘ç«™çš„é™æ€æ–‡ä»¶ä¼šæœ‰ç‰¹åˆ«çš„åŸŸåï¼Œä½¿å¾—ä¸šåŠ¡ç›¸å…³çš„Cookieä¸å†å½±å“é™æ€èµ„æºã€‚å½“ç„¶æ¢ç”¨é¢å¤–çš„åŸŸåå¸¦æ¥çš„å¥½å¤„ä¸åªè¿™ç‚¹ï¼Œè¿˜å¯ä»¥çªç ´æµè§ˆå™¨ä¸‹è½½çº¿ç¨‹æ•°é‡çš„é™åˆ¶ï¼Œå› ä¸ºåŸŸåä¸åŒï¼Œå¯ä»¥å°†ä¸‹è½½çº¿ç¨‹æ•°ç¿»å€ã€‚ä½†æ˜¯æ¢ç”¨é¢å¤–åŸŸåè¿˜æ˜¯æœ‰ä¸€å®šçš„ç¡®å®šçš„ï¼Œé‚£å°±æ˜¯å°†åŸŸåè½¬æ¢ä¸ºIPéœ€è¦è¿›è¡ŒDNSæŸ¥è¯¢ï¼Œå¤šä¸€ä¸ªåŸŸåå°±å¤šä¸€æ¬¡DNSæŸ¥è¯¢ã€‚YSlowä¸­æœ‰è¿™æ ·ä¸€æ¡è§„åˆ™ï¼š å‡å°‘DNSæŸ¥è¯¢ï¼šçœ‹èµ·æ¥å‡å°‘DNSæŸ¥è¯¢å’Œä½¿ç”¨ä¸åŒçš„åŸŸåæ˜¯å†²çªçš„ä¸¤æ¡è§„åˆ™ï¼Œä½†æ˜¯å¥½åœ¨ç°ä»Šçš„æµè§ˆå™¨éƒ½ä¼šè¿›è¡ŒDNSç¼“å­˜ï¼Œä»¥å‰Šå¼±è¿™ä¸ªå‰¯ä½œç”¨çš„å½±å“ Session å¦‚ä½•å°†æ¯ä¸ªå®¢æˆ·å’ŒæœåŠ¡å™¨ä¸­çš„æ•°æ®ä¸€ä¸€å¯¹åº”èµ·æ¥ï¼Ÿ ç¬¬ä¸€ç§ï¼šåŸºäºCookieæ¥å®ç°ç”¨æˆ·å’Œæ•°æ®çš„æ˜ å°„ è™½ç„¶å°†æ‰€æœ‰æ•°æ®éƒ½æ”¾åœ¨Cookieä¸­ä¸å¯å–ï¼Œä½†æ˜¯å°†å£ä»¤æ”¾åœ¨Cookieä¸­è¿˜æ˜¯å¯ä»¥çš„ã€‚å› ä¸ºå£ä»¤ä¸€æ—¦è¢«ç¯¡æ”¹ï¼Œå°±ä¸¢å¤±äº†æ˜ å°„å…³ç³»ï¼Œä¹Ÿæ— æ³•ä¿®æ”¹æœåŠ¡å™¨ç«¯å­˜åœ¨çš„æ•°æ®äº†ã€‚å¹¶ä¸”Sessionçš„æœ‰æ•ˆæœŸé€šå¸¸è¾ƒçŸ­ï¼Œæ™®éçš„è®¾ç½®æ˜¯20åˆ†é’Ÿï¼Œå¦‚æœåœ¨20åˆ†é’Ÿå†…å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯æ²¡æœ‰äº¤äº’äº§ç”Ÿï¼ŒæœåŠ¡å™¨ç«¯å°±å°†æ•°æ®åˆ é™¤ã€‚ç”±äºæ•°æ®è¿‡æœŸæ—¶é—´è¾ƒçŸ­ï¼Œä¸”åœ¨æœåŠ¡å™¨ç«¯å­˜å‚¨æ•°æ®ï¼Œå› æ­¤å®‰å…¨æ€§ç›¸å¯¹è¾ƒé«˜ã€‚é‚£ä¹ˆå£ä»¤æ˜¯å¦‚ä½•å‚æ•°çš„å‘¢ï¼Ÿ ä¸€æ—¦æœåŠ¡å™¨ç«¯å¯ç”¨äº†Sessionï¼Œå®ƒå°†çº¦å®šä¸€ä¸ªé”®å€¼ä½œä¸ºSessionçš„å£ä»¤ï¼Œè¿™ä¸ªå€¼å¯ä»¥éšæ„çº¦å®šï¼Œæ¯”å¦‚Connecté»˜è®¤é‡‡ç”¨connect_uidï¼ŒTomactä¼šé‡‡ç”¨jsessionidç­‰ã€‚ä¸€æ—¦æœåŠ¡å™¨æ£€æŸ¥åˆ°ç”¨æˆ·è¯·æ±‚Cookieä¸­æ²¡æœ‰æºå¸¦è¯¥å€¼ï¼Œå®ƒå°±ä¼šä¸ºä¹‹ç”Ÿæˆä¸€ä¸ªå€¼ï¼Œè¿™ä¸ªå€¼æ—¶å”¯ä¸€ä¸”ä¸é‡å¤çš„å€¼ï¼Œå¹¶è®¾å®šè¶…æ—¶æ—¶é—´ ç¬¬äºŒç§ï¼šé€šè¿‡æŸ¥è¯¢å­—ç¬¦ä¸²æ¥å®ç°æµè§ˆå™¨ç«¯å’ŒæœåŠ¡å™¨ç«¯æ•°æ®çš„å¯¹åº” å®ƒçš„åŸç†æ˜¯æ£€æŸ¥è¯·æ±‚çš„æŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œå¦‚æœæ²¡æœ‰å€¼ï¼Œä¼šå…ˆç”Ÿæˆæ–°çš„å¸¦å€¼å¾—URLï¼Œç„¶åå½¢æˆè·³è½¬ï¼Œè®©å®¢æˆ·ç«¯é‡æ–°å‘èµ·è¯·æ±‚ï¼Œ æœ‰çš„æœåŠ¡å™¨åœ¨å®¢æˆ·ç«¯ç¦ç”¨Cookieæ—¶ï¼Œä¼šé‡‡ç”¨è¿™ç§æ–¹æ¡ˆå®ç°é€€åŒ–ã€‚é€šè¿‡è¿™ç§æ–¹æ¡ˆï¼Œæ— é¡»å†å“åº”æ—¶è®¾ç½®Cookieã€‚ä½†æ˜¯è¿™ç§æ–¹æ¡ˆå¸¦æ¥çš„é£é™©æºå¤§äºåŸºäºCookieå®ç°çš„é£é™©ï¼Œå› ä¸ºåªè¦å°†åœ°å€æ ä¸­çš„åœ°å€å‘ç»™å¦å¤–ä¸€ä¸ªäººï¼Œé‚£ä¹ˆä»–å°±æ‹¥æœ‰è·Ÿä½ ç›¸åŒçš„èº«ä»½ã€‚Cookieçš„æ–¹æ¡ˆåœ¨æ¢äº†æµè§ˆå™¨æˆ–è€…æ¢äº†ç”µè„‘ä¹‹åæ— æ³•ç”Ÿæ•ˆï¼Œç›¸å¯¹è¾ƒä¸ºå®‰å…¨ã€‚ è¿˜æœ‰ä¸€ç§æ¯”è¾ƒæœ‰è¶£çš„å¤„ç†Sessionçš„æ–¹å¼æ˜¯åˆ©ç”¨HTTPè¯·æ±‚å¤´ä¸­çš„ETagï¼ŒåŒæ ·å¯¹äºæ›´æ¢æµè§ˆå™¨å’Œç”µè„‘åä¹Ÿæ˜¯æ— æ•ˆçš„ã€‚ Sessionä¸å†…å­˜ Sessionæ•°æ®ç›´æ¥å­˜äºå†…å­˜ä¸­ä¼šå¸¦æ¥æå¤§çš„éšæ‚£ï¼Œå¦‚æœç”¨æˆ·å¢å¤šï¼Œæˆ‘ä»¬å¾ˆå¯èƒ½å°±æ¥è§¦åˆ°äº†å†…å­˜é™åˆ¶çš„ä¸Šé™ï¼Œå¹¶ä¸”å†…å­˜ä¸­çš„æ•°æ®é‡åŠ å¤§ï¼Œå¿…ç„¶ä¼šå¼•èµ·åƒåœ¾å›æ”¶çš„é¢‘ç¹æ‰«æï¼Œå¼•èµ·æ€§èƒ½é—®é¢˜ã€‚ å¦ä¸€ä¸ªé—®é¢˜åˆ™æ˜¯æˆ‘ä»¬å¯èƒ½ä¸ºäº†åˆ©ç”¨å¤šæ ¸CPUè€Œå¯åŠ¨äº†å¤šä¸ªè¿›ç¨‹ã€‚ç”¨æˆ·è¯·æ±‚çš„è¿æ¥å°†å¯èƒ½éšæ„åˆ†é…åˆ°å„ä¸ªè¿›ç¨‹ä¸­ï¼ŒNodeçš„è¿›ç¨‹ä¸è¿›ç¨‹ä¹‹é—´æ˜¯ä¸èƒ½ç›´æ¥å…±äº«å†…å­˜çš„ï¼Œç”¨æˆ·çš„Sessionå¯èƒ½ä¼šå¼•èµ·é”™ä¹±ã€‚ ä¸ºäº†è§£å†³æ€§èƒ½é—®é¢˜å’ŒSessionæ•°æ®æ— æ³•è·¨è¿›ç¨‹å…±äº«çš„é—®é¢˜ï¼Œå¸¸ç”¨çš„æ–¹æ¡ˆæ˜¯å°†Sessioné›†ä¸­åŒ–ï¼Œå°†åŸæœ¬å¯èƒ½åˆ†æ•£åœ¨å¤šä¸ªè¿›ç¨‹é‡Œçš„æ•°æ®ï¼Œç»Ÿä¸€è½¬ç§»åˆ°é›†ä¸­çš„æ•°æ®å­˜å‚¨ä¸­ã€‚ç›®å‰å¸¸ç”¨çš„å·¥å…·æ˜¯Redisã€Memcachedç­‰ï¼Œé€šè¿‡è¿™äº›é«˜æ•ˆçš„ç¼“å­˜ï¼ŒNodeè¿›ç¨‹æ— é¡»åœ¨å†…éƒ¨ç»´æŠ¤æ•°æ®å¯¹è±¡ï¼Œåƒåœ¾å›æ”¶é—®é¢˜å’Œå†…å­˜é™åˆ¶é—®é¢˜éƒ½å¯ä»¥è¿åˆƒè€Œè§£ã€‚ é‡‡ç”¨ç¬¬ä¸‰æ–¹ç¼“å­˜æ¥å­˜å‚¨Sessionå¼•èµ·çš„ä¸€ä¸ªé—®é¢˜æ˜¯ä¼šå¼•èµ·ç½‘ç»œè®¿é—®ã€‚ç†è®ºä¸Šæ¥è¯´è®¿é—®ç½‘ç»œä¸­çš„æ•°æ®è¦æ¯”è®¿é—®æœ¬åœ°ç£ç›˜ä¸­çš„æ•°æ®é€Ÿåº¦è¿˜è¦æ…¢ï¼Œå› ä¸ºæ¶‰åŠåˆ°æ¡æ‰‹ã€ä¼ è¾“ä»¥åŠç½‘ç»œç»ˆç«¯è‡ªèº«çš„ç£ç›˜I/Oç­‰ï¼Œå°½ç®¡å¦‚æ­¤ä½†ä¾ç„¶ä¼šé‡‡ç”¨è¿™äº›é«˜é€Ÿç¼“å­˜çš„ç†ç”±æœ‰ä»¥ä¸‹å‡ æ¡ï¼š Nodeä¸ç¼“å­˜æœåŠ¡ä¿æŒé•¿è¿æ¥ï¼Œè€Œéé¢‘ç¹çš„çŸ­è¿æ¥ï¼Œæ¡æ‰‹å¯¼è‡´çš„å»¶è¿Ÿåªå½±å“åˆå§‹åŒ– é«˜é€Ÿç¼“å­˜ç›´æ¥åœ¨å†…å­˜ä¸­è¿›è¡Œæ•°æ®å­˜å‚¨å’Œè®¿é—® ç¼“å­˜æœåŠ¡é€šå¸¸ä¸Nodeè¿›ç¨‹è¿è¡Œåœ¨ç›¸åŒçš„æœºå™¨ä¸Šæˆ–è€…ç›¸åŒçš„æœºæˆ¿é‡Œï¼Œç½‘ç»œé€Ÿåº¦å½±å“è¾ƒå° Sessionä¸å®‰å…¨ ä»å‰æ–‡å¯ä»¥çŸ¥é“ï¼Œå°½ç®¡æˆ‘ä»¬çš„æ•°æ®éƒ½æ”¾ç½®åœ¨åç«¯äº†ï¼Œä½¿å¾—å®ƒèƒ½ä¿éšœå®‰å…¨ï¼Œä½†æ˜¯æ— è®ºé€šè¿‡Cookieï¼Œè¿˜æ˜¯æŸ¥è¯¢å­—ç¬¦ä¸²çš„å®ç°æ–¹å¼ï¼ŒSessionçš„å£ä»¤ä¾ç„¶ä¿å­˜åœ¨å®¢æˆ·ç«¯ï¼Œè¿™é‡Œä¼šå­˜åœ¨å£ä»¤è¢«ç›—ç”¨çš„æƒ…å†µã€‚å¦‚æœWebåº”ç”¨çš„ç”¨æˆ·ååˆ†å¤šï¼Œè‡ªè¡Œè®¾è®¡çš„éšæœºç®—æ³•çš„ä¸€äº›å£ä»¤å€¼å°±æœ‰ç†è®ºæœºä¼šå‘½ä¸­æœ‰æ•ˆçš„å£ä»¤å€¼ã€‚ä¸€æ—¦å£ä»¤è¢«ä¼ªé€ ï¼ŒæœåŠ¡å™¨ç«¯çš„æ•°æ®ä¹Ÿå¯èƒ½é—´æ¥è¢«åˆ©ç”¨ã€‚ æœ‰ä¸€ç§åšæ³•æ˜¯å°†è¿™ä¸ªå£ä»¤é€šè¿‡ç§é’¥åŠ å¯†è¿›è¡Œç­¾åï¼Œä½¿å¾—ä¼ªé€ çš„æˆæœ¬è¾ƒé«˜ã€‚å®¢æˆ·ç«¯å°½ç®¡å¯ä»¥ä¼ªé€ å£ä»¤å€¼ï¼Œä½†æ˜¯ç”±äºä¸çŸ¥é“ç§é’¥å€¼ï¼Œç­¾åä¿¡æ¯å¾ˆéš¾ä¼ªé€ ã€‚å¦‚æ­¤ï¼Œæˆ‘ä»¬åªè¦åœ¨å“åº”æ—¶å°†å£ä»¤å’Œç­¾åè¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœç­¾åéæ³•ï¼Œæˆ‘ä»¬å°†æœåŠ¡å™¨ç«¯çš„æ•°æ®ç«‹å³è¿‡æœŸå³å¯ã€‚ è¿™æ ·ä¸€æ¥ï¼Œå³ä½¿æ”»å‡»è€…çŸ¥é“å£ä»¤ä¸­.å·å‰çš„å€¼æ—¶æœåŠ¡å™¨ç«¯Sessionçš„IDå€¼ï¼Œåªè¦ä¸çŸ¥é“secretç§é’¥çš„å€¼ï¼Œå°±æ— æ³•ä¼ªé€ ç­¾åä¿¡æ¯ï¼Œä»¥æ­¤å®ç°å¯¹Sessionçš„ä¿æŠ¤ã€‚ å½“ç„¶ï¼Œå°†å£ä»¤è¿›è¡Œç­¾åæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯å¦‚æœæ”»å‡»è€…é€šè¿‡æŸç§æ–¹å¼è·å–äº†ä¸€ä¸ªçœŸå®çš„å£ä»¤å’Œç­¾åï¼Œä»–å°±èƒ½å®ç°èº«ä»½çš„ä¼ªè£…ã€‚ä¸€ç§æ–¹æ¡ˆæ˜¯å°†å®¢æˆ·ç«¯çš„æŸäº›ç‹¬æœ‰ä¿¡æ¯å’Œå£ä»¤ä½œä¸ºåŸå€¼ï¼Œç„¶åç­¾åï¼Œè¿™æ ·æ”»å‡»è€…ä¸€æ—¦ä¸åœ¨åŸå§‹çš„å®¢æˆ·ç«¯ä¸Šè¿›è¡Œè®¿é—®ï¼Œå°±ä¼šå¯¼è‡´ç­¾åå¤±è´¥ã€‚è¿™äº›ç‹¬æœ‰ä¿¡æ¯åŒ…æ‹¬ç”¨æˆ·IPå’Œç”¨æˆ·ä»£ç†ï¼ˆUser Agentï¼‰ã€‚ ç¼“å­˜ YSlowä¸­æåˆ°äº†å‡ æ¡å…³äºç¼“å­˜çš„è§„åˆ™ æ·»åŠ Expiresæˆ–Cache-Controlåˆ°æŠ¥æ–‡å¤´ä¸­ é…ç½®ETags è®©Ajaxå¯ç¼“å­˜é€šå¸¸æ¥è¯´ï¼ŒPOSTã€DELETEã€PUTè¿™ç±»å¾…è¡Œä¸ºæ€§çš„è¯·æ±‚æ“ä½œä¸€èˆ¬ä¸åšä»»ä½•ç¼“å­˜ï¼Œå¤§å¤šæ•°ç¼“å­˜åªåº”ç”¨åœ¨GETè¯·æ±‚ä¸­ Basicè®¤è¯ï¼šBasicè®¤è¯æ˜¯å½“å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ç«¯è¿›è¡Œè¯·æ±‚æ—¶ï¼Œå…è®¸é€šè¿‡ç”¨æˆ·åå’Œå¯†ç å®ç°çš„ä¸€ç§èº«ä»½è®¤è¯æ–¹å¼ã€‚å¦‚æœä¸€ä¸ªé¡µé¢éœ€è¦Basicè®¤è¯ï¼Œå®ƒä¼šæ£€æŸ¥è¯·æ±‚æŠ¥æ–‡å¤´ä¸­çš„Authorizationå­—æ®µçš„å†…å®¹ï¼Œè¯¥å­—æ®µçš„å€¼ç”±è®¤è¯æ–¹å¼å’ŒåŠ å¯†å€¼æ„æˆã€‚åœ¨Basicè®¤è¯ä¸­ï¼Œå®ƒä¼šå°†ç”¨æˆ·å’Œå¯†ç éƒ¨åˆ†ç»„åˆï¼Œç„¶åè¿›è¡ŒBase64ç¼–ç ï¼Œå¦‚æœç”¨æˆ·é¦–æ¬¡è®¿é—®è¯¥ç½‘é¡µï¼ŒURLåœ°å€ä¸­é¡µæ²¡æºå¸¦è®¤è¯å†…å®¹ï¼Œé‚£ä¹ˆæµè§ˆå™¨ä¼šå“åº”ä¸€ä¸ª401æœªæˆæƒçš„çŠ¶æ€ç ã€‚å“åº”å¤´ä¸­çš„WWW-Authenticateå­—æ®µå‘ŠçŸ¥æµè§ˆå™¨é‡‡ç”¨ä»€ä¹ˆæ ·çš„è®¤è¯å’ŒåŠ å¯†æ–¹å¼ã€‚å½“è®¤è¯é€šè¿‡ï¼ŒæœåŠ¡å™¨ç«¯å“åº”200çŠ¶æ€ç ä¹‹åï¼Œæµè§ˆå™¨ä¼šä¿å­˜ç”¨æˆ·åå’Œå¯†ç å£ä»¤ï¼Œåœ¨åç»­çš„è¯·æ±‚ä¸­éƒ½æºå¸¦å¼Authorizationä¿¡æ¯ã€‚ Basicè®¤è¯æœ‰å¤ªå¤šçš„ç¼ºç‚¹ï¼Œå®ƒè™½ç„¶ç»è¿‡Base64åŠ å¯†ååœ¨ç½‘ç»œä¸­ä¼ é€ï¼Œä½†æ˜¯è¿™è¿‘ä¹äºæ˜æ–‡ï¼Œååˆ†å±é™©ï¼Œä¸€èˆ¬åªæœ‰åœ¨HTTPSçš„æƒ…å†µä¸‹æ‰ä¼šä½¿ç”¨ã€‚ä¸è¿‡Basicè®¤è¯çš„æ”¯æŒèŒƒå›´ååˆ†å¹¿æ³›ï¼Œå‡ ä¹æ‰€æœ‰çš„æµè§ˆå™¨éƒ½æ”¯æŒå®ƒã€‚ ä¸ºäº†æ”¹è¿›Basicè®¤è¯ï¼ŒRFC 2069è§„èŒƒæå‡ºäº†æ‘˜è¦è®¿é—®è®¤è¯ï¼Œå®ƒåŠ å…¥äº†æœåŠ¡å™¨ç«¯éšæœºæ•°æ¥ä¿æŠ¤è®¤è¯è¿‡ç¨‹ æ•°æ®ä¸Šä¼  é€šè¿‡æŠ¥å¤´çš„Transfer-Encodingæˆ–Content-Lengthå³å¯åˆ¤æ–­è¯·æ±‚ä¸­æ˜¯å¦å¸¦æœ‰å†…å®¹ 123function hasBody (req) &#123; return 'transfer-encoding' in req.headers || 'content-length' in req.headers&#125; è¡¨å•æ•°æ® 12345&lt;form action=\"/upload\" method=\"post\"&gt; &lt;label for=\"username\"&gt;Username:&lt;/label&gt; &lt;input type=\"text\" name=\"username\" id=\"username\" /&gt; &lt;br /&gt; &lt;input type=\"submit\" name=\"submit\" value=\"Submit\" /&gt;&lt;/form&gt; Content-Type: application/x-www-form-urlencode æŠ¥æ–‡ä½“å†…å®¹è·ŸæŸ¥è¯¢å­—ç¬¦ä¸²ç›¸åŒï¼šfoo=bar&amp;baz=val 123456var handle = function (req, res) &#123; if (req.headers['content-type'] === 'application/x-www-form-urlencoded') &#123; req.body = querystring.parse(req.rawBody) &#125; todo(req, res)&#125; JSON Content-Type: application/json; charset=utf-8 1234567891011121314151617var mime = function (req) &#123; var str = req.headers['content-type'] || '' return str.split(';')[0]&#125;var handle = function (req, res) &#123; if (mime(req) === 'application/json') &#123; try &#123; req.body = JSON.parse(req.rawBody) &#125; catch (e) &#123; res.writeHead(400) res.end('Invaild JSON') return &#125; &#125; todo(req, res)&#125; XML Content-Type: application/xml; charset=utf-8 123456789101112131415var xml2js = require('xml2js')var handle = function (req, res) &#123; if (mime(req) === 'application/xml') &#123; xml2js.parseString(req.rawBody, function (err, xml) &#123; if (err) &#123; res.writeHead(400) res.end('Invaild XML') return &#125; req.body = xml todo(req, res) &#125;) &#125;&#125; é™„ä»¶ä¸Šä¼  12345&lt;form action=\"/upload\" method=\"post\" enctype=\"multipart/form-data\"&gt; &lt;label for=\"username\"&gt;Username:&lt;/label&gt; &lt;input type=\"text\" name=\"username\" id=\"username\" /&gt; &lt;label for=\"file\"&gt;Filename:&lt;/label&gt; &lt;input type=\"file\" name=\"file\" id=\"file\"/&gt; &lt;input type=\"submit\" name=\"submit\" value=\"Submit\" /&gt;&lt;/form&gt; æµè§ˆå™¨åœ¨é‡åˆ°multipart/form-dataè¡¨å•æäº¤æ—¶ï¼Œæ„é€ çš„è¯·æ±‚æŠ¥æ–‡ä¸æ™®é€šè¡¨å•å®Œå…¨ä¸åŒã€‚é¦–å…ˆå®ƒçš„æŠ¥å¤´ä¸­æœ€ä¸ºç‰¹æ®Šçš„å¦‚ä¸‹æ‰€ç¤ºï¼š 12Content-Type: multipart/form-data; boundary=AaB03xContent-Legnth: 18231 å®ƒä»£è¡¨æœ¬æ¬¡æäº¤çš„å†…å®¹æ˜¯ç”±å¤šéƒ¨åˆ†æ„æˆçš„ï¼Œå…¶ä¸­çš„boundary=AaB03xæŒ‡å®šçš„æ˜¯æ¯éƒ¨åˆ†å†…å®¹çš„åˆ†ç•Œç¬¦ï¼ŒAaB03xæ˜¯éšæœºç”Ÿæˆçš„ä¸€æ®µå­—ç¬¦ä¸²ï¼ŒæŠ¥æ–‡ä½“çš„å†…å®¹å°†é€šè¿‡åœ¨å®ƒå‰é¢æ·»åŠ â€“è¿›è¡Œåˆ†ç§‘ï¼ŒæŠ¥æ–‡ç»“æŸæ—¶åœ¨å®ƒå‰åéƒ½åŠ ä¸Šâ€“è¡¨ç¤ºç»“æŸã€‚å¦å¤–ï¼ŒContent-Lengthçš„å€¼å¿…é¡»ç¡®ä¿æ˜¯æŠ¥æ–‡ä½“çš„é•¿åº¦ã€‚ ä¸€æ—¦æˆ‘ä»¬çŸ¥æ™“æŠ¥æ–‡æ˜¯å¦‚ä½•æ„æˆçš„ï¼Œé‚£ä¹ˆè§£æå®ƒå°±å˜å¾—ååˆ†å®¹æ˜“ã€‚å€¼å¾—æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œç”±äºæ˜¯æ–‡ä»¶ä¸Šä¼ ï¼Œé‚£ä¹ˆåƒæ™®é€šè¡¨å•ã€JSONæˆ–XMLé‚£æ ·å…ˆæ¥å—å†…å®¹å†è§£æçš„æ–¹å¼å°†å˜å¾—ä¸å¯æ¥å—ã€‚æ¥æ”¶æœªçŸ¥çš„æ•°æ®é‡æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ååˆ†è°¨æ…ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 1234567891011121314151617function (req, res) &#123; if (hasBody(req)) &#123; var done = function () &#123; handle(req, res) &#125; if (mime(req) === 'application/json') &#123; parseJSON(req, done) &#125; else if (mime(req) === 'application/xml') &#123; parseXML(req, done) &#125; else if (mime(req) === 'multipart/form-data') &#123; parseMultipart(req, done) &#125; &#125; else &#123; handle(req, res) &#125;&#125; è¿™é‡Œæˆ‘ä»¬å°†reqè¿™ä¸ªæµå¯¹è±¡ç›´æ¥äº¤ç»™å¯¹åº”çš„è§£ææ–¹æ³•ï¼Œç”±è§£ææ–¹æ³•è‡ªè¡Œå¤„ç†ä¸Šä¼ çš„å†…å®¹ï¼Œæˆ–æ¥æ”¶å†…å®¹å¹¶ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œæˆ–æµå¼å¤„ç†æ‰ã€‚ è¿™é‡Œè¦ä»‹ç»çš„æ¨¡å—æ˜¯formidableã€‚å®ƒåŸºäºæµå¼å¤„ç†è§£ææŠ¥æ–‡ï¼Œå°†æ¥æ”¶åˆ°çš„æ–‡ä»¶å†™å…¥åˆ°ç³»ç»Ÿçš„ä¸´æ—¶æ–‡ä»¶å¤¹ä¸­ï¼Œå¹¶è¿”å›å¯¹åº”çš„è·¯å¾„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 1234567891011121314151617var formidable = require('formidable')function parseMultipart (req, res) &#123; if (hasBody(req)) &#123; if (mime(req) === 'multipart/form-data') &#123; var form = new formidable.IncomingForm() form.parse(req, function (err, fields, files) &#123; req.body = fields req.files = files handle(req, res) &#125;) &#125; else &#123; handle(req, res) &#125; &#125;&#125; æ•°æ®ä¸Šä¼ ä¸å®‰å…¨ å†…å­˜é™åˆ¶ åœ¨è§£æè¡¨å•ã€JSONå’ŒXMLéƒ¨åˆ†ï¼Œæˆ‘ä»¬é‡‡å–çš„ç­–ç•¥æ˜¯å…ˆä¿å­˜ç”¨æˆ·æäº¤çš„æ‰€æœ‰æ•°æ®ï¼Œç„¶åå†è§£æå¤„ç†ï¼Œæœ€åæ‰ä¼ é€’ç»™ä¸šåŠ¡é€»è¾‘ã€‚è¿™ç§ç­–ç•¥å­˜åœ¨æ½œåœ¨çš„é—®é¢˜æ˜¯ï¼Œå®ƒä»…ä»…é€‚åˆæ•°æ®é‡å°çš„æäº¤è¯·æ±‚ï¼Œä¸€æ—¦æ•°æ®é‡è¿‡å¤§ï¼Œå°†å‘ç”Ÿå†…å­˜è¢«å å…‰çš„æƒ…å†µã€‚æ”»å‡»è€…é€šè¿‡å®¢æˆ·ç«¯èƒ½å¤Ÿååˆ†å®¹æ˜“åœ°æ¨¡æ‹Ÿä¼ªé€ å¤§é‡æ•°æ®ï¼Œå¦‚æœæ”»å‡»è€…æ¯æ¬¡æäº¤1MBçš„å†…å®¹ï¼Œé‚£ä¹ˆåªè¦å¹¶å‘è¯·æ±‚æ•°é‡ä¸€å¤§ï¼Œå†…å­˜å°±ä¼šå¾ˆå¿«åœ°è¢«åƒå…‰ã€‚ è¦è§£å†³è¿™ä¸ªé—®é¢˜ä¸»è¦æœ‰ä¸¤ä¸ªæ–¹æ¡ˆï¼š é™åˆ¶ä¸Šä¼ å†…å®¹çš„å¤§å°ï¼Œä¸€æ—¦è¶…è¿‡é™åˆ¶ï¼Œåœæ­¢æ¥æ”¶æ•°æ®ï¼Œå¹¶å“åº”400çŠ¶æ€ç  é€šè¿‡æµå¼è§£æï¼Œå°†æ•°æ®æµå¯¼å‘åˆ°ç£ç›˜ä¸­ï¼ŒNodeåªä¿ç•™æ–‡ä»¶è·¯å¾„ç­‰å°æ•°æ®æµå¼å¤„ç†åœ¨ä¸Šæ–‡çš„æ–‡ä»¶ä¸Šä¼ ä¸­å·²ç»æœ‰æ‰€ä½“ç°ï¼Œè¿™é‡Œä»‹ç»ä¸€ä¸‹Connectä¸­é‡‡ç”¨çš„ä¸Šä¼ æ•°æ®é‡çš„é™åˆ¶æ–¹å¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 12345678910111213141516171819202122232425var bytes = 1024function (req, res) &#123; var received = 0 var len = req.headers['content-length'] ? parseInt(req.headers['content-length'], 10) : null // å¦‚æœå†…å®¹è¶…è¿‡é•¿åº¦é™åˆ¶ï¼Œè¿”å›è¯·æ±‚å®ä½“è¿‡é•¿çš„çŠ¶æ€ç  if (len &amp;&amp; len &gt; bytes) &#123; res.writeHead(413) res.end() return &#125; // limit req.on('data', function (chunk) &#123; received += chunk.length if (received &gt; bytes) &#123; // åœæ­¢æ¥æ”¶æ•°æ®ï¼Œè§¦å‘end() req.destroy() &#125; &#125;) handle(req, res)&#125; CSRF CSRFçš„å…¨ç§°æ˜¯Cross-Site Request Forgeryï¼Œä¸­æ–‡æ„æ€æ˜¯è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼Œæ”»å‡»è€…å¼•è¯±æŸä¸ªdomain_açš„ç™»å½•ç”¨æˆ·è®¿domain_bçš„ç½‘ç«™ï¼Œåœ¨domain_bçš„ç½‘ç«™ä¸­è¯·æ±‚domain_açš„èµ„æºä¼šæŠŠdomain_açš„Cookieå‘é€åˆ°æœåŠ¡å™¨ï¼Œå°½ç®¡è¿™ä¸ªè¯·æ±‚æ—¶æ¥è‡ªdomain_bçš„ï¼Œä½†æ˜¯æœåŠ¡å™¨å¹¶ä¸çŸ¥æƒ…ï¼Œç”¨æˆ·ä¹Ÿä¸çŸ¥æƒ…ã€‚ è·¯ç”±è§£æ æ–‡ä»¶è·¯å¾„å‹ é™æ€æ–‡ä»¶ï¼šURLçš„è·¯å¾„ä¸ç½‘ç«™ç›®å½•çš„è·¯å¾„ä¸€è‡´ï¼Œæ— é¡»è½¬æ¢ã€‚å¤„ç†è¿‡ç¨‹å°†è¯·æ±‚è·¯å¾„å¯¹åº”çš„æ–‡ä»¶å‘é€ç»™å®¢æˆ·ç«¯å³å¯ã€‚ åŠ¨æ€æ–‡ä»¶ï¼šWebæœåŠ¡å™¨æ ¹æ®URLè·¯å¾„æ‰¾åˆ°å¯¹åº”çš„æ–‡ä»¶ï¼Œå¦‚/index.aspæˆ–/index.phpã€‚WebæœåŠ¡å™¨æ ¹æ®æ–‡ä»¶ååç¼€å»å¯»æ‰¾è„šæœ¬çš„è§£æå™¨ï¼Œå¹¶ä¼ å…¥HTTPè¯·æ±‚çš„ä¸Šä¸‹æ–‡ã€‚è§£æå™¨æ‰§è¡Œè„šæœ¬ï¼Œå¹¶è¾“å‡ºå“åº”æŠ¥æ–‡ï¼Œè¾¾åˆ°å®ŒæˆæœåŠ¡çš„ç›®çš„ã€‚ç°ä»Šå¤§å¤šæ•°çš„æœåŠ¡å™¨éƒ½å¾ˆæ™ºèƒ½åœ°æ ¹æ®åç¼€åŒæ—¶æœåŠ¡åŠ¨æ€å’Œé™æ€æ–‡ä»¶ã€‚è¿™ç§æ–¹å¼åœ¨Nodeä¸­ä¸å¤ªå¸¸è§ï¼Œä¸»è¦åŸå› æ˜¯æ–‡ä»¶çš„åç¼€éƒ½æ˜¯.jsï¼Œåˆ†ä¸æ¸…æ˜¯åç«¯è„šæœ¬ï¼Œè¿˜æ˜¯å‰ç«¯è„šæœ¬ï¼Œè¿™å¯ä¸æ˜¯ä»€ä¹ˆå¥½çš„è®¾è®¡ã€‚è€Œä¸”Nodeä¸­WebæœåŠ¡å™¨ä¸åº”ç”¨ä¸šåŠ¡è„šæœ¬æ˜¯ä¸€ä½“çš„ï¼Œæ— é¡»æŒ‰è¿™ç§æ–¹å¼å®ç°ã€‚ MVC MVCæ¨¡å‹çš„ä¸»è¦æ€æƒ³æ˜¯å°†ä¸šåŠ¡é€»è¾‘æŒ‰èŒè´£åˆ†ç¦»ï¼Œä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ç§ï¼š æ§åˆ¶å™¨ï¼ˆController)ï¼Œä¸€ç»„è¡Œä¸ºçš„é›†åˆ æ¨¡å‹ï¼ˆModelï¼‰ï¼Œæ•°æ®ç›¸å…³çš„æ“ä½œå’Œå°è£… è§†å›¾ï¼ˆView)ï¼Œè§†å›¾çš„æ¸²æŸ“è¿™æ˜¯ç›®å‰æœ€ä¸ºç»å…¸çš„åˆ†å±‚æ¨¡å¼ï¼Œå¤§è‡´è€Œè¨€ï¼Œå®ƒçš„å·¥ä½œæ¨¡å¼å¦‚ä¸‹è¯´æ˜ï¼š è·¯ç”±è§£æï¼Œæ ¹æ®URLå¯»æ‰¾åˆ°å¯¹åº”çš„æ§åˆ¶å™¨å’Œè¡Œä¸º è¡Œä¸ºè°ƒç”¨ç›¸å…³çš„æ¨¡å‹ï¼Œè¿›è¡Œæ•°æ®æ“ä½œ æ•°æ®æ“ä½œç»“æŸåï¼Œè°ƒç”¨è§†å›¾å’Œç›¸å…³æ•°æ®è¿›è¡Œé¡µé¢æ¸²æŸ“ï¼Œè¾“å‡ºåˆ°å®¢æˆ·ç«¯è·¯ç”±æ˜ å°„æ–¹æ³•ï¼š æ‰‹å·¥æ˜ å°„ ä¼˜ç‚¹ï¼šæ‰‹å·¥æ˜ å°„é™¤äº†éœ€è¦æ‰‹å·¥é…ç½®è·¯ç”±è¾ƒä¸ºåŸå§‹å¤–ï¼Œå®ƒå¯¹URLçš„è¦æ±‚ååˆ†çµæ´»ï¼Œå‡ ä¹æ²¡æœ‰æ ¼å¼ä¸Šçš„é™åˆ¶ ç¼ºç‚¹ï¼šå¦‚æœé¡¹ç›®è¾ƒå¤§ï¼Œè·¯ç”±æ˜ å°„çš„æ•°é‡ä¹Ÿä¼šå¾ˆå¤šã€‚ä»å‰ç«¯è·¯å¾„åˆ°å…·ä½“çš„æ§åˆ¶æ–‡ä»¶ï¼Œéœ€è¦æŸ¥é˜…æ‰èƒ½å®šä½åˆ°å®é™…ä»£ç çš„ä½ç½® è‡ªç„¶æ˜ å°„ï¼š ä¼˜ç‚¹ï¼šè·¯ç”±æŒ‰ç…§ä¸€ç§çº¦å®šçš„æ–¹å¼è‡ªç„¶è€Œç„¶åœ°å®ç°äº†è·¯ç”±ï¼Œæ— é¡»å»ç»´æŠ¤è·¯ç”±æ˜ å°„ ç¼ºç‚¹ï¼šå¦‚æœURLå˜åŠ¨ï¼Œå®ƒçš„æ–‡ä»¶ä¹Ÿéœ€è¦å‘ç”Ÿå˜åŠ¨ RESTful RESTçš„å…¨ç§°æ˜¯Representational State Transferï¼Œä¸­æ–‡å«ä¹‰ä¸ºè¡¨ç°å±‚çŠ¶æ€è½¬åŒ–ã€‚ç¬¦åˆRESTè§„èŒƒçš„è®¾è®¡ï¼Œæˆ‘ä»¬ç§°ä¸ºRESTfulè®¾è®¡ã€‚å®ƒçš„è®¾è®¡å“²å­¦ä¸»è¦å°†æœåŠ¡å™¨ç«¯æä¾›çš„å†…å®¹å®ä½“çœ‹åšä¸€ä¸ªèµ„æºï¼Œå¹¶è¡¨ç°åœ¨URLä¸Šã€‚ æ¯”å¦‚ä¸€ä¸ªç”¨æˆ·çš„åœ°å€å¦‚ä¸‹æ‰€ç¤ºï¼š 1/users/jacksontian è¿™ä¸ªåœ°å€ä»£è¡¨äº†ä¸€ä¸ªèµ„æºï¼Œå¯¹è¿™ä¸ªèµ„æºçš„æ“ä½œï¼Œä¸»è¦ä½“ç°åœ¨HTTPè¯·æ±‚æ–¹æ³•ä¸Šï¼Œä¸æ˜¯ä½“ç°åœ¨URLä¸Šã€‚è¿‡å»æˆ‘ä»¬é˜Ÿç”¨æˆ·çš„å¢åˆ æ”¹æŸ¥æˆ–è®¸æ˜¯å¦‚ä¸‹è¿™æ ·è®¾è®¡URLçš„ï¼š 1234POST /user/add?username=jacksontianGET /user/remove?username=jacksontianPOST /user/update?username=jacksontianGET /user/get?username=jacksontian æ“ä½œè¡Œä¸ºä¸»è¦ä½“ç°åœ¨è¡Œä¸ºä¸Šï¼Œä¸»è¦ä½¿ç”¨çš„è¯·æ±‚æ–¹æ³•æ˜¯POSTå’ŒGETã€‚åœ¨RESTfulè®¾è®¡ä¸­ï¼Œå®ƒæ˜¯å¦‚ä¸‹è¿™æ ·çš„ï¼š 1234POST /user/jacksontianDELETE /user/jacksontianPUT /user/jacksontianGET /user/jacksontian å®ƒå°†DELETEå’ŒPUTè¯·æ±‚æ–¹æ³•å¼•å…¥è®¾è®¡ä¸­ï¼Œå‚ä¸èµ„æºçš„æ“ä½œå’Œæ›´æ”¹èµ„æºçš„çŠ¶æ€ åœ¨RESTfulè®¾è®¡ä¸­ï¼Œèµ„æºçš„å…·ä½“æ ¼å¼ç”±è¯·æ±‚æŠ¥å¤´ä¸­Acceptå­—æ®µå’ŒæœåŠ¡å™¨ç«¯çš„æ”¯æŒæƒ…å†µæ¥å†³å®šã€‚å¦‚æœå®¢æˆ·ç«¯åŒæ—¶æ¥å—JSONå’ŒXMLæ ¼å¼çš„å“åº”ï¼Œé‚£ä¹ˆå®ƒçš„Acceptå­—æ®µå€¼æ˜¯å¦‚ä¸‹è¿™æ ·çš„ï¼š 1Accept: application/json,application/xml åœ¨å“åº”æŠ¥æ–‡ä¸­ï¼Œé€šè¿‡Content-Typeå‘ŠçŸ¥å®¢æˆ·ç«¯æ˜¯ä»€ä¹ˆæ ¼å¼ æ‰€ä»¥RESTçš„è®¾è®¡å°±æ˜¯ï¼Œé€šè¿‡URLè®¾è®¡èµ„æºã€è¯·æ±‚æ–¹æ³•å®šä¹‰èµ„æºçš„æ“ä½œï¼Œé€šè¿‡Acceptå†³å®šèµ„æºçš„è¡¨ç°å½¢å¼ ï¼ˆä¸­é—´ä»¶çš„å…·ä½“å®ç°è¯·æŸ¥çœ‹8.4ï¼‰ä¸­é—´ä»¶ï¼šå¯¹äºWebåº”ç”¨çš„å„ç§åŸºç¡€åŠŸèƒ½ï¼Œæˆ‘ä»¬é€šè¿‡ä¸­é—´ä»¶æ¥å®Œæˆï¼Œæ¯ä¸ªä¸­é—´ä»¶å¤„ç†æ‰ç›¸å¯¹ç®€å•çš„é€»è¾‘ï¼Œæœ€ç»ˆæ±‡æˆå¼ºå¤§çš„åŸºç¡€æ¡†æ¶ å¼‚å¸¸å¤„ç† ä¸­é—´ä»¶ä¸æ€§èƒ½ ç¼–å†™é«˜æ•ˆçš„ä¸­é—´ä»¶ ä½¿ç”¨é«˜æ•ˆçš„æ–¹æ³•ã€‚å¿…è¦æ—¶é€šè¿‡jsperf.comæµ‹è¯•åŸºå‡†æ€§èƒ½ã€‚ ç¼“å­˜éœ€è¦é‡å¤è®¡ç®—çš„ç»“æœï¼ˆéœ€è¦æ§åˆ¶ç¼“å­˜ç”¨é‡ï¼‰ é¿å…ä¸å¿…è¦çš„è®¡ç®—ã€‚æ¯”å¦‚HTTPæŠ¥æ–‡ä½“çš„è§£æï¼Œå¯¹äºGETæ–¹æ³•å®Œå…¨ä¸éœ€è¦ åˆç†ä½¿ç”¨è·¯ç”± é¡µé¢æ¸²æŸ“ å†…å®¹å“åº”ï¼šå†…å®¹å“åº”çš„è¿‡ç¨‹ä¸­ï¼Œå“åº”æŠ¥å¤´ä¸­çš„Content-*å­—æ®µååˆ†é‡è¦ MIMEï¼šæµè§ˆå™¨æ­£å¼é€šè¿‡ä¸åŒçš„Content-Typeçš„å€¼æ¥å†³å®šé‡‡ç”¨ä¸åŒçš„æ¸²æŸ“æ–¹å¼ï¼Œè¿™ä¸ªå€¼æˆ‘ä»¬ç®€ç§°ä¸ºMIMEå€¼ã€‚MIMEçš„å…¨ç§°æ˜¯Multipurpose Internet Mail Extensionsã€‚ä¸åŒçš„æ–‡ä»¶ç±»å‹å…·æœ‰ä¸åŒçš„MIMEå€¼ï¼Œä¸ºäº†æ–¹ä¾¿è·çŸ¥æ–‡ä»¶çš„MIMEå€¼ï¼Œç¤¾åŒºæœ‰ä¸“æœ‰çš„mimeæ¨¡å—å¯ä»¥ç”¨æ¥åˆ¤æ–­æ–‡ä»¶ç±»å‹ã€‚ é™„ä»¶ä¸‹è½½ Content-Disposition: attachment; filename=â€filename.extâ€ï¼›å‘ŠçŸ¥å®¢æˆ·ç«¯å°†æŠ¥æ–‡æ•°æ®ä½œä¸ºå¯ä¸‹è½½çš„é™„ä»¶ Content-Disposition: inlineï¼›å‘ŠçŸ¥å®¢æˆ·ç«¯å°†æŠ¥æ–‡æ•°æ®å½“åšå³ä½¿æµè§ˆçš„å†…å®¹ å“åº”JSON 12345res.json = function (json) &#123; res.setHeader('Content-Type', 'application/json') res.writeHead(200) res.end(JSON.stringify(json))&#125; å“åº”è·³è½¬ 12345res.redirect = function (url) &#123; res.setHeader('Location', url) res.writeHead(302) res.end('Redirect to' + url)&#125; è§†å›¾æ¸²æŸ“ BigPipeï¼šå°†é¡µé¢åˆ†å‰²æˆå¤šä¸ªéƒ¨åˆ†ï¼Œå…ˆå‘ç”¨æˆ·è¾“å‡ºæ²¡æœ‰æ•°æ®çš„å¸ƒå±€ï¼ˆæ¡†æ¶ï¼‰ï¼Œå°†æ¯ä¸ªéƒ¨åˆ†é€æ­¥è¾“å‡ºåˆ°å‰ç«¯ï¼Œå†æœ€ç»ˆæ¸²æŸ“å¡«å……æ¡†æ¶ï¼Œå®Œæˆæ•´ä¸ªç½‘é¡µçš„æ¸²æŸ“ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­éœ€è¦å‰ç«¯JSçš„å‚ä¸ï¼Œå®ƒè´Ÿè´£å°†åç»­è¾“å‡ºçš„æ•°æ®æ¸²æŸ“åˆ°é¡µé¢ä¸Š ç¬¬ä¹ç«  ç©è½¬è¿›ç¨‹ Nodeå­˜åœ¨çš„é—®é¢˜ å¦‚ä½•å……åˆ†åˆ©ç”¨å¤šæ ¸CPUæœåŠ¡å™¨ï¼šå¦‚ä»ŠCPUåŸºæœ¬å‡æ˜¯å¤šæ ¸çš„ï¼ŒçœŸæ­£çš„æœåŠ¡å™¨ï¼ˆéVPSï¼‰å¾€å¾€è¿˜æœ‰å¤šä¸ªCPUã€‚è€Œå•è¿›ç¨‹å•çº¿ç¨‹çš„ç»“æ„åªèƒ½åˆ©ç”¨ä¸€ä¸ªæ ¸ å¦‚ä½•ä¿è¯è¿›ç¨‹çš„å¥å£®æ€§æ ¸ç¨³å®šæ€§ï¼šç”±äºNodeæ‰§è¡Œåœ¨å•çº¿ç¨‹ä¸Šï¼Œä¸€æ—¦å•çº¿ç¨‹ä¸ŠæŠ›å‡ºçš„å¼‚å¸¸æ²¡æœ‰è¢«æ•è·ï¼Œå°†ä¼šå¼•èµ·æ•´ä¸ªè¿›ç¨‹çš„å´©æºƒ å¤šè¿›ç¨‹æ¶æ„ Master-Workeræ¨¡å¼ï¼šåˆç§°ä¸ºä¸»ä»æ¨¡å¼ï¼Œåœ¨è¿™ç§æ¨¡å¼ä¸­è¿›ç¨‹åˆ†ä¸ºä¸¤ç§ï¼šä¸»è¿›ç¨‹å’Œå·¥ä½œè¿›ç¨‹ã€‚è¿™æ˜¯å…¸å‹çš„åˆ†å¸ƒå¼æ¶æ„ä¸­ç”¨äºå¹¶è¡Œå¤„ç†ä¸šåŠ¡çš„æ¨¡å¼ï¼Œå…·å¤‡è¾ƒå¥½çš„å¯ä¼¸ç¼©æ€§å’Œç¨³å®šæ€§ã€‚ä¸»è¿›ç¨‹ä¸è´Ÿè´£å…·ä½“çš„ä¸šåŠ¡å¤„ç†ï¼Œè€Œæ˜¯è´Ÿè´£è°ƒåº¦å’Œç®¡ç†å·¥ä½œè¿›ç¨‹ï¼Œå®ƒæ˜¯è¶‹å‘äºç¨³å®šçš„ã€‚å·¥ä½œè¿›ç¨‹è´Ÿè´£å…·ä½“çš„ä¸šåŠ¡åŠ©ç†ã€‚ åˆ›å»ºå­è¿›ç¨‹ spawn()ï¼šå¯åŠ¨ä¸€ä¸ªå­è¿›ç¨‹æ¥æ‰§è¡Œå‘½ä»¤ exec()ï¼šå¯åŠ¨ä¸€ä¸ªå­è¿›ç¨‹æ¥æ‰§è¡Œå‘½ä»¤ï¼Œä¸spawn()ä¸åŒçš„æ˜¯å…¶æ¥å£ä¸åŒï¼Œå®ƒç”±ä¸€ä¸ªå›è°ƒå‡½æ•°è·çŸ¥å­è¿›ç¨‹çš„çŠ¶å†µ execFIle()ï¼šå¯åŠ¨ä¸€ä¸ªå­è¿›ç¨‹æ¥æ‰§è¡Œç§‘æ‰§è¡Œæ–‡ä»¶ fork()ï¼šä¸spawn()ç±»ä¼¼ï¼Œä¸åŒç‚¹åœ¨äºå®ƒåˆ›å»ºNodeçš„å­è¿›ç¨‹åªéœ€æŒ‡å®šè¦æ‰§è¡Œçš„JSæ–‡ä»¶æ¨¡å—å³å¯ spawn()ä¸exec()ã€execFile()ä¸åŒçš„æ˜¯ï¼Œåä¸¤è€…åˆ›å»ºæ—¶å¯ä»¥æŒ‡å®štimeoutå±æ€§è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œä¸€æ—¦åˆ›å»ºçš„è¿›ç¨‹å…è®¸è¶…è¿‡è®¾å®šçš„æ—¶é—´å°†ä¼šè¢«æ€æ­»ã€‚ |ç±»å‹|å›è°ƒ/å¼‚å¸¸|è¿›ç¨‹ç±»å‹|æ‰§è¡Œç±»å‹|å¯è®¾ç½®è¶…æ—¶||spawn()|x|ä»»æ„|å‘½ä»¤|x||exec()|âœ”ï¸|ä»»æ„|å‘½ä»¤|âœ”ï¸||execFile()|âœ”ï¸|ä»»æ„|å¯æ‰§è¡Œæ–‡ä»¶|âœ”ï¸||fork()|x|Node|JSæ–‡ä»¶|x| è¿™é‡Œçš„å¯æ‰§è¡Œæ–‡ä»¶æ˜¯æŒ‡å¯ä»¥ç›´æ¥æ‰§è¡Œçš„æ–‡ä»¶ï¼Œå¦‚æœæ˜¯JSæ–‡ä»¶é€šè¿‡execFile()è¿è¡Œï¼Œå®ƒçš„é¦–è¡Œå†…å®¹å¿…é¡»æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š 1#!/usr/bin/env node å°½ç®¡4ç§åˆ›å»ºå­è¿›ç¨‹çš„æ–¹å¼æœ‰äº›å·®åˆ«ï¼Œä½†äº‹å®ä¸Šåé¢3ç§æ–¹æ³•éƒ½æ˜¯spawn()çš„å»¶ä¼¸åº”ç”¨ è¿›ç¨‹é—´é€šä¿¡ é€šè¿‡fork()æˆ–è€…å…¶ä»–APIï¼Œåˆ›å»ºå­è¿›ç¨‹ä¹‹åï¼Œä¸ºäº†å®ç°çˆ¶å­è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ï¼Œçˆ¶è¿›ç¨‹ä¸å­è¿›ç¨‹ä¹‹é—´å°†ä¼šåˆ›å»ºIPCé€šé“ã€‚é€šè¿‡IPCé€šé“ï¼Œçˆ¶å­è¿›ç¨‹ä¹‹é—´æ‰èƒ½é€šè¿‡messageå’Œsend()ä¼ é€’æ¶ˆæ¯ 12345678910111213141516// parent.jsvar cp = require('child_process')var n = cp.fork(__dirname + '/sub.js')n.on('message', function (m) &#123; console.log('Parent got message:', m)&#125;)n.send(&#123; hello: 'world' &#125;)// sub.jsprocess.on('message'ï¼Œ function (m) &#123; console.log('Child got message:', m)&#125;)process.send(&#123; foo: 'bar' &#125;) è¿›ç¨‹é—´é€šä¿¡åŸç† IPCçš„å…¨ç§°æ˜¯Inter-Process Communicationï¼Œå³è¿›ç¨‹é—´é€šä¿¡ã€‚å®ç°è¿›ç¨‹é—´é€šä¿¡çš„æŠ€æœ¯æœ‰å¾ˆå¤šï¼Œå¦‚å‘½åç®¡é“ã€åŒ¿åç®¡é“ã€socketã€ä¿¡å·é‡ã€å…±äº«å†…å­˜ã€æ¶ˆæ¯é˜Ÿåˆ—ã€Domain Socketç­‰ã€‚Nodeä¸­å®ç°IPCé€šé“çš„æ˜¯ç®¡é“ï¼ˆpipeï¼‰æŠ€æœ¯ã€‚ä½†æ­¤ç®¡é“éå½¼ç®¡é“ï¼Œåœ¨Nodeä¸­ç®¡é“æ˜¯ä¸ªæŠ½è±¡å±‚é¢çš„ç§°å‘¼ï¼Œå…·ä½“ç»†èŠ‚å®ç°ç”±libuvæä¾›ï¼Œåœ¨Windowsä¸‹ç”±å‘½åç®¡é“ï¼ˆnamed pipeï¼‰å®ç°ï¼Œ*nixç³»ç»Ÿåˆ™é‡‡ç”¨Unix Domain Socketå®ç°ã€‚ çˆ¶è¿›ç¨‹åœ¨å®é™…åˆ›å»ºå­è¿›ç¨‹ä¹‹å‰ï¼Œä¼šåˆ›å»ºIPCé€šé“å¹¶ç›‘å¬å®ƒï¼Œç„¶åæ‰çœŸæ­£åˆ›å»ºå‡ºå­è¿›ç¨‹ï¼Œå¹¶é€šè¿‡ç¯å¢ƒå˜é‡ï¼ˆNODE_CHANNEL_FDï¼‰å‘Šè¯‰å­è¿›ç¨‹è¿™ä¸ªIPCé€šé“çš„æ–‡ä»¶æè¿°ç¬¦ã€‚å­è¿›ç¨‹åœ¨å¯åŠ¨çš„è¿‡ç¨‹ä¸­ï¼Œæ ¹æ®æ–‡ä»¶æè¿°ç¬¦å»è¿æ¥è¿™ä¸ªå·²å­˜åœ¨çš„IPCé€šé“ï¼Œä»è€Œå®Œæˆçˆ¶å­è¿›ç¨‹çš„è¿æ¥ã€‚ å»ºç«‹è¿æ¥ä¹‹åçš„çˆ¶å­è¿›ç¨‹å°±å¯ä»¥è‡ªç”±åœ°é€šä¿¡äº†ã€‚ç”±äºIPCé€šé“æ˜¯ç”¨å‘½åç®¡é“æˆ–Domain Socketåˆ›å»ºçš„ï¼Œå®ƒä»¬ä¸ç½‘ç»œsocketçš„è¡Œä¸ºæ¯”è¾ƒç±»ä¼¼ï¼Œå±äºåŒå‘é€šä¿¡ã€‚åœ¨Nodeä¸­ï¼ŒIPCé€šé“è¢«æŠ½è±¡ä¸ºStreamå¯¹è±¡ï¼Œåœ¨è°ƒç”¨send()å‘é€æ•°æ®ï¼ˆç±»ä¼¼äºwrite()ï¼‰æ¥æ”¶åˆ°çš„æ¶ˆæ¯ä¼šé€šè¿‡messageäº‹ä»¶ï¼ˆç±»ä¼¼äºdataï¼‰è§¦å‘ç»™åº”ç”¨å±‚ã€‚ åªæœ‰å¯åŠ¨çš„å­è¿›ç¨‹æ˜¯Nodeè¿›ç¨‹æ—¶ï¼Œå­è¿›ç¨‹æ‰ä¼šæ ¹æ®ç¯å¢ƒå˜é‡å»è¿æ¥IPCé€šé“ï¼Œå¯¹äºå…¶ä»–ç±»å‹çš„å­è¿›ç¨‹åˆ™æ— æ³•å®ç°è¿›ç¨‹é—´é€šä¿¡ï¼Œé™¤éå…¶ä»–è¿›ç¨‹ä¹ŸæŒ‰çº¦å®šå»è¿æ¥è¿™ä¸ªå·²ç»åˆ›å»ºå¥½çš„IPCé€šé“ã€‚ å¥æŸ„ä¼ é€’ é€šè¿‡ä»£ç†ï¼Œä¸»è¿›ç¨‹å¯¹å¤–æ¥æ”¶æ‰€æœ‰çš„ç½‘ç»œè¯·æ±‚ï¼Œå†å°†è¿™äº›è¯·æ±‚åˆ†åˆ«ä»£ç†åˆ°ä¸åŒçš„ç«¯å£çš„è¿›ç¨‹ä¸Šã€‚è¿™æ ·ï¼Œå¯ä»¥é¿å…ç«¯å£ä¸èƒ½é‡å¤ç›‘å¬çš„é—®é¢˜ï¼Œç”šè‡³å¯ä»¥åœ¨ä»£ç†è¿›ç¨‹ä¸Šåšé€‚å½“çš„è´Ÿè½½å‡è¡¡ï¼Œä½¿å¾—æ¯ä¸ªå­è¿›ç¨‹å¯ä»¥è¾ƒä¸ºå‡è¡¡åœ°æ‰§è¡Œä»»åŠ¡ã€‚ç”±äºè¿›ç¨‹æ¯æ¥æ”¶åˆ°ä¸€ä¸ªè¿æ¥ï¼Œå°†ä¼šç”¨æ‰ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œå› æ­¤ä»£ç†æ–¹æ¡ˆä¸­å®¢æˆ·ç«¯è¿æ¥åˆ°ä»£ç†è¿›ç¨‹ï¼Œä»£ç†è¿›ç¨‹è¿æ¥åˆ°å·¥ä½œè¿›ç¨‹çš„è¿‡ç¨‹éœ€è¦ç”¨æ‰ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚æ“ä½œç³»ç»Ÿçš„æ–‡ä»¶æè¿°ç¬¦æ˜¯æœ‰é™çš„ï¼Œä»£ç†æ–¹æ¡ˆæµªè´¹æ‰ä¸€å€æ•°é‡çš„æ–‡ä»¶æè¿°ç¬¦çš„åšæ³•å½±å“äº†ç³»ç»Ÿçš„æ‰©å±•èƒ½åŠ›ã€‚ ä¸ºäº†è§£å†³ä¸Šè¿°è¿™æ ·çš„é—®é¢˜ï¼ŒNodeå¼•å…¥äº†è¿›ç¨‹é—´å‘é€å¥æŸ„çš„åŠŸèƒ½ã€‚send()æ–¹æ³•é™¤äº†èƒ½é€šè¿‡IPCå‘é€æ•°æ®å¤–ï¼Œè¿˜èƒ½å‘é€å¥æŸ„ï¼Œç¬¬äºŒä¸ªå¯é€‰å‚æ•°å°±æ˜¯å¥æŸ„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 1child.send(message, [sendHandle]) é‚£ä»€ä¹ˆæ˜¯å¥æŸ„ï¼Ÿå¥æŸ„æ˜¯ä¸€ç§å¯ä»¥ç”¨æ¥æ ‡è¯†èµ„æºçš„å¼•ç”¨ï¼Œå®ƒçš„å†…éƒ¨åŒ…å«äº†æŒ‡å‘å¯¹è±¡çš„æ–‡ä»¶æè¿°ç¬¦ã€‚æ¯”å¦‚å¥æŸ„å¯ä»¥ç”¨æ¥æ ‡è¯†ä¸€ä¸ªæœåŠ¡å™¨ç«¯socketå¯¹è±¡ã€ä¸€ä¸ªå®¢æˆ·ç«¯socketå¯¹è±¡ã€ä¸€ä¸ªUDPå¥—æ¥å­—ã€ä¸€ä¸ªç®¡é“ç­‰ã€‚ å‘é€å¥æŸ„æ„å‘³ç€ä»€ä¹ˆï¼Ÿåœ¨å‰ä¸€ä¸ªé—®é¢˜ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å»æ‰ä»£ç†è¿™ç§æ–¹æ¡ˆï¼Œä½¿ä¸»è¿›ç¨‹æ¥æ”¶åˆ°socketè¯·æ±‚åï¼Œå°†è¿™ä¸ªsocketç›´æ¥å‘é€ç»™å·¥ä½œè¿›ç¨‹ï¼Œè€Œä¸æ˜¯é‡æ–°ä¸å·¥ä½œè¿›ç¨‹ä¹‹é—´å»ºç«‹æ–°çš„socketè¿æ¥æ¥è½¬å‘æ•°æ®ã€‚æ–‡ä»¶æè¿°ç¬¦æµªè´¹çš„é—®é¢˜å¯ä»¥é€šè¿‡è¿™æ ·çš„æ–¹å¼è½»æ¾è§£å†³ã€‚ 123456789101112131415161718192021222324252627// parent.jsvar cp = require('child_process')var child1 = cp.fork('child.js')var child2 = cp.fork('child.j2')var server = require('net').createServer()server.listen(1337, function () &#123; child.send('server', server) child.send('server', server) // å…³æ‰ server.close()&#125;)// child.jsvar http = require('http')var server = http.createServer(function (req, res) &#123; res.writeHead(200, &#123; 'Content-Type': 'text/plain' &#125;) res.end('handled by child, pid is ' + process.id + '\\n')&#125;)process.on('message', function (m, tcp) &#123; if (m === 'server') &#123; tcp.on('connection', function (socket) &#123; server.emit('connection', socket) &#125;) &#125;&#125;) å¥æŸ„å‘é€ä¸è¿˜åŸ ä¸Šæ–‡ä»‹ç»çš„è™½ç„¶æ˜¯å¥æŸ„å‘é€ï¼Œä½†æ˜¯ä»”ç»†çœ‹çœ‹ï¼Œå¥æŸ„å‘é€è·Ÿæˆ‘ä»¬ç›´æ¥å°†æœåŠ¡å™¨å¯¹è±¡å‘é€ç»™å­è¿›ç¨‹æœ‰æ²¡æœ‰å·®åˆ«ï¼Ÿå®ƒæ˜¯å¦çœŸçš„å°†æœåŠ¡å™¨å¯¹è±¡å‘é€ç»™äº†å­è¿›ç¨‹ï¼Ÿä¸ºä»€ä¹ˆå®ƒå¯ä»¥å‘é€åˆ°å¤šä¸ªå­è¿›ç¨‹ä¸­ï¼Ÿå‘é€ç»™å­è¿›ç¨‹ä¸ºä»€ä¹ˆçˆ¶è¿›ç¨‹ä¸­è¿˜å­˜åœ¨è¿™ä¸ªå¯¹è±¡ï¼Ÿ ç›®å‰å­è¿›ç¨‹å¯¹è±¡send()æ–¹æ³•å¯ä»¥å‘é€çš„å¥æŸ„ç±»å‹åŒ…æ‹¬å¦‚ä¸‹å‡ ç§ï¼š net.Socketã€‚TCPå¥—æ¥å­—ã€‚ net.Serverã€‚TCPæœåŠ¡å™¨ï¼Œä»»æ„å»ºç«‹åœ¨TCPæœåŠ¡ä¸Šçš„åº”ç”¨å±‚æœåŠ¡éƒ½å¯ä»¥äº«å—åˆ°å®ƒå¸¦æ¥çš„å¥½å¤„ã€‚ net.Nativeã€‚C++å±‚é¢çš„TCPå¥—æ¥å­—æˆ–IPCç®¡é“ã€‚ dgram.Socketã€‚UDPå¥—æ¥å­—ã€‚ dgram.Nativeã€‚C++å±‚é¢çš„UDPå¥—æ¥å­—ã€‚ send()æ–¹æ³•åœ¨å°†æ¶ˆæ¯å‘é€åˆ°IPCç®¡é“å‰ï¼Œå°†æ¶ˆæ¯ç»„è£…æˆä¸¤ä¸ªå¯¹è±¡ï¼Œä¸€ä¸ªå‚æ•°æ˜¯handleï¼Œå¦ä¸€ä¸ªæ˜¯messageã€‚messageå‚æ•°å¦‚ä¸‹æ‰€ç¤ºï¼š 12345&#123; cmd: 'NODE_HANDLE', type: 'net.Server', msg: message&#125; å‘é€åˆ°IPCç®¡é“ä¸­çš„å®é™…ä¸Šæ˜¯æˆ‘ä»¬è¦å‘é€çš„å¥æŸ„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ–‡ä»¶æè¿°ç¬¦å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ•´æ•°å€¼ã€‚è¿™ä¸ªmessageå¯¹è±¡åœ¨å†™å…¥åˆ°IPCç®¡é“æ—¶ä¹Ÿä¼šé€šè¿‡JSON.stringify()è¿›è¡Œåºåˆ—åŒ–ã€‚æ‰€ä»¥æœ€ç»ˆå‘é€åˆ°IPCé€šé“ä¸­çš„ä¿¡æ¯éƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œsend()æ–¹æ³•èƒ½å‘é€æ¶ˆæ¯å’Œå¥æŸ„å¹¶ä¸æ„å‘³ç€å®ƒèƒ½å‘é€ä»»æ„å¯¹è±¡ã€‚ è¿æ¥äº†IPCé€šé“çš„å­è¿›ç¨‹å¯ä»¥è¯»å–åˆ°çˆ¶è¿›ç¨‹å‘æ¥çš„æ¶ˆæ¯ï¼Œå°†å­—ç¬¦ä¸²é€šè¿‡JSON.parse()è§£æè¿˜åŸä¸ºå¯¹è±¡åï¼Œæ‰è§¦å‘messageäº‹ä»¶å°†æ¶ˆæ¯ä½“ä¼ é€’ç»™åº”ç”¨å±‚ä½¿ç”¨ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ¶ˆæ¯å¯¹è±¡è¿˜è¦è¢«è¿›è¡Œè¿‡æ»¤å¤„ç†ï¼Œmessage.cmçš„å€¼å¦‚æœä»¥NODE_ä¸ºå‰ç¼€ï¼Œå®ƒå°†å“åº”ä¸€ä¸ªå†…éƒ¨äº‹ä»¶internalMessageã€‚å¦‚æœmessage.cmdçš„å€¼ä¸ºNODE_HANDLEï¼Œå®ƒå°†å–å‡ºmessage.typeå€¼å’Œå¾—åˆ°çš„æ–‡ä»¶æè¿°ç¬¦ä¸€èµ·è¿˜åŸå‡ºä¸€ä¸ªå¯¹åº”çš„å¯¹è±¡ã€‚ ç«¯å£å…±åŒç›‘å¬ åœ¨äº†è§£äº†å¥æŸ„ä¼ é€’èƒŒåçš„åŸç†åï¼Œæˆ‘ä»¬ç»§ç»­æ¢ç©¶ä¸ºä½•é€šè¿‡å‘é€å¥æŸ„åï¼Œå¤šä¸ªè¿›ç¨‹å¯ä»¥ç›‘å¬åˆ°ç›¸åŒçš„ç«¯å£è€Œä¸å¼•èµ·EADDRINUSEå¼‚å¸¸ã€‚å…¶ç­”æ¡ˆä¹Ÿå¾ˆç®€å•ï¼Œæˆ‘ä»¬ç‹¬ç«‹å¯åŠ¨çš„è¿›ç¨‹ä¸­ï¼ŒTCPæœåŠ¡å™¨ç«¯socketå¥—æ¥å­—çš„æ–‡ä»¶æè¿°ç¬¦å¹¶ä¸ç›¸åŒï¼Œå¯¼è‡´ç›‘å¬åˆ°ç›¸åŒçš„ç«¯å£æ—¶ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ Nodeåº•å±‚å¯¹æ¯ä¸ªç«¯å£ç›‘å¬éƒ½è®¾ç½®äº†SO_REUSEADDRé€‰é¡¹ï¼Œè¿™ä¸ªé€‰é¡¹çš„æ¶µä¹‰æ˜¯ä¸åŒè¿›ç¨‹å¯ä»¥å°±ç›¸åŒçš„ç½‘å¡å’Œç«¯å£è¿›è¡Œç›‘å¬ï¼Œè¿™ä¸ªæœåŠ¡å™¨ç«¯å¥—æ¥å­—å¯ä»¥è¢«ä¸åŒçš„è¿›ç¨‹å¤ç”¨ ç”±äºç‹¬ç«‹å¯åŠ¨çš„è¿›ç¨‹äº’ç›¸ä¹‹é—´å¹¶ä¸çŸ¥é“æ–‡ä»¶æè¿°ç¬¦ï¼Œæ‰€ä»¥ç›‘å¬ç›¸åŒç«¯å£æ—¶ä¼šå¤±è´¥ã€‚ä½†å¯¹äºsend()å‘é€çš„å¥æŸ„è¿˜åŸå‡ºæ¥çš„æœåŠ¡è€Œè¨€ï¼Œå®ƒä»¬çš„æ–‡ä»¶æè¿°ç¬¦æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥ç›‘å¬ç›¸åŒçš„ç«¯å£ä¸ä¼šå¼•èµ·å¼‚å¸¸ã€‚ å¤šä¸ªåº”ç”¨ç›‘å¬ç›¸åŒçš„ç«¯å£æ—¶ï¼Œæ–‡ä»¶æè¿°ç¬¦åŒä¸€æ—¶é—´åªèƒ½è¢«æŸä¸ªè¿›ç¨‹æ‰€ç”¨ã€‚æ¢è¨€ä¹‹å°±æ˜¯ç½‘ç»œè¯·æ±‚å‘æœåŠ¡å™¨å‘é€æ—¶ï¼Œåªæœ‰ä¸€ä¸ªå¹¸è¿çš„è¿›ç¨‹èƒ½å¤ŸæŠ¢åˆ°è¿æ¥ï¼Œä¹Ÿå°±æ˜¯è¯´åªæœ‰å®ƒèƒ½ä¸ºè¿™ä¸ªè¯·æ±‚è¿›è¡ŒæœåŠ¡ã€‚è¿™äº›è¿›ç¨‹æœåŠ¡æ˜¯æŠ¢å å¼çš„ã€‚ é›†ç¾¤ç¨³å®šä¹‹è·¯ é—®é¢˜ æ€§èƒ½é—®é¢˜ å¤šä¸ªå·¥ä½œè¿›ç¨‹çš„å­˜æ´»çŠ¶æ€ç®¡ç† å·¥ä½œè¿›ç¨‹çš„å¹³æ»‘é‡å¯ é…ç½®æˆ–è€…é™æ€æ•°æ®çš„åŠ¨æ€é‡æ–°è½½å…¥ å…¶ä»–ç»†èŠ‚ è¿›ç¨‹äº‹ä»¶ errorï¼šå½“å­è¿›ç¨‹æ— æ³•è¢«å¤åˆ¶åˆ›å»ºã€æ— æ³•è¢«æ€æ­»ã€æ— æ³•å‘é€æ¶ˆæ¯æ—¶ä¼šè§¦å‘è¯¥äº‹ä»¶ã€‚ exitï¼šå­è¿›ç¨‹é€€å‡ºæ—¶è§¦å‘è¯¥äº‹ä»¶ï¼Œå­è¿›ç¨‹å¦‚æœæ˜¯æ­£å¸¸é€€å‡ºï¼Œè¿™ä¸ªäº‹ä»¶çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºé€€å‡ºç ï¼Œå¦åˆ™ä¸ºnullã€‚å¦‚æœè¿›ç¨‹æ˜¯é€šè¿‡kill()æ–¹æ³•æ€æ­»çš„ï¼Œä¼šå¾—åˆ°ç¬¬äºŒä¸ªå‚æ•°ï¼Œå®ƒè¡¨ç¤ºæ€æ­»è¿›ç¨‹æ—¶çš„ä¿¡å·ã€‚ closeï¼šåœ¨å­è¿›ç¨‹çš„æ ‡å‡†è¾“å…¥è¾“å‡ºæµä¸­æ­¢æ—¶è§¦å‘è¯¥äº‹ä»¶ï¼Œå‚æ•°ä¸exitç›¸åŒã€‚ disconnectï¼šåœ¨çˆ¶è¿›ç¨‹æˆ–å­è¿›ç¨‹ä¸­è°ƒç”¨disconnect()æ–¹æ³•å¼è§¦å‘è¯¥äº‹ä»¶ï¼Œåœ¨è°ƒç”¨è¯¥æ–¹æ³•æ—¶å°†å…³é—­ç›‘å¬IPCé€šé“ã€‚ è‡ªåŠ¨é‡å¯ï¼š ä¸€æ—¦æœ‰æœªæ•è·çš„å¼‚å¸¸å‡ºç°ï¼Œå·¥ä½œè¿›ç¨‹å°±ä¼šç«‹å³åœæ­¢æ¥æ”¶æ–°çš„è¿æ¥ï¼›å½“æ‰€æœ‰è¿æ¥æ–­å¼€åï¼Œé€€å‡ºè¿›ç¨‹ã€‚ä¸»è¿›ç¨‹åœ¨ä¾¦å¬åˆ°å·¥ä½œè¿›ç¨‹çš„exitåï¼Œå°†ä¼šç«‹å³å¯åŠ¨æ–°çš„è¿›ç¨‹æœåŠ¡ï¼Œä»¥æ­¤ä¿è¯æ•´ä¸ªé›†ç¾¤ä¸­æ€»æ˜¯æœ‰è¿›ç¨‹åœ¨ä¸ºç”¨æˆ·æœåŠ¡çš„ã€‚ è‡ªæ€ä¿¡å· ä¸Šè¿°è¿‡ç¨‹å­˜åœ¨çš„é—®é¢˜æ˜¯è¦ç­‰åˆ°å·²æœ‰çš„è¿æ¥æ–­å¼€åè¿›ç¨‹æ‰é€€å‡ºï¼Œåœ¨æç«¯çš„æƒ…å†µä¸‹ï¼Œæ‰€æœ‰å·¥ä½œè¿›ç¨‹éƒ½åœæ­¢æ¥æ”¶æ–°çš„è¿æ¥ï¼Œå…¨å¤„åœ¨ç­‰å¾…é€€å‡ºçš„çŠ¶æ€ã€‚ä½†åœ¨ç­‰åˆ°è¿›ç¨‹å®Œå…¨é€€å‡ºåœ¨é‡å¯çš„è¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰æ–°æ¥çš„è¯·æ±‚å¯èƒ½å­˜åœ¨æ²¡æœ‰å·¥ä½œè¿›ç¨‹ä¸ºæ–°ç”¨æˆ·æœåŠ¡çš„æƒ…æ™¯ï¼Œè¿™å›ä¸¢æ‰å¤§éƒ¨åˆ†è¯·æ±‚ã€‚ ä¸ºæ­¤éœ€è¦æ”¹è¿›è¿™ä¸ªè¿‡ç¨‹ï¼Œä¸èƒ½ç­‰åˆ°å·¥ä½œè¿›ç¨‹é€€å‡ºåæ‰é‡å¯æ–°çš„å·¥ä½œè¿›ç¨‹ã€‚å½“ç„¶ä¹Ÿä¸èƒ½æš´åŠ›é€€å‡ºè¿›ç¨‹ï¼Œå› ä¸ºè¿™æ ·ä¼šå¯¼è‡´å·²è¿æ¥çš„ç”¨æˆ·ä¹‹é—´æ–­å¼€ã€‚äºæ˜¯æˆ‘ä»¬åœ¨é€€å‡ºçš„æµç¨‹ä¸­å¢åŠ ä¸€ä¸ªè‡ªæ€ï¼ˆsuicideï¼‰ä¿¡å·ã€‚å·¥ä½œè¿›ç¨‹åœ¨å¾—çŸ¥è¦é€€å‡ºæ—¶ï¼Œå‘ä¸»è¿›ç¨‹å‘é€ä¸€ä¸ªè‡ªæ€ä¿¡å·ï¼Œç„¶åæ‰åœæ­¢æ¥æ”¶æ–°çš„è¿æ¥ï¼Œå½“æ‰€æœ‰è¿æ¥æ–­å¼€åæ‰é€€å‡ºã€‚ä¸»è¿›ç¨‹åœ¨æ¥æ”¶åˆ°è‡ªæ€ä¿¡å·åï¼Œç«‹å³åˆ›å»ºæ–°çš„å·¥ä½œè¿›ç¨‹æœåŠ¡ã€‚ è¿™é‡Œå­˜åœ¨é—®é¢˜çš„æ˜¯æœ‰å¯èƒ½æˆ‘ä»¬çš„è¿æ¥æ˜¯é•¿è¿æ¥ï¼Œä¸æ˜¯HTTPæœåŠ¡çš„è¿™ç§çŸ­è¿æ¥ï¼Œç­‰å¾…é•¿è¿æ¥æ–­å¼€å¯èƒ½éœ€è¦è¾ƒä¹…çš„æ—¶é—´ã€‚ä¸ºæ­¤ä¸ºå·²æœ‰çš„è¿æ¥çš„æ–­å¼€è®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´æ˜¯å¿…è¦çš„ã€‚ è¿›ç¨‹ä¸­å¦‚æœå‡ºç°æœªèƒ½æ•è·çš„å¼‚å¸¸ï¼Œå°±æ„å‘³ç€æœ‰é‚£ä¹ˆä¸€æ®µä»£ç åœ¨å¥å£®æ€§ä¸Šæ˜¯ä¸åˆæ ¼çš„ã€‚ä¸ºæ­¤é€€å‡ºè¿›ç¨‹å‰ï¼Œé€šè¿‡æ—¥å¿—è®°å½•ä¸‹é—®é¢˜æ‰€åœ¨æ˜¯å¿…é¡»è¦åšçš„äº‹æƒ…ï¼Œå®ƒå¯ä»¥å¸®æˆ‘ä»¬å¾ˆå¥½åœ°å®šä½å’Œè¿½è¸ªä»£ç å¼‚å¸¸å‡ºç°çš„ä½ç½®ã€‚ é™é‡é‡å¯ é€šè¿‡è‡ªæ€ä¿¡å·å‘ŠçŸ¥ä¸»è¿›ç¨‹å¯ä»¥ä½¿å¾—æ–°è¿æ¥æ€»æ˜¯æœ‰è¿›ç¨‹æœåŠ¡ï¼Œä½†æ˜¯ä¾ç„¶è¿˜æ˜¯æœ‰æç«¯çš„æƒ…å†µã€‚å·¥ä½œè¿›ç¨‹ä¸èƒ½æ— é™åˆ¶åœ°è¢«é‡å¯ï¼Œå¦‚æœå¯åŠ¨çš„è¿‡ç¨‹ä¸­å°±å‘ç”Ÿäº†é”™è¯¯ï¼Œæˆ–è€…å¯åŠ¨åæ¥åˆ°è¿æ¥å°±æ”¶åˆ°é”™è¯¯ï¼Œä¼šå¯¼è‡´å·¥ä½œè¿›ç¨‹è¢«é¢‘ç¹é‡å¯ï¼Œè¿™ç§é¢‘ç¹é‡å¯ä¸å±äºæˆ‘ä»¬æ•æ‰æœªçŸ¥å¼‚å¸¸çš„æƒ…å†µï¼Œå› ä¸ºè¿™ç§çŸ­æ—¶é—´å†…é¢‘ç¹é‡å¯å·²ç»ä¸ç¬¦åˆé¢„æœŸçš„è®¾ç½®ï¼Œææœ‰å¯èƒ½æ˜¯ç¨‹åºç¼–å†™çš„é”™è¯¯ã€‚ ä¸ºäº†æ¶ˆé™¤è¿™ç§æ— æ„ä¹‰çš„é‡å¯ï¼Œåœ¨æ»¡è¶³ä¸€å®šè§„åˆ™çš„é™åˆ¶ä¸‹ï¼Œä¸åº”å½“åå¤é‡å¯ã€‚æ¯”å¦‚åœ¨å•ä½æ—¶é—´å†…è§„å®šåªèƒ½é‡å¯å¤šå°‘æ¬¡ï¼Œè¶…è¿‡é™åˆ¶å°±è§¦å‘giveupäº‹ä»¶ï¼Œå‘ŠçŸ¥æ”¾å¼ƒé‡å¯å·¥ä½œè¿›ç¨‹è¿™ä¸ªé‡è¦äº‹ä»¶ã€‚ è´Ÿè½½å‡è¡¡ Nodeé»˜è®¤æä¾›çš„æœºåˆ¶æ˜¯é‡‡ç”¨æ“ä½œç³»ç»Ÿçš„æŠ¢å å¼ç­–ç•¥ã€‚æ‰€è°“çš„æŠ¢å å¼å°±æ˜¯åœ¨ä¸€å †å·¥ä½œè¿›ç¨‹ä¸­ï¼Œé—²ç€çš„è¿›ç¨‹å¯¹åˆ°æ¥çš„è¯·æ±‚è¿›è¡Œäº‰æŠ¢ï¼Œè°æŠ¢åˆ°è°æœåŠ¡ã€‚ ä¸€èˆ¬è€Œè¨€ï¼Œè¿™ç§æŠ¢å å¼ç­–ç•¥å¯¹å¤§å®¶æ˜¯å…¬å¹³çš„ï¼Œå„ä¸ªè¿›ç¨‹å¯ä»¥æ ¹æ®è‡ªå·±çš„ç¹å¿™åº¦æ¥è¿›è¡ŒæŠ¢å ã€‚ä½†æ˜¯å¯¹äºNodeè€Œè¨€ï¼Œéœ€è¦åˆ†æ¸…çš„æ˜¯å®ƒçš„ç¹å¿™æ˜¯æœ‰CPUã€I/Oä¸¤ä¸ªéƒ¨åˆ†æ„æˆçš„ï¼Œå½±å“æŠ¢å çš„æ˜¯CPUçš„ç¹å¿™åº¦ã€‚å¯¹ä¸åŒçš„ä¸šåŠ¡ï¼Œå¯èƒ½å­˜åœ¨I/Oç¹å¿™ï¼Œè€ŒCPUè¾ƒä¸ºç©ºé—²çš„æƒ…å†µï¼Œè¿™å¯èƒ½é€ æˆæŸä¸ªè¿›ç¨‹èƒ½å¤ŸæŠ¢åˆ°è¾ƒå¤šçš„è¯·æ±‚ï¼Œå½¢æˆè´Ÿè½½ä¸å‡è¡¡çš„æƒ…å†µã€‚ ä¸ºæ­¤Nodeåœ¨V0.11ä¸­æä¾›äº†ä¸€ç§æ–°çš„ç­–ç•¥ä½¿å¾—è´Ÿè½½å‡è¡¡æ›´åˆç†ï¼Œè¿™ç§æ–°çš„ç­–ç•¥å«Round-Robinï¼Œåˆå«è½®å«è°ƒåº¦ã€‚è½®å«è°ƒåº¦çš„å·¥ä½œæ–¹å¼æ˜¯ç”±ä¸»è¿›ç¨‹æ¥å—è¿æ¥ï¼Œå°†å…¶ä»¥æ­¤åˆ†å‘ç»™å·¥ä½œçš„è¿›ç¨‹ã€‚åˆ†å‘çš„ç­–ç•¥æ˜¯åœ¨Nä¸ªå·¥ä½œè¿›ç¨‹ä¸­ï¼Œæ¯æ¬¡é€‰æ‹©ç¬¬i=(i + 1) mod nä¸ªè¿›ç¨‹æ¥å‘é€è¿æ¥ã€‚ çŠ¶æ€å…±äº« è§£å†³æ•°æ®å…±äº«æœ€ç›´æ¥ã€ç®€å•çš„æ–¹å¼å°±æ˜¯é€šè¿‡ç¬¬ä¸‰æ–¹æ¥è¿›è¡Œæ•°æ®å­˜å‚¨ï¼Œæ¯”å¦‚å°†æ•°æ®å­˜æ”¾åˆ°æ•°æ®åº“ã€ç£ç›˜æ–‡ä»¶ã€ç¼“å­˜æœåŠ¡ï¼ˆå¦‚Redis)ä¸­ï¼Œæ‰€æœ‰å·¥ä½œè¿›ç¨‹å¯åŠ¨æ—¶å°†å…¶è¯»å–è¿›å†…å­˜ä¸­ã€‚ä½†è¿™ç§æ–¹å¼å­˜åœ¨çš„é—®é¢˜æ˜¯å¦‚æœæ•°æ®å‘ç”Ÿæ”¹å˜ï¼Œè¿˜éœ€è¦ä¸€ç§æœºåˆ¶é€šçŸ¥åˆ°å„ä¸ªå­è¿›ç¨‹ï¼Œä½¿å¾—å®ƒä»¬çš„å†…éƒ¨çŠ¶æ€ä¹Ÿå¾—åˆ°æ›´æ–°ã€‚ å®ç°çŠ¶æ€åŒæ­¥çš„æœºåˆ¶æœ‰ä¸¤ç§ï¼š å„ä¸ªå­è¿›ç¨‹å»å‘ç¬¬ä¸‰æ–¹è¿›è¡Œå®šæ—¶è½®è¯¢ åˆ›å»ºä¸€ä¸ªé€šçŸ¥è¿›ç¨‹ï¼Œè¿™ä¸ªè¿›ç¨‹è®¾è®¡ä¸ºå€¼è¿›è¡Œè½®è¯¢å’Œé€šçŸ¥ï¼Œä¸å¤„ç†ä»»ä½•ä¸šåŠ¡é€»è¾‘ã€‚è¿›ç¨‹åœ¨å¯åŠ¨æ—¶ä»é€šçŸ¥æœåŠ¡å¤„é™¤äº†è¯»å–ç¬¬ä¸€æ¬¡æ•°æ®å¤–ï¼Œè¿˜å°†è¿›ç¨‹ä¿¡æ¯æ³¨å†Œåˆ°é€šçŸ¥æœåŠ¡å¤„ã€‚ä¸€æ—¦è½®è¯¢å‘ç°æœ‰æ•°æ®æ›´æ–°åï¼Œæ ¹æ®æ³¨å†Œä¿¡æ¯ï¼Œå°†æ›´æ–°åçš„æ•°æ®å‘é€ç»™å·¥ä½œè¿›ç¨‹ã€‚ Clusteræ¨¡å— 12345678910var cluster = require('cluster')cluster.setupMaster(&#123; exec: 'workter.js'&#125;)var cpus = require('os').cpus()for (var i = 0; i &lt; cpus.length; i++) &#123; cluster.fork()&#125; æ‰§è¡Œä¸Šè¿°ä»£ç å°†ä¼šå¾—åˆ°ä¸å‰æ–‡åˆ›å»ºå­è¿›ç¨‹é›†ç¾¤çš„æ•ˆæœç›¸åŒã€‚å°±å®˜æ–¹çš„æ–‡æ¡£è€Œè¨€ï¼Œå®ƒæ›´å–œæ¬¢å¦‚ä¸‹çš„å½¢å¼ä½œä¸ºç¤ºä¾‹ï¼š 1234567891011121314151617181920var cluster = require('cluster')var http = require('http')var numCPUs = require('os').cpus().lengthif (cluster.isMaster) &#123; // Fork workers for (var i = 0; i &lt; numCPUs; i++) &#123; cluster.fork() &#125; cluster.on('exit', function (worker, code, signal) &#123; console.log('worker' + worker.process.pid + ' died') &#125;)&#125; else &#123; // Workers can share any TCP connection http.createServer(function (req, res) &#123; res.writeHead(200) res.end('hello world\\n') &#125;).listen(8000)&#125; åœ¨è¿›ç¨‹ä¸­åˆ¤æ–­æ˜¯ä¸»è¿›ç¨‹è¿˜æ˜¯å·¥ä½œè¿›ç¨‹ï¼Œä¸»è¦å–å†³äºç¯å¢ƒå˜é‡ä¸­æ˜¯å¦æœ‰NODE_UNIQUE_IDï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 12cluster.isWorker = ('NODE_UNIQUE_ID' in process.env)cluster.isMaster - (cluster.isWorker === false) Clusterå·¥ä½œåŸç† äº‹å®ä¸Šclusteræ¨¡å—å°±æ˜¯child_processå’Œnetæ¨¡å—çš„ç»„åˆåº”ç”¨ã€‚clusterå¯åŠ¨æ—¶ï¼Œå®ƒä¼šåœ¨å†…éƒ¨å¯åŠ¨TCPæœåŠ¡å™¨ï¼Œåœ¨cluster.fork()å­è¿›ç¨‹æ—¶ï¼Œå°†è¿™ä¸ªTCPæœåŠ¡å™¨ç«¯socketçš„æ–‡ä»¶æè¿°ç¬¦å‘é€ç»™å·¥ä½œè¿›ç¨‹ã€‚å¦‚æœè¿›ç¨‹æ˜¯é€šè¿‡cluster.fork()å¤åˆ¶å‡ºæ¥çš„ï¼Œé‚£ä¹ˆå®ƒçš„ç¯å¢ƒå˜é‡å°±å­˜åœ¨NODE_UNIQUE_IDï¼Œå¦‚æœè¿›ç¨‹ä¸­å­˜åœ¨listen()ä¾¦å¬ç½‘ç»œç«¯å£çš„è°ƒç”¨ï¼Œå®ƒä»¬å°†æ‹¿åˆ°è¯¥æ–‡ä»¶æè¿°ç¬¦ï¼Œé€šè¿‡SO_REUSEADDRç«¯å£é‡ç”¨ï¼Œä»è€Œå®ç°å¤šä¸ªå­è¿›ç¨‹å…±äº«ç«¯å£ã€‚å¯¹äºæ™®é€šæ–¹å¼å¯åŠ¨çš„è¿›ç¨‹ï¼Œåˆ™ä¸å­˜åœ¨æ–‡ä»¶æè¿°ç¬¦ä¼ é€’å…±äº«ç­‰äº‹æƒ…ã€‚ åœ¨clusterå†…éƒ¨éšå¼åˆ›å»ºTCPæœåŠ¡å™¨çš„æ–¹å¼å¯¹ä½¿ç”¨è€…æ¥è¯´ååˆ†é€æ˜ï¼Œä½†ä¹Ÿæ­£æ˜¯è¿™ç§æ–¹å¼ä½¿å¾—å®ƒæ— æ³•å…¥ç›´æ¥ä½¿ç”¨child_processé‚£æ ·çµæ´»ã€‚åœ¨clusteræ¨¡å—åº”ç”¨ä¸­ï¼Œä¸€ä¸ªä¸»è¿›ç¨‹åªèƒ½ç®¡ç†ä¸€ç»„å·¥ä½œè¿›ç¨‹ã€‚ å¯¹äºè‡ªè¡Œé€šè¿‡child_processæ¥æ“ä½œæ—¶ï¼Œåˆ™å¯ä»¥æ›´çµæ´»åœ°æ§åˆ¶å·¥ä½œè¿›ç¨‹ï¼Œç”šè‡³æ§åˆ¶å¤šç»„å·¥ä½œè¿›ç¨‹ã€‚å…¶åŸå› åœ¨äºè‡ªè¡Œé€šè¿‡child_processæ“ä½œå­è¿›ç¨‹æ—¶ï¼Œå¯ä»¥éšå¼åœ°åˆ›å»ºå¤šä¸ªTCPæœåŠ¡å™¨ï¼Œä½¿å¾—å­è¿›ç¨‹å¯ä»¥å…±äº«å¤šä¸ªçš„æœåŠ¡å™¨ç«¯socketã€‚ Clusteräº‹ä»¶ forkï¼šå¤åˆ¶ä¸€ä¸ªå·¥ä½œè¿›ç¨‹åè§¦å‘è¯¥äº‹ä»¶ã€‚ onlineï¼šå¤åˆ¶å¥½ä¸€ä¸ªå·¥ä½œè¿›ç¨‹åï¼Œå·¥ä½œè¿›ç¨‹ä¸»åŠ¨å‘é€ä¸€æ¡onlineæ¶ˆæ¯ç»™ä¸»è¿›ç¨‹ï¼Œä¸»è¿›ç¨‹æ”¶åˆ°æ¶ˆæ¯åï¼Œè§¦å‘è¯¥äº‹ä»¶ã€‚ listeningï¼šå·¥ä½œè¿›ç¨‹ä¸­è°ƒç”¨listen()ï¼ˆå…±äº«äº†æœåŠ¡ç«¯Socketï¼‰åï¼Œå‘é€ä¸€æ¡listeningæ¶ˆæ¯ç»™ä¸»è¿›ç¨‹ï¼Œä¸»è¿›ç¨‹æ”¶åˆ°æ¶ˆæ¯åï¼Œè§¦å‘è¯¥äº‹ä»¶ exitï¼šæœ‰å·¥ä½œè¿›ç¨‹é€€å‡ºæ—¶è§¦å‘è¯¥äº‹ä»¶ã€‚ setupï¼šcluster.setupMaster()æ‰§è¡Œåè§¦å‘è¯¥äº‹ä»¶ ç¬¬åç«  æµ‹è¯• å•å…ƒæµ‹è¯• ç¼–å†™å¯æµ‹è¯•ä»£ç æœ‰ä»¥ä¸‹å‡ ä¸ªåŸåˆ™å¯ä»¥éµå¾ª å•ä¸€èŒè´£ æ¥å£æŠ½è±¡ å±‚æ¬¡åˆ†ç¦» å•å…ƒæµ‹è¯•ä»‹ç» æ–­è¨€ åœ¨ç¨‹åºè®¾è®¡ä¸­ï¼Œæ–­è¨€ï¼ˆassertionï¼‰æ˜¯ä¸€ç§æ”¾åœ¨ç¨‹åºä¸­çš„ä¸€é˜¶é€»è¾‘ï¼ˆå¦‚ä¸€ä¸ªç»“æœä¸ºçœŸæˆ–æ˜¯å‡çš„é€»è¾‘åˆ¤æ–­å¼ï¼‰ï¼Œç›®çš„æ˜¯ä¸ºäº†æ ‡è¯†ç¨‹åºå¼€å‘è€…é¢„æœŸçš„ç»“æœâ€”â€”å½“ç¨‹åºè¿è¡Œåˆ°æ–­è¨€çš„ä½ç½®æ—¶ï¼Œå¯¹åº”çš„æ–­è¨€åº”è¯¥ä¸ºçœŸã€‚è‹¥æ–­è¨€ä¸ä¸ºçœŸï¼Œç¨‹åºä¼šä¸­æ­¢è¿è¡Œï¼Œå¹¶å‡ºç°é”™è¯¯ä¿¡æ¯ã€‚ assertæ¨¡å— ok()ï¼šåˆ¤æ–­ç»“æœæ˜¯å¦ä¸ºçœŸã€‚ equal()ï¼šåˆ¤æ–­å®é™…å€¼ä¸æœŸæœ›å€¼æ˜¯å¦ç›¸ç­‰ã€‚ notEqual()ï¼šåˆ¤æ–­å®é™…å€¼ä¸æœŸæœ›å€¼æ˜¯å¦ä¸ç›¸ç­‰ã€‚ deepEqual()ï¼šåˆ¤æ–­å®é™…å€¼ä¸æœŸæœ›å€¼æ˜¯å¦æ·±åº¦ç›¸ç­‰ï¼ˆå¯¹è±¡æˆ–æ•°ç»„çš„å…ƒç´ æ˜¯å¦ç›¸ç­‰ï¼‰ã€‚ notDeepEqual()ï¼šåˆ¤æ–­å®é™…å€¼ä¸æœŸæœ›å€¼æ˜¯å¦ä¸æ·±åº¦ç›¸ç­‰ã€‚ strictEqual()ï¼šåˆ¤æ–­å®é™…å€¼ä¸æœŸæœ›å€¼æ˜¯å¦ä¸¥æ ¼ç›¸ç­‰ï¼ˆç›¸å½“äº===ï¼‰ã€‚ notStrictEqual()ï¼šåˆ¤æ–­å®é™…å€¼ä¸æœŸæœ›å€¼æ˜¯å¦ä¸ä¸¥æ ¼ç›¸ç­‰ï¼ˆç›¸å½“äº!==)ã€‚ throws()ï¼šåˆ¤æ–­ä»£ç å—æ˜¯å¦æŠ›å‡ºå¼‚å¸¸ã€‚ doesNotThrow()ï¼šåˆ¤æ–­ä»£ç å—æ˜¯å¦æ²¡æœ‰æŠ›å‡ºå¼‚å¸¸ã€‚ ifError()ï¼šåˆ¤æ–­å®é™…å€¼æ˜¯å¦ä¸ºä¸€ä¸ªå‡å€¼ï¼ˆnullã€undefinedã€0ã€â€™â€™ã€falseï¼‰ï¼Œå¦‚æœå®é™…å€¼ä¸ºçœŸå€¼ï¼Œå°†ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ æµ‹è¯•æ¡†æ¶ï¼šmocha æµ‹è¯•é£æ ¼ï¼šæˆ‘ä»¬å°†æµ‹è¯•ç”¨ä¾‹çš„ä¸åŒç»„ç»‡æ–¹å¼ç§°ä¸ºæµ‹è¯•é£æ ¼ï¼Œç°ä»Šæµè¡Œçš„å•å…ƒæµ‹è¯•é£æ ¼ä¸»è¦æœ‰TDDï¼ˆæµ‹è¯•é©±åŠ¨å¼€å‘ï¼‰å’ŒBDDï¼ˆè¡Œä¸ºé©±åŠ¨å¼€å‘ï¼‰ä¸¤ç§ï¼Œä»–ä»¬çš„å·®åˆ«å¦‚ä¸‹ï¼š å…³æ³¨ç‚¹ä¸åŒï¼šTDDå…³æ³¨æ‰€æœ‰åŠŸèƒ½æ˜¯å¦è¢«æ­£ç¡®å®ç°ï¼Œæ¯ä¸€ä¸ªåŠŸèƒ½éƒ½å…·å¤‡å¯¹åº”çš„æµ‹è¯•ç”¨ä¾‹ï¼›BDDå…³æ³¨æ•´ä½“è¡Œä¸ºæ˜¯å¦ç¬¦åˆé¢„æœŸï¼Œé€‚åˆè‡ªé¡¶å‘ä¸‹çš„è®¾è®¡æ–¹å¼ã€‚ è¡¨è¾¾æ–¹å¼ä¸åŒï¼šTDDçš„è¡¨è¿°æ–¹å¼åå‘äºåŠŸèƒ½è¯´æ˜ä¹¦çš„é£æ ¼ï¼›BDDçš„è¡¨è¿°æ–¹å¼æ›´æ¥è¿‘äºè‡ªç„¶è¯­è¨€çš„ä¹ æƒ¯ã€‚ 123456789101112131415161718192021222324252627// BDDdescribe('Array', function () &#123; // æä¾›äº†beforeã€afterã€beforeEachã€afterEaché’©å­æ–¹æ³• before (function () &#123; // ... &#125;) describe('#indexOf()', function () &#123; it('should return -1 when not present', function () &#123; [1, 2, 3].indexOf(4).should.equal(-1) &#125;) &#125;)&#125;)// TDDsuite('Array', function () &#123; // æä¾›äº†setupã€teardowné’©å­æ–¹æ³• setup (function () &#123; // ... &#125;) suite('#indexOf()', function () &#123; test('should return -1 when not present', function () &#123; assert.equal(-1, [1, 2, 3].indexOf(4)) &#125;) &#125;)&#125;) æµ‹è¯•æŠ¥å‘Š æµ‹è¯•ä»£ç çš„æ–‡ä»¶ç»„ç»‡ï¼šæµ‹è¯•ä»£ç å­˜åœ¨äºtestç›®å½•ä¸­ æµ‹è¯•ç”¨ä¾‹ ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ä¸­åŒ…å«è‡³å°‘ä¸€ä¸ªæ–­è¨€ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š 1234567891011describe('#indexOf()', function () &#123; it('should return -1 when not present', function () &#123; [1, 2, 3].indexOf(4).should.equal(-1) &#125;) it('should return index when present', function () &#123; [1, 2, 3].indexOf(1).should.equal(0) [1, 2, 3].indexOf(2).should.equal(1) [1, 2, 3].indexOf(3).should.equal(2) &#125;)&#125;) æµ‹è¯•ç”¨ä¾‹æœ€å°‘éœ€è¦é€šè¿‡æ­£å‘æµ‹è¯•å’Œåå‘æµ‹è¯•æ¥ä¿è¯æµ‹è¯•å¯¹åŠŸèƒ½çš„è¦†ç›–ï¼Œè¿™æ˜¯æœ€åŸºæœ¬çš„æµ‹è¯•ç”¨ä¾‹ã€‚å¯¹äºNodeè€Œè¨€ï¼Œä¸ä»…æœ‰è¿™æ ·ç®€å•çš„æ–¹æ³•è°ƒç”¨ï¼Œè¿˜æœ‰å¼‚æ­¥ä»£ç å’Œè¶…æ—¶è®¾ç½®éœ€è¦å…³æ³¨ã€‚ å¼‚æ­¥æµ‹è¯• ç”±äºNodeç¯å¢ƒçš„ç‰¹æ®Šæ€§ï¼Œå¼‚æ­¥è°ƒç”¨éå¸¸å¸¸è§ï¼Œè¿™ä¹Ÿå¸¦æ¥äº†å¼‚æ­¥ä»£ç åœ¨æµ‹è¯•æ–¹é¢çš„è·³è½¬ã€‚åœ¨å…¶ä»–å…¸å‹ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œå¦‚Javaã€Rubyã€Pythonï¼Œä»£ç å¤§å¤šæ˜¯åŒæ­¥æ‰§è¡Œçš„ï¼Œæ‰€ä»¥æµ‹è¯•ç”¨ä¾‹åŸºæœ¬ä¸Šåªè¦åŒ…å«ä¸€äº›æ–­è¨€æ£€æŸ¥è¿”å›å€¼å³å¯ã€‚ä½†æ˜¯åœ¨Nodeä¸­ï¼Œæ£€æŸ¥æ–¹æ³•çš„è¿”å›å€¼æ¯«æ— æ„ä¹‰ï¼Œå¹¶ä¸”ä¸çŸ¥é“å›è°ƒå‡½æ•°å…·ä½“ä½•æ—¶è°ƒç”¨ç»“æŸï¼Œè¿™å°†å¯¼è‡´æˆ‘ä»¬åœ¨å¯¹å¼‚æ­¥è°ƒç”¨è¿›è¡Œæµ‹è¯•æ—¶ï¼Œæ— æ³•è°ƒåº¦åç»­æµ‹è¯•ç”¨ä¾‹çš„æ‰§è¡Œã€‚ æ‰€å¹¸ï¼Œmochaè§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚ä¸€ä¸‹ä¸ºfsæ¨¡å—ä¸­readFileçš„æµ‹è¯•ç”¨ä¾‹ 123456it('fs.readFile should be ok', function (done) &#123; fs.readFile('file_path', 'utf-8', function (err, data) &#123; should.not.exist(err) done() &#125;)&#125;) åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæµ‹è¯•ç”¨ä¾‹æ–¹æ³•it()æ¥å—ä¸¤ä¸ªå‚æ•°ï¼›ç”¨ä¾‹æ ‡é¢˜å’Œå›è°ƒå‡½æ•°ã€‚é€šè¿‡æ£€æŸ¥è¿™ä¸ªå›è°ƒå‡½æ•°çš„å½¢å‚é•¿åº¦ï¼ˆfn.lengthï¼‰æ¥åˆ¤æ–­è¿™ä¸ªç”¨ä¾‹æ˜¯å¦æ˜¯å¼‚æ­¥è°ƒç”¨ï¼Œå¦‚æœæ˜¯å¼‚æ­¥è°ƒç”¨ï¼Œåœ¨æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹æ—¶ï¼Œä¼šå°†ä¸€ä¸ªå‡½æ•°done()æ³¨å…¥ä¸ºå®å‚ï¼Œæµ‹è¯•ä»£ç éœ€è¦ä¸»åŠ¨è°ƒç”¨è¿™ä¸ªå‡½æ•°é€šçŸ¥æµ‹è¯•æ¡†æ¶å½“å‰æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œå®Œæˆï¼Œç„¶åæµ‹è¯•æ¡†æ¶æ‰è¿›è¡Œä¸‹ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹çš„æ‰§è¡Œã€‚ è¶…æ—¶è®¾ç½® mochaç»™æ‰€æœ‰æ¶‰åŠå¼‚æ­¥çš„æµ‹è¯•ç”¨ä¾‹æ·»åŠ äº†è¶…æ—¶é™åˆ¶ï¼Œå¦‚æœä¸€ä¸ªç”¨ä¾‹çš„æ‰§è¡Œæ—¶é—´è¶…è¿‡äº†é¢„æœŸæ—¶é—´ï¼Œå°†ä¼šè®°å½•ä¸‹ä¸€ä¸ªè¶…æ—¶é”™è¯¯ï¼Œç„¶åæ‰§è¡Œä¸‹ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ã€‚ mochaçš„é»˜è®¤è¶…æ—¶æ—¶é—´ä¸º2000æ¯«ç§’ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé€šè¿‡Mocha -t &lt;ms&gt;è®¾ç½®æ‰€æœ‰ç”¨ä¾‹çš„è¶…æ—¶æ—¶é—´ã€‚è‹¥éœ€æ›´ç»†ç²’åº¦åœ°è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œå¯ä»¥åœ¨æµ‹è¯•ç”¨ä¾‹itä¸­è°ƒç”¨this.timeout(ms)å®ç°å¯¹å•ä¸ªç”¨ä¾‹çš„ç‰¹æ®Šè®¾ç½®ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š 1234it('should take less than 500ms', function (done) &#123; this.timeout(500) setTimeout(done, 300)&#125;) ä¹Ÿå¯ä»¥åœ¨æè¿°describeä¸­è°ƒç”¨this.timeout(ms)è®¾ç½®æè¿°ä¸‹å½“å‰å±‚çº§çš„æ‰€æœ‰ç”¨ä¾‹ï¼š 12345678910describe('a suit of tests', function () &#123; this.timeout(500) it('should take less than 500ms', function (done) &#123; setTimeout(done, 300) &#125;) it('should take less than 500ms as well', function (done) &#123; setTimeout(done, 200) &#125;)&#125;) æµ‹è¯•è¦†ç›–ç‡ é€šè¿‡ç»Ÿè®¡æ¯ä¸€è¡Œä»£ç æ˜¯å¦æ‰§è¡Œæ¥å¾—çŸ¥æµ‹è¯•ç”¨ä¾‹å¯¹æºç çš„è¦†ç›–ç‡ blanketæ¨¡å— 123456789// åªéœ€åœ¨æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹ä¹‹å‰é€šè¿‡--requireé€‰é¡¹å¼•å…¥å®ƒå³å¯mocha --require blanket -R html-cov &gt; coverage.html// åœ¨åŒ…æè¿°æ–‡ä»¶(package.json)æ–‡ä»¶ä¸­é…ç½®scriptsèŠ‚ç‚¹ï¼Œpatternå±æ€§ç”¨ä»¥åŒ¹é…éœ€è¦ç¼–è¯‘çš„æ–‡ä»¶\"scripts\": &#123; \"blanket\": &#123; \"pattern\": \"eventproxy/lib\" &#125;&#125; mock å‰é¢æåˆ°å¼€å‘è€…å¸¸å¸¸ä¼šé—æ¼æ‰ä¸€äº›å¼‚å¸¸æ¡ˆä¾‹ï¼Œå…¶ä¸­æƒ³å½“ä¸€éƒ¨åˆ†åŸå› åœ¨äºå¼‚å¸¸çš„æƒ…å†µè¾ƒéš¾å®ç°ã€‚å¤§å¤šå¼‚å¸¸ä¸è¾“å…¥æ•°æ®å¹¶æ— ç»å¯¹çš„å…³ç³»ï¼Œæ¯”å¦‚æ•°æ®åº“çš„å¼‚æ­¥è°ƒç”¨ï¼Œé™¤äº†è¾“å…¥å¼‚å¸¸å¤–ï¼Œè¿˜æœ‰å¯èƒ½æ˜¯ç½‘ç»œå¼‚å¸¸ã€æƒé™å¼‚å¸¸ç­‰éè¾“å…¥æ•°æ®ç›¸å…³çš„æƒ…å†µï¼Œè¿™ç›¸å¯¹éš¾ä»¥æ¨¡æ‹Ÿã€‚ ä»¥ä¸‹é¢ä»£ç ä¸ºä¾‹ï¼Œæ–‡ä»¶ç³»ç»Ÿçš„å¼‚å¸¸æ—¶ç»å¯¹ä¸å®¹æ˜“å‘ˆç°çš„ï¼Œä¸ºäº†æµ‹è¯•ä»£ç çš„å¥å£®æ€§è€Œä¸“ç¨‹è°ƒèŠ‚ç£ç›˜ä¸Šçš„æƒé™ç­‰ï¼Œæˆæœ¬ç•¥é«˜ï¼š 1234567exports.getContent = function (filename) &#123; try &#123; return fs.readFileSync(filename, 'utf-8') &#125; catch (e) &#123; return '' &#125;&#125; ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬é€šè¿‡ä¼ªé€ fs.readFileSync()æ–¹æ³•æŠ›å‡ºé”™è¯¯æ¥è§¦å‘å¼‚å¸¸ã€‚åŒæ—¶ä¸ºäº†ä¿è¯è¯¥æµ‹è¯•ç”¨ä¾‹ä¸å½±å“å…¶ä½™ç”¨ä¾‹ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ‰§è¡Œå®Œåè¿˜åŸå®ƒã€‚ä¸ºæ­¤ï¼Œå‰é¢æåˆ°çš„before()å’Œafter()é’©å­å‡½æ•°æ´¾ä¸Šäº†ç”¨åœºï¼Œç›¸å…³ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516describe('getContent', function () &#123; var _readFileSync before(function () &#123; _readFileSync = fs.readFileSync fs.readFileSync = function (filename, encoding) &#123; throw new Error('mock readFileSync error') &#125; &#125;) // it() after(function () &#123; fs.readFileSync = _readFileSync &#125;)&#125;) æˆ‘ä»¬åœ¨æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹å‰å°†å¼•ç”¨æ›¿æ¢æ‰ï¼Œæ‰§è¡Œç»“æŸåè¿˜åŸå®ƒã€‚å¦‚æœæ¯ä¸ªæµ‹è¯•ç”¨ä¾‹æ‰§è¡Œå‰åéƒ½è¦è¿›è¡Œè®¾ç½®å’Œè¿˜åŸï¼Œå°±ä½¿ç”¨beforeEach()å’ŒafterEach()è¿™ä¸¤ä¸ªé’©å­å‡½æ•°ã€‚ ç”±äºmockçš„è¿‡ç¨‹æ¯”è¾ƒçƒ¦çï¼Œè¿™é‡Œæ¨èä¸€ä¸ªæ¨¡å—æ¥è§£å†³æ­¤äº‹â€”â€”mukï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314var fs = require('fs')var muk = require('muk')before(function () &#123; muk(fs. 'readFileSync', function (path, encoding) &#123; throw new Error('mock readFileSync error') &#125;)&#125;)// it()after(function () &#123; muk.restore()&#125;) å€¼å¾—æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå¯¹äºå¼‚æ­¥æ–¹æ³•çš„æ¨¡æ‹Ÿï¼Œéœ€è¦ååˆ†å°å¿ƒæ˜¯å¦å°†å¼‚æ­¥æ–¹æ³•æ¨¡æ‹Ÿä¸ºåŒæ­¥ 1234567891011// errorfs.readFile = function (filename, encoding, callback) &#123; callback(new Error('mock readFile error'))&#125;// goodfs.readFile = function (filename, encoding, callback) &#123; process.nextTick(function () &#123; callback(new Error('mock readFile error')) &#125;)&#125; ç§æœ‰æ–¹æ³•çš„æµ‹è¯• å¯¹äºNodeè€Œè¨€ï¼Œåˆä¸€ä¸ªéš¾ç‚¹ä¼šå‡ºç°åœ¨å•å…ƒæµ‹è¯•çš„è¿‡ç¨‹ä¸­ï¼Œé‚£å°±æ˜¯ç§æœ‰æ–¹æ³•çš„æµ‹è¯•ï¼Œè¿™åœ¨ç¬¬2ç« ä¸­ä»‹ç»è¿‡ã€‚åªæœ‰æŒ‚è½½åœ¨exportsæˆ–module.exportsä¸Šçš„å˜é‡æˆ–æ–¹æ³•æ‰å¯ä»¥è¢«å¤–éƒ¨é€šè¿‡requireå¼•å…¥è®¿é—®ï¼Œå…¶ä½™æ–¹æ³•åªèƒ½åœ¨æ¨¡å—å†…éƒ¨è¢«è°ƒç”¨å’Œè®¿é—®ã€‚ rewriteæ¨¡å—æä¾›äº†ä¸€ç§å·§å¦™çš„æ–¹å¼å®ç°å¯¹ç§æœ‰æ–¹æ³•çš„è®¿é—® 1234567891011// æºä»£ç var limit = function (num) &#123; return num &lt; 0 ? 0 : num&#125;// æµ‹è¯•ç”¨ä¾‹it('limit should return success', function () &#123; var lib = rewrite('../lib/index.js') var limit = lib.__get__('limit') litmit(10).should.be.equal(10)&#125;) rewriteçš„è¯€çªåœ¨äºå®ƒå¼•å…¥æ–‡ä»¶æ—¶ï¼Œåƒrequireä¸€æ ·å¯¹åŸå§‹æ–‡ä»¶åšäº†ä¸€å®šçš„æ‰‹è„šã€‚é™¤äº†æ·»åŠ (function(exports, require, module, filename, dirname){)å’Œ});çš„å¤´å°¾åŒ…è£…å¤–ï¼Œå®ƒè¿˜æ³¨å…¥äº†éƒ¨åˆ†ä»£ç ï¼Œå…·ä½“å¦‚ä¸‹æ‰€ç¤ºï¼š 12345678910(function (exports, require, module, __filename, __dirname) &#123; var method = function () &#123;&#125; exports.__set__ = function (name, value) &#123; eval(name ' = ' value.toString()) &#125; exports.__get__ = function (name) &#123; return eval(name) &#125;&#125;) æ¯ä¸€ä¸ªè¢«rewriteå¼•å…¥çš„æ¨¡å—éƒ½æœ‰set()å’Œget()æ–¹æ³•ã€‚å®ƒå·§å¦™åˆ©ç”¨äº†é—­åŒ…çš„è¯€çªï¼Œåœ¨eval()æ‰§è¡Œæ—¶ï¼Œå®ç°äº†å¯¹æ¨¡å—å†…éƒ¨å±€éƒ¨å˜é‡çš„è®¿é—®ï¼Œä»è€Œå¯ä»¥å°†å±€éƒ¨å˜é‡å¯¼å‡ºç»™æµ‹è¯•ç”¨ä¾‹è°ƒç”¨æ‰§è¡Œã€‚ å·¥ç¨‹åŒ–å’Œè‡ªåŠ¨åŒ– æ€§èƒ½æµ‹è¯• åŸºå‡†æµ‹è¯• åŸºå‡†æµ‹è¯•è¦ç»Ÿè®¡çš„å°±æ˜¯åœ¨å¤šå°‘æ—¶é—´å†…æ‰§è¡Œäº†å¤šå°‘æ¬¡æŸä¸ªæ–¹æ³•ã€‚ä¸ºäº†å¢å¼ºå¯æ¯”æ€§ï¼Œä¸€èˆ¬ä¼šä»¥æ¬¡æ•°ä½œä¸ºå‚ç…§ç‰©ï¼Œç„¶åæ¯”è¾ƒæ—¶é—´ï¼Œä»¥æ­¤æ¥åˆ¤åˆ«æ€§èƒ½çš„å·®è·ã€‚ è¿™é‡Œä»‹ç»benchmarkè¿™ä¸ªæ¨¡å—æ˜¯å¦‚ä½•ç»„ç»‡åŸºå‡†æµ‹è¯•çš„ï¼Œç›¸å…³ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819var Benchmark = require('benchmark')var suite = new Benchmark.Suite()var arr = [0, 1, 2, 3, 5, 6]suite.add('nativeMap', function () &#123; return arr.map(callback)&#125;).add('customMap', function () &#123; var ret = [] for (var i = 0; i &lt; arr.length; i++) &#123; ret.push(callback(arr[i])) &#125; return ret&#125;).on('cycle', function (event) &#123; console.log(String(evnet.target))&#125;).on('complete', function () &#123; console.log('Fastest is ' + this.fileter('fastest').pluck('name'))&#125;).run() å®ƒé€šè¿‡suiteæ¥ç»„ç»‡æ¯ç»„æµ‹è¯•ï¼Œåœ¨æµ‹è¯•å¥—ä»¶ä¸­è°ƒç”¨add()æ¥æ·»åŠ è¢«æµ‹è¯•çš„ä»£ç  æ‰§è¡Œä¸Šè¿°ä»£ç ï¼Œå¾—åˆ°çš„è¾“å‡ºç»“æœå¦‚ä¸‹ 123nativeMap x 1,227,341 ops/sec Â±1.99%(83 runs sampled)customMap x 7,919,649 ops/sec Â±0.57%(96 runs sampled)Fastest is customMap è´Ÿè½½æµ‹è¯• å‹åŠ›æµ‹è¯• é™¤äº†å¯ä»¥å¯¹åŸºæœ¬çš„æ–¹æ³•è¿›è¡ŒåŸºå‡†æµ‹è¯•å¤–ï¼Œé€šå¸¸è¿˜ä¼šå¯¹ç½‘ç»œæ¥å£è¿›è¡Œå‹åŠ›æµ‹è¯•ä»¥åˆ¤æ–­ç½‘ç»œæ¥å£çš„æ€§èƒ½ï¼Œè¿™åœ¨ç¬¬å…­ç« æ¼”ç¤ºè¿‡ã€‚å¯¹ç½‘ç»œæ¥å£åšå‹åŠ›æµ‹è¯•éœ€è¦è€ƒæŸ¥çš„å‡ ä¸ªæŒ‡æ ‡æœ‰ååç‡ã€å“åº”æ—¶é—´å’Œå¹¶å‘æ•°ï¼Œè¿™äº›æŒ‡æ ‡åæ˜ äº†æœåŠ¡å™¨çš„å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚ æœ€å¸¸ç”¨çš„å·¥å…·æ˜¯abã€siegeã€http_loadç­‰ åŸºå‡†æµ‹è¯•é©±åŠ¨å¼€å‘ æµ‹è¯•æ•°æ®ä¸ä¸šåŠ¡æ•°æ®çš„è½¬æ¢ å‡è®¾æŸä¸ªé¡µé¢æ¯å¤©çš„è®¿é—®é‡ä¸º100ä¸‡ã€‚æ ¹æ®å®é™…ä¸šåŠ¡æƒ…å†µï¼Œä¸»è¦è®¿é—®é‡å¤§è‡´é›†ä¸­åœ¨10ä¸ªå°æ—¶ä»¥å†…ï¼Œé‚£ä¹ˆæ¢ç®—å…¬å¼å°±æ˜¯ï¼š 1QPS = PV / 10h 100ä¸‡çš„ä¸šåŠ¡è®¿é—®é‡æ¢ç®—ä¸ºQPSï¼Œçº¦ç­‰äº27.7ï¼Œå³æœåŠ¡å™¨éœ€è¦æ¯ç§’å¤„ç†27.7ä¸ªè¯·æ±‚æ‰èƒ½èƒœä»»ä¸šåŠ¡é‡ ç¬¬åä¸€ç«  äº§å“åŒ– é¡¹ç›®å·¥ç¨‹åŒ– ç›®å½•ç»“æ„ æ„å»ºå·¥å…· ä»£ç å®¡æŸ¥ éƒ¨ç½²æµç¨‹ éƒ¨ç½²ç¯å¢ƒ éƒ¨ç½²æ“ä½œ æ€§èƒ½ åŠ¨é™åˆ†ç¦»ï¼šå°†åŠ¨æ€è¯·æ±‚å’Œé™æ€è¯·æ±‚åˆ†ç¦»ï¼Œä½¿æœåŠ¡å™¨ä¸“æ³¨åœ¨åŠ¨æ€æœåŠ¡æ–¹é¢ï¼Œä¸“ä¸šçš„CDNä¼šå°†é™æ€æ–‡ä»¶ä¸ç”¨æˆ·å°½å¯èƒ½é è¿‘ï¼ŒåŒæ—¶èƒ½å¤Ÿæœ‰æ›´ç²¾ç¡®å’Œé«˜æ•ˆçš„ç¼“å­˜æœºåˆ¶ã€‚ å¯ç”¨ç¼“å­˜ï¼šæå‡æ€§èƒ½å…¶å®å·®ä¸å¤šåªæœ‰ä¸¤ä¸ªé€”å¾„ï¼Œä¸€æ˜¯æå‡æœåŠ¡çš„é€Ÿåº¦ï¼ŒäºŒæ˜¯é¿å…ä¸å¿…è¦çš„è®¡ç®—ã€‚å‰è€…æå‡çš„æ€§èƒ½åœ¨æµ·é‡æµé‡é¢å‰ç»ˆæœ‰ç“¶é¢ˆï¼Œä½†åè€…å´èƒ½å¤Ÿåœ¨è®¿é—®é‡è¶Šå¤§æ—¶æ”¶ç›Šè¶Šå¤šã€‚é¿å…ä¸è¦çš„è®¡ç®—ï¼Œåº”ç”¨åœºæ™¯åšå¤šçš„å°±æ˜¯ç¼“å­˜ã€‚ å¤šè¿›ç¨‹æ¶æ„ï¼šé€šè¿‡å¤šè¿›ç¨‹æ¶æ„ï¼Œä¸ä»…å¯ä»¥å……åˆ†åˆ©ç”¨å¤šæ ¸CPUï¼Œæ›´æ˜¯å¯ä»¥å»ºç«‹æœºåˆ¶è®©Nodeè¿›ç¨‹æ›´åŠ å¥å£®ï¼Œï¼Œä»¥ä¿éšœWebåº”ç”¨æŒç»­æœåŠ¡ã€‚ è¯»å†™åˆ†ç¦»ï¼šé™¤äº†åŠ¨é™åˆ†ç¦»å¤–ï¼Œå¦ä¸€ä¸ªè¾ƒä¸ºé‡è¦çš„åˆ†ç¦»æ˜¯è¯»å†™åˆ†ç¦»ï¼Œè¿™ä¸»è¦é’ˆå¯¹æ•°æ®åº“è€Œè¨€ã€‚å°±ä»»æ„æ•°æ®åº“è€Œè¨€ï¼Œè¯»å–çš„é€Ÿåº¦è¿œè¿œé«˜äºå†™å…¥çš„é€Ÿåº¦ã€‚è€ŒæŸäº›æ•°æ®åº“åœ¨å†™å…¥æ—¶ä¸ºäº†ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œä¼šè¿›è¡Œé”è¡¨æ“ä½œï¼Œè¿™åŒæ—¶ä¼šå½±å“åˆ°è¯»å–çš„é€Ÿåº¦ã€‚æŸäº›ç³»ç»Ÿä¸ºäº†æå‡æ€§èƒ½ï¼Œé€šå¸¸ä¼šè¿›è¡Œæ•°æ®åº“çš„è¯»å†™åˆ†ç¦»ï¼Œå°†æ•°æ®åº“è¿›è¡Œä¸»ä»è®¾è®¡ï¼Œè¿™æ ·è¯»æ•°æ®æ“ä½œä¸å†å—åˆ°å†™å…¥çš„å½±å“ã€‚ æ—¥å¿— è®¿é—®æ—¥å¿—ï¼šä¸€èˆ¬ç”¨æ¥è®°å½•æ¯ä¸ªå®¢æˆ·ç«¯å¯¹åº”ç”¨çš„è®¿é—® å¼‚å¸¸æ—¥å¿—ï¼šé€šå¸¸ç”¨æ¥è®°å½•é‚£äº›æ„å¤–äº§ç”Ÿçš„å¼‚å¸¸é”™è¯¯ å¼‚å¸¸æ—¥å¿—é€šå¸¸æœ‰å®Œå–„çš„åˆ†çº§ï¼ŒNodeä¸­æä¾›consoleå¯¹è±¡å°±ç®€å•åœ°å®ç°äº†è¿™å‡ ç§åˆ’åˆ†ï¼Œå…·ä½“å¦‚ä¸‹æ‰€ç¤ºï¼š console.logï¼šæ™®é€šæ—¥å¿— console.infoï¼šæ™®é€šä¿¡æ¯ console.warnï¼šè­¦å‘Šä¿¡æ¯ console.errorï¼šé”™è¯¯ä¿¡æ¯consoleæ¨¡å—åœ¨å…·ä½“å®ç°æ—¶ï¼Œlogä¸infoæ–¹æ³•éƒ½å°†ä¿¡æ¯è¾“å‡ºç»™æ ‡å‡†è¾“å‡ºprocess.stdoutï¼Œwarnä¸erroræ–¹æ³•åˆ™å°†ä¿¡æ¯è¾“å‡ºåˆ°æ ‡å‡†é”™è¯¯process.stderrï¼Œè€Œinfoå’Œerroråˆ†åˆ«æ˜¯logå’Œwarnçš„åˆ«åã€‚ä¸‹é¢ä¸ºå®ƒä»¬çš„å®ç°ä»£ç ï¼š 1234567891011Console.prototype.log = function () &#123; this._stdout.write(util.format.apply(this, arguments) + '\\n')&#125;Console.prototype.info = Console.prototype.logConsole.prototype.warn = function () &#123; this._stderr.write(util.format.apply(this, arguments) + '\\n')&#125;Console.prototype.error = Console.prototype.warn consoleå¯¹è±¡ä¸Šå…·æœ‰ä¸€ä¸ªConsoleå±æ€§ï¼Œå®ƒæ˜¯consoleå¯¹è±¡çš„æ„é€ å‡½æ•°ã€‚å€ŸåŠ©è¿™ä¸ªæ„é€ å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°è‡ªå·±çš„æ—¥å¿—å¯¹è±¡ï¼Œç›¸å…³ä»£ç å¦‚ä¸‹ï¼š 1234var info = fs.createWriteStream(logdir + '/info.log', &#123;flags: 'a', mode: '0666'&#125;)var error = fs.createWriteStream(logdir + '/error.log', &#123;flags: 'a', mode: '0666'&#125;)var logger = new console.Console(info, error) åˆ†åˆ«è°ƒç”¨å®ƒçš„APIï¼Œæ—¥å¿—å†…å®¹å°±èƒ½å„è‡ªå†™å…¥åˆ°å¯¹åº”çš„æ–‡ä»¶ä¸­ï¼Œç›¸å…³ä»£ç å¦‚ä¸‹ï¼š 12logger.log('Hello world!')logger.error('segment fault') æœ‰äº†è®°å½•ä¿¡æ¯çš„æ—¥å¿—APIåï¼Œå¼€å‘è€…éœ€è¦å…³å¿ƒçš„æ˜¯è¦å°å¿ƒæ•è·æ¯ä¸€ä¸ªå¼‚å¸¸ï¼Œåœ¨ç¬¬å››ç« ä¸­ï¼Œæˆ‘ä»¬æåˆ°å¼‚æ­¥è°ƒç”¨ä¸­å›è°ƒå‡½æ•°é‡Œçš„å¼‚å¸¸æ— æ³•è¢«å¤–éƒ¨æ•è·çš„é—®é¢˜ï¼Œä¹Ÿæåˆ°äº†å¼‚æ­¥APIç¼–å†™çš„è§„èŒƒï¼Œæ¯ä¸ªå¼€å‘è€…åº”å½“å°†APIå†…éƒ¨å‘ç”Ÿçš„å¼‚å¸¸ä½œä¸ºç¬¬ä¸€ä¸ªå®å‚ä¼ é€’ç»™å›è°ƒå‡½æ•°ã€‚å¯¹äºå›è°ƒå‡½æ•°äº§ç”Ÿçš„å¼‚å¸¸ï¼Œåˆ™å¯ä»¥ä¸ç”¨è¿‡é—®ï¼Œäº¤ç»™å…¨å±€çš„uncaughtExceptionäº‹ä»¶å»æ•è·å³å¯ã€‚ åœ¨é€å±‚æ¬¡çš„å¼‚æ­¥APIè°ƒç”¨ä¸­ï¼Œå¼‚å¸¸æ˜¯è¯¥ä¼ é€’ç»™è°ƒç”¨æ–¹è¿˜æ˜¯ç«‹å³é€šè¿‡æ—¥å¿—è®°å½•ï¼Œè¿™æ˜¯ä¸€ä¸ªéœ€è¦æ³¨æ„çš„é—®é¢˜ã€‚å°±é€šå¸¸çš„APIç¼–å†™è€Œè¨€ï¼Œå°½é‡ä¸è¦éšè—é”™è¯¯ï¼Œä¸è¦é€šè¿‡try/catchå—å°†å¼‚å¸¸æ•è·ï¼Œç„¶åéšè—èµ·æ¥ä¸å‘å¤–éƒ¨è°ƒç”¨è€…æš´éœ²ã€‚è¿™å¯¹äºåº•å±‚APIçš„è®¾è®¡è€Œè¨€ï¼Œå°¤ä¸ºé‡è¦ã€‚äº‹å®ä¸Šï¼Œæ—¥å¿—é€šå¸¸æ˜¯æœåŠ¡äºä¸šåŠ¡çš„ã€‚å»ºè®®å¼‚å¸¸å°½é‡ç”±ä¸Šå±‚çš„è°ƒç”¨è€…æ•è·è®°å½•ï¼Œåº•å±‚è°ƒç”¨æˆ–ä¸­é—´å±‚è°ƒç”¨ä¸­å‡ºç°çš„å¼‚å¸¸åªè¦æ­£å¸¸ä¼ é€’ç»™ä¸Šå±‚çš„è°ƒç”¨æ–¹å³å¯ã€‚ æ—¥å¿—ä¸æ•°æ®åº“ æœ‰çš„å¼€å‘è€…å¯¹æ—¥å¿—å¯èƒ½ä¸å¤ªäº†è§£ï¼Œä¼šé€‰æ‹©å°†ä¸€äº›æ—¥å¿—å†™å…¥åˆ°æ•°æ®åº“ä¸­ã€‚æ•°æ®åº“æ¯”æ—¥å¿—æ–‡ä»¶å¥½çš„åœ°æ–¹åœ¨äºå®ƒæ˜¯ç»“æ„åŒ–æ•°æ®ï¼Œå¯ä»¥ç›´æ¥ç¼–å†™SQLè¯­å¥è¿›è¡Œåˆ†æï¼Œæ—¥å¿—æ–‡ä»¶åˆ™éœ€è¦å†åŠ å·¥ä¹‹åæ‰èƒ½åˆ†æã€‚ä½†æ˜¯æ—¥å¿—æ–‡ä»¶ä¸æ•°æ®åº“å†™å…¥åœ¨æ€§èƒ½ä¸Šå¤„äºä¸¤ä¸ªçº§åˆ«ï¼Œæ•°æ®åº“åœ¨å†™å…¥è¿‡ç¨‹ä¸­è¦ç»å†ä¸€ç³»åˆ—å¤„ç†ï¼Œæ¯”å¦‚é”è¡¨ã€æ—¥å¿—ç­‰æ“ä½œã€‚å†™æ—¥å¿—æ–‡ä»¶åˆ™æ˜¯ç›´æ¥å°†æ•°æ®å†™åˆ°ç£ç›˜ä¸Šã€‚ä¸ºæ­¤ï¼Œå¦‚æœæœ‰å¤§é‡çš„è®¿é—®ï¼Œå¯èƒ½ä¼šå­˜åœ¨å†™å…¥æ“ä½œå¤§é‡æ’é˜Ÿçš„çŠ¶å†µï¼Œæ•°æ®åº“çš„æ¶ˆè´¹é€Ÿåº¦ä¸¥é‡ä½äºç”Ÿäº§é€Ÿåº¦ï¼Œè¿›è€Œå¯¼è‡´å†…å­˜æ³„æ¼ç­‰ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œå†™æ—¥å¿—æ˜¯è½»é‡çš„æ–¹æ³•ï¼Œå°†æ—¥å¿—åˆ†æå’Œæ—¥å¿—è®°å½•è¿™ä¸¤ä¸ªæ­¥éª¤åˆ†ç¦»å¼€æ¥æ˜¯è¾ƒå¥½çš„é€‰æ‹©ã€‚æ—¥å¿—è®°å½•å¯ä»¥åœ¨çº¿å†™ï¼Œæ—¥å¿—åˆ†æåˆ™å¯ä»¥å€ŸåŠ©ä¸€äº›å·¥å…·åŒæ­¥åˆ°æ•°æ®åº“ä¸­ï¼Œé€šè¿‡ç¦»çº¿åˆ†æçš„æ–¹å¼åé¦ˆå‡ºæ¥ã€‚ åˆ†å‰²æ—¥å¿—ï¼šå°†äº§ç”Ÿçš„æ—¥å¿—æŒ‰æ—¥æœŸåˆ†å‰² ç›‘æ§æŠ¥è­¦ åº”ç”¨çš„ç›‘æ§ä¸»è¦æœ‰ä¸¤ç±»ï¼Œä¸€ç§æ˜¯ä¸šåŠ¡é€»è¾‘å‹çš„ç›‘æ§ï¼Œä¸€ç§æ˜¯ç¡¬ä»¶å‹çš„ç›‘æ§ã€‚ç›‘æ§ä¸»è¦é€šè¿‡å®šæ—¶é‡‡æ ·æ¥è¿›è¡Œè®°å½•ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜è¦å¯¹ç›‘æ§çš„ä¿¡æ¯è®¾ç½®ä¸Šé™ï¼Œä¸€æ—¦å‡ºç°å¤§çš„æ³¢åŠ¨ï¼Œå°±éœ€è¦å‘å‡ºè­¦æŠ¥æé†’å¼€å‘è€…ã€‚ä¸ºäº†è¾ƒå¥½åœ°ä¾›å¼€å‘è€…ä½¿ç”¨ï¼Œç›‘æ§åˆ°çš„ä¿¡æ¯ä¸€èˆ¬è¿˜è¦é€šè¿‡æ•°æ®å¯è§†åŒ–çš„æ–¹å¼åæ˜ å‡ºæ¥ï¼Œä»¥ä¾¿æ›´ç›´è§‚åœ°æŸ¥çœ‹ã€‚ ç›‘æ§ æ—¥å¿—ç›‘æ§ï¼šé€šè¿‡ç›‘æ§å¼‚å¸¸æ—¥å¿—æ–‡ä»¶çš„å˜åŠ¨ï¼Œå°†æ–°å¢çš„å¼‚å¸¸æŒ‰å¼‚å¸¸ç±»å‹å’Œæ•°é‡åæ˜ å‡ºæ¥ï¼›å¯¹äºè®¿é—®æ—¥å¿—çš„ç›‘æ§ä¹Ÿèƒ½ä½“ç°å‡ºå®é™…çš„ä¸šåŠ¡QPSå€¼ã€‚è§‚å¯ŸQPSçš„è¡¨ç°èƒ½å¤Ÿæ£€æŸ¥ä¸šåŠ¡åœ¨æ—¶é—´ä¸Šçš„åˆ†å¸ƒã€‚æ­¤å¤–ï¼Œä»è®¿é—®æ—¥å¿—ä¸­ä¹Ÿèƒ½å®ç°PVå’ŒUVçš„ç›‘æ§ã€‚åŒQPSå€¼ä¸€æ ·ï¼Œé€šè¿‡å¯¹PV/UVçš„ç›‘æ§ï¼Œå¯ä»¥å¾ˆå¥½åœ°çŸ¥é“åº”ç”¨çš„ä½¿ç”¨è€…ä»¬çš„ä¹ æƒ¯ã€é¢„çŸ¥è®¿é—®é«˜å³°ç­‰ã€‚ å“åº”æ—¶é—´ï¼šå“åº”æ—¶é—´ä¹Ÿæ˜¯ä¸€ä¸ªéœ€è¦ç›‘æ§çš„ç‚¹ã€‚ä¸€æ—¦ç³»ç»Ÿçš„æŸä¸ªå­ç³»ç»Ÿå‡ºç°å¼‚å¸¸æˆ–è€…æ€§èƒ½ç“¶é¢ˆï¼Œå°†ä¼šå¯¼è‡´ç³»ç»Ÿçš„å“åº”æ—¶é—´å˜é•¿ã€‚å“åº”æ—¶é—´å¯ä»¥åœ¨Nginxä¸€ç±»çš„åå‘ä»£ç†ä¸Šç›‘æ§ï¼Œä¹Ÿå¯ä»¥é€šè¿‡åº”ç”¨è‡ªè¡Œäº§ç”Ÿçš„è®¿é—®æ—¥å¿—æ¥ç›‘æ§ã€‚ è¿›ç¨‹ç›‘æ§ï¼šç›‘æ§è¿›ç¨‹ä¸€èˆ¬æ˜¯æ£€æŸ¥æ“ä½œç³»ç»Ÿä¸­è¿è¡Œçš„åº”ç”¨è¿›ç¨‹æ•°ï¼Œæ¯”å¦‚å¯¹äºé‡‡ç”¨å¤šè¿›ç¨‹æ¶æ„çš„Webåº”ç”¨ï¼Œå°±éœ€è¦æ£€æŸ¥å·¥ä½œè¿›ç¨‹çš„æ•°é‡ï¼Œå¦‚æœä½äºé¢„ä¼°å€¼ï¼Œå°±åº”å½“å‘å‡ºæŠ¥è­¦å£°ã€‚ ç£ç›˜ç›‘æ§ï¼šç£ç›˜ç›‘æ§ä¸»è¦æ˜¯ç›‘æ§ç£ç›˜çš„ç”¨é‡ã€‚ç”±äºæ—¥å¿—é¢‘ç¹å†™çš„ç¼˜æ•…ï¼Œç£ç›˜ç©ºé—´æ¸æ¸è¢«ç”¨å…‰ã€‚ä¸€æ—¦ç£ç›˜ä¸å¤Ÿç”¨ï¼Œå°†ä¼šå¼•å‘ç³»ç»Ÿçš„å„ç§é—®é¢˜ã€‚ç»™ç£ç›˜çš„ä½¿ç”¨é‡è®¾ç½®ä¸€ä¸ªä¸Šé™ï¼Œä¸€æ—¦ç£ç›˜ç”¨é‡è¶…è¿‡è­¦æˆ’å€¼ï¼ŒæœåŠ¡å™¨çš„ç®¡ç†è€…å°±åº”è¯¥æ•´ç†æ—¥å¿—æˆ–æ¸…ç†ç£ç›˜äº†ã€‚ å†…å­˜ç›‘æ§ï¼šç›‘æ§æœåŠ¡å™¨çš„å†…å­˜ä½¿ç”¨çŠ¶å†µï¼Œå¯ä»¥æ£€æŸ¥åº”ç”¨ä¸­æ˜¯å¦å­˜åœ¨å†…å­˜æ³„æ¼çš„çŠ¶å†µã€‚å¦‚æœå†…å­˜åªå‡ä¸é™ï¼Œé‚£ä¹ˆé“å®šå­˜åœ¨å†…å­˜æ³„æ¼é—®é¢˜ã€‚å¥åº·çš„å†…å­˜ä½¿ç”¨åº”å½“æ˜¯æœ‰å‡æœ‰é™ï¼Œåœ¨è®¿é—®é‡å¤§çš„æ—¶å€™ä¸Šå‡ï¼Œåœ¨è®¿é—®é‡å›è½çš„æ—¶å€™ï¼Œå ç”¨é‡ä¹Ÿéšä¹‹å›è½ã€‚ CPUå ç”¨ç›‘æ§ï¼šCPUçš„ä½¿ç”¨åˆ†ä¸ºç”¨æˆ·æ€ã€å†…æ ¸æ€ã€IOWaitç­‰ã€‚å¦‚æœç”¨æˆ·æ€CPUä½¿ç”¨ç‡è¾ƒé«˜ï¼Œè¯´æ˜æœåŠ¡å™¨ä¸Šçš„åº”ç”¨éœ€è¦å¤§é‡çš„CPUå¼€é”€ï¼›å¦‚æœå†…æ ¸æ€CPUä½¿ç”¨ç‡è¾ƒé«˜ï¼Œè¯´æ˜æœåŠ¡å™¨èŠ±è´¹å¤§é‡æ—¶é—´è¿›è¡Œè¿›ç¨‹è°ƒåº¦æˆ–è€…ç³»ç»Ÿè°ƒç”¨ï¼›IOWaitä½¿ç”¨ç‡åˆ™ååº”çš„æ˜¯CPUç­‰å¾…ç£ç›˜I/Oæ“ä½œã€‚ CPU loadç›‘æ§ï¼šCPU loadåˆç§°CPUå¹³å‡è´Ÿè½½ï¼Œå®ƒç”¨æ¥æè¿°æ“ä½œç³»ç»Ÿå½“å‰çš„ç¹å¿™ç¨‹åº¦ï¼Œå¯ä»¥ç®€å•åœ°ç†è§£ä¸ºCPUåœ¨å•ä½æ—¶é—´å†…æ­£åœ¨ä½¿ç”¨å’Œç­‰å¾…ä½¿ç”¨CPUçš„å¹³å‡ä»»åŠ¡æ•°ã€‚å®ƒæœ‰3ä¸ªæŒ‡æ ‡ï¼Œå³1åˆ†é’Ÿçš„å¹³å‡è´Ÿè½½ã€5åˆ†é’Ÿçš„å¹³å‡è´Ÿè½½ã€15åˆ†é’Ÿçš„å¹³å‡è´Ÿè½½ã€‚CPU loadè¿‡é«˜è¯´æ˜è¿›ç¨‹æ•°é‡è¿‡å¤šï¼Œè¿™åœ¨Nodeä¸­å¯èƒ½ä½“ç°åœ¨ç”¨å­è¿›ç¨‹æ¨¡å—åå¤å¯åŠ¨æ–°çš„è¿›ç¨‹ã€‚ I/Oè´Ÿè½½ï¼šI/Oè´Ÿè½½æŒ‡çš„ä¸»è¦æ˜¯ç£ç›˜I/Oã€‚ååº”çš„æ˜¯ç£ç›˜ä¸Šçš„è¯»å†™æƒ…å†µï¼Œå¯¹äºNodeç¼–å†™çš„åº”ç”¨ï¼Œä¸»è¦æ˜¯é¢å‘ç½‘ç»œæœåŠ¡ï¼Œæ˜¯æ•…ä¸å¤ªå¯èƒ½å‡ºç°I/Oè´Ÿè½½è¿‡é«˜çš„æƒ…å†µï¼Œå¤§å¤šæ•°çš„I/Oå‹åŠ›æ¥è‡ªäºæ•°æ®åº“ã€‚ ç½‘ç»œç›‘æ§ï¼šè™½ç„¶ç½‘ç»œæµé‡ç›‘æ§çš„ä¼˜å…ˆçº§æ²¡æœ‰ä¸Šè¯‰é¡¹ç›®é‚£ä¹ˆé«˜ï¼Œä½†è¿˜æ˜¯éœ€è¦å¯¹æµé‡è¿›è¡Œç›‘æ§å¹¶è®¾ç½®ä¸Šé™å€¼ã€‚å³ä¾¿åº”ç”¨çªç„¶å—åˆ°ç”¨æˆ·çš„é’çï¼Œæµé‡æš´æ¶¨æ—¶ä¹Ÿèƒ½é€šè¿‡æ•°å€¼æ„ŸçŸ¥åˆ°ç½‘ç«™çš„å®£ä¼ æ˜¯å¦æœ‰æ•ˆã€‚ä¸€æ—¦æµé‡è¶…è¿‡è­¦æˆ’å€¼ï¼Œå¼€å‘è€…å°±åº”å½“æ‰¾å‡ºæµé‡å¢é•¿çš„åŸå› ã€‚å¯¹äºæ­£å¸¸å¢é•¿ï¼Œåº”å½“è¯„ä¼°æ˜¯å¦è¯¥å¢åŠ ç¡¬ä»¶è®¾å¤‡æ¥ä¸ºæ›´å¤šç”¨æˆ·æä¾›æœåŠ¡ã€‚ç½‘è·¯æµé‡ç›‘æ§çš„ä¸¤ä¸ªä¸»è¦æŒ‡æ ‡æ˜¯æµå…¥æµé‡å’Œæµå‡ºæµé‡ã€‚ åº”ç”¨çŠ¶æ€ç›‘æ§ï¼šé™¤äº†è¿™äº›ç¡¬æ€§éœ€è¦æ£€æµ‹çš„æŒ‡æ ‡å¤–ï¼Œåº”ç”¨è¿˜åº”å½“æä¾›ä¸€ç§æœºåˆ¶æ¥åé¦ˆå…¶è‡ªèº«çš„çŠ¶æ€ä¿¡æ¯ï¼Œå¤–éƒ¨ç›‘æ§å°†ä¼šæŒç»­åœ°è°ƒç”¨åº”ç”¨çš„åé¦ˆæ¥å£æ¥æ£€æŸ¥å®ƒçš„å¥åº·çŠ¶æ€ã€‚æœ€ç®€å•çš„çŠ¶æ€åé¦ˆå°±æ˜¯ç»™ç›‘æ§å“åº”ä¸€ä¸ªæ—¶é—´æˆ³ï¼Œç›‘æ§æ–¹æ£€æŸ¥æ—¶é—´æˆ³æ˜¯å¦æ­£å¸¸å³å¯ã€‚å¥å£®ä¸€äº›çš„çŠ¶æ€å“åº”åˆ™æ˜¯å°†åº”ç”¨çš„ä¾èµ–é¡¹çš„çŠ¶æ€æ‰“å°å‡ºæ¥ï¼Œå¦‚æ•°æ®åº“è¿æ¥æ˜¯å¦æ­£å¸¸ã€ç¼“å­˜æ˜¯å¦æ­£å¸¸ç­‰ã€‚ DNSç›‘æ§ï¼šDNSæ˜¯ç½‘ç»œåº”ç”¨çš„åŸºç¡€ï¼Œåœ¨å®é™…çš„å¯¹å¤–æœåŠ¡çš„äº§å“ä¸­ï¼Œå¤šæ•°éƒ½å¯¹åŸŸåæœ‰ä¾èµ–ã€‚DNSæ•…éšœå¯¼è‡´äº§å“å‡ºç°å¤§é¢ç§¯å½±å“çš„äº‹ä»¶å¹¶ä¸å°‘è§ã€‚ç”±äºDNSæœåŠ¡é€šå¸¸æ˜¯ç¨³å®šçš„ï¼Œå®¹æ˜“è®©äººå¿½ç•¥ï¼Œä½†ä¸€æ—¦å‡ºç°æ•…éšœï¼Œå°±å¯èƒ½æ˜¯å²æ— å‰ä¾‹çš„æ•…éšœã€‚å¯¹äºäº§å“çš„ç¨³å®šæ€§ï¼ŒåŸŸåDNSçŠ¶æ€ä¹Ÿéœ€è¦åŠ å…¥ç›‘æ§ã€‚ç›®å‰å›½å†…æœ‰ä¸€äº›å…è´¹çš„DNSç›‘æ§æœåŠ¡ï¼Œå¦‚DNSPodç­‰ï¼Œå¯ä»¥é€šè¿‡è¿™äº›ç›‘æ§æœåŠ¡ï¼Œç›‘æ§è‡ªå·±çš„åœ¨çº¿åº”ç”¨ã€‚ æŠ¥è­¦ é‚®ä»¶æŠ¥è­¦ï¼šå¯ä»¥è°ƒç”¨nodemaileræ¨¡å—æ¥å®ç°é‚®ä»¶çš„å‘é€ çŸ­ä¿¡æˆ–ç”µè¯æŠ¥è­¦ï¼š ç¨³å®šæ€§ å¤šæœºå™¨ï¼šå¤šæœºå™¨éƒ¨ç½²åº”ç”¨å¸¦æ¥çš„å¥½å¤„æ˜¯èƒ½åˆ©ç”¨æ›´å¤šçš„ç¡¬ä»¶èµ„æºï¼Œä¸ºæ›´å¤šçš„è¯·æ±‚æœåŠ¡ã€‚åŒæ—¶èƒ½å¤Ÿåœ¨æœ‰æ•…éšœæ—¶ï¼Œç»§ç»­æœåŠ¡ç”¨æˆ·è¯·æ±‚ï¼Œä¿è¯æ•´ä½“ç³»ç»Ÿçš„é«˜å¯ç”¨æ€§ã€‚ä½†æ˜¯ä¸€æ—¦å‡ºç°åˆ†å¸ƒå¼ï¼Œå°±éœ€è¦è€ƒè™‘è´Ÿè½½å‡è¡¡ã€çŠ¶æ€å…±äº«å’Œæ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚ å¤šæœºæˆ¿ï¼šå¤šæœºæˆ¿éƒ¨ç½²æ˜¯æ¯”å¤šæœºå™¨éƒ¨ç½²æ›´é«˜å±‚æ¬¡çš„éƒ¨ç½²ï¼Œç›®çš„æ˜¯ä¸ºäº†è§£å†³åœ°ç†ä½ç½®ç»™ç”¨æˆ·è®¿é—®å¸¦æ¥çš„å»¶è¿Ÿé—®é¢˜ã€‚åœ¨å®¹ç¾æ–¹é¢ï¼Œæœºæˆ¿ä¸æœºæˆ¿ä¹‹é—´å¯ä»¥äº’ç›¸å¤‡ä»½ã€‚ç”±äºæœºæˆ¿ä¸æœºæˆ¿ä¹‹é—´çš„ç½‘ç»œå¤æ‚åº¦å†åº¦æå‡ï¼Œè´Ÿè½½å‡è¡¡æ–¹é¢éœ€è¦è¿›ä¸€æ­¥å»ç»Ÿç­¹è§„åˆ’ã€‚ å®¹ç¾å¤‡ä»½ï¼šåœ¨å¤šæœºæˆ¿å’Œå¤šæœºå™¨çš„éƒ¨ç½²ç»“æ„ä¸‹ï¼Œååˆ†å®¹æ˜“é€šè¿‡å¤‡ä»½çš„æ–¹å¼è¿›è¡Œå®¹ç¾ï¼Œä»»ä½•ä¸€å°æœºå™¨æˆ–è€…ä¸€ä¸ªæœºæˆ¿åœæ­¢äº†æœåŠ¡ï¼Œéƒ½èƒ½æœ‰å…¶ä½™çš„æœåŠ¡å™¨æ¥æ¥æ›¿æ–°çš„ä»»åŠ¡ã€‚ å¼‚æ„å…±å­˜","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"http://yoursite.com/categories/ç¼–ç¨‹è¯­è¨€/"},{"name":"NodeJs","slug":"ç¼–ç¨‹è¯­è¨€/NodeJs","permalink":"http://yoursite.com/categories/ç¼–ç¨‹è¯­è¨€/NodeJs/"}],"tags":[{"name":"NodeJs","slug":"NodeJs","permalink":"http://yoursite.com/tags/NodeJs/"},{"name":"æ·±å…¥æµ…å‡ºNodeJs","slug":"æ·±å…¥æµ…å‡ºNodeJs","permalink":"http://yoursite.com/tags/æ·±å…¥æµ…å‡ºNodeJs/"}]},{"title":"TypeScript è¯­æ³•","slug":"typescript","date":"2019-02-12T02:27:23.000Z","updated":"2019-03-08T09:43:05.935Z","comments":true,"path":"2019/02/12/typescript.html","link":"","permalink":"http://yoursite.com/2019/02/12/typescript.html","excerpt":"","text":"ç®€ä»‹TypeScriptæ˜¯ä»€ä¹ˆèƒŒæ™¯TypeScriptæ˜¯å¾®è½¯å¼€å‘çš„ä¸€æ¬¾å¼€æºçš„ç¼–ç¨‹è¯­è¨€ï¼Œæœ¬è´¨ä¸Šæ˜¯å‘JavaScriptå¢åŠ é™æ€ç±»å‹ç³»ç»Ÿã€‚å®ƒæ˜¯JavaScriptçš„è¶…é›†ï¼Œæ‰€æœ‰ç°æœ‰çš„JavaScriptéƒ½å¯ä»¥ä¸åŠ æ”¹å˜å°±åœ¨å…¶ä¸­ä½¿ç”¨ã€‚å®ƒæ˜¯ä¸ºå¤§å‹è½¯ä»¶å¼€å‘è€Œè®¾è®¡çš„ï¼Œæœ€ç»ˆç¼–è¯‘äº§ç”ŸJavaScriptï¼Œæ‰€ä»¥å¯ä»¥è¿è¡Œåœ¨æµè§ˆå™¨ã€Node.jsç­‰ç­‰çš„è¿è¡Œæ—¶ç¯å¢ƒã€‚ ä»€ä¹ˆæ˜¯ç±»å‹ç³»ç»Ÿä¸‹é¢æ˜¯æ‘˜è‡ªã€ŠTypes And Programming Languagesã€‹ä¸­çš„å®šä¹‰ï¼š A type system is a tractable syntactic method for proving the absence of certain program behaviors by classifying phrases according to the kinds of values they compute. ç¬¬ä¸€ä¸ªé‡ç‚¹æ˜¯Proving the absence of certain program behaviorsï¼Œæ‰€ä»¥æˆ‘ä»¬äº¦å¯å°†ç±»å‹æ£€æŸ¥å™¨çœ‹åšä¸€ä¸ªç¨‹åºæ¨ç†å·¥å…·ï¼Œå¯ä»¥é™æ€çš„è¯æ˜ç¨‹åºæˆç«‹ã€‚ å¦ä¸€ä¸ªé‡ç‚¹æ˜¯Classifying phrases according to the kinds of values they computeï¼Œå¯¹è¯è¯­ï¼ˆæ¯”å¦‚å˜é‡ï¼‰çš„å€¼å¾—æ€§è´¨è¿›è¡Œåˆ†ç±»ï¼Œæ¯”å¦‚è¯´TypeScriptä¸­çš„Interfaceã€Classç­‰ã€‚ é™æ€ç±»å‹ç³»ç»Ÿæ˜¯ä»€ä¹ˆå¢åŠ é™æ€è¿™ä¸ªå®šè¯­ï¼Œæ˜¯ä¸ºäº†å’Œè¿è¡Œæ—¶çš„ç±»å‹æ£€æŸ¥æœºåˆ¶åŠ ä»¥åŒºåˆ†ï¼Œå¼ºè°ƒé™æ€ç±»å‹ç³»ç»Ÿæ˜¯åœ¨ç¼–è¯‘æ—¶è¿›è¡Œç±»å‹åˆ†æã€‚ TypeScriptå’ŒJavaScriptçš„å…³ç³»å’Œä¸€äº›åŸºäºJavaScriptçš„æ¿€è¿›è¯­è¨€ä¸åŒï¼ˆæ¯”å¦‚CoffeScriptï¼‰ï¼ŒTypeScriptçš„è¯­æ³•è®¾è®¡é¦–å…ˆè€ƒè™‘çš„å°±æ˜¯å…¼å®¹JavaScriptï¼Œæˆ–è€…è¯´å¯¹JavaScriptçš„è¯­æ³•åšæ‰©å±•ã€‚åŸºæœ¬ä¸Šæ˜¯åœ¨JavaScriptçš„åŸºç¡€ä¸Šå¢åŠ äº†ä¸€äº›ç±»å‹æ ‡è®°è¯­æ³•ï¼Œä»¥å®ç°é™æ€ç±»å‹åˆ†æã€‚æŠŠè¿™äº›ç±»å‹æ ‡æ³¨è¯­æ³•å»æ‰ä¹‹åï¼Œä»æ˜¯ä¸€ä¸ªæ ‡å‡†çš„JavaScriptè¯­è¨€ã€‚ ä¸ºä»€ä¹ˆè¦ä½¿ç”¨TypeScript æé«˜ä»£ç è´¨é‡ï¼Œé™ä½bugç‡ï¼Œéšå¼ç±»å‹è½¬æ¢å¸¦æ¥å¤§é‡ä¸å¯é¢„çŸ¥çš„ç±»å‹é”™è¯¯ é™æ€ç±»å‹æ£€æµ‹ï¼Œå‡å°‘ç¼–è¯‘é˜¶æ®µå¼•èµ·çš„é”™è¯¯ æ¨¡å—åŒ–ï¼Œes6å·²æ”¯æŒ è®©ä»£ç æ›´åŠ æ¸…æ™°æ˜“è¯» è¯­æ³•ç³–()=&gt;ï¼Œæ¥å£ï¼Œæšä¸¾ï¼Œæ³›å‹ï¼Œæ–¹æ³•é‡è½½ TypeScript è¯­æ³•ä»‹ç»åŸºç¡€ç±»å‹ å¸ƒå°”å€¼ï¼ˆBooleanï¼‰ 1let isDone: boolean = false æ•°å­—ï¼ˆNumberï¼‰ 1234let decLiteral: number = 6let hexLiteral: number = 0xf00dlet binaryLiteral: number = 0b1010let octalLiteral: number = 0o744 å­—ç¬¦ä¸²ï¼ˆStringï¼‰ 1let name: string = 'bob' æ•°ç»„ï¼ˆArrayï¼‰ 12345// åœ¨å…ƒç´ ç±»å‹åé¢æ¥ä¸Š []ï¼Œè¡¨ç¤ºç”±æ­¤ç±»å‹å…ƒç´ ç»„æˆçš„ä¸€ä¸ªæ•°ç»„let list: number[] = [1, 2, 3]// æ•°ç»„æ³›å‹ï¼ŒArray&lt;å…ƒç´ ç±»å‹&gt;let list: Array&lt;number&gt; = [1, 2, 3] å…ƒç»„ï¼ˆTupleï¼‰ï¼šå…ƒç»„ç±»å‹å…è®¸è¡¨ç¤ºä¸€ä¸ªå·²çŸ¥å…ƒç´ æ•°é‡å’Œç±»å‹çš„æ•°ç»„ï¼Œå„å…ƒç´ çš„ç±»å‹ä¸å¿…ç›¸åŒ 123let x: [string, number]x = ['hello', 10] // OKx = [10, 'hello'] // Error æšä¸¾ï¼ˆEnumï¼‰ 123enum Color &#123; Red = 2, Green, Blue &#125;let c: Color = Color.Green // 3let colorName: string = Color[2] // 'Red' Anyï¼šå…è®¸ä½ åœ¨ç¼–è¯‘æ—¶å¯é€‰æ‹©åœ°åŒ…å«æˆ–ç§»é™¤ç±»å‹æ£€æŸ¥ï¼Œä¸Objectçš„åŒºåˆ«åœ¨äºï¼ŒObjectç±»å‹çš„å˜é‡åªæ˜¯å…è®¸ä½ ç»™å®ƒèµ‹ä»»æ„å€¼ï¼Œä½†æ˜¯å´ä¸èƒ½å¤Ÿåœ¨å®ƒä¸Šé¢è°ƒç”¨ä»»æ„çš„æ–¹æ³• 123456let notSure: any = 4notSure.ifItExits() // OKnotSure.toFixed() // OKlet prettySure: Object = 4prettySure.toFixed() // Error Voidï¼šå£°æ˜ä¸€ä¸ªvoidç±»å‹çš„å˜é‡ï¼Œåªèƒ½èµ‹å€¼ä¸ºundefinedå’Œnull Nullå’ŒUndefinedï¼šé»˜è®¤æƒ…å†µä¸‹nullå’Œundefinedæ˜¯æ‰€æœ‰ç±»å‹çš„å­ç±»å‹ã€‚å°±æ˜¯è¯´ä½ å¯ä»¥æŠŠnullå’Œundefinedèµ‹å€¼ç»™numberç±»å‹çš„å˜é‡ã€‚ç„¶è€Œï¼Œå½“ä½ æŒ‡å®šäº†â€“strictNullChecksæ ‡è®°ï¼Œnullå’Œundefinedåªèƒ½èµ‹å€¼ç»™voidå’Œå®ƒä»¬å„è‡ª Neverï¼šè¡¨ç¤ºçš„æ˜¯é‚£äº›æ°¸ä¸å­˜åœ¨çš„å€¼çš„ç±»å‹ã€‚neverç±»å‹æ˜¯ä»»ä½•ç±»å‹çš„å­ç±»å‹ï¼Œä¹Ÿå¯ä»¥èµ‹å€¼ç»™ä»»ä½•ç±»å‹ï¼›ç„¶è€Œï¼Œæ²¡æœ‰ç±»å‹æ˜¯neverçš„å­ç±»å‹æˆ–å¯ä»¥èµ‹å€¼ç»™neverç±»å‹ï¼ˆé™¤äº†neveræœ¬èº«ä¹‹å¤–ï¼‰ã€‚ Objectï¼šè¡¨ç¤ºéåŸå§‹ç±»å‹ï¼Œä¹Ÿå°±æ˜¯é™¤numberï¼Œstringï¼Œbooleanï¼Œsymbolï¼Œnullæˆ–undefinedä¹‹å¤–çš„ç±»å‹ 1234let o: object = &#123; prop: 0 &#125; // OKlet o1: object = 4 // Error// æ³¨æ„ï¼Œobjectä¸Objectçš„åŒºåˆ«let o1: Object = 4 // OK ç±»å‹æ–­è¨€ï¼šå¥½æ¯”å…¶å®ƒè¯­è¨€é‡Œçš„ç±»å‹è½¬æ¢ 12345678// â€œå°–æ‹¬å·â€è¯­æ³•let someValue: any = 'this is a string'let strLength: number = (&lt;string&gt;someValue).length// asè¯­æ³•// å½“åœ¨TypeScriptä¸­ä½¿ç”¨JSXæ—¶ï¼Œåªæœ‰asè¯­æ³•æ–­è¨€æ˜¯è¢«å…è®¸çš„let someValue: any = 'this is a string'let strLength: number = (someValue as string).length å˜é‡å£°æ˜ varã€letã€const è§£æ„ æ¥å£TypeScriptçš„æ ¸å¿ƒåŸåˆ™ä¹‹ä¸€å°±æ˜¯å¯¹å€¼æ‰€å…·æœ‰çš„ç»“æ„è¿›è¡Œç±»å‹æ£€æŸ¥åœ¨ã€‚åœ¨TypeScripté‡Œï¼Œæ¥å£çš„ä½œç”¨å°±æ˜¯ä¸ºè¿™äº›ç±»å‹å‘½åå’Œä¸ºä½ çš„ä»£ç æˆ–ç¬¬ä¸‰æ–¹ä»£ç å®šä¹‰å¥‘çº¦ã€‚ç›¸å¯¹äºå…¶å®ƒè¯­è¨€çš„æ¥å£è€Œè¨€ï¼Œåœ¨tsä¸­åªä¼šå…³æ³¨å€¼å¾—å¤–å½¢ï¼Œè€Œä¸èƒ½è¯´æŸä¸ªå¯¹è±¡å®ç°äº†è¿™ä¸ªæ¥å£ã€‚ 123456789101112interface SquareConfig &#123; width: number height: number // å¯é€‰å±æ€§çš„å¥½å¤„ï¼š1. å¯ä»¥å¯¹å¯èƒ½å­˜åœ¨çš„å±æ€§è¿›è¡Œé¢„å®šä¹‰ï¼›2. å¯ä»¥æ•è·å¼•ç”¨äº†ä¸å­˜åœ¨çš„å±æ€§æ—¶çš„é”™è¯¯ï¼ˆä¾‹å¦‚ï¼šcolorå±æ€§æ‹¼å†™é”™è¯¯æˆclorï¼‰ color?: string // åªè¯»å±æ€§ readonly borderColor: string // åªè¯»æ•°ç»„ï¼ŒæŠŠReadonlyArrayç±»å‹çš„å˜é‡èµ‹å€¼ç»™æ™®é€šæ•°ç»„æ˜¯ä¸è¢«å…è®¸çš„ï¼Œä½†æ˜¯å¯ä»¥ç”¨ç±»å‹æ–­è¨€é‡å†™ arr: ReadonlyArray&lt;number&gt; // å­—ç¬¦ä¸²ç´¢å¼•ç­¾åï¼šé¿å…é¢å¤–çš„å±æ€§æ£€æŸ¥ [propName: string]: any&#125; å‡½æ•°ç±»å‹æ¥å£èƒ½å¤Ÿæè¿°JavaScriptä¸­å¯¹è±¡æ‹¥æœ‰çš„å„ç§å„æ ·çš„å¤–å½¢ã€‚é™¤äº†æè¿°å¸¦æœ‰å±æ€§çš„æ™®é€šå¯¹è±¡å¤–ï¼Œæ¥å£ä¹Ÿå¯ä»¥æè¿°å‡½æ•°ç±»å‹ã€‚ 123456789interface SearchFunc &#123; (source: string, subString: string): boolean&#125;let mySearchFunc: SearchFuncmySearchFunc = function (src, sub): boolean &#123; let result = src.search(sub) return result &gt; -1&#125; å¯ç´¢å¼•çš„ç±»å‹ä¸ä½¿ç”¨æ¥å£æè¿°å‡½æ•°ç±»å‹å·®ä¸å¤šï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æè¿°é‚£äº›èƒ½å¤Ÿâ€œé€šè¿‡ç´¢å¼•å¾—åˆ°â€çš„ç±»å‹ã€‚TypeScriptæ”¯æŒä¸¤ç§ç´¢å¼•ç­¾åï¼šå­—ç¬¦ä¸²å’Œæ•°å­—ã€‚å¯ä»¥åŒæ—¶ä½¿ç”¨ä¸¤ç§ç±»å‹çš„ç´¢å¼•ï¼Œä½†æ˜¯æ•°å­—ç´¢å¼•çš„è¿”å›å€¼å¿…é¡»æ˜¯å­—ç¬¦ä¸²ç´¢å¼•è¿”å›å€¼çš„å­ç±»å‹ã€‚è¿™æ˜¯å› ä¸ºå½“ä½¿ç”¨numberæ¥ç´¢å¼•æ—¶ï¼ŒJavaScriptä¼šå°†å®ƒè½¬æ¢æˆstringç„¶åå†å»ç´¢å¼•å¯¹è±¡ã€‚ 123456789101112class Animal &#123; name: string&#125;class Dog extends Animal &#123; breed: string&#125;// é”™è¯¯ï¼šä½¿ç”¨æ•°å€¼å‹çš„å­—ç¬¦ä¸²ç´¢å¼•ï¼Œæœ‰æ—¶å¾—åˆ°çš„ä¼šæ˜¯Dogç±»å‹çš„æ•°æ®interface NotOkay &#123; [x: number]: Animal [x: string]: Dog&#125; ç±»ç±»å‹ä¸C#æˆ–Javaé‡Œæ¥å£çš„åŸºæœ¬ä½œç”¨ä¸€æ ·ï¼ŒTypeScriptä¹Ÿèƒ½å¤Ÿç”¨å®ƒæ¥æ˜ç¡®çš„å¼ºåˆ¶ä¸€ä¸ªç±»å»ç¬¦åˆæŸç§å¥‘çº¦ã€‚ 123456789101112interface ClockInterface &#123; currentTime: Date setTime(d: Date)&#125;class Clock implements ClockInterface &#123; currentTime: Date setTime(d: Date) &#123; this.currentTime = d &#125; constructor(h: number, m: number) &#123;&#125;&#125; ç»§æ‰¿æ¥å£å’Œç±»ä¸€æ ·ï¼Œæ¥å£ä¹Ÿå¯ä»¥ç›¸äº’ç»§æ‰¿ã€‚ 1234567891011121314interface Shape &#123; color: string&#125;interface PenStroke &#123; penWidth: number&#125;interface Square extends Shape, PenStroke &#123; sideLength: number&#125;let square = &lt;Square&gt;&#123;&#125;square.color = 'blue'square.penWidth = 5.0square.sideLength = 10 æ··åˆç±»å‹å› ä¸ºJavaScriptå…¶åŠ¨æ€çµæ´»çš„ç‰¹ç‚¹ï¼Œæœ‰æ—¶ä½ ä¼šå¸Œæœ›ä¸€ä¸ªå¯¹è±¡å¯ä»¥åŒæ—¶å…·æœ‰ä¸Šé¢æåˆ°çš„å¤šç§ç±»å‹ã€‚ ä¸€ä¸ªä¾‹å­å°±æ˜¯ï¼Œä¸€ä¸ªå¯¹è±¡å¯ä»¥åŒæ—¶åšä¸ºå‡½æ•°å’Œå¯¹è±¡ä½¿ç”¨ï¼Œå¹¶å¸¦æœ‰é¢å¤–çš„å±æ€§ 1234567891011121314151617interface Counter &#123; (start: number): string interval: number reset(): void&#125;function getCounter(): Counter &#123; let counter = &lt;Counter&gt;function (start: number) &#123;&#125; counter.interval = 123 counter.reset = function () &#123;&#125; return counter&#125;let c = getCounter()c(10)c.reset()c.interval = 5.0 æ¥å£ç»§æ‰¿ç±»å½“æ¥å£ç»§æ‰¿äº†ä¸€ä¸ªç±»ç±»å‹æ—¶ï¼Œå®ƒä¼šç»§æ‰¿ç±»çš„æˆå‘˜ä½†ä¸åŒ…æ‹¬å…¶å®ç°ã€‚æ¥å£åŒæ ·ä¼šç»§æ‰¿åˆ°ç±»çš„privateå’Œprotectedæˆå‘˜ã€‚è¿™æ„å‘³ç€å½“ä½ åˆ›å»ºäº†ä¸€ä¸ªæ¥å£ç»§æ‰¿äº†ä¸€ä¸ªæ‹¥æœ‰ç§æœ‰æˆ–å—ä¿æŠ¤çš„æˆå‘˜çš„ç±»æ—¶ï¼Œè¿™ä¸ªæ¥å£ç±»å‹åªèƒ½è¢«è¿™ä¸ªç±»æˆ–å…¶ä¹‹ç±»æ‰€å®ç°ã€‚ 1234567891011121314151617class Control &#123; private state: any&#125;interface SelectableControl extends Control &#123; select(): void&#125;class Button extends Control implements SelectableControl &#123; select() &#123;&#125;&#125;class TextBox extends Control &#123; select() &#123;&#125;&#125;// é”™è¯¯ï¼š â€œImageâ€ç±»å‹ç¼ºå°‘â€œstateâ€å±æ€§class Image implements SelectableControl &#123; select() &#123;&#125;&#125; ç±»ç»§æ‰¿ å­ç±»çš„æ„é€ å‡½æ•°é‡Œå¿…é¡»è°ƒç”¨super()ï¼Œä¸”è¦åœ¨è®¿é—®thisçš„å±æ€§ä¹‹å‰ å­ç±»å¯ä»¥é‡å†™åŸºç±»çš„å‡½æ•° 1234567891011121314151617181920212223242526272829class Animal &#123; name: string; constructor(theName: string) &#123; this.name = theName; &#125; move(distanceInMeters: number = 0) &#123; console.log(`$&#123;this.name&#125; moved $&#123;distanceInMeters&#125;m.`) &#125;&#125;class Snake extends Animal &#123; constructor(name: string) &#123; super(name) &#125; move(distanceInMeters = 5) &#123; console.log(\"Slithering...\") super.move(distanceInMeters) &#125;&#125;class Horse extends Animal &#123; constructor(name: string) &#123; super(name); &#125; move(distanceInMeters = 45) &#123; console.log(\"Galloping...\") super.move(distanceInMeters) &#125;&#125;let sam = new Snake(\"Sammy the Python\")let tom: Animal = new Horse(\"Tommy the Palomino\")sam.move()tom.move(34) å…¬æœ‰ï¼Œç§æœ‰ä¸å—ä¿æŠ¤çš„ä¿®é¥°ç¬¦ public(é»˜è®¤) private TypeScriptä½¿ç”¨çš„æ˜¯ç»“æ„æ€§ç±»å‹ç³»ç»Ÿã€‚å½“æˆ‘ä»¬æ¯”è¾ƒä¸¤ç§ä¸åŒçš„ç±»å‹æ—¶ï¼Œå¹¶ä¸åœ¨ä¹å®ƒä»¬ä»ä½•è€Œæ¥ï¼Œå¦‚æœæ‰€æœ‰æˆå‘˜çš„ç±»å‹éƒ½æ˜¯å…¼å®¹çš„ï¼Œæˆ‘ä»¬å°±è®¤ä¸ºå®ƒä»¬çš„ç±»å‹æ˜¯å…¼å®¹çš„ã€‚ ç„¶è€Œï¼Œå½“æˆ‘ä»¬æ¯”è¾ƒå¸¦æœ‰privateæˆ–protectedæˆå‘˜çš„ç±»å‹çš„æ—¶å€™ï¼Œæƒ…å†µå°±ä¸åŒäº†ã€‚å¦‚æœå…¶ä¸­ä¸€ä¸ªç±»å‹é‡ŒåŒ…å«ä¸€ä¸ªprivateæˆå‘˜ï¼Œé‚£ä¹ˆåªæœ‰å½“å¦å¤–ä¸€ä¸ªç±»å‹ä¸­ä¹Ÿå­˜åœ¨è¿™æ ·ä¸€ä¸ªprivateæˆå‘˜ï¼Œå¹¶ä¸”å®ƒä»¬éƒ½æ˜¯æ¥è‡ªåŒä¸€å¤„å£°æ˜æ—¶ï¼Œæˆ‘ä»¬æ‰è®¤ä¸ºè¿™ä¸¤ä¸ªç±»å‹æ˜¯å…¼å®¹çš„ã€‚ 12345678910111213141516171819class Animal &#123; private name: string constructor(theName: string) &#123; this.name = theName &#125;&#125;class Rhino extends Animal &#123; constructor(theName: string) &#123; super('Rhino') &#125;&#125;class Employee &#123; private name: string constructor(theName: string) &#123; this.name = theName &#125;&#125;let animal = new Animal('Goat')let rhino = new Rhino()let employee = new Employee('bob')animal = rhino// é”™è¯¯ï¼šAnimal ä¸ Employeeä¸å…¼å®¹ï¼Œç§æœ‰æˆå‘˜nameçš„å®šä¹‰ä¸æ˜¯æ¥è‡ªåŒä¸€å¤„animal = employee protectedï¼šprotectedä¿®é¥°ç¬¦ä¸privateä¿®é¥°ç¬¦çš„è¡Œä¸ºå¾ˆç›¸ä¼¼ï¼Œä½†æœ‰ä¸€ç‚¹ä¸åŒï¼Œprotectedæˆå‘˜åœ¨æ´¾ç”Ÿç±»ä¸­ä»ç„¶å¯ä»¥è®¿é—®ã€‚æ„é€ å‡½æ•°ä¹Ÿå¯ä»¥è¢«æ ‡è®°æˆprotectedï¼Œè¿™æ„å‘³ç€è¿™ä¸ªç±»ä¸èƒ½å†åŒ…å«å®ƒçš„ç±»å¤–è¢«å®ä¾‹åŒ–ï¼Œä½†æ˜¯èƒ½è¢«ç»§æ‰¿ã€‚ 1234567891011121314151617181920212223class Person &#123; protected name: string; protected constructor(theName: string) &#123; this.name = theName; &#125;&#125;// Employee èƒ½å¤Ÿç»§æ‰¿ Personclass Employee extends Person &#123; private department: string; constructor(name: string, department: string) &#123; super(name); this.department = department; &#125; public getElevatorPitch() &#123; return `Hello, my name is $&#123;this.name&#125; and I work in $&#123;this.department&#125;.`; &#125;&#125;let howard = new Employee(\"Howard\", \"Sales\");let john = new Person(\"John\"); // é”™è¯¯: 'Person' çš„æ„é€ å‡½æ•°æ˜¯è¢«ä¿æŠ¤çš„.export default &#123;&#125; readonlyä¿®é¥°ç¬¦ä½¿ç”¨readonlyå…³é”®å­—å¯ä»¥å°†å±æ€§è®¾ç½®ä¸ºåªè¯»çš„ 12345678910class Octopus &#123; readonly name: string readonly numberOfLegs: number = 8 constructor (theName: string) &#123; this.name = theName &#125;&#125;let dad = new Octopus('Man with the 8 strong legs')dad.name = 'Man with the 3-piece suit' // é”™è¯¯ï¼nameæ˜¯åªè¯»çš„ å‚æ•°å±æ€§å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä»£ç æ›¿ä»£ä¸Šè¿°æ–¹æ³•ï¼š 12345class Octopus &#123; readonly numberOfLegs: number = 8 constructor (readonly name: string) &#123; &#125;&#125; æ³¨æ„çœ‹æˆ‘ä»¬æ˜¯å¦‚ä½•èˆå¼ƒäº†theNameï¼Œä»…åœ¨æ„é€ å‡½æ•°é‡Œä½¿ç”¨readonly name: stringå‚æ•°æ¥åˆ›å»ºå’Œåˆå§‹åŒ–nameæˆå‘˜ã€‚æˆ‘ä»¬æŠŠå£°æ˜å’Œèµ‹å€¼åˆå¹¶è‡³ä¸€å¤„ã€‚ å‚æ•°å±æ€§é€šè¿‡ç»™æ„é€ å‡½æ•°å‰é¢æ·»åŠ ä¸€ä¸ªè®¿é—®é™å®šç¬¦æ¥å£°æ˜ã€‚ä½¿ç”¨privateé™å®šä¸€ä¸ªå‚æ•°å±æ€§ä¼šå£°æ˜å¹¶åˆå§‹åŒ–ä¸€ä¸ªç§æœ‰æˆå‘˜ï¼›å¯¹äºpublicå’Œprotectedæ¥è¯´ä¹Ÿä¸€æ · å­˜å–å™¨å¯¹äºå­˜å–å™¨æœ‰ä¸‹é¢å‡ ç‚¹éœ€è¦æ³¨æ„çš„ï¼š ç¼–è¯‘å™¨è®¾ç½®ä¸ºè¾“å‡ºECMAScript 5æˆ–æ›´é«˜ åªå¸¦æœ‰getä¸å¸¦æœ‰setçš„å­˜å–å™¨è‡ªåŠ¨è¢«æ¨æ–­ä¸ºreadonly 1234567891011121314151617181920212223let passcode = 'secret passcode'class Employee &#123; private _fullName: string get fullName(): string &#123; return this._fullName &#125; set fullName(newName: string): &#123; if (passcode &amp;&amp; passcode === 'secret passcode') &#123; this._fullName = newName &#125; else &#123; console.log(\"Error: Unauthorized update of employee!\"); &#125; &#125;&#125;let employee = new Employee()employee.fullName = 'Bob Smith'if (employee.fullName) &#123; alert(employee.fullName)&#125; é™æ€å±æ€§12345class Grid &#123; static origin = &#123; x: 0, y: 0 &#125;&#125;console.log(Grid.origin.x) æŠ½è±¡ç±» abstractå…³é”®å­—ç”¨äºå®šä¹‰æŠ½è±¡ç±»å’Œåœ¨æŠ½è±¡ç±»å†…éƒ¨å®šä¹‰æŠ½è±¡æ–¹æ³• æŠ½è±¡ç±»ä½œä¸ºå…¶å®ƒæ´¾ç”Ÿç±»çš„åŸºç±»ä½¿ç”¨ï¼Œä¸€èˆ¬ä¸ä¼šè¢«å®ä¾‹åŒ– ä¸åŒäºæ¥å£ï¼ŒæŠ½è±¡ç±»å¯ä»¥åŒ…å«æˆå‘˜çš„å®ç°ç»†èŠ‚ æŠ½è±¡ç±»ä¸­çš„æŠ½è±¡æ–¹æ³•ä¸åŒ…å«å…·ä½“å®ç°å¹¶ä¸”å¿…é¡»åœ¨æ´¾ç”Ÿç±»ä¸­å®ç° 123456789101112131415161718192021222324252627282930313233abstract class Department &#123; constructor(public name: string) &#123; &#125; printName(): void &#123; console.log('Department name: ' + this.name); &#125; abstract printMeeting(): void; // å¿…é¡»åœ¨æ´¾ç”Ÿç±»ä¸­å®ç°&#125;class AccountingDepartment extends Department &#123; constructor() &#123; super('Accounting and Auditing'); // åœ¨æ´¾ç”Ÿç±»çš„æ„é€ å‡½æ•°ä¸­å¿…é¡»è°ƒç”¨ super() &#125; printMeeting(): void &#123; console.log('The Accounting Department meets each Monday at 10am.'); &#125; generateReports(): void &#123; console.log('Generating accounting reports...'); &#125;&#125;let department: Department; // å…è®¸åˆ›å»ºä¸€ä¸ªå¯¹æŠ½è±¡ç±»å‹çš„å¼•ç”¨department = new Department(); // é”™è¯¯: ä¸èƒ½åˆ›å»ºä¸€ä¸ªæŠ½è±¡ç±»çš„å®ä¾‹department = new AccountingDepartment(); // å…è®¸å¯¹ä¸€ä¸ªæŠ½è±¡å­ç±»è¿›è¡Œå®ä¾‹åŒ–å’Œèµ‹å€¼department.printName();department.printMeeting();department.generateReports(); // é”™è¯¯: æ–¹æ³•åœ¨å£°æ˜çš„æŠ½è±¡ç±»ä¸­ä¸å­˜åœ¨ æŠŠç±»å½“æ¥å£ä½¿ç”¨ç±»çš„å®šä¹‰ä¼šåˆ›å»ºä¸¤ä¸ªä¸œè¥¿ï¼šç±»çš„å®ä¾‹ç±»å‹å’Œä¸€ä¸ªæ„é€ å‡½æ•°ã€‚å› ä¸ºç±»å¯ä»¥åˆ›å»ºå‡ºç±»å‹ï¼Œæ‰€ä»¥ä½ èƒ½å¤Ÿåœ¨å…è®¸ä½¿ç”¨æ¥å£çš„åœ°æ–¹ä½¿ç”¨ç±» 123456789class Point &#123; x: number y: number&#125;interface Point3d extends Point &#123; z: number&#125;let point3d: Point3d = &#123; x: 1, y: 2, z: 3 &#125; å‡½æ•°ä¸ºå‡½æ•°å®šä¹‰ç±»å‹å‡½æ•°çš„ç±»å‹ç”±å‚æ•°ç±»å‹å’Œè¿”å›å€¼ç±»å‹å†³å®š 1234567function add(x: number, y: number): number &#123; return x + y&#125;let myAdd = function (x: number, y: number): number &#123; return x + y&#125; ä¹¦å†™å®Œæ•´å‡½æ•°ç±»å‹123let myAdd: (baseValue: number, increment: number) =&gt; number = function (x: number, y: number): number &#123; return x + y&#125; å¯é€‰å‚æ•°å’Œé»˜è®¤å‚æ•° ä¼ é€’ç»™ä¸€ä¸ªå‡½æ•°çš„å‚æ•°ä¸ªæ•°å¿…é¡»ä¸å‡½æ•°æœŸæœ›çš„å‚æ•°ä¸ªæ•°ä¸€è‡´ 1234567function buildName(firstName: string, lastName: string) &#123; return firstName + \" \" + lastName;&#125;let result1 = buildName(\"Bob\"); // error, too few parameterslet result2 = buildName(\"Bob\", \"Adams\", \"Sr.\"); // error, too many parameterslet result3 = buildName(\"Bob\", \"Adams\"); // ah, just right åœ¨å‚æ•°åæ—è¾¹ä½¿ç”¨?å®ç°å¯é€‰å‚æ•°çš„åŠŸèƒ½ï¼Œå¯é€‰å‚æ•°å¿…é¡»è·Ÿåœ¨å¿…é¡»å‚æ•°åé¢ 12345678910function buildName(firstName: string, lastName?: string) &#123; if (lastName) return firstName + \" \" + lastName; else return firstName;&#125;let result1 = buildName(\"Bob\"); // works correctly nowlet result2 = buildName(\"Bob\", \"Adams\", \"Sr.\"); // error, too many parameterslet result3 = buildName(\"Bob\", \"Adams\"); // ah, just right å¸¦é»˜è®¤å€¼å¾—å‚æ•°ä¸éœ€è¦æ”¾åœ¨å¿…é¡»å‚æ•°çš„åé¢ã€‚å¦‚æœå¸¦é»˜è®¤å€¼çš„å‚æ•°å‡ºç°åœ¨å¿…é¡»å‚æ•°å‰é¢ï¼Œç”¨æˆ·å¿…é¡»æ˜ç¡®çš„ä¼ å…¥undefinedå€¼æ¥è·å¾—é»˜è®¤å€¼ 12345678function buildName(firstName = \"Will\", lastName: string) &#123; return firstName + \" \" + lastName;&#125;let result1 = buildName(\"Bob\"); // error, too few parameterslet result2 = buildName(\"Bob\", \"Adams\", \"Sr.\"); // error, too many parameterslet result3 = buildName(\"Bob\", \"Adams\"); // okay and returns \"Bob Adams\"let result4 = buildName(undefined, \"Adams\"); // okay and returns \"Will Adams\" å¯é€‰å‚æ•°å’Œæœ«å°¾çš„é»˜è®¤å‚æ•°å…±äº«å‚æ•°ç±»å‹ 123function buildName(firstName: string, lastName?: string) &#123; //. ..&#125; å’Œ 123function buildName(firstName: string, lastName = 'Smith') &#123; //. ..&#125; å…±äº«åŒæ ·çš„ç±»å‹(firstName: string, lastName?: string) =&gt; string å‰©ä½™å‚æ•°é€šè¿‡â€¦æ“ä½œç¬¦æ¥è·å–å‰©ä½™å‚æ•° 12345function buildName(firstName: string, ...restOfName: string[]) &#123; return firstName + ' ' + restOfName.join(' ')&#125;let buildNameFun: (fname: string, ...rest: string[]) =&gt; string = buildName é‡è½½å®šä¹‰é‡è½½æ—¶ï¼Œä¸€å®šè¦æŠŠæœ€ç²¾ç¡®çš„å®šä¹‰æ”¾åœ¨æœ€å‰é¢ 123456789101112131415161718192021222324let suits = [\"hearts\", \"spades\", \"clubs\", \"diamonds\"];function pickCard(x: &#123;suit: string; card: number; &#125;[]): number;function pickCard(x: number): &#123;suit: string; card: number; &#125;;function pickCard(x): any &#123; // Check to see if we're working with an object/array // if so, they gave us the deck and we'll pick the card if (typeof x == \"object\") &#123; let pickedCard = Math.floor(Math.random() * x.length); return pickedCard; &#125; // Otherwise just let them pick the card else if (typeof x == \"number\") &#123; let pickedSuit = Math.floor(x / 13); return &#123; suit: suits[pickedSuit], card: x % 13 &#125;; &#125;&#125;let myDeck = [&#123; suit: \"diamonds\", card: 2 &#125;, &#123; suit: \"spades\", card: 10 &#125;, &#123; suit: \"hearts\", card: 4 &#125;];let pickedCard1 = myDeck[pickCard(myDeck)];alert(\"card: \" + pickedCard1.card + \" of \" + pickedCard1.suit);let pickedCard2 = pickCard(15);alert(\"card: \" + pickedCard2.card + \" of \" + pickedCard2.suit); æ³¨æ„ï¼Œfunction pickCard(x): anyå¹¶ä¸æ˜¯é‡è½½åˆ—è¡¨çš„ä¸€éƒ¨åˆ†ï¼Œæ˜¯å‡½æ•°çš„å…·ä½“å®ç°ã€‚ æ³›å‹å«ä¹‰ï¼šç±»å‹çš„å‚æ•°åŒ–ï¼Œå°±æ˜¯å¯ä»¥æŠŠç±»å‹åƒæ–¹æ³•çš„å‚æ•°é‚£æ ·ä¼ é€’ 1234567// å‚æ•°ç±»å‹ä¸è¿”å›å€¼ç±»å‹ç›¸åŒfunction identity&lt;T&gt;(arg: T): T &#123; return arg&#125;let output = identity&lt;string&gt;('myString')let output = identity('myString') ä½¿ç”¨æ³›å‹å˜é‡ä½¿ç”¨æ³›å‹åˆ›å»ºåƒidentityè¿™æ ·çš„æ³›å‹å‡½æ•°æ—¶ï¼Œç¼–è¯‘å™¨è¦æ±‚ä½ åœ¨å‡½æ•°ä½“å¿…é¡»æ­£ç¡®çš„ä½¿ç”¨è¿™ä¸ªé€šç”¨çš„ç±»å‹ã€‚æ¢å¥è¯è¯´ï¼Œä½ å¿…é¡»æŠŠè¿™äº›å‚æ•°å½“åšæ˜¯ä»»æ„æˆ–æ‰€æœ‰ç±»å‹ 12345function loggingIdentity&lt;T&gt;(arg: T): T &#123; // Error: T doesn't have .length console.log(arg.length) return arg&#125; æ³›å‹ç±»å‹æ³›å‹å‡½æ•°çš„ç±»å‹ä¸éæ³›å‹å‡½æ•°çš„ç±»å‹æ²¡ä»€ä¹ˆä¸åŒï¼Œåªæ˜¯æœ‰ä¸€ä¸ªç±»å‹å‚æ•°æ”¾åœ¨æœ€å‰é¢ï¼Œåƒå‡½æ•°å£°æ˜ä¸€æ ·ï¼š 12345function identity&lt;T&gt;(arg: T): T &#123; return arg&#125;let myIdentity: &lt;U&gt;(arg: U) =&gt; U = identity è¿˜å¯ä»¥ä½¿ç”¨å¸¦æœ‰è°ƒç”¨ç­¾åçš„å¯¹è±¡å­—é¢é‡æ¥å®šä¹‰æ³›å‹å‡½æ•° 12345function identity&lt;T&gt;(arg: T): T &#123; return arg&#125;let myIdentity1: &#123; &lt;U&gt;(arg: U): U &#125; = identity è¿™å¼•å¯¼æˆ‘ä»¬å»å†™ä¸€ä¸ªæ³›å‹æ¥å£äº† 123456789interface GenericIdentityFn &#123; &lt;U&gt;(arg: U): U&#125;function identity&lt;T&gt;(arg: T): T &#123; return arg&#125;let myIdentity: GenericIdentityFn = identity æˆ–è€…æˆ‘ä»¬å¯ä»¥æŠŠæ³›å‹å‚æ•°å½“åšæ•´ä¸ªæ¥å£çš„ä¸€ä¸ªå‚æ•° 123456789interface GenericIdentityFn&lt;U&gt; &#123; (arg: U): U&#125;function identity&lt;T&gt;(arg: T): T &#123; return arg&#125;let myIdentity: GenericIdentityFn&lt;number&gt; = identity æ³›å‹ç±»æ³›å‹ç±»æŒ‡çš„æ˜¯å®ä¾‹éƒ¨åˆ†çš„ç±»å‹ï¼Œæ‰€ä»¥ç±»çš„é™æ€å±æ€§ä¸èƒ½ä½¿ç”¨è¿™ä¸ªæ³›å‹ç±»å‹ 12345678class GenericNumber&lt;T&gt; &#123; zeroValue: T add: (x: T, y: T) =&gt; T&#125;let myGenericNumber = new GenericNumber&lt;number&gt;()myGenericNumber.zeroValue = 0myGenericNumber.add = function(x, y) &#123; return x + y &#125; æ³›å‹çº¦æŸå¦‚æœæˆ‘ä»¬æƒ³è¦é™åˆ¶å‡½æ•°å»å¤„ç†ä»»æ„å¸¦æœ‰.lengthå±æ€§çš„æ‰€æœ‰ç±»å‹ã€‚åªè¦ä¼ å…¥çš„ç±»å‹ä¸­æœ‰è¿™ä¸ªå±æ€§ï¼Œæˆ‘ä»¬å°±å…è®¸ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦ç´¯å‡ºå¯¹äºTçš„çº¦æŸè¦æ±‚ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ¥å£æ¥æè¿°çº¦æŸæ¡ä»¶ã€‚åˆ›å»ºä¸€ä¸ªåŒ…å«.lengthå±æ€§çš„æ¥å£ï¼Œä½¿ç”¨è¿™ä¸ªæ¥å£å’Œextendså…³é”®å­—æ¥å®ç°çº¦æŸï¼š 123456789interface Lengthwise &#123; length: number&#125;function loggingIdentity&lt;T extends Lengthwise&gt;(arg: T): T &#123; // Now we konw it has .length property, so no more error console.log(arg.length) return arg&#125; åœ¨æ³›å‹çº¦æŸä¸­ä½¿ç”¨ç±»å‹å‚æ•°ä½ å¯ä»¥å£°æ˜ä¸€ä¸ªç±»å‹å‚æ•°ï¼Œä¸”å®ƒè¢«å¦ä¸€ä¸ªç±»å‹å‚æ•°æ‰€çº¦æŸã€‚ æ¯”å¦‚ï¼Œç°åœ¨æˆ‘ä»¬æƒ³è¦ç”¨å±æ€§åä»å¯¹è±¡é‡Œè·å–è¿™ä¸ªå±æ€§ã€‚ å¹¶ä¸”æˆ‘ä»¬æƒ³è¦ç¡®ä¿è¿™ä¸ªå±æ€§å­˜åœ¨äºå¯¹è±¡ objä¸Šï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åœ¨è¿™ä¸¤ä¸ªç±»å‹ä¹‹é—´ä½¿ç”¨çº¦æŸã€‚ 123456789function getProperty&lt;T, K extends keyof T&gt;(obj: T, key: K): T[K] &#123; return obj[key];&#125;let x = &#123; a: 1, b: 2, c: 3, d: 4 &#125;;getProperty(x, \"a\"); // okaygetProperty(x, \"m\"); // error: Argument of type 'm' isn't assignable to 'a' | 'b' | 'c' | 'd'.// export default &#123;&#125; åœ¨æ³›å‹é‡Œä½¿ç”¨ç±»ç±»å‹åœ¨TypeScriptä½¿ç”¨æ³›å‹åˆ›å»ºå·¥å‚å‡½æ•°æ—¶ï¼Œéœ€è¦å¼•ç”¨æ„é€ å‡½æ•°çš„ç±»ç±»å‹ã€‚æ¯”å¦‚ï¼š 123function create&lt;T&gt;(c: &#123; new(): T &#125;): T &#123; return new c()&#125; æšä¸¾ä½¿ç”¨æšä¸¾æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€äº›å¸¦åå­—çš„å¸¸é‡ã€‚ä½¿ç”¨æšä¸¾å¯ä»¥æ¸…æ™°åœ°è¡¨è¾¾æ„å›¾æˆ–åˆ›å»ºä¸€ç»„æœ‰åŒºåˆ«çš„ç”¨ä¾‹ã€‚TypeScriptæ”¯æŒæ•°å­—çš„å’ŒåŸºäºå­—ç¬¦ä¸²çš„æšä¸¾ã€‚ æ•°å­—æšä¸¾ é»˜è®¤ä»0å¼€å§‹ï¼Œå¾€åä¾æ¬¡åŠ 1 å¦‚æœç»™å…¶ä¸­ä¸€ä¸ªæšä¸¾æˆå‘˜èµ‹å€¼nï¼Œè¿™åç»­çš„æšä¸¾æˆå‘˜ä»nå¼€å§‹ä¾æ¬¡åŠ 1 123456789101112131415enum Direction &#123; top, bottom = 4, left, right = 10, topLeft, topRight, bottomLeft, bottomRight&#125;console.log(Direction.top) // 0console.log(Direction.left) // 5console.log(Direction.topLeft) // 11console.log(Direction[4]) // 'bottom' æ•°å­—æšä¸¾å¯ä»¥è¢«æ··å…¥åˆ°è®¡ç®—è¿‡çš„å’Œå¸¸é‡æˆå‘˜ï¼ˆå¦‚ä¸‹æ‰€ç¤ºï¼‰ï¼Œç®€å•åœ°è¯´ï¼Œä¸å¸¦åˆå§‹åŒ–å™¨çš„æšä¸¾ï¼Œè¦ä¹ˆè¢«æ”¾åœ¨ç¬¬ä¸€çš„ä½ç½®ï¼Œè¦ä¹ˆè¢«æ”¾åœ¨ä½¿ç”¨äº†æ•°å­—å¸¸é‡æˆ–è€…å…¶å®ƒå¸¸é‡åˆå§‹åŒ–äº†çš„æšä¸¾åé¢ã€‚æ¢å¥è¯è¯´ï¼Œä¸‹é¢çš„æƒ…å†µæ˜¯ä¸è¢«å…è®¸çš„ï¼š 1234enum E &#123; A = getSomeValue(), B, // error! 'A' is not constant-initialized, so 'B' needs an initializer&#125; å­—ç¬¦ä¸²æšä¸¾åœ¨ä¸€ä¸ªå­—ç¬¦ä¸²æšä¸¾é‡Œï¼Œæ¯ä¸ªæˆå‘˜éƒ½å¿…é¡»ç”¨å­—ç¬¦ä¸²å­—é¢é‡ï¼Œæˆ–å¦å¤–ä¸€ä¸ªå­—ç¬¦ä¸²æšä¸¾æˆå‘˜è¿›è¡Œåˆå§‹åŒ– 123456enum Direction &#123; Up = 'UP', Down = 'DOWN', Left = 'LEFT', Right = 'RIGHT'&#125; å¼‚æ„æšä¸¾ä»æŠ€æœ¯çš„è§’åº¦æ¥è¯´ï¼Œæšä¸¾å¯ä»¥æ··åˆå­—ç¬¦ä¸²å’Œæ•°å­—æˆå‘˜ï¼Œé™¤éä½ çœŸçš„æƒ³è¦åˆ©ç”¨JavaScriptè¿è¡Œæ—¶çš„è¡Œä¸ºï¼Œå¦åˆ™æˆ‘ä»¬ä¸å»ºè®®è¿™æ ·åš 1234enum BooleanLikeHetergeneousEnum &#123; No = 0, Yes = 'YES'&#125; è®¡ç®—çš„å’Œå¸¸é‡æˆå‘˜æ¯ä¸ªæšä¸¾æˆå‘˜éƒ½å¸¦æœ‰ä¸€ä¸ªå€¼ï¼Œå®ƒå¯ä»¥æ˜¯å¸¸é‡æˆ–è®¡ç®—å‡ºæ¥çš„ã€‚å½“æ»¡è¶³å¦‚ä¸‹æ¡ä»¶æ—¶ï¼Œæšä¸¾æˆå‘˜è¢«å½“ä½œæ˜¯å¸¸é‡ï¼š å®ƒæ˜¯æšä¸¾çš„ç¬¬ä¸€ä¸ªæˆå‘˜ä¸”æ²¡æœ‰åˆå§‹åŒ–å™¨ï¼Œè¿™ç§æƒ…å†µä¸‹å®ƒè¢«èµ‹å€¼äº0 å®ƒä¸å¸¦æœ‰åˆå§‹åŒ–å™¨ä¸”å®ƒä¹‹å‰çš„æšä¸¾æˆå‘˜æ˜¯ä¸€ä¸ªæ•°å­—å¸¸é‡ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå½“å‰æšä¸¾æˆå‘˜çš„å€¼ä¸ºå®ƒä¸Šä¸€ä¸ªæšä¸¾æˆå‘˜çš„å€¼åŠ 1 æšä¸¾æˆå‘˜ä½¿ç”¨å¸¸é‡æšä¸¾è¡¨è¾¾å¼åˆå§‹åŒ–ã€‚å¸¸é‡æšä¸¾è¡¨è¾¾å¼æ˜¯TypeScriptè¡¨è¾¾å¼çš„å­é›†ï¼Œä»–å¯ä»¥åœ¨ç¼–è¯‘é˜¶æ®µæ±‚å€¼ã€‚å½“ä¸€ä¸ªè¡¨è¾¾å¼æ»¡è¶³ä¸‹é¢æ¡ä»¶ä¹‹ä¸€æ—¶ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªå¸¸é‡æšä¸¾è¡¨è¾¾å¼ï¼š ä¸€ä¸ªæšä¸¾è¡¨è¾¾å¼å­—é¢é‡ï¼ˆä¸»è¦æ˜¯å­—ç¬¦ä¸²å­—é¢é‡å’Œæ•°å­—å­—é¢é‡ï¼‰ ä¸€ä¸ªå¯¹ä¹‹å‰å®šä¹‰çš„å¸¸é‡æšä¸¾æˆå‘˜çš„å¼•ç”¨ï¼ˆå¯ä»¥æ˜¯åœ¨ä¸åŒçš„æšä¸¾ç±»å‹ä¸­å®šä¹‰çš„ï¼‰ å¸¦æ‹¬å·çš„å¸¸é‡æšä¸¾è¡¨è¾¾å¼ ä¸€å…ƒè¿ç®—ç¬¦+ï¼Œ-ï¼Œ~å…¶ä¸­ä¹‹ä¸€è¿ç”¨åœ¨äº†å¸¸é‡æšä¸¾è¡¨è¾¾å¼ å¸¸é‡æšä¸¾è¡¨è¾¾å¼åšä¸ºäºŒå…ƒè¿ç®—ç¬¦ +ï¼Œ-ï¼Œ*ï¼Œ/ï¼Œ%ï¼Œ&lt;&lt;ï¼Œ&gt;&gt;ï¼Œ&gt;&gt;&gt;ï¼Œ|ï¼Œ^çš„æ“ä½œå¯¹è±¡ã€‚è‹¥å¸¸æ•°æšä¸¾è¡¨è¾¾å¼æ±‚å€¼åä¸ºNaNæˆ–Inifityï¼Œåˆ™ä¼šåœ¨ç¼–è¯‘é˜¶æ®µæŠ¥é”™ æ‰€æœ‰å…¶å®ƒæƒ…å†µçš„æšä¸¾æˆå‘˜è¢«å½“ä½œæ˜¯éœ€è¦è®¡ç®—å¾—å‡ºçš„å€¼ è”åˆæšä¸¾ä¸æšä¸¾æˆå‘˜çš„ç±»å‹å­˜åœ¨ä¸€ç§ç‰¹æ®Šçš„éè®¡ç®—çš„å¸¸é‡æšä¸¾æˆå‘˜çš„å­é›†ï¼šå­—é¢é‡æšä¸¾æˆå‘˜ã€‚å­—é¢é‡æšä¸¾æˆå‘˜æ˜¯æŒ‡ä¸å¸¦æœ‰åˆå§‹å€¼çš„å¸¸é‡æšä¸¾æˆå‘˜ï¼Œæˆ–è€…æ˜¯å€¼è¢«åˆå§‹åŒ–ä¸º ä»»ä½•å­—ç¬¦ä¸²å­—é¢é‡ï¼ˆä¾‹å¦‚ï¼šâ€fooâ€, â€œbarâ€ï¼‰ ä»»ä½•æ•°å­—å­—é¢é‡ï¼ˆä¾‹å¦‚ï¼š1ï¼Œ100ï¼‰ åº”ç”¨äº†ä¸€å…ƒ - ç¬¦å·çš„æ•°å­—å­—é¢é‡ï¼ˆä¾‹å¦‚ï¼š-1ï¼Œ-100ï¼‰ å½“æ‰€æœ‰æšä¸¾æˆå‘˜éƒ½æ‹¥æœ‰å­—é¢é‡æšä¸¾å€¼æ—¶ï¼Œå®ƒå°±å¸¦æœ‰äº†ä¸€ç§ç‰¹æ®Šçš„è¯­ä¹‰ï¼š æšä¸¾æˆå‘˜æˆä¸ºäº†ç±»å‹ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥è¯´æŸäº›æˆå‘˜åªèƒ½æ˜¯æšä¸¾æˆå‘˜çš„å€¼ï¼š 1234567891011121314151617181920212223242526272829303132enum ShapeKind &#123; Circle, Square,&#125;interface Circle &#123; kind: ShapeKind.Circle radius: number&#125;interface Square &#123; kind: ShapeKind.Square sideLength: number&#125;let c: Circle = &#123; kind: ShapeKind.Square, // ~~~~~~~~~~~~~~~~ Error! radius: 100,&#125;// å½“æœ‰æˆå‘˜ä¸ºéå­—é¢é‡æšä¸¾å€¼æ—¶enum ColorKind &#123; Red, Green, Yellow = 2 &lt;&lt; 3&#125;interface Green &#123; // é”™è¯¯ï¼šæšä¸¾ç±»å‹â€œColorKindâ€åŒ…å«å…·æœ‰ä¸æ˜¯æ–‡æœ¬çš„åˆå§‹å€¼è®¾å®šé¡¹çš„æˆå‘˜ kind: ColorKind.Green&#125; æšä¸¾ç±»å‹æœ¬èº«å˜æˆäº†æ¯ä¸ªæšä¸¾æˆå‘˜çš„è”åˆã€‚é€šè¿‡è”åˆæšä¸¾ï¼Œç±»å‹ç³»ç»Ÿèƒ½å¤Ÿåˆ©ç”¨è¿™æ ·ä¸€ä¸ªäº‹å®ï¼Œå®ƒå¯ä»¥çŸ¥é“æšä¸¾é‡Œçš„å€¼å¾—é›†åˆã€‚å› æ­¤ï¼ŒTypeScriptèƒ½å¤Ÿæ•è·åœ¨æ¯”è¾ƒå€¼çš„æ—¶å€™çŠ¯çš„æ„šè ¢çš„é”™è¯¯ã€‚ä¾‹å¦‚ï¼š 1234567891011enum E &#123; Foo, Bar&#125;function f(x: E) &#123; if (x !== E.Foo || x !== E.Bar) &#123; // // Error! Operator '!==' cannot be applied to types 'E.Foo' and 'E.Bar'. &#125;&#125; è¿™ä¸ªä¾‹å­é‡Œï¼Œæˆ‘ä»¬å…ˆæ£€æŸ¥ xæ˜¯å¦ä¸æ˜¯ E.Fooã€‚ å¦‚æœé€šè¿‡äº†è¿™ä¸ªæ£€æŸ¥ï¼Œç„¶å ||ä¼šå‘ç”ŸçŸ­è·¯æ•ˆæœï¼Œ ifè¯­å¥ä½“é‡Œçš„å†…å®¹ä¼šè¢«æ‰§è¡Œã€‚ ç„¶è€Œï¼Œè¿™ä¸ªæ£€æŸ¥æ²¡æœ‰é€šè¿‡ï¼Œé‚£ä¹ˆ xåˆ™ åªèƒ½ä¸º E.Fooï¼Œå› æ­¤æ²¡ç†ç”±å†å»æ£€æŸ¥å®ƒæ˜¯å¦ä¸º E.Bar è¿è¡Œæ—¶çš„æšä¸¾æšä¸¾æ˜¯åœ¨è¿è¡Œæ—¶çœŸæ­£å­˜åœ¨çš„å¯¹è±¡ã€‚ä¾‹å¦‚ä¸‹é¢çš„æšä¸¾ï¼š 123456789enum E &#123; X, Y, Z&#125;function f(obj: &#123; X: number &#125;) &#123; return obj.X&#125;// Works, since 'E' has a property named 'X' which is a number.f(E) åå‘æ˜ å°„ä»æšä¸¾å€¼åˆ°æšä¸¾åå­—ï¼Œä½†ä¸ä¼šä¸ºå­—ç¬¦ä¸²æšä¸¾æˆå‘˜ç”Ÿæˆåå‘æ˜ å°„ï¼Œå¦‚ï¼š 123456789enum NumberEnum &#123; A&#125;enum StringEnum &#123; A = 'a'&#125;console.log(NumberEnum[0]) // 'A'console.log(StringEnum['a']) // undefined constæšä¸¾å¸¸é‡æšä¸¾æœ‰ä¸¤ä¸ªç‰¹ç‚¹ï¼š å¸¸é‡æšä¸¾åªèƒ½ä½¿ç”¨å¸¸é‡æšä¸¾è¡¨è¾¾å¼ã€‚ 1234567891011// OKenum NumberEnum &#123; A, B = Math.random()&#125;// Errorconst enum NumberEnum &#123; A, B = Math.random()&#125; ä¸åŒäºå¸¸è§„çš„æšä¸¾ï¼Œå®ƒä»¬åœ¨ç¼–è¯‘é˜¶æ®µä¼šè¢«åˆ é™¤ã€‚å¸¸é‡æšä¸¾æˆå‘˜åœ¨ä½¿ç”¨çš„åœ°æ–¹ä¼šè¢«å†…è”è¿›æ¥ã€‚ä¹‹æ‰€ä»¥å¯ä»¥è¿™ä¹ˆåšæ˜¯å› ä¸ºï¼Œå¸¸é‡æšä¸¾ä¸å…è®¸åŒ…å«è®¡ç®—æˆå‘˜ã€‚ 12345678const enum Directions &#123; Up, Down, Left, Right&#125;let directions = [Directions.Up, Directions.Down, Directions.Left, Directions.Right] ç”Ÿæˆåçš„ä»£ç ä¸ºï¼š 1var directions = [0 /* Up */, 1 /* Down */, 2 /* Left */, 3 /* Right */]; å¤–éƒ¨æšä¸¾å¤–éƒ¨æšä¸¾ç”¨æ¥æè¿°å·²ç»å­˜åœ¨çš„æšä¸¾ç±»å‹çš„å½¢çŠ¶ 12345declare enum Enum &#123; A = 1, B, C = 2&#125; å¤–éƒ¨æšä¸¾å’Œéå¤–éƒ¨æšä¸¾ä¹‹é—´æœ‰ä¸€ä¸ªé‡è¦çš„åŒºåˆ«ï¼Œåœ¨æ­£å¸¸çš„æšä¸¾é‡Œï¼Œæ²¡æœ‰åˆå§‹åŒ–æ–¹æ³•çš„æˆå‘˜è¢«å½“æˆå¸¸æ•°æˆå‘˜ã€‚ å¯¹äºéå¸¸æ•°çš„å¤–éƒ¨æšä¸¾è€Œè¨€ï¼Œæ²¡æœ‰åˆå§‹åŒ–æ–¹æ³•æ—¶è¢«å½“åšéœ€è¦ç»è¿‡è®¡ç®—çš„ã€‚ ç±»å‹æ¨è®ºè¿™èŠ‚ä»‹ç»TypeScripté‡Œçš„ç±»å‹æ¨è®ºã€‚å³ï¼Œç±»å‹æ˜¯åœ¨å“ªé‡Œå¦‚ä½•è¢«æ¨æ–­çš„ åŸºç¡€TypeScripté‡Œï¼Œåœ¨æœ‰äº›æ²¡æœ‰æ˜ç¡®æŒ‡å‡ºç±»å‹çš„åœ°æ–¹ï¼Œç±»å‹æ¨è®ºä¼šå¸®åŠ©æä¾›ç±»å‹ã€‚å¦‚ä¸‹é¢çš„ä¾‹å­ 1let x = 3 å˜é‡xçš„ç±»å‹ä¸ºæ•°å­—ã€‚è¿™ç§æ¨æ–­å‘ç”Ÿåœ¨åˆå§‹åŒ–å˜é‡å’Œæˆå‘˜ï¼Œè®¾ç½®é»˜è®¤å‚æ•°å€¼å’Œå†³å®šå‡½æ•°è¿”å›å€¼æ—¶ã€‚ æœ€ä½³é€šç”¨ç±»å‹å½“éœ€è¦ä»å‡ ä¸ªè¡¨è¾¾å¼ä¸­æ¨æ–­ç±»å‹çš„æ—¶å€™ï¼Œä¼šä½¿ç”¨è¿™äº›è¡¨è¾¾å¼çš„ç±»å‹æ¥æ¨æ–­å‡ºä¸€ä¸ªæœ€é€‚åˆçš„é€šç”¨ç±»å‹ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°æœ€ä½³é€šç”¨ç±»å‹çš„è¯ï¼Œç±»å‹æ¨æ–­çš„ç»“æœä¸ºè”åˆæ•°ç»„ç±»å‹ã€‚ 1234let x = [0, 1, null] // (number)[]let zoo = [new Rhino(), new Elephant(), new Snake()] // (Rhino | Elephant | Snake)[]// å½“å€™é€‰ç±»å‹ä¸èƒ½ä½¿ç”¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æ˜ç¡®çš„æŒ‡å‡ºç±»å‹let zoo: Animal[] = [new Rhino(), new Elephant(), new Snake()] ä¸Šä¸‹æ–‡ç±»å‹TypeScriptç±»å‹æ¨è®ºä¹Ÿå¯èƒ½æŒ‰ç…§ç›¸åçš„æ–¹å‘è¿›è¡Œã€‚è¿™è¢«å«åšâ€æŒ‰ä¸Šä¸‹æ–‡å½’ç±»â€œã€‚æŒ‰ä¸Šä¸‹æ–‡å½’ç±»ä¼šå‘ç”Ÿåœ¨è¡¨è¾¾å¼çš„ç±»å‹ä¸æ‰€å¤„çš„ä½ç½®ç›¸å…³æ—¶ã€‚æ¯”å¦‚ï¼š 123window.onmousedown = function (mouseEvent) &#123; console.log(mouseEvent.message) // Error&#125; å¦‚æœä¸Šä¸‹æ–‡ç±»å‹è¡¨è¾¾å¼åŒ…å«äº†æ˜ç¡®çš„ç±»å‹ä¿¡æ¯ï¼Œä¸Šä¸‹æ–‡çš„ç±»å‹è¢«å¿½ç•¥ã€‚é‡å†™ä¸Šé¢çš„ä¾‹å­ 123window.onmousedown = function(mouseEvent: any) &#123; console.log(mouseEvent.message); //&lt;- Now, no error is given&#125;; ä¸Šä¸‹æ–‡å½’ç±»ä¼šåœ¨å¾ˆå¤šæƒ…å†µä¸‹ä½¿ç”¨åˆ°ã€‚ é€šå¸¸åŒ…å«å‡½æ•°çš„å‚æ•°ï¼Œèµ‹å€¼è¡¨è¾¾å¼çš„å³è¾¹ï¼Œç±»å‹æ–­è¨€ï¼Œå¯¹è±¡æˆå‘˜å’Œæ•°ç»„å­—é¢é‡å’Œè¿”å›å€¼è¯­å¥ã€‚ ä¸Šä¸‹æ–‡ç±»å‹ä¹Ÿä¼šåšä¸ºæœ€ä½³é€šç”¨ç±»å‹çš„å€™é€‰ç±»å‹ã€‚æ¯”å¦‚ï¼š 123function createZoo(): Animal[] &#123; return [new Rhino(), new Elephant(), new Snake()];&#125; è¿™ä¸ªä¾‹å­é‡Œï¼Œæœ€ä½³é€šç”¨ç±»å‹ç”±4ä¸ªå€™é€‰è€…ï¼šAnimalï¼ŒRhinoï¼ŒElephantå’ŒSnakeã€‚å½“ç„¶ï¼ŒAnimalä¼šè¢«ä½œä¸ºæœ€ä½³é€šç”¨ç±»å‹ ç±»å‹å…¼å®¹æ€§TypeScripté‡Œçš„ç±»å‹å…¼å®¹æ€§æ˜¯åŸºäºç»“æ„å­ç±»å‹çš„ã€‚ç»“æ„ç±»å‹æ˜¯ä¸€ç§å€¼ä½¿ç”¨å…¶æˆå‘˜æ¥æè¿°ç±»å‹çš„æ–¹å¼ã€‚å®ƒæ­£å¥½ä¸åä¹‰ï¼ˆnominalï¼‰ç±»å‹å½¢æˆå¯¹æ¯”ã€‚ï¼ˆåœ¨åŸºäºåä¹‰ç±»å‹çš„ç±»å‹ç³»ç»Ÿä¸­ï¼Œæ•°æ®ç±»å‹çš„å…¼å®¹æ€§æˆ–ç­‰ä»·æ€§æ˜¯é€šè¿‡æ˜ç¡®çš„å£°æ˜å’Œ/æˆ–ç±»å‹çš„åç§°æ¥å†³å®šçš„ã€‚è¿™ä¸ç»“æ„æ€§ç±»å‹ç³»ç»Ÿä¸åŒï¼Œå®ƒæ˜¯åŸºäºç±»å‹çš„ç»„æˆç»“æ„ï¼Œä¸”ä¸è¦æ±‚æ˜ç¡®åœ°å£°æ˜ã€‚ï¼‰ çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š 123456789interface Named &#123; name: string&#125;class Person &#123; name: string&#125;// OK, because of a structural typinglet p: Named = new Person TypeScriptçš„ç»“æ„æ€§å­ç±»å‹æ˜¯æ ¹æ®JavaScriptä»£ç çš„å…¸å‹å†™æ³•æ¥è®¾è®¡çš„ã€‚ å› ä¸ºJavaScripté‡Œå¹¿æ³›åœ°ä½¿ç”¨åŒ¿åå¯¹è±¡ï¼Œä¾‹å¦‚å‡½æ•°è¡¨è¾¾å¼å’Œå¯¹è±¡å­—é¢é‡ï¼Œæ‰€ä»¥ä½¿ç”¨ç»“æ„ç±»å‹ç³»ç»Ÿæ¥æè¿°è¿™äº›ç±»å‹æ¯”ä½¿ç”¨åä¹‰ç±»å‹ç³»ç»Ÿæ›´å¥½ã€‚ å¼€å§‹TypeScriptç»“æ„åŒ–ç±»å‹ç³»ç»Ÿçš„åŸºæœ¬è§„åˆ™æ˜¯ï¼Œå¦‚æœxè¦å…¼å®¹yï¼Œé‚£ä¹ˆyè‡³å°‘å…·æœ‰xç›¸åŒçš„å±æ€§ï¼Œå¦‚æœä¸€ä¸ªyç±»å‹çš„å€¼èµ‹ç»™ä¸€ä¸ªxç±»å‹çš„å€¼ï¼Œåˆ™ä¼šé€’å½’éå†xçš„å±æ€§æ˜¯å¦åœ¨yä¸­éƒ½å­˜åœ¨ï¼Œå¦‚æœéƒ½å­˜åœ¨ï¼Œåˆ™è¿™ä¸¤è€…æ˜¯å…¼å®¹çš„ï¼Œæ¯”å¦‚ 1234567891011interface Named &#123; props: &#123; name: string &#125;&#125;function greet(n: Named) &#123; console.log('Hello, ' + n.props.name)&#125;let y = &#123; props: &#123;name: 'a'&#125; &#125;greet(y) // OK æ¯”è¾ƒä¸¤ä¸ªå‡½æ•°x(æºå‡½æ•°) = y(ç›®æ ‡å‡½æ•°) ç›®æ ‡å‡½æ•°çš„å‚æ•°å¿…é¡»èƒ½åœ¨æºå‡½æ•°é‡Œæ‰¾åˆ°å¯¹åº”ç±»å‹çš„å‚æ•° æºå‡½æ•°çš„è¿”å›å€¼ç±»å‹å¿…é¡»æ˜¯ç›®æ ‡å‡½æ•°è¿”å›å€¼ç±»å‹çš„å­ç±»å‹ æ¯”è¾ƒå‡½æ•°å…¼å®¹æ€§çš„æ—¶å€™ï¼Œå¯é€‰å‚æ•°ä¸å¿…é¡»å‚æ•°æ˜¯å¯äº’æ¢çš„ã€‚æºç±»å‹ä¸Šæœ‰é¢å¤–çš„å¯é€‰å‚æ•°ä¸æ˜¯é”™è¯¯ï¼Œç›®æ ‡ç±»å‹çš„å¯é€‰å‚æ•°åœ¨æºç±»å‹é‡Œæ²¡æœ‰å¯¹åº”çš„å‚æ•°ä¹Ÿä¸æ˜¯é”™è¯¯ã€‚ å¯¹äºæœ‰é‡è½½çš„å‡½æ•°ï¼Œæºå‡½æ•°çš„æ¯ä¸ªé‡è½½éƒ½è¦åœ¨ç›®æ ‡å‡½æ•°ä¸Šæ‰¾åˆ°å¯¹åº”çš„ç­¾å 1234let x = (a: number) =&gt; (&#123; a: 1, b: 2 &#125;)let y = (b: number, s: string) =&gt; (&#123; a: 1 &#125;)y = x // OK æšä¸¾æ•°å­—æšä¸¾ç±»å‹ä¸æ•°å­—ç±»å‹å…¼å®¹ï¼Œå¹¶ä¸”æ•°å­—ç±»å‹ä¸æ•°å­—æšä¸¾ç±»å‹å…¼å®¹ã€‚ä¸åŒæšä¸¾ç±»å‹ä¹‹é—´æ˜¯ä¸å…¼å®¹çš„ã€‚æ¯”å¦‚ 12345678enum Status &#123; Ready, Waiting &#125;enum Color &#123; Red, Blue, Green &#125;let st = Status.Readylet a: number = 2st = 2 // OKa = Status.Ready // OKst = Color.Green; // Error ç±»ç±»ä¸å¯¹è±¡å­—é¢é‡å’Œæ¥å£å·®ä¸å¤šï¼Œä½†æœ‰ä¸€ç‚¹ä¸åŒï¼šç±»æœ‰é™æ€éƒ¨åˆ†å’Œå®ä¾‹éƒ¨åˆ†çš„ç±»å‹ã€‚æ¯”è¾ƒä¸¤ä¸ªç±»ç±»å‹çš„å¯¹è±¡æ—¶ï¼Œåªæœ‰å®ä¾‹çš„æˆå‘˜ä¼šè¢«æ¯”è¾ƒã€‚é™æ€æˆå‘˜å’Œæ„é€ å‡½æ•°ä¸åœ¨æ¯”è¾ƒçš„èŒƒå›´å†…ã€‚ ç±»çš„ç§æœ‰æˆå‘˜å’Œå—ä¿æŠ¤æˆå‘˜ä¼šå½±å“å…¼å®¹æ€§ã€‚ å½“æ£€æŸ¥ç±»å®ä¾‹çš„å…¼å®¹æ—¶ï¼Œå¦‚æœç›®æ ‡ç±»å‹åŒ…å«ä¸€ä¸ªç§æœ‰æˆå‘˜ï¼Œé‚£ä¹ˆæºç±»å‹å¿…é¡»åŒ…å«æ¥è‡ªåŒä¸€ä¸ªç±»çš„è¿™ä¸ªç§æœ‰æˆå‘˜ã€‚ åŒæ ·åœ°ï¼Œè¿™æ¡è§„åˆ™ä¹Ÿé€‚ç”¨äºåŒ…å«å—ä¿æŠ¤æˆå‘˜å®ä¾‹çš„ç±»å‹æ£€æŸ¥ã€‚ è¿™å…è®¸å­ç±»èµ‹å€¼ç»™çˆ¶ç±»ï¼Œä½†æ˜¯ä¸èƒ½èµ‹å€¼ç»™å…¶å®ƒæœ‰åŒæ ·ç±»å‹çš„ç±»ã€‚ æ³›å‹å› ä¸ºTypeScriptæ˜¯ç»“æ„æ€§çš„ç±»å‹ç³»ç»Ÿï¼Œç±»å‹å‚æ•°åªå½±å“ä½¿ç”¨å…¶åšä¸ºç±»å‹ä¸€éƒ¨åˆ†çš„ç»“æœç±»å‹ã€‚æ¯”å¦‚ï¼š 123456interface Empty&lt;T&gt; &#123;&#125;let x: Empty&lt;number&gt;;let y: Empty&lt;string&gt;;x = y; // OK, because y matches structure of x ä¸Šé¢ä»£ç é‡Œï¼Œxå’Œyæ˜¯å…¼å®¹çš„ï¼Œå› ä¸ºå®ƒä»¬çš„ç»“æ„ä½¿ç”¨ç±»å‹å‚æ•°æ—¶å¹¶æ²¡æœ‰ä»€ä¹ˆä¸åŒã€‚ æŠŠè¿™ä¸ªä¾‹å­æ”¹å˜ä¸€ä¸‹ï¼Œå¢åŠ ä¸€ä¸ªæˆå‘˜ï¼Œå°±èƒ½çœ‹å‡ºæ˜¯å¦‚ä½•å·¥ä½œçš„äº†ï¼š 1234567interface NotEmpty&lt;T&gt; &#123; data: T;&#125;let x: NotEmpty&lt;number&gt;;let y: NotEmpty&lt;string&gt;;x = y; // Error, because x and y are not compatible å¯¹äºæ²¡æŒ‡å®šæ³›å‹ç±»å‹çš„æ³›å‹å‚æ•°æ—¶ï¼Œä¼šæŠŠæ‰€æœ‰æ³›å‹å‚æ•°å½“æˆanyæ¯”è¾ƒã€‚ ç„¶åç”¨ç»“æœç±»å‹è¿›è¡Œæ¯”è¾ƒï¼Œå°±åƒä¸Šé¢ç¬¬ä¸€ä¸ªä¾‹å­ã€‚æ¯”å¦‚ï¼š 123456789let identity = function&lt;T&gt;(x: T): T &#123; // ...&#125;let reverse = function&lt;U&gt;(y: U): U &#123; // ...&#125;identity = reverse; // OK, because (x: any) =&gt; any matches (y: any) =&gt; any é«˜çº§ç±»å‹æœ¬èŠ‚ä¸»è¦ä»‹ç»é€šè¿‡typeå…³é”®å­—åˆ›å»ºé«˜çº§ç±»å‹ï¼Œè‹¥è¦è¯¦ç»†äº†è§£æ­¤èŠ‚ï¼Œè¯·é˜…è¯»æºæ–‡æ¡£ äº¤å‰ç±»å‹ï¼šäº¤å‰ç±»å‹æ˜¯å°†å¤šä¸ªç±»å‹åˆå¹¶ä¸ºä¸€ä¸ªç±»å‹ã€‚ è¿™è®©æˆ‘ä»¬å¯ä»¥æŠŠç°æœ‰çš„å¤šç§ç±»å‹å åŠ åˆ°ä¸€èµ·æˆä¸ºä¸€ç§ç±»å‹ï¼Œå®ƒåŒ…å«äº†æ‰€éœ€çš„æ‰€æœ‰ç±»å‹çš„ç‰¹æ€§ã€‚ ä¾‹å¦‚ï¼Œ Person &amp; Serializable &amp; LoggableåŒæ—¶æ˜¯ Person å’Œ Serializable å’Œ Loggableã€‚ å°±æ˜¯è¯´è¿™ä¸ªç±»å‹çš„å¯¹è±¡åŒæ—¶æ‹¥æœ‰äº†è¿™ä¸‰ç§ç±»å‹çš„æˆå‘˜ã€‚ è”åˆç±»å‹ï¼šè¡¨ç¤ºä¸€ä¸ªå€¼å¯ä»¥æ˜¯å‡ ç§ç±»å‹ä¹‹ä¸€ã€‚æˆ‘ä»¬ç”¨ç«–çº¿ï¼ˆ|ï¼‰åˆ†éš”æ¯ä¸ªç±»å‹ï¼Œæ‰€ä»¥number | string | booleanè¡¨ç¤ºä¸€ä¸ªå€¼å¯ä»¥æ˜¯numberï¼Œstringï¼Œæˆ–booleanã€‚å¦‚æœä¸€ä¸ªå€¼æ˜¯è”åˆç±»å‹ï¼Œæˆ‘ä»¬åªèƒ½è®¿é—®æ­¤è”åˆç±»å‹çš„æ‰€æœ‰ç±»å‹é‡Œå…±æœ‰çš„æˆå‘˜ã€‚ ç±»å‹ä¿æŠ¤ä¸åŒºåˆ†ç±»å‹ ç±»å‹è°“è¯ï¼šparameterName is Type typeofç±»å‹ä¿æŠ¤ï¼šåªæœ‰ä¸¤ç§å½¢å¼èƒ½è¢«è¯†åˆ«ï¼š typeof v === â€œtypenameâ€å’Œ typeof v !== â€œtypenameâ€ï¼Œ â€œtypenameâ€å¿…é¡»æ˜¯ â€œnumberâ€ï¼Œ â€œstringâ€ï¼Œ â€œbooleanâ€æˆ– â€œsymbolâ€ã€‚ ä½†æ˜¯TypeScriptå¹¶ä¸ä¼šé˜»æ­¢ä½ ä¸å…¶å®ƒå­—ç¬¦ä¸²æ¯”è¾ƒï¼Œè¯­è¨€ä¸ä¼šæŠŠé‚£äº›è¡¨è¾¾å¼è¯†åˆ«ä¸ºç±»å‹ä¿æŠ¤ã€‚ instanceofç±»å‹ä¿æŠ¤ Symbolsè¿­ä»£å™¨å’Œç”Ÿæˆå™¨å½“ä¸€ä¸ªå¯¹è±¡å®ç°äº†Symbol.iteratorå±æ€§æ—¶ï¼Œæˆ‘ä»¬è®¤ä¸ºå®ƒæ˜¯å¯è¿­ä»£çš„ã€‚ forâ€¦of vs forâ€¦in forâ€¦oféå†çš„æ˜¯å€¼ï¼Œforâ€¦inéå†çš„æ˜¯å±æ€§ å¦ä¸€ä¸ªåŒºåˆ«æ˜¯for..inå¯ä»¥æ“ä½œä»»ä½•å¯¹è±¡ï¼›å®ƒæä¾›äº†æŸ¥çœ‹å¯¹è±¡å±æ€§çš„ä¸€ç§æ–¹æ³•ã€‚ ä½†æ˜¯ for..ofå…³æ³¨äºè¿­ä»£å¯¹è±¡çš„å€¼ã€‚å†…ç½®å¯¹è±¡Mapå’ŒSetå·²ç»å®ç°äº†Symbol.iteratoræ–¹æ³•ï¼Œè®©æˆ‘ä»¬å¯ä»¥è®¿é—®å®ƒä»¬ä¿å­˜çš„å€¼ã€‚ 12345678910let pets = new Set([\"Cat\", \"Dog\", \"Hamster\"]);pets[\"species\"] = \"mammals\";for (let pet in pets) &#123; console.log(pet); // \"species\"&#125;for (let pet of pets) &#123; console.log(pet); // \"Cat\", \"Dog\", \"Hamster\"&#125; ä»£ç ç”Ÿæˆ ç›®æ ‡ä¸ºES5å’ŒES3 å½“ç”Ÿæˆç›®æ ‡ä¸ºES5æˆ–ES3ï¼Œè¿­ä»£å™¨åªå…è®¸åœ¨Arrayç±»å‹ä¸Šä½¿ç”¨ã€‚ åœ¨éæ•°ç»„å€¼ä¸Šä½¿ç”¨for..ofè¯­å¥ä¼šå¾—åˆ°ä¸€ä¸ªé”™è¯¯ï¼Œå°±ç®—è¿™äº›éæ•°ç»„å€¼å·²ç»å®ç°äº†Symbol.iteratorå±æ€§ã€‚ ç¼–è¯‘å™¨ä¼šç”Ÿæˆä¸€ä¸ªç®€å•çš„forå¾ªç¯åšä¸ºforâ€¦ofå¾ªç¯ï¼Œæ¯”å¦‚ï¼š 1234let numbers = [1, 2, 3];for (let num of numbers) &#123; console.log(num);&#125; ç”Ÿæˆçš„ä»£ç ä¸ºï¼š 12345var numbers = [1, 2, 3];for (var _i = 0; _i &lt; numbers.length; _i++) &#123; var num = numbers[_i]; console.log(num);&#125; ç›®æ ‡ä¸ºECMAScript 2015æˆ–æ›´é«˜ å½“ç›®æ ‡ä¸ºå…¼å®¹ECMAScript 2015çš„å¼•æ“æ—¶ï¼Œç¼–è¯‘å™¨ä¼šç”Ÿæˆç›¸å¯¹äºå¼•æ“çš„for..ofå†…ç½®è¿­ä»£å™¨å®ç°æ–¹å¼ æ¨¡å—åŒECMAScript 2015çš„æ¨¡å—æ¦‚å¿µ export = å’Œ importä¸ºäº†æ”¯æŒCommonJSå’ŒAMDçš„exportsï¼ŒTypeScriptæä¾›äº†export = å’Œimport = require()è¯­æ³• ZipCodeValidator.ts1234567let numberRegexp = /^[0-9]+$/;class ZipCodeValidator &#123; isAcceptable(s: string) &#123; return s.length === 5 &amp;&amp; numberRegexp.test(s); &#125;&#125;export = ZipCodeValidator; Test.ts123456789101112import zip = require(\"./ZipCodeValidator\");// Some samples to trylet strings = [\"Hello\", \"98052\", \"101\"];// Validators to uselet validator = new zip();// Show whether each string passed each validatorstrings.forEach(s =&gt; &#123; console.log(`\"$&#123; s &#125;\" - $&#123; validator.isAcceptable(s) ? \"matches\" : \"does not match\" &#125;`);&#125;); å±é™©ä¿¡å· æ–‡ä»¶çš„é¡¶å±‚å£°æ˜æ˜¯export namespace Foo { â€¦ }ï¼ˆåˆ é™¤Fooå¹¶æŠŠæ‰€æœ‰å†…å®¹å‘ä¸Šå±‚ç§»åŠ¨ä¸€å±‚ï¼‰ æ–‡ä»¶åªæœ‰ä¸€ä¸ªexport class æˆ– export functionï¼ˆè€ƒè™‘ä½¿ç”¨export defaultï¼‰ å¤šä¸ªæ–‡ä»¶çš„é¡¶å±‚å…·æœ‰åŒæ ·çš„export namespace Foo {ï¼ˆä¸è¦ä»¥ä¸ºè¿™äº›ä¼šè¢«åˆå¹¶åˆ°ä¸€ä¸ªFooä¸­ï¼ï¼‰ å‘½åç©ºé—´å‘½åç©ºé—´å’Œæ¨¡å—åœ¨TypeScriptä¸­ï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½ä»£è¡¨ä¸€ä¸ªæ¨¡å—ï¼Œé€šè¿‡importï¼Œexportï¼Œexport = å’Œimport = require(â€¦)è¿›è¡Œå¯¼å…¥å’Œå¯¼å‡ºï¼Œåœ¨TypeScript1.5ä¹‹å‰ç§°ä¸ºå¤–éƒ¨æ¨¡å—ã€‚å‘½åç©ºé—´namespaceï¼Œåœ¨TypeScript1.5ä¹‹å‰ç§°ä¸ºå†…éƒ¨æ¨¡å—ï¼Œæ˜¯å®šä¹‰åœ¨å…¨å±€ç©ºé—´ä¸‹çš„ä¸€ä¸ªJSå¯¹è±¡ï¼Œä¸å­˜åœ¨å¯¼å…¥å’Œå¯¼å‡ºçš„æ¦‚å¿µï¼Œä¸åŒæ–‡ä»¶ç›¸åŒçš„å‘½åç©ºé—´é‡Œçš„å˜é‡ä¼šè¢«æ•´åˆåˆ°ä¸€èµ·ï¼Œå› æ­¤éœ€è¦æŠŠæ‰€æœ‰ç›¸åŒå‘½åç©ºé—´çš„æ–‡ä»¶é€šè¿‡â€“outFileè¾“å‡ºåˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œé˜²æ­¢å‘ç”Ÿè¿è¡Œæ—¶é”™è¯¯ï¼Œä½¿ç”¨å…¨å±€å‘½åç©ºé—´çš„æ—¶å€™ï¼Œä¸èƒ½ä½¿ç”¨importå¯¼å…¥å…¶ä»–æ¨¡å—ã€‚å½“æŠŠnamespaceé€šè¿‡exportå¯¼å‡ºçš„æ—¶å€™ï¼Œè¿™ä¸ªå†…éƒ¨æ¨¡å—å°±å˜æˆäº†å¤–éƒ¨æ¨¡å—ã€‚ å‘½åç©ºé—´å‘½åç©ºé—´æ˜¯ä½äºå…¨å±€å‘½åç©ºé—´ä¸‹çš„ä¸€ä¸ªæ™®é€šçš„å¸¦æœ‰åå­—çš„JavaScriptå¯¹è±¡ã€‚ è¿™ä»¤å‘½åç©ºé—´ååˆ†å®¹æ˜“ä½¿ç”¨ã€‚ å®ƒä»¬å¯ä»¥åœ¨å¤šæ–‡ä»¶ä¸­åŒæ—¶ä½¿ç”¨ï¼Œå¹¶é€šè¿‡ â€“outFileç»“åˆåœ¨ä¸€èµ·ã€‚ å‘½åç©ºé—´æ˜¯å¸®ä½ ç»„ç»‡Webåº”ç”¨ä¸é”™çš„æ–¹å¼ï¼Œä½ å¯ä»¥æŠŠæ‰€æœ‰ä¾èµ–éƒ½æ”¾åœ¨HTMLé¡µé¢çš„&lt;script&gt;æ ‡ç­¾é‡Œã€‚ ä½†å°±åƒå…¶å®ƒçš„å…¨å±€å‘½åç©ºé—´æ±¡æŸ“ä¸€æ ·ï¼Œå®ƒå¾ˆéš¾å»è¯†åˆ«ç»„ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œå°¤å…¶æ˜¯åœ¨å¤§å‹çš„åº”ç”¨ä¸­ã€‚ æ¨¡å—åƒå‘½åç©ºé—´ä¸€æ ·ï¼Œæ¨¡å—å¯ä»¥åŒ…å«ä»£ç å’Œå£°æ˜ã€‚ ä¸åŒçš„æ˜¯æ¨¡å—å¯ä»¥ å£°æ˜å®ƒçš„ä¾èµ–ã€‚ æ¨¡å—ä¼šæŠŠä¾èµ–æ·»åŠ åˆ°æ¨¡å—åŠ è½½å™¨ä¸Šï¼ˆä¾‹å¦‚CommonJs / Require.jsï¼‰ã€‚ å¯¹äºå°å‹çš„JSåº”ç”¨æ¥è¯´å¯èƒ½æ²¡å¿…è¦ï¼Œä½†æ˜¯å¯¹äºå¤§å‹åº”ç”¨ï¼Œè¿™ä¸€ç‚¹ç‚¹çš„èŠ±è´¹ä¼šå¸¦æ¥é•¿ä¹…çš„æ¨¡å—åŒ–å’Œå¯ç»´æŠ¤æ€§ä¸Šçš„ä¾¿åˆ©ã€‚ æ¨¡å—ä¹Ÿæä¾›äº†æ›´å¥½çš„ä»£ç é‡ç”¨ï¼Œæ›´å¼ºçš„å°é—­æ€§ä»¥åŠæ›´å¥½çš„ä½¿ç”¨å·¥å…·è¿›è¡Œä¼˜åŒ–ã€‚ æ¨¡å—è§£æå®˜ç½‘åŸæ–‡ å£°æ˜åˆå¹¶æ¥å£åˆå¹¶æ¥å£çš„éå‡½æ•°çš„æˆå‘˜åº”è¯¥æ˜¯å”¯ä¸€çš„ã€‚å¦‚æœå®ƒä»¬ä¸æ˜¯å”¯ä¸€çš„ï¼Œé‚£ä¹ˆå®ƒä»¬å¿…é¡»æ˜¯ç›¸åŒçš„ç±»å‹ã€‚å¦‚æœä¸¤ä¸ªæ¥å£ä¸­åŒæ—¶å£°æ˜äº†åŒåçš„éå‡½æ•°æˆå‘˜ä¸”å®ƒä»¬çš„ç±»å‹ä¸åŒï¼Œåˆ™ç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚ äºå‡½æ•°æˆå‘˜ï¼Œæ¯ä¸ªåŒåå‡½æ•°å£°æ˜éƒ½ä¼šè¢«å½“æˆè¿™ä¸ªå‡½æ•°çš„ä¸€ä¸ªé‡è½½ã€‚ åŒæ—¶éœ€è¦æ³¨æ„ï¼Œå½“æ¥å£ Aä¸åæ¥çš„æ¥å£ Aåˆå¹¶æ—¶ï¼Œåé¢çš„æ¥å£å…·æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§ã€‚ å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š 123456789101112interface Cloner &#123; clone(animal: Animal): Animal;&#125;interface Cloner &#123; clone(animal: Sheep): Sheep;&#125;interface Cloner &#123; clone(animal: Dog): Dog; clone(animal: Cat): Cat;&#125; è¿™ä¸‰ä¸ªæ¥å£åˆå¹¶æˆä¸€ä¸ªå£°æ˜ï¼š 123456interface Cloner &#123; clone(animal: Dog): Dog; clone(animal: Cat): Cat; clone(animal: Sheep): Sheep; clone(animal: Animal): Animal;&#125; è¿™ä¸ªè§„åˆ™æœ‰ä¸€ä¸ªä¾‹å¤–æ˜¯å½“å‡ºç°ç‰¹æ®Šçš„å‡½æ•°ç­¾åæ—¶ã€‚ å¦‚æœç­¾åé‡Œæœ‰ä¸€ä¸ªå‚æ•°çš„ç±»å‹æ˜¯ å•ä¸€çš„å­—ç¬¦ä¸²å­—é¢é‡ï¼ˆæ¯”å¦‚ï¼Œä¸æ˜¯å­—ç¬¦ä¸²å­—é¢é‡çš„è”åˆç±»å‹ï¼‰ï¼Œé‚£ä¹ˆå®ƒå°†ä¼šè¢«æå‡åˆ°é‡è½½åˆ—è¡¨çš„æœ€é¡¶ç«¯ã€‚ æ¯”å¦‚ï¼Œä¸‹é¢çš„æ¥å£ä¼šåˆå¹¶åˆ°ä¸€èµ·ï¼š 1234567891011interface Document &#123; createElement(tagName: any): Element;&#125;interface Document &#123; createElement(tagName: \"div\"): HTMLDivElement; createElement(tagName: \"span\"): HTMLSpanElement;&#125;interface Document &#123; createElement(tagName: string): HTMLElement; createElement(tagName: \"canvas\"): HTMLCanvasElement;&#125; åˆå¹¶åçš„Documentå°†ä¼šåƒä¸‹é¢è¿™æ ·ï¼š 1234567interface Document &#123; createElement(tagName: \"canvas\"): HTMLCanvasElement; createElement(tagName: \"div\"): HTMLDivElement; createElement(tagName: \"span\"): HTMLSpanElement; createElement(tagName: string): HTMLElement; createElement(tagName: any): Element;&#125; åˆå¹¶å‘½åç©ºé—´å¯¹äºå‘½åç©ºé—´çš„åˆå¹¶ï¼Œæ¨¡å—å¯¼å‡ºçš„åŒåæ¥å£è¿›è¡Œåˆå¹¶ï¼Œæ„æˆå•ä¸€å‘½åç©ºé—´å†…å«åˆå¹¶åçš„æ¥å£ã€‚ å¯¹äºå‘½åç©ºé—´é‡Œå€¼çš„åˆå¹¶ï¼Œå¦‚æœå½“å‰å·²ç»å­˜åœ¨ç»™å®šåå­—çš„å‘½åç©ºé—´ï¼Œé‚£ä¹ˆåæ¥çš„å‘½åç©ºé—´çš„å¯¼å‡ºæˆå‘˜ä¼šè¢«åŠ åˆ°å·²ç»å­˜åœ¨çš„é‚£ä¸ªæ¨¡å—é‡Œ Animalså£°æ˜åˆå¹¶ç¤ºä¾‹ï¼š 12345678namespace Animals &#123; export class Zebra &#123; &#125;&#125;namespace Animals &#123; export interface Legged &#123; numberOfLegs: number; &#125; export class Dog &#123; &#125;&#125; ç­‰åŒäºï¼š 123456namespace Animals &#123; export interface Legged &#123; numberOfLegs: number; &#125; export class Zebra &#123; &#125; export class Dog &#123; &#125;&#125; é™¤äº†è¿™äº›åˆå¹¶å¤–ï¼Œä½ è¿˜éœ€è¦äº†è§£éå¯¼å‡ºæˆå‘˜æ˜¯å¦‚ä½•å¤„ç†çš„ã€‚ éå¯¼å‡ºæˆå‘˜ä»…åœ¨å…¶åŸæœ‰çš„ï¼ˆåˆå¹¶å‰çš„ï¼‰å‘½åç©ºé—´å†…å¯è§ã€‚è¿™å°±æ˜¯è¯´åˆå¹¶ä¹‹åï¼Œä»å…¶å®ƒå‘½åç©ºé—´åˆå¹¶è¿›æ¥çš„æˆå‘˜æ— æ³•è®¿é—®éå¯¼å‡ºæˆå‘˜ã€‚ 12345678910111213namespace Animal &#123; let haveMuscles = true; export function animalsHaveMuscles() &#123; return haveMuscles; &#125;&#125;namespace Animal &#123; export function doAnimalsHaveMuscles() &#123; return haveMuscles; // Error, because haveMuscles is not accessible here &#125;&#125; å‘½åç©ºé—´ä¸ç±»å’Œå‡½æ•°å’Œæšä¸¾ç±»å‹åˆå¹¶ åˆå¹¶å‘½åç©ºé—´å’Œç±» 123456class Album &#123; label: Album.AlbumLabel;&#125;namespace Album &#123; export class AlbumLabel &#123; &#125;&#125; ç”Ÿæˆçš„ä»£ç  1234567class Album &#123;&#125;(function (Album) &#123; class AlbumLabel &#123; &#125; Album.AlbumLabel = AlbumLabel;&#125;)(Album || (Album = &#123;&#125;)); åˆ©ç”¨å‘½åç©ºé—´æ¥æ·»åŠ å‡½æ•°çš„å±æ€§ 12345678910function buildLabel(name: string): string &#123; return buildLabel.prefix + name + buildLabel.suffix;&#125;namespace buildLabel &#123; export let suffix = \"\"; export let prefix = \"Hello, \";&#125;console.log(buildLabel(\"Sam Smith\")); åˆ©ç”¨å‘½åç©ºé—´æ¥æ‰©å±•æšä¸¾å‹ï¼š 12345678910111213141516171819202122enum Color &#123; red = 1, green = 2, blue = 4&#125;namespace Color &#123; export function mixColor(colorName: string) &#123; if (colorName == \"yellow\") &#123; return Color.red + Color.green; &#125; else if (colorName == \"white\") &#123; return Color.red + Color.green + Color.blue; &#125; else if (colorName == \"magenta\") &#123; return Color.red + Color.blue; &#125; else if (colorName == \"cyan\") &#123; return Color.green + Color.blue; &#125; &#125;&#125; éæ³•çš„åˆå¹¶TypeScriptå¹¶éå…è®¸æ‰€æœ‰çš„åˆå¹¶ã€‚ç›®å‰ï¼Œç±»ä¸èƒ½ä¸å…¶å®ƒç±»æˆ–å˜é‡åˆå¹¶ã€‚ JSXåŸºæœ¬ç”¨æ³•æƒ³è¦ä½¿ç”¨JSXå¿…é¡»åšä¸¤ä»¶äº‹ ç»™æ–‡ä»¶ä¸€ä¸ª.tsxæ‰©å±•å å¯ç”¨jsxé€‰é¡¹ TypeScriptå…·æœ‰ä¸‰ç§JSXæ¨¡å¼ï¼š preserveï¼šåœ¨preserveræ¨¡å¼ä¸‹ç”Ÿæˆä»£ç ä¸­ä¼šä¿ç•™JSXä»¥ä¾›åç»­çš„è½¬æ¢æ“ä½œä½¿ç”¨ï¼ˆæ¯”å¦‚ï¼šBabelï¼‰ï¼Œè¾“å‡ºæ–‡ä»¶æ‰©å±•åä¸º.jsxã€‚ reactï¼šä¼šç”ŸæˆReact.createElementï¼Œåœ¨ä½¿ç”¨å‰ä¸éœ€è¦å†è¿›è¡Œè½¬æ¢æ“ä½œäº†ï¼Œè¾“å‡ºæ–‡ä»¶æ‰©å±•åä¸º.jsã€‚ react-nativeï¼šç›¸å½“äºpreserveï¼Œè¾“å‡ºæ–‡ä»¶æ‰©å±•åä¸º.jsã€‚ ç±»å‹æ£€æŸ¥ å›ºæœ‰å…ƒç´ ï¼šç¯å¢ƒè‡ªå¸¦çš„æŸäº›ä¸œè¥¿ï¼ˆæ¯”å¦‚ï¼ŒDOMç¯å¢ƒé‡Œçš„divæˆ–spanç»„ä»¶ï¼‰ï¼Œå›ºæœ‰å…ƒç´ ä½¿ç”¨ç‰¹æ®Šçš„æ¥å£JSX.IntrinsicElementsæ¥æŸ¥æ‰¾ã€‚é»˜è®¤åœ°ï¼Œå¦‚æœè¿™ä¸ªæ¥å£æ²¡æœ‰æŒ‡å®šï¼Œä¼šå…¨éƒ¨é€šè¿‡ï¼Œä¸å¯¹å›ºæœ‰å…ƒç´ è¿›è¡Œç±»å‹æ£€æŸ¥ã€‚ç„¶è€Œï¼Œå¦‚æœè¿™ä¸ªæ¥å£å­˜åœ¨ï¼Œé‚£ä¹ˆå›ºæœ‰å…ƒç´ çš„åå­—éœ€è¦åœ¨JSX.IntrinsicElementsæ¥å£çš„å±æ€§é‡ŒæŸ¥æ‰¾ã€‚ ä¾‹å¦‚ï¼š 12345678declare namespace JSX &#123; interface IntrinsicElements &#123; foo: any &#125;&#125;let a = &lt;foo /&gt;; // æ­£ç¡®let b = &lt;div /&gt;; // é”™è¯¯ åŸºäºå€¼å¾—å…ƒç´ ï¼š åŸºäºå€¼å¾—å…ƒç´ ä¼šç®€å•çš„åœ¨å®ƒæ‰€åœ¨çš„ä½œç”¨åŸŸé‡ŒæŒ‰æ ‡è¯†ç¬¦æŸ¥æ‰¾ è£…é¥°å™¨è£…é¥°å™¨æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„å£°æ˜ï¼Œå®ƒèƒ½å¤Ÿè¢«é™„åŠ åˆ°ç±»å£°æ˜ï¼Œæ–¹æ³•ï¼Œ è®¿é—®ç¬¦ï¼Œå±æ€§æˆ–å‚æ•°ä¸Šã€‚ è£…é¥°å™¨ä½¿ç”¨ @expressionè¿™ç§å½¢å¼ï¼Œexpressionæ±‚å€¼åå¿…é¡»ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œå®ƒä¼šåœ¨è¿è¡Œæ—¶è¢«è°ƒç”¨ï¼Œè¢«è£…é¥°çš„å£°æ˜ä¿¡æ¯åšä¸ºå‚æ•°ä¼ å…¥ã€‚ ä¾‹å¦‚ï¼Œæœ‰ä¸€ä¸ª@sealedè£…é¥°å™¨ï¼Œæˆ‘ä»¬ä¼šè¿™æ ·å®šä¹‰sealedå‡½æ•°ï¼š 123function sealed(target) &#123; // do something with \"target\" ...&#125; è£…é¥°å™¨å·¥å‚å¦‚æœæˆ‘ä»¬è¦å®šåˆ¶ä¸€ä¸ªä¿®é¥°å™¨å¦‚ä½•åº”ç”¨åˆ°ä¸€ä¸ªå£°æ˜ä¸Šï¼Œæˆ‘ä»¬å¾—å†™ä¸€ä¸ªè£…é¥°å™¨å·¥å‚å‡½æ•°ã€‚ è£…é¥°å™¨å·¥å‚å°±æ˜¯ä¸€ä¸ªç®€å•çš„å‡½æ•°ï¼Œå®ƒè¿”å›ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œä»¥ä¾›è£…é¥°å™¨åœ¨è¿è¡Œæ—¶è°ƒç”¨ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼æ¥å†™ä¸€ä¸ªè£…é¥°å™¨å·¥å‚å‡½æ•°ï¼š 12345function color(value: string) &#123; // è¿™æ˜¯ä¸€ä¸ªè£…é¥°å™¨å·¥å‚ return function (target) &#123; // è¿™æ˜¯è£…é¥°å™¨ // do something with \"target\" and \"value\"... &#125;&#125; è£…é¥°å™¨ç»„åˆå¤šä¸ªè£…é¥°å™¨å¯ä»¥åŒæ—¶åº”ç”¨åˆ°ä¸€ä¸ªå£°æ˜ä¸Šï¼Œå°±åƒä¸‹é¢çš„ç¤ºä¾‹ 1234567// ä¹¦å†™åœ¨åŒä¸€è¡Œä¸Š@f @g x// ä¹¦å†™åœ¨å¤šè¡Œä¸Š@f@gx å½“å¤šä¸ªè£…é¥°å™¨åº”ç”¨äºä¸€ä¸ªå£°æ˜ä¸Šï¼Œå®ƒä»¬æ±‚å€¼æ–¹å¼ä¸å¤åˆå‡½æ•°ç›¸ä¼¼ã€‚åœ¨è¿™ä¸ªæ¨¡å‹ä¸‹ï¼Œå½“å¤åˆfå’Œgæ—¶ï¼Œå¤åˆçš„ç»“æœ(f âˆ˜ g)(x)ç­‰åŒäºf(g(x))ã€‚ è£…é¥°å™¨æ±‚å€¼ç±»ä¸­ä¸åŒå£°æ˜ä¸Šçš„è£…é¥°å™¨å°†æŒ‰ä»¥ä¸‹è§„å®šçš„é¡ºåºåº”ç”¨ï¼š å‚æ•°è£…é¥°å™¨ï¼Œç„¶åä¾æ¬¡æ˜¯æ–¹æ³•è£…é¥°å™¨ï¼Œè®¿é—®ç¬¦è£…é¥°å™¨ï¼Œæˆ–å±æ€§è£…é¥°å™¨åº”ç”¨åˆ°æ¯ä¸ªå®ä¾‹æˆå‘˜ã€‚ å‚æ•°è£…é¥°å™¨ï¼Œç„¶åä¾æ¬¡æ˜¯æ–¹æ³•è£…é¥°å™¨ï¼Œè®¿é—®ç¬¦è£…é¥°å™¨ï¼Œæˆ–å±æ€§è£…é¥°å™¨åº”ç”¨åˆ°æ¯ä¸ªé™æ€æˆå‘˜ã€‚ å‚æ•°è£…é¥°å™¨åº”ç”¨åˆ°æ„é€ å‡½æ•°ã€‚ ç±»è£…é¥°å™¨åº”ç”¨åˆ°ç±»ã€‚ ç±»è£…é¥°å™¨å‚æ•°ï¼š ç±»çš„æ„é€ å‡½æ•°ã€‚ å¦‚æœç±»è£…é¥°å™¨è¿”å›ä¸€ä¸ªå€¼ï¼Œå®ƒä¼šä½¿ç”¨æä¾›çš„æ„é€ å‡½æ•°æ¥æ›¿æ¢ç±»çš„å£°æ˜ã€‚ 1æ³¨æ„ å¦‚æœä½ è¦è¿”å›ä¸€ä¸ªæ–°çš„æ„é€ å‡½æ•°ï¼Œä½ å¿…é¡»æ³¨æ„å¤„ç†å¥½åŸæ¥çš„åŸå‹é“¾ã€‚åœ¨è¿è¡Œæ—¶çš„è£…é¥°å™¨è°ƒç”¨é€»è¾‘ä¸­ä¸ä¼šä¸ºä½ åšè¿™äº›ã€‚ æ–¹æ³•è£…é¥°å™¨å‚æ•°ï¼š å¯¹äºé™æ€æˆå‘˜æ¥è¯´æ˜¯ç±»çš„æ„é€ å‡½æ•°ï¼Œå¯¹äºå®ä¾‹æˆå‘˜æ˜¯ç±»çš„åŸå‹å¯¹è±¡ã€‚ æˆå‘˜çš„åå­—ã€‚ æˆå‘˜çš„å±æ€§æè¿°ç¬¦ã€‚ 1æ³¨æ„ å¦‚æœä»£ç è¾“å‡ºç›®æ ‡ç‰ˆæœ¬å°äºES5ï¼Œå±æ€§æè¿°ç¬¦å°†ä¼šæ˜¯undefinedã€‚ å¦‚æœæ–¹æ³•è£…é¥°å™¨è¿”å›ä¸€ä¸ªå€¼ï¼Œå®ƒä¼šè¢«ç”¨ä½œæ–¹æ³•çš„å±æ€§æè¿°ç¬¦ã€‚ 1æ³¨æ„ å¦‚æœä»£ç è¾“å‡ºç›®æ ‡ç‰ˆæœ¬å°äºES5è¿”å›å€¼ä¼šè¢«å¿½ç•¥ã€‚ è®¿é—®å™¨è£…é¥°å™¨1æ³¨æ„ TypeScriptä¸å…è®¸åŒæ—¶è£…é¥°ä¸€ä¸ªæˆå‘˜çš„getå’Œsetè®¿é—®å™¨ã€‚å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œä¸€ä¸ªæˆå‘˜çš„æ‰€æœ‰è£…é¥°çš„å¿…é¡»åº”ç”¨åœ¨æ–‡æ¡£é¡ºåºçš„ç¬¬ä¸€ä¸ªè®¿é—®å™¨ä¸Šã€‚è¿™æ˜¯å› ä¸ºï¼Œåœ¨è£…é¥°å™¨åº”ç”¨äºä¸€ä¸ªå±æ€§æè¿°ç¬¦æ—¶ï¼Œå®ƒè”åˆäº†getå’Œsetè®¿é—®å™¨ï¼Œè€Œä¸æ˜¯åˆ†å¼€å£°æ˜çš„ã€‚ å‚æ•°ï¼š å¯¹äºé™æ€æˆå‘˜æ¥è¯´æ˜¯ç±»çš„æ„é€ å‡½æ•°ï¼Œå¯¹äºå®ä¾‹æˆå‘˜æ˜¯ç±»çš„åŸå‹å¯¹è±¡ã€‚ æˆå‘˜çš„åå­—ã€‚ æˆå‘˜çš„å±æ€§æè¿°ç¬¦ã€‚ 1æ³¨æ„ å¦‚æœä»£ç è¾“å‡ºç›®æ ‡ç‰ˆæœ¬å°äºES5ï¼Œå±æ€§æè¿°ç¬¦å°†ä¼šæ˜¯undefinedã€‚ å¦‚æœæ–¹æ³•è£…é¥°å™¨è¿”å›ä¸€ä¸ªå€¼ï¼Œå®ƒä¼šè¢«ç”¨ä½œæ–¹æ³•çš„å±æ€§æè¿°ç¬¦ã€‚ 1æ³¨æ„ å¦‚æœä»£ç è¾“å‡ºç›®æ ‡ç‰ˆæœ¬å°äºES5è¿”å›å€¼ä¼šè¢«å¿½ç•¥ã€‚ å±æ€§è£…é¥°å™¨å±æ€§è£…é¥°å™¨è¡¨è¾¾å¼ä¼šåœ¨è¿è¡Œæ—¶å½“ä½œå‡½æ•°è¢«è°ƒç”¨ï¼Œä¼ å…¥ä¸‹åˆ—2ä¸ªå‚æ•°ï¼š å¯¹äºé™æ€æˆå‘˜æ¥è¯´æ˜¯ç±»çš„æ„é€ å‡½æ•°ï¼Œå¯¹äºå®ä¾‹æˆå‘˜æ˜¯ç±»çš„åŸå‹å¯¹è±¡ã€‚ æˆå‘˜çš„åå­—ã€‚ 1æ³¨æ„ å±æ€§æè¿°ç¬¦ä¸ä¼šåšä¸ºå‚æ•°ä¼ å…¥å±æ€§è£…é¥°å™¨ï¼Œè¿™ä¸TypeScriptæ˜¯å¦‚ä½•åˆå§‹åŒ–å±æ€§è£…é¥°å™¨çš„æœ‰å…³ã€‚ å› ä¸ºç›®å‰æ²¡æœ‰åŠæ³•åœ¨å®šä¹‰ä¸€ä¸ªåŸå‹å¯¹è±¡çš„æˆå‘˜æ—¶æè¿°ä¸€ä¸ªå®ä¾‹å±æ€§ï¼Œå¹¶ä¸”æ²¡åŠæ³•ç›‘è§†æˆ–ä¿®æ”¹ä¸€ä¸ªå±æ€§çš„åˆå§‹åŒ–æ–¹æ³•ã€‚è¿”å›å€¼ä¹Ÿä¼šè¢«å¿½ç•¥ã€‚å› æ­¤ï¼Œå±æ€§æè¿°ç¬¦åªèƒ½ç”¨æ¥ç›‘è§†ç±»ä¸­æ˜¯å¦å£°æ˜äº†æŸä¸ªåå­—çš„å±æ€§ã€‚ å‚æ•°è£…é¥°å™¨å‚æ•°è£…é¥°å™¨è¡¨è¾¾å¼ä¼šåœ¨è¿è¡Œæ—¶å½“ä½œå‡½æ•°è¢«è°ƒç”¨ï¼Œä¼ å…¥ä¸‹åˆ—3ä¸ªå‚æ•°ï¼š å¯¹äºé™æ€æˆå‘˜æ¥è¯´æ˜¯ç±»çš„æ„é€ å‡½æ•°ï¼Œå¯¹äºå®ä¾‹æˆå‘˜æ˜¯ç±»çš„åŸå‹å¯¹è±¡ã€‚ æˆå‘˜çš„åå­—ã€‚ å‚æ•°åœ¨å‡½æ•°å‚æ•°åˆ—è¡¨ä¸­çš„ç´¢å¼•ã€‚ 1æ³¨æ„ å‚æ•°è£…é¥°å™¨åªèƒ½ç”¨æ¥ç›‘è§†ä¸€ä¸ªæ–¹æ³•çš„å‚æ•°æ˜¯å¦è¢«ä¼ å…¥ã€‚ å‚æ•°è£…é¥°å™¨çš„è¿”å›å€¼ä¼šè¢«å¿½ç•¥ã€‚ Mixins ä½¿ç”¨implementså…³é”®è¯ï¼ŒæŠŠç±»å½“åšæ¥å£ã€‚ ä¸ºå°†è¦mixinè¿›æ¥çš„å±æ€§æ–¹æ³•åˆ›å»ºå‡ºå ä½å±æ€§,å‘Šè¯‰ç¼–è¯‘å™¨è¿™äº›æˆå‘˜åœ¨è¿è¡Œæ—¶æ˜¯å¯ç”¨çš„ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253// Disposable Mixinclass Disposable &#123; isDisposed: boolean; dispose() &#123; this.isDisposed = true; &#125;&#125;// Activatable Mixinclass Activatable &#123; isActive: boolean; activate() &#123; this.isActive = true; &#125; deactivate() &#123; this.isActive = false; &#125;&#125;class SmartObject implements Disposable, Activatable &#123; constructor() &#123; setInterval(() =&gt; console.log(this.isActive + \" : \" + this.isDisposed), 500); &#125; interact() &#123; this.activate(); &#125; // Disposable isDisposed: boolean = false; dispose: () =&gt; void; // Activatable isActive: boolean = false; activate: () =&gt; void; deactivate: () =&gt; void;&#125;applyMixins(SmartObject, [Disposable, Activatable]);let smartObj = new SmartObject();setTimeout(() =&gt; smartObj.interact(), 1000);////////////////////////////////////////// In your runtime library somewhere////////////////////////////////////////function applyMixins(derivedCtor: any, baseCtors: any[]) &#123; baseCtors.forEach(baseCtor =&gt; &#123; Object.getOwnPropertyNames(baseCtor.prototype).forEach(name =&gt; &#123; derivedCtor.prototype[name] = baseCtor.prototype[name]; &#125;); &#125;);&#125; ä¸‰æ–œçº¿æŒ‡ä»¤ä¸‰æ–œçº¿æŒ‡ä»¤æ˜¯åŒ…å«å•ä¸ªXMLæ ‡ç­¾çš„å•è¡Œæ³¨é‡Šã€‚æ³¨é‡Šçš„å†…å®¹ä¼šä½œä¸ºç¼–è¯‘å™¨æŒ‡ä»¤ä½¿ç”¨ã€‚ ä¸‰æ–œçº¿æŒ‡ä»¤ä»…å¯æ”¾åœ¨åŒ…å«å®ƒçš„æ–‡ä»¶çš„æœ€é¡¶ç«¯ã€‚ä¸€ä¸ªä¸‰æ–œçº¿æŒ‡ä»¤çš„å‰é¢åªèƒ½å‡ºç°å•è¡Œæˆ–å¤šè¡Œæ³¨é‡Šï¼Œè¿™åŒ…æ‹¬å…¶å®ƒçš„ä¸‰æ–œçº¿æŒ‡ä»¤ã€‚ å¦‚æœå®ƒä»¬å‡ºç°åœ¨ä¸€ä¸ªè¯­å¥æˆ–å£°æ˜ä¹‹åï¼Œé‚£ä¹ˆå®ƒä»¬ä¼šè¢«å½“åšæ™®é€šçš„å•è¡Œæ³¨é‡Šï¼Œå¹¶ä¸”ä¸å…·æœ‰ç‰¹æ®Šçš„æ¶µä¹‰ã€‚ ä½¿ç”¨â€“noResolveç¼–è¯‘é€‰é¡¹ï¼Œä¸‰æ–œçº¿å¼•ç”¨ä¼šè¢«å¿½ç•¥ /// &lt;reference path=â€â€¦â€ /&gt;ï¼šç”¨äºå£°æ˜æ–‡ä»¶é—´çš„ä¾èµ–ï¼Œå‘Šè¯‰ç¼–è¯‘å™¨åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­è¦å¼•å…¥çš„é¢å¤–çš„æ–‡ä»¶ã€‚ /// &lt;reference types=â€â€¦â€ /&gt;ï¼šç”¨äºå£°æ˜å¯¹æŸä¸ªåŒ…çš„ä¾èµ–ï¼Œä»…å½“åœ¨ä½ éœ€è¦å†™ä¸€ä¸ªd.tsæ–‡ä»¶æ—¶æ‰ä½¿ç”¨è¿™ä¸ªæŒ‡ä»¤ã€‚è‹¥è¦åœ¨.tsæ–‡ä»¶å£°æ˜ä¸€ä¸ªå¯¹@typesåŒ…çš„ä¾èµ–ï¼Œä½¿ç”¨â€“typeså‘½ä»¤è¡Œé€‰é¡¹æˆ–åœ¨tsconfig.jsoné‡ŒæŒ‡å®šã€‚ /// &lt;reference no-default-lib=â€trueâ€ /&gt;ï¼šè¿™ä¸ªæŒ‡ä»¤æŠŠä¸€ä¸ªæ–‡ä»¶æ ‡è®°æˆé»˜è®¤åº“ï¼Œå‘Šè¯‰ç¼–è¯‘å™¨åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ä¸è¦åŒ…å«è¿™ä¸ªé»˜è®¤åº“ï¼ˆæ¯”å¦‚ï¼Œlib.d.tsï¼‰ã€‚ è¿™ä¸åœ¨å‘½ä»¤è¡Œä¸Šä½¿ç”¨ â€“noLibç›¸ä¼¼ã€‚è¿˜è¦æ³¨æ„ï¼Œå½“ä¼ é€’äº†â€“skipDefaultLibCheckæ—¶ï¼Œç¼–è¯‘å™¨åªä¼šå¿½ç•¥æ£€æŸ¥å¸¦æœ‰/// &lt;reference no-default-lib=â€trueâ€/&gt;çš„æ–‡ä»¶ã€‚ /// &lt;amd-module name=â€â€¦â€ /&gt;ï¼š é»˜è®¤æƒ…å†µä¸‹ç”Ÿæˆçš„AMDæ¨¡å—éƒ½æ˜¯åŒ¿åçš„ã€‚ ä½†æ˜¯ï¼Œå½“ä¸€äº›å·¥å…·éœ€è¦å¤„ç†ç”Ÿæˆçš„æ¨¡å—æ—¶ä¼šäº§ç”Ÿé—®é¢˜ï¼Œæ¯”å¦‚ r.jsã€‚ amd-moduleæŒ‡ä»¤å…è®¸ç»™ç¼–è¯‘å™¨ä¼ å…¥ä¸€ä¸ªå¯é€‰çš„æ¨¡å—åï¼š amdModule.ts123///&lt;amd-module name='NamedModule'/&gt;export class C &#123;&#125; è¿™ä¼šå°†NamedModuleä¼ å…¥åˆ°AMD defineå‡½æ•°é‡Œï¼š amdModule.js12345678define(\"NamedModule\", [\"require\", \"exports\"], function (require, exports) &#123; var C = (function () &#123; function C() &#123; &#125; return C; &#125;)(); exports.C = C;&#125;);","categories":[{"name":"ç¼–ç¨‹è¯­è¨€","slug":"ç¼–ç¨‹è¯­è¨€","permalink":"http://yoursite.com/categories/ç¼–ç¨‹è¯­è¨€/"},{"name":"TypeScript","slug":"ç¼–ç¨‹è¯­è¨€/TypeScript","permalink":"http://yoursite.com/categories/ç¼–ç¨‹è¯­è¨€/TypeScript/"}],"tags":[{"name":"typescript","slug":"typescript","permalink":"http://yoursite.com/tags/typescript/"}]},{"title":"Hello World","slug":"hello-world","date":"2019-01-25T06:49:11.465Z","updated":"2019-02-12T02:21:46.025Z","comments":true,"path":"2019/01/25/hello-world.html","link":"","permalink":"http://yoursite.com/2019/01/25/hello-world.html","excerpt":"","text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new \"My New Post\" More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment","categories":[{"name":"others","slug":"others","permalink":"http://yoursite.com/categories/others/"}],"tags":[]}]}